console.log("I'm form%c mod-all1.js","color:green");
function insertData(_data) {
	console.log(_data);
	window.postMessage({"insertSql": _data}, '*');
};
define("douyu/com/vcode-v3", ["jquery", "shark/class", "shark/observer"], function(e, t, i) {
	var a = {
		type: null,
		fast: {
			idpre: "gt-captcha-",
			count: 0
		}
	},
		n = t({
			init: function(t) {
				this.config = e.extend(!0, {}, {
					target: null
				}, t), this.render()
			},
			nextId: function() {
				var e = this.config.idpre || a.fast.idpre;
				return e + ++a.fast.count
			},
			getResult: function() {
				return this.config.result
			},
			check: function(t) {
				var i = e.isFunction(t.error) ? t.error : function() {},
					a = function(t) {
						0 === t.error && e.isPlainObject(t.data) ? this.buildAsync(t.data) : i()
					},
					n = function() {
						i()
					};
				t.checkOptions ? this.buildAsync(t.checkOptions) : e.ajax("/member/cpSecurity/check_geetest_status", {
					type: "post",
					data: {
						op_type: t.op_type || ""
					},
					dataType: "json",
					timeout: 5e3,
					success: e.proxy(a, this),
					error: e.proxy(n, this)
				})
			},
			render: function() {
				this.config.$el = this.config.target
			},
			build: function(t) {
				var i = this.nextId(),
					a = this,
					n = e.isFunction(a.config.success) ? a.config.success : function() {},
					s = e.isFunction(a.config.error) ? a.config.error : function() {},
					r = "zh-cn";
				"en" === $SYS.lang && (r = $SYS.lang), this.config.$el.html('<div id="' + i + '"></div>'), this.config.result = null;
				var o = {
					gt: t.gt,
					challenge: t.challenge,
					offline: !t.success,
					new_captcha: !0,
					product: "float",
					lang: r
				};
				return window.initGeetest ? (this.config.gtObj && this.config.gtObj.product && (o = e.extend(!0, o, this.config.gtObj)), void window.initGeetest(o, function(e) {
					e.appendTo("#" + i), e.onSuccess(function() {
						a.config.result = a.plugin.getValidate(), n(a.config.result)
					}), e.onError(function() {
						a.config.result = null
					}), a.plugin = e
				})) : (s(), !1)
			},
			buildAsync: function(e) {
				var t = this,
					i = location.protocol;
				require.use([i + "//static.geetest.com/static/tools/gt.js"], function() {
					t.build(e)
				})
			},
			refresh: function() {
				this.plugin && this.plugin.reset(), this.config.result = null
			},
			show: function() {
				this.config.$el.show()
			},
			hide: function() {
				this.config.$el.hide()
			},
			destroy: function() {
				this.plugin && this.plugin.destroy()
			}
		}),
		s = {
			init: function(t, i, s) {
				var r = e.extend(!0, {
					product: "custom",
					width: "100%",
					area: ".v3-area",
					next_width: "260px",
					bg_color: "transparent"
				}, s || {}),
					o = {
						target: t,
						gtObj: r,
						idpre: i.idpre || "",
						success: i.success ||
						function() {},
						error: i.error ||
						function() {}
					},
					l = new n(o);
				return l.check(i), {
					refresh: function() {
						l.refresh()
					},
					isFast: function() {
						return "fast" === a.type
					},
					getFastResult: function() {
						return l.getResult()
					},
					destroy: function() {
						return l.destroy()
					}
				}
			}
		};
	return s
}), define("douyu/page/room/normal/mod/account-security-qa", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "shark/util/cookie/1.0", "douyu/context", "douyu/page/room/base/api"], function(e, t, i, a, n, s, r) {
	var o = {
		notComplete: "请完成所有问题之后再提交",
		netError: "网络故障，请求失败",
		tipsSuccess: "帐号安全验证成功",
		questionLength: 0,
		answers: [],
		quizId: null,
		submitLock: !1,
		submitUrl: "/member/accountVerify/verifyValidate",
		getSecurityQuiz: "/member/accountVerify/securityQuiz",
		csrfUrl: "/curl/csrfApi/getCsrfCookie",
		verifyType: 3
	},
		l = {
			init: function(t) {
				o.resource = t.resource;
				var i = t.data;
				"string" === e.type(i) ? this.renderEmpty(i) : (o.answers = [], o.quizId = i.quizId, o.questionLength = i.quizContent && i.quizContent.length, this.renderList(i.quizContent || [])), this.getDoms(), this.bindEvent()
			},
			getCSRFCookie: function(t) {
				var i = this,
					a = n.get(s.get("sys.tvk")),
					r = s.get("sys.tn");
				return a ? void(t && t({
					name: r,
					value: a
				})) : void e.ajax({
					url: o.csrfUrl,
					type: "GET",
					dataType: "json",
					success: function(e) {
						0 === e.error && i.getCSRFCookie(t)
					}
				})
			},
			sendAjax: function(t) {
				this.getCSRFCookie(function(i) {
					t.data || (t.data = {}), t.data[i.name] = i.value, e.ajax({
						url: t.url,
						type: "POST",
						dataType: "json",
						data: t.data,
						complete: t.complete || e.noop,
						success: t.success || e.noop,
						error: t.error || e.noop
					})
				})
			},
			getDoms: function() {
				var t = e("#account-security-qa-wrap");
				this.doms = {
					wrap: t,
					preWrap: e("#account-security-wrap"),
					cancelBtn: t.find(".js-account-security-qa-cancel"),
					closeBtn: e(".account-security .aui_close")
				}
			},
			renderEmpty: function(t) {
				var i = e("#account-security-qa-wrap"),
					a = ['<div class="account-security-qa-nodata">', "<p>" + t + "</p>", '<a class="account-security-qa-btn js-account-security-qa-cancel">返回</a>', "</div>"].join("");
				i.html(a)
			},
			renderList: function(t) {
				var i = this.tpl(t),
					a = e("#account-security-qa-wrap");
				a.html(i), e(".account-security-qa-question-wrap").mCustomScrollbar()
			},
			tpl: function(e) {
				var t = i.string.join("{{if data.length}}", '<p class="account-security-qa-info">请完成以下安保问题以验证身份，所有选项为单选：</p>', '<div class="account-security-qa-question-wrap">', "{{each data as $qa $i}}", '<p class="account-security-qa-question">{{$i + 1}}.{{$qa.title}}</p>', "<p>", "{{each $qa.answers as $answer $j}}", '<span class="account-security-qa-answer js-account-security-qa-answer" data-account-question-index={{$i}} data-account-question-id={{$qa.id}} data-account-answer-index={{$j}}>{{$answer}}</span>', "{{/each}}", "</p>", "{{/each}}", "</div>", '<div class="account-security-qa-footer">', '<a class="account-security-qa-btn account-security-qa-submit js-account-security-qa-submit">提交验证</a>', '<a class="account-security-qa-btn account-security-qa-cancel js-account-security-qa-cancel">返回</a>', "</div>", "{{ else }}", '<div class="account-security-qa-nodata">', "<p>亲爱的用户，您的行为过少，请联系客服。</p>", '<a class="account-security-qa-btn js-account-security-qa-cancel">返回</a>', "</div>", "{{/if}}"),
					n = a.compile(t);
				return n({
					data: e
				})
			},
			refreshQuiz: function() {
				var t = this;
				this.sendAjax({
					url: o.getSecurityQuiz,
					success: function(i) {
						0 === +i.error ? t.init({
							data: i.data,
							resource: o.resource
						}) : i.msg && e.dialog.tips_black(i.msg)
					},
					error: function() {
						e.dialog.tips_black(o.netError)
					}
				})
			},
			show: function() {
				var e = this.doms.wrap;
				e.show()
			},
			bindEvent: function() {
				var i = this,
					a = i.doms;
				a.wrap.on("click", ".js-account-security-qa-answer", function(t) {
					var i = e(t.target),
						a = i.data("account-question-id"),
						n = i.data("account-question-index"),
						s = i.data("account-answer-index"),
						r = i.siblings();
					r.removeClass("active"), i.addClass("active"), o.answers[n] = {
						id: a,
						answer: s
					}
				}).on("click", ".js-account-security-qa-submit", function() {
					if (!o.submitLock) {
						var n = a.wrap.find(".js-account-security-qa-answer.active").length;
						if (n !== o.questionLength) return void e.dialog.tips_black(o.notComplete);
						var r = {
							rid: s.get("room.room_id"),
							resource: o.resource,
							quizId: o.quizId,
							code: JSON.stringify(o.answers),
							verify: o.verifyType
						};
						o.submitLock = !0, i.sendAjax({
							url: o.submitUrl,
							data: r,
							success: function(n) {
								o.submitLock = !1, 0 === +n.error ? (e.dialog.tips_black(o.tipsSuccess), a.closeBtn.click(), t.trigger("dys", {
									key: "dys.room.account.security.qa.success",
									type: 2
								})) : 50002 === +n.error ? (i.init({
									data: n.msg,
									resource: o.resource
								}), t.trigger("dys", {
									key: "dys.room.account.security.qa.fail",
									type: 2,
									em: n.msg
								})) : (n.msg && e.dialog.tips_black(n.msg), i.refreshQuiz(), t.trigger("dys", {
									key: "dys.room.account.security.qa.fail",
									type: 2,
									em: n.msg
								}))
							},
							error: function() {
								o.submitLock = !1, e.dialog.tips_black(o.netError), t.trigger("dys", {
									key: "dys.room.account.security.qa.fail",
									type: 2,
									em: o.netError
								})
							}
						}), t.trigger("dys", {
							key: "dys.room.account.security.qa.confirm",
							type: 2
						})
					}
				}), a.cancelBtn.on("click", function() {
					a.wrap.hide(), a.preWrap.show(), t.trigger("dys", {
						key: "dys.room.account.security.qa.back",
						type: 2
					})
				})
			}
		};
	return {
		init: function(e) {
			l.init(e)
		},
		show: function() {
			l.show()
		}
	}
}), define("douyu/com/get-gift-configs", ["jquery", "shark/util/cookie/1.0", "shark/util/storage/1.0", "douyu/context", "douyu/com/exjsonp"], function(e, t, i, a, n) {
	var s = {
		initConfigs: function() {
			this.configs = {
				webconfUrl: a.get("sys.webconfUrl"),
				lastReqTimestamp: 0,
				propCBName: "propGiftConfig",
				giftCBName: "roomGiftConfig",
				giftBatchCBName: "commonConfig",
				loadProgress: [],
				urls: {
					getGiftConfigs: "resource/common/gift/gift_template/" + a.get("room.giftTempId") + ".json",
					getGiftBatchConfigs: "resource/common/gift/common_config_v2.json",
					getPropConfigs: "resource/common/prop_gift_list/prop_gift_config.json",
					getGiftConf: a.get("room.giftHost") + "/lapi/gift/webProp/getPropGift"
				},
				giftConfigArray: [],
				giftConfigsData: null,
				giftBatchConfigsData: null,
				propConfigsData: null,
				allConfigsData: null,
				loadPromise: e.Deferred()
			}
		},
		handleGiftConfig: function() {
			var e, t, i = this.configs,
				a = 0;
			if (i.giftConfigsData = {}, i.giftConfigArray && i.giftConfigArray.length) for (e = i.giftConfigArray.length; e > a; a++) t = i.giftConfigArray[a], t && (i.giftConfigsData[t.id] = t)
		},
		handleGiftBatchConfig: function(t) {
			var i, a, n = (this.configs, e.extend({}, t));
			if (!e.isEmptyObject(n)) for (var s in n) if (i = e.extend({}, n[s])) {
				if (i.batchTemp = {}, i.batchNum = [], i.list) for (var r = 0; r < i.list.length; r++) a = i.list[r], a.num && (i.batchTemp[a.num] = a, i.batchNum.push(a.num));
				i.batchNum.sort(function(e, t) {
					return e - t
				}), n[s] = i
			}
			return n
		},
		reqPropJson: function() {
			var t = this,
				i = t.configs,
				a = e.Deferred();
			return i.propConfigsData ? a.resolve(i.propConfigsData) : (n.load(i.webconfUrl + i.urls.getPropConfigs, i.propCBName, function(e) {
				return i.propConfigsData = e || {}, a.resolve(i.propConfigsData)
			}), a)
		},
		reqGiftJson: function() {
			var t = this,
				i = t.configs,
				s = e.Deferred();
			return void 0 === a.get("room.giftTempId") ? s.reject() : i.giftConfigsData ? s.resolve(i.giftConfigsData) : (n.load(i.webconfUrl + i.urls.getGiftConfigs, i.giftCBName, function(a) {
				i.giftConfigArray = a, t.handleGiftConfig(), n.load(i.webconfUrl + i.urls.getGiftBatchConfigs, i.giftBatchCBName, function(a) {
					if (!e.isEmptyObject(a)) {
						var n = a.batch_conf,
							r = t.handleGiftBatchConfig(n);
						if (!e.isEmptyObject(i.giftConfigsData) && !e.isEmptyObject(r)) {
							i.giftConfigsData.bimg = a.bimg || {};
							for (var o in i.giftConfigsData) {
								var l = r[o],
									c = i.giftConfigsData[o];
								r[o] && (c.isBatchGift = 1, c.culture_content = l.culture_content || "", c.desc_content_1 = l.desc_content_1 || "", c.desc_content_2 = l.desc_content_2 || "", c.list = l.list || [], c.batchTemp = l.batchTemp || {}, c.batchNum = l.batchNum || {})
							}
						}
					}
					return s.resolve(i.giftConfigsData)
				}, function() {
					return s.resolve(i.giftConfigsData)
				})
			}), s)
		},
		reqAllConfig: function() {
			var t = this,
				i = t.configs,
				a = e.Deferred();
			return e.when(t.reqPropJson(), t.reqGiftJson()).done(function(t, n) {
				i.allConfigsData = e.extend(!0, {}, i.propConfigsData, i.giftConfigsData), a.resolve(i.allConfigsData)
			}), a
		},
		reqGiftConfig: function(t) {
			var i = this,
				a = i.configs,
				n = e.Deferred();
			return e.ajax({
				url: a.urls.getGiftConf,
				type: "GET",
				dataType: "json",
				data: {
					gid: t
				}
			}).done(function(e) {
				return e && 0 == e.error ? n.resolve(e.data) : n.reject()
			}).fail(function() {
				return n.reject()
			}), n
		},
		getGiftConfig: function(t) {
			var i = this,
				a = i.configs,
				n = a.allConfigsData[t],
				s = e.Deferred();
			return n ? s.resolve(n) : (i.reqGiftConfig(t).done(function(e) {
				return n = e || {}, e && (a.giftConfigsData[t] = e, a.allConfigsData[t] = e), s.resolve(n)
			}), s)
		},
		load: function() {
			var e = s;
			return e.configs ? "" : e.initConfigs(), e.configs.allConfigsData ? s.configs.loadPromise.resolve(e.configs.allConfigsData) : (e.reqAllConfig().done(function(e) {
				return s.configs.loadPromise.resolve(e)
			}), s.configs.loadPromise)
		},
		getGift: function() {
			var t = s,
				i = e.Deferred();
			return t.configs ? "" : t.initConfigs(), t.reqGiftJson().done(function(e) {
				return i.resolve(e)
			}), i
		},
		getProp: function() {
			var t = s,
				i = e.Deferred();
			return t.configs ? "" : t.initConfigs(), t.reqPropJson().done(function(e) {
				return i.resolve(e)
			}), i
		},
		get: function(t) {
			var i = s,
				a = e.Deferred();
			return i.configs ? "" : i.initConfigs(), i.configs.allConfigsData ? i.getGiftConfig(t).done(function(e) {
				return a.resolve(e)
			}) : i.reqAllConfig().done(function(e) {
				i.getGiftConfig(t).done(function(e) {
					return a.resolve(e)
				})
			}), a
		}
	},
		r = {
			data: null,
			promise: e.Deferred(),
			isLoading: 0,
			load: function() {
				var e = this,
					t = e.promise,
					i = a.get("sys.webconfUrl") + "resource/common/return_coin/web_return_switch.json";
				return e.data ? t.resolve(e.data) : e.isLoading ? t : (e.isLoading = 1, n.load(i, "yuwanReturnSwitch", function(i) {
					i ? (e.data = i, t.resolve(e.data)) : t.reject()
				}, function() {
					t.reject()
				}), t.promise())
			}
		};
	return {
		getGift: s.getGift,
		getProp: s.getProp,
		load: s.load,
		get: s.get,
		loadYwReturnSwitch: function() {
			return r.load()
		}
	}
}), define("douyu/page/room/normal/mod/gift-queue", ["jquery", "douyu/com/get-gift-configs"], function(e, t) {
	var i = function(i) {
			var a = this;
			t.getGift().done(function(t) {
				a.config = e.extend(!0, {
					giftConfig: t
				}, i || {}), a.init(i)
			})
		};
	e.extend(i.prototype, {
		init: function(e) {
			var t, i = this.config.giftConfig;
			this.queue = {}, this.types = {
				all: [],
				yw: [],
				yc: []
			}, this.locks = {}, this.timers = {};
			for (var a in i) t = i[a], this.queue[a] = [], this.types.all.push(a), 1 === t.type ? this.types.yw.push(a) : 2 === t.type && this.types.yc.push(a), this.locks[a] = !1
		},
		push: function(t, i) {
			if (t = String(t), "undefined" !== t && e.isPlainObject(i) && !e.isEmptyObject(i) && i.count && this.queue[t]) {
				for (var a, n = 0 === this.queue[t].length, s = [], r = 0; r < i.count; r++) a = e.extend(!0, {}, i), n && 0 === r && (a.delay = null), s.push(a);
				this.queue[t] = this.queue[t].concat(s)
			}
		},
		next: function(t, i) {
			if (t = String(t), "undefined" !== t && e.isFunction(i) && !this.islock(t)) {
				var a = this.queue[t].shift();
				a && (a.delay ? (this.lock(t), this.timers[t] = setTimeout(function() {
					i(a)
				}, a.delay)) : i(a))
			}
		},
		hasNext: function(e) {
			if (e = String(e), "undefined" !== e && void 0 !== this.queue[e]) return !!this.queue[e].length;
			for (var t in this.queue) if (this.queue[t].length) return !0;
			return !1
		},
		islock: function(e) {
			return this.locks[String(e)]
		},
		lock: function(e) {
			e = String(e), this.queue[e] && (this.locks[e] = !0)
		},
		unlock: function(e) {
			e = String(e), this.queue[e] && (this.locks[e] = !1)
		},
		clear: function(e) {
			var t = this.types.all;
			"yw" === e ? t = this.types.yw : "yc" === e && (t = this.types.yc);
			for (var i = 0, a = t.length; a > i; i++) this.queue[t[i]] = [], this.unlock(t[i])
		}
	});
	var a = new i;
	return a
}), define("douyu/com/room-gift-tmp", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/flash/data/1.0", "shark/util/template/2.0", "douyu/context", "douyu/com/exjsonp", "douyu/page/room/base/api"], function(e, t, i, a, n, s, r, o) {
	var l = {
		isGetData: !1,
		isTplRender: !1,
		reqDefered: null,
		configUrl: s.get("sys.webconfUrl") + "resource/common/gift/gift_template/" + s.get("room.giftTempId") + ".json",
		batchConfigUrl: s.get("sys.webconfUrl") + "resource/common/gift/common_config_v2.json",
		callbackName: "roomGiftConfig",
		batchCallbackName: "commonConfig",
		$giftListWrap: e("#gift-content"),
		cqSwitch: s.get("room.cqSwitch") || 0,
		isFlashInit: !1,
		isConfigInit: !1,
		isPostData: !1,
		isEvtBind: !1,
		configData: [],
		batchConfigData: []
	},
		c = {};
	return e("body").data("cq") || e("body").data("cq", l.cqSwitch), l.reqDefered = e.Deferred(), c = {
		impl: function() {
			l.isEvtBind || (c.bindEvt(), l.isEvtBind = !0)
		},
		init: function() {
			return c.regData(), l.reqDefered.promise()
		},
		regData: function() {
			var e = this;
			return l.isTplRender ? l.reqDefered.resolve() : void 0 === $ROOM.giftTempId ? l.reqDefered.reject() : void r.load(l.configUrl, l.callbackName, function(t) {
				r.load(l.batchConfigUrl, l.batchCallbackName, function(i) {
					var a = t.concat(),
						n = e.handleBatchData(t, i);
					l.batchConfigData = i, l.configData = n, l.isConfigInit = !0, e.postData(), e.handleData(a)
				}, function() {
					l.configData = t, l.isConfigInit = !0, e.postData(), e.handleData(l.configData)
				})
			})
		},
		bindEvt: function() {
			var e = this;
			o.reg("room_data_login", function() {
				l.isFlashInit = !0, e.postData()
			}), o.reg("room_data_req_gift_config", function() {
				c.init().done(function() {
					o.exe("js_gift_config", l.configData), o.exe("js_setConf", {
						business: "batch_gift_config",
						data: l.batchConfigData
					})
				})
			})
		},
		postData: function() {
			l.isConfigInit && l.isFlashInit && !l.isPostData && (o.exe("js_gift_config", l.configData), o.exe("js_setConf", {
				business: "batch_gift_config",
				data: l.batchConfigData
			}), l.isPostData = !0)
		},
		handleData: function(e) {
			var t, i = this,
				a = e.length,
				n = {
					visibleGift: [],
					invisible: {
						normal: [],
						noble: []
					}
				},
				s = 0;
			for (s; a > s; s++) t = e[s], t.isAlipay || (7 > s ? n.visibleGift.push(t) : 1 !== parseInt(t.gt, 10) ? n.invisible.normal.push(t) : n.invisible.noble.push(t));
			return l.isTplRender ? l.reqDefered.resolve() : void i.initGiftTpl(n)
		},
		handleBatchData: function(t, i) {
			var a = this;
			i = i || {};
			var n = a.handleGiftConfig(t, "id"),
				s = i.batch_conf;
			if (!e.isEmptyObject(n) && !e.isEmptyObject(s)) for (var r in n) {
				var o = s[r],
					l = n[r];
				if (!e.isEmptyObject(o)) {
					l.isBatchGift = 1, l.culture_content = o.culture_content || "", l.desc_content_1 = o.desc_content_1 || "", l.desc_content_2 = o.desc_content_2 || "", l.list = o.list || [], l.batchTemp = {}, l.batchNum = [];
					for (var c = 0; c < l.list.length; c++) {
						var d = l.list[c];
						d.num && (l.batchTemp[d.num] = d, l.batchNum.push(d.num))
					}
					l.batchNum.sort(function(e, t) {
						return e - t
					})
				}
			}
			var u = a.getArrayByObject(n);
			return u
		},
		handleGiftConfig: function(e, t) {
			var i, a, n = 0,
				s = {};
			if (e && e.length) for (i = e.length; i > n; n++) a = e[n], a && (s[a[t]] = a);
			return s
		},
		getArrayByObject: function(e) {
			var t = this,
				i = [];
			for (var a in e) i.push(e[a]);
			var n = i.sort(t.compare("index"));
			return n
		},
		compare: function(e) {
			return function(t, i) {
				var a = t[e],
					n = i[e];
				return a - n
			}
		},
		initGiftTpl: function(e) {
			var a, r, o;
			a = i.string.join('<div class="g-list clearfix" data-slider="slider">', '<div class="gift-info-panel" data-type="gift-info-panel">', '<div class="gift-info-panel-cont clearfix" data-type="gift-info-panel-cont"></div>', '<i class="gift-info-panel-fill"></i>', '<i class="gift-info-panel-arrow1"></i>', '<i class="gift-info-panel-arrow2"></i>', "</div>", '<ul class="clearfix fl" data-slider="list">', "{{ each initGift as item }}", '<li class="gift-item" data-type="gift" data-noble="{{item.gt}}" data-send="{{item.type}}" data-giftid="{{item.id}}" data-giftname="{{item.name}}" data-name="{{item.price_name}}" data-gifticon="{{item.himg}}" data-exp="{{item.exp}}" data-devote="{{item.devote}}" data-intro="{{item.intro}}" data-explain="{{item.desc}}" data-bi="{{item.batch_interval}}" data-intimate="{{item.devote}}" data-returnyw="{{item.ry}}" data-face="{{ item.face_effect }}" data-price="{{ item.pc }}">', '<img class="g-img" src="{{ item.gift_pic }}">', "{{ if (item.gift_active_icon_style && item.gift_active_icon_style > 0 && item.gift_web_active_text) }}", '<div class="icon--conner-mark icon--conner-mark-s{{ item.gift_active_icon_style}}">', "<span>{{ item.gift_web_active_text}}</span>", "</div>", "{{ else }}", "{{ if ((!item.gift_active_icon_style || item.gift_active_icon_style == 0) && (item.gt == 1)) }}", '<div class="icon--conner-mark icon--conner-mark-s1">', "<span>贵</span>", "</div>", "{{ else if ((!item.gift_active_icon_style || item.gift_active_icon_style == 0) && (item.gt == 2)) }}", '<div class="icon--conner-mark icon--conner-mark-s1">', "<span>周</span>", "</div>", "{{ /if }}", "{{ /if }}", "</li>", "{{ /each }}", "</ul>", '<div class="item-expand-panel expand-gift-panel">', '<a class="expand-gift-panel-close" href="javascript:;">×</a>', '<div class="item-expand-tran-outer">', '<div class="item-expand-tran-inner">', "</div>", "</div>", "{{ if popInitGift.length }}", '<div class="gift--box">', '<div class="box--title">', "<strong>普通礼物</strong>", "<span>", "拥有数：<em>{{ popInitGift.length }}</em>", "</span>", "</div>", '<div class="box--content">', '<ul class="item-expand-cont clearfix" data-slider="list">', "{{ each popInitGift as item }}", '<li class="gift-item" data-type="gift" data-noble="{{ item.gt }}" data-send="{{ item.type }}" data-giftid="{{ item.id }}" data-giftname="{{ item.name }}" data-name="{{ item.price_name }}" data-gifticon="{{ item.himg }}" data-exp="{{ item.exp }}" data-devote="{{ item.devote }}" data-intro="{{ item.intro }}" data-explain="{{ item.desc }}" data-bi="{{ item.batch_interval }}" data-intimate="{{ item.devote }}" data-returnyw="{{ item.ry }}" data-face="{{ item.face_effect }}" data-price="{{ item.pc }}">', '<img class="g-img" src="{{ item.gift_pic }}" />', "{{ if (item.gift_active_icon_style && item.gift_active_icon_style > 0 && item.gift_web_active_text) }}", '<div class="icon--conner-mark icon--conner-mark-s{{ item.gift_active_icon_style || ""}}">', "<span>{{ item.gift_web_active_text }}</span>", "</div>", "{{ else if ((!item.gift_active_icon_style || item.gift_active_icon_style == 0) && item.gt == 2) }}", '<div class="icon--conner-mark icon--conner-mark-s1">', "<span>周</span>", "</div>", "{{ /if }}", "</li>", "{{ /each }}", "</ul>", "</div>", "</div>", "{{ /if }}", "{{ if nobleGift.length }}", '<div class="gift--box gift--noble-box">', '<div class="box--title">', "<strong>贵族礼物</strong>", "<span>", "拥有数：<em>{{ nobleGift.length }}</em>", "</span>", "</div>", '<div class="box--content">', '<ul class="item-expand-cont clearfix" data-slider="list">', "{{ each nobleGift as item }}", '<li class="gift-item" data-type="gift" data-noble="{{ item.gt }}" data-send="{{ item.type }}" data-giftid="{{ item.id }}" data-giftname="{{ item.name }}" data-name="{{ item.price_name }}" data-gifticon="{{ item.himg }}" data-exp="{{ item.exp }}" data-devote="{{ item.devote }}" data-intro="{{ item.intro }}" data-explain="{{ item.desc }}" data-bi="{{ item.batch_interval }}" data-intimate="{{ item.devote }}" data-returnyw="{{ item.ry }}" data-face="{{ item.face_effect }}" data-price="{{ item.pc }}">', '<img class="g-img" src="{{ item.gift_pic }}" />', "{{ if (item.gift_active_icon_style && item.gift_active_icon_style > 0 && item.gift_web_active_text) }}", '<div class="icon--conner-mark icon--conner-mark-s{{ item.gift_active_icon_style || ""}}">', "<span>{{ item.gift_web_active_text}}</span>", "</div>", "{{ else }}", '<div class="icon--conner-mark icon--conner-mark-s1">', "<span>贵</span>", "</div>", "{{ /if }}", "</li>", "{{ /each }}", "</ul>", "</div>", "</div>", "{{ /if }}", "</div>", "{{ if popInitGift.length || nobleGift.length}}", '<div class="more-gift-btn fl"></div>', "{{ /if }}", "{{ if (isOpenCq == 1) }}", '<div class="gift-item" data-type="cq" data-point-2="0" data-send="0" data-giftid="cq"', 'data-giftname="酬勤" data-name="15/30/50 鱼翅" data-gifticon="' + $SYS.web_url + 'app/douyu/res/page/room-normal/gift/chouqin_90.gif" data-exp="0"', 'data-devote="0" data-intro="0"', 'data-explain="可获得鱼丸奖励/可获得贡献值奖励/', '可获得30天酬勤头衔">', '<img class="g-img" src="' + $SYS.web_url + 'app/douyu/res/page/room-normal/gift/chouqin_48.png" />', "</div>", "{{ /if }}", "</div>"), r = n.compile(a), o = r({
				initGift: e.visibleGift || [],
				popInitGift: e.invisible.normal || [],
				nobleGift: e.invisible.noble || [],
				isOpenCq: l.cqSwitch
			}), l.$giftListWrap.html(o), l.isTplRender = !0, l.reqDefered.resolve(), s.get("room.owner_uid") == s.get("sys.uid") && l.$giftListWrap.find('[data-slider="slider"]').hide(), t.trigger("mod.normal.gift.expand")
		}
	}, c.impl(), {
		render: c.init
	}
}), define("douyu/page/room/normal/mod/account-security", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "shark/util/cookie/1.0", "douyu/context", "douyu/com/vcode-v3", "douyu/page/room/base/api", "douyu/page/room/normal/mod/account-security-qa"], function(e, t, i, a, n, s, r, o, l) {
	var c = {
		getInfoUrl: "/member/accountVerify/verifyInfo",
		smsUrl: "/member/accountVerify/sendPhoneCaptcha",
		emailUrl: "/member/accountVerify/sendEmail",
		submitUrl: "/member/accountVerify/verifyValidate",
		csrfUrl: "/curl/csrfApi/getCsrfCookie",
		type: 0,
		pre: "account-security",
		v3Instance: null,
		lock: {},
		timer: null,
		time: 60,
		verifyType: 1
	},
		d = {
			success: "帐号安全验证成功",
			error: "网络故障，请求失败",
			v3Error: "极验验证码加载失败，请稍后重试",
			v3Empty: "请点击按钮进行验证",
			codeEmpty: "请输入验证码"
		},
		u = {
			init: function(e) {
				this.option = e || {}, this.resouce = e.dys_type, this.getInfoReq()
			},
			getDoms: function() {
				var t = e("#account-security-wrap");
				this.doms = {
					wrap: t,
					phoneInput: t.find(".js-account-security-input"),
					smsBtn: t.find(".js-account-security-sms"),
					submitBtn: t.find(".js-account-security-button"),
					v3Box: t.find(".account-security-captcha"),
					selectWrap: t.find(".js-account-security-select"),
					selectValue: t.find(".js-account-security-select-value"),
					selectList: t.find(".js-account-security-select-list")
				}
			},
			getCSRFCookie: function(t) {
				var i = this,
					a = n.get(s.get("sys.tvk")),
					r = s.get("sys.tn");
				return a ? void(t && t({
					name: r,
					value: a
				})) : void e.ajax({
					url: c.csrfUrl,
					type: "GET",
					dataType: "json",
					success: function(e) {
						0 === e.error && i.getCSRFCookie(t)
					}
				})
			},
			sendAjax: function(t) {
				this.getCSRFCookie(function(i) {
					t.data || (t.data = {}), t.data[i.name] = i.value, e.ajax({
						url: t.url,
						type: "POST",
						dataType: "json",
						data: t.data,
						complete: t.complete || e.noop,
						success: t.success || e.noop,
						error: t.error || e.noop
					})
				})
			},
			getInfoReq: function() {
				var t = this,
					i = {
						rid: s.get("room.room_id")
					};
				t.sendAjax({
					url: c.getInfoUrl,
					data: i,
					success: function(i) {
						if (0 === +i.error) {
							if (c.type = +i.data.validate_type, 4 === c.type) return;
							t.show(i.data)
						} else i.msg && e.dialog.tips_black(i.msg)
					},
					error: function() {
						e.dialog.tips_black(d.error)
					}
				})
			},
			show: function(i) {
				if (!e("." + c.pre).length) {
					var a = this,
						n = a.tpl(i);
					o.exe("js_exitFullScreen"), e.dialog({
						skin: c.pre,
						content: n,
						title: "",
						close: function() {
							a.v3Destroy()
						}
					}), a.getDoms(), a.v3Init(i.validate_str || {}), i.securityQuiz && 2 === +i.validate_type && l.init({
						resource: a.resouce,
						data: i.securityQuiz || {}
					}), a.bindEvt(), t.trigger("dys", {
						key: "dys.room.account.security.show.type" + c.type,
						resouce: a.resouce
					})
				}
			},
			hide: function() {
				e("." + c.pre).length && (e("." + c.pre).hide().remove(), this.v3Destroy())
			},
			tpl: function(e) {
				var t = +e.validate_type || 1,
					n = 0 === e.is_foreign ? "短信验证" : "语音验证",
					s = "",
					r = "";
				switch (t) {
				case 1:
					s = i.string.join('<div class="account-security-row">', '<div class="account-security-area"></div>', '<div class="account-security-captcha"></div>', "</div>"), r = "极验验证";
					break;
				case 2:
					s = i.string.join('<div class="account-security-row">', '<div class="account-security-area"></div>', '<div class="account-security-captcha type-sms"></div>', "</div>", '<div class="account-security-row">', '<div class="account-security-box clearfix">', '<input type="text" class="account-security-input fl js-account-security-input" maxlength="6" placeholder="请输入验证码"/>', '<button class="account-security-sms button fl js-account-security-sms">' + n + "</button>", "</div>", "</div>", "{{if data.securityQuiz}}", '<p class="account-security-other-wrap"><a class="account-security-other js-account-security-other" href="javascript:;">其他验证方式</a></p>', "{{/if}}", '<button class="account-security-submit button js-account-security-button">提交验证</button>'), r = e.email ? i.string.join('<div class="account-security-select js-account-security-select">', '<span class="account-security-select-arrow"></span>', '<div class="account-security-select-value js-account-security-select-value" title="">手机验证（' + (e.phone || "") + "）</div>", '<ul class="account-security-select-list js-account-security-select-list">', '<li class="account-security-select-item js-account-security-select-item" title="' + e.phone + '" data-verify-type="1" data-select-type=' + n + ">手机验证（" + (e.phone || "") + "）</li>", '<li class="account-security-select-item js-account-security-select-item" title="' + e.email + '" data-verify-type="2" data-select-type="发送验证码">邮箱验证（' + (e.email || "") + "）</li>", "</ul>", "</div>") : "手机验证（" + (e.phone || "") + "）", this.dysIsForeign = 0 === e.is_foreign ? "2" : "1";
					break;
				case 3:
					s = i.string.join('<div class="account-security-row account-security-666">', '请编辑短信： <span class="account-security-f70 account-security-text">{{ data.code }}</span>', '发送到： <span class="account-security-f70">{{ data.douyu_phone }}</span>', "</div>", '<div class="account-security-row">', '<span class="account-security-999 account-security-tip">', "短信费用一般为0.1元/条，全部由运营商收取", "</span>", "</div>", '<button class="account-security-submit account-security-next button js-account-security-button">我已发送短信，下一步</button>'), r = "手机验证（" + (e.phone || "") + "）"
				}
				var o = a.compile(s),
					l = o({
						data: e
					});
				return ['<div class="account-security-wrap" id="account-security-wrap">', '<div class="account-security-content">', '<div class="account-security-main">', '<div class="account-security-row">', '<span class="account-security-type">验证方式：</span>', '<span class="account-security-666">', r, "</span>", "</div>", l, "</div>", "</div>", "</div>", '<div class="account-security-qa-wrap" id="account-security-qa-wrap"></div>'].join("")
			},
			v3Init: function(e) {
				var t = this,
					i = e.success && e || null,
					a = this.doms.v3Box;
				!c.v3Instance && a.length && (c.v3Instance = r.init(a, {
					idpre: c.pre,
					checkOptions: i,
					success: function(e) {
						1 === c.type && t.sendSubmitReq(e)
					},
					error: function() {
						t.v3Error(a)
					}
				}, {
					area: ".account-security-area"
				}))
			},
			v3Error: function(e) {
				e.text(d.v3Error)
			},
			v3refresh: function() {
				c.v3Instance && c.v3Instance.refresh()
			},
			v3getResult: function() {
				return c.v3Instance ? c.v3Instance.getFastResult() : null
			},
			v3Destroy: function() {
				c.v3Instance && c.v3Instance.destroy(), c.v3Instance = null
			},
			countDown: function(e, t, i) {
				var a = this;
				i >= 0 ? (e.attr("disabled", !0).text(t + "(" + i + ")").addClass("gray"), i--, clearTimeout(c.timer), c.timer = setTimeout(function() {
					a.countDown(e, t, i)
				}, 1e3)) : a.clearSmsTimer(e)
			},
			clearSmsTimer: function(e) {
				clearTimeout(c.timer), e.attr("disabled", !1).text("重新获取").removeClass("gray")
			},
			restore: function() {
				var e = this;
				switch (c.type) {
				case 1:
					e.v3refresh();
					break;
				case 2:
					e.v3refresh(), e.clearSmsTimer(e.doms.smsBtn)
				}
			},
			sendSmsReq: function(t, i) {
				var a = this,
					n = t.text(),
					s = 1 === +c.verifyType ? c.smsUrl : c.emailUrl;
				c.lock.smsCode = !0, a.sendAjax({
					url: s,
					data: i,
					complete: function() {
						c.lock.smsCode = !1
					},
					success: function(i) {
						i && 0 === +i.error ? a.countDown(t, n, c.time) : (a.restore(), i.msg && e.dialog.tips_black(i.msg))
					},
					error: function() {
						a.restore(), e.dialog.tips_black(d.error)
					}
				})
			},
			sendSubmitReq: function(i) {
				var a = u;
				i.rid = s.get("room.room_id"), i.resource = a.resouce, c.lock.submit = !0, a.sendAjax({
					url: c.submitUrl,
					data: i,
					complete: function() {
						c.lock.submit = !1
					},
					success: function(i) {
						if (i && 0 === +i.error) {
							e.dialog.tips_black(d.success), a.hide();
							var n = {
								key: "dys.room.account.security.submit" + c.type + ".succ",
								resouce: a.resouce
							};
							2 === c.type && (n.verify_type = a.getVerifyType()), t.trigger("dys", n)
						} else {
							i.msg && e.dialog.tips_black(i.msg), a.restore();
							var n = {
								key: "dys.room.account.security.submit" + c.type + ".fail",
								resouce: a.resouce
							};
							2 === c.type && (n.verify_type = a.getVerifyType(), n.em = i.msg), t.trigger("dys", n)
						}
					},
					error: function() {
						e.dialog.tips_black(d.error), a.restore();
						var i = {
							key: "dys.room.account.security.submit" + c.type + ".fail",
							resouce: a.resouce
						};
						2 === c.type && (i.verify_type = a.getVerifyType(), i.em = d.error), t.trigger("dys", i)
					}
				})
			},
			getVerifyType: function() {
				return 1 === +c.verifyType ? this.dysIsForeign : 3
			},
			bindEvt: function() {
				var i = this,
					a = i.doms;
				a.wrap.on("click.get.sms.code", ".js-account-security-sms", function() {
					var a = i.v3getResult();
					if (!a) return void e.dialog.tips_black(d.v3Empty);
					var n = e(this);
					c.lock.smsCode || n.hasClass("gray") || (i.sendSmsReq(n, a), t.trigger("dys", {
						key: "dys.room.account.security.getsms",
						verify_type: i.getVerifyType(),
						resouce: i.resouce
					}))
				}).on("click.account.security.submit", ".js-account-security-button", function() {
					if (!c.lock.submit) {
						var n = {};
						if (2 === c.type) {
							if (!i.v3getResult()) return void e.dialog.tips_black(d.v3Empty);
							if (n.code = a.phoneInput.val(), !n.code) return void e.dialog.tips_black(d.codeEmpty);
							n.verify = c.verifyType
						}
						i.sendSubmitReq(n);
						var s = {
							key: "dys.room.account.security.submit" + c.type + ".click",
							resouce: i.resouce
						};
						2 === c.type && (s.verify_type = i.getVerifyType()), t.trigger("dys", s)
					}
				}).on("click.account.security.select", ".js-account-security-select", function() {
					a.selectList.toggle(), a.selectWrap.toggleClass("active")
				}).on("click.account.security.select", function(t) {
					e(t.target).closest(".js-account-security-select").length || (a.selectList.hide(), a.selectWrap.removeClass("active"))
				}).on("click.account.security.select", ".js-account-security-select-item", function(t) {
					var i = e(t.target),
						n = i.data("select-type"),
						s = i.data("verify-type");
					a.selectValue.text(i.text()), a.selectValue.attr("title", i.text()), a.smsBtn.text(n), c.verifyType = s
				}).on("click.account.security.select", ".js-account-security-other", function() {
					a.wrap.hide(), l.show(), t.trigger("dys", {
						key: "dys.room.account.security.qa.other",
						resouce: i.resouce
					})
				})
			}
		};
	return {
		init: function(e) {
			u.init(e)
		}
	}
}), define("douyu/page/room/normal/mod/gift", ["jquery", "shark/class", "shark/observer", "shark/util/cookie/1.0", "shark/util/flash/data/1.0", "shark/util/template/1.0", "shark/util/date/1.0/date", "douyu/context", "douyu/com/sign", "douyu/com/user", "douyu/com/exjsonp", "douyu/com/get-gift-configs", "douyu/page/room/base/api", "douyu/page/room/normal/mod/gift-queue", "shark/util/storage/1.0", "douyu/com/room-gift-tmp", "douyu/page/room/normal/mod/account-security"], function(e, t, i, a, n, s, r, o, l, c, d, u, f, p, m, h, g) {
	var v = "",
		y = "",
		b = {};
	i.on("mod.room.spring.activity.stage", function(e) {
		y = e
	}), i.on("mod.room.spring.gift.config", function(e) {
		v = e.giftId
	}), i.on("giftReturnPropBagConfig", function(e) {
		b = e || {}
	});
	var k, w, _ = function(e) {
			var t = e || 0,
				i = 1e4,
				a = 1e8,
				n = Math.pow(10, 2);
			return t >= a ? Math.floor(t / a * n) / n + "亿" : t >= i ? Math.floor(t / i * n) / n + "万" : t > 0 ? Math.floor(t * n) / n : t
		},
		x = {
			CGIFT: {},
			SENDDATA: {},
			ERR: {
				207: "参数错误",
				218: "请先绑定手机！",
				284: "请稍后尝试。。",
				357: "没有找到礼物",
				291: "请稍后尝试。"
			},
			batchSwitch: !0,
			timer: null,
			panelWidth: 0,
			delay: 100,
			currentGiftId: null,
			prevGiftId: null,
			currentNumber: 0,
			slider: {
				prevActionWidth: 0,
				padding: 400,
				offset: 0,
				sliderWidth: 0,
				itemLength: 0,
				itemWidth: 0,
				listWidth: 0,
				visibleLength: 0,
				currentIndex: 0,
				delay: 300
			},
			nobleInfo: {
				load: !1,
				nl: 0
			},
			giftBatterData: {},
			giftConfigData: {},
			propConfigData: {},
			ywReturnSwitch: 0,
			lowYcConfig: {
				loadingImg: o.get("sys.web_url") + "app/douyu/res/page/room-normal/gift/qrcode-loading.gif?v=20180723",
				getCodeUrl: o.get("sys.pay_site_host") + "/m/gold/getQrCode",
				isShortGold: !1,
				willSendGift: "",
				willSendGiftNum: 0,
				willSendGiftName: "",
				giftId: "",
				willSendGold: 0,
				sendFlag: !0
			}
		},
		C = null,
		T = null,
		S = {
			data: null,
			promise: e.Deferred(),
			isLoading: 0,
			load: function() {
				var e = this,
					t = e.promise,
					i = o.get("sys.webconfUrl") + "resource/common/return_coin/web_return_switch.json";
				return e.data ? t.resolve(e.data) : e.isLoading ? t : (e.isLoading = 1, d.load(i, "yuwanReturnSwitch", function(i) {
					i ? (e.data = i, t.resolve(e.data)) : t.reject()
				}, function() {
					t.reject()
				}), t.promise())
			}
		};
	S.load().then(function(e) {
		var t = e || {};
		1 === t.show_switch && (x.ywReturnSwitch = 1)
	}), w = t({
		getDoms: function() {
			var t = e("#gift-content");
			this.doms = {
				body: e("body"),
				giftContent: t,
				actions: e("#js-stats-and-actions"),
				giftSlider: t.find('[data-slider="slider"]'),
				giftSliderPrev: t.find('[data-slider="prev"]'),
				giftSliderNext: t.find('[data-slider="next"]'),
				giftSliderCont: t.find('[data-slider="cont"]'),
				giftSliderList: t.find('[data-slider="list"]'),
				giftInfoPanel: t.find('[data-type="gift-info-panel"]'),
				giftInfoCont: t.find('[data-type="gift-info-panel-cont"]')
			}
		},
		init: function() {
			return this.getDoms(), this.config = {
				giftConfigData: {}
			}, o.get("sys.uid") == o.get("room.owner_uid") ? void this.doms.giftContent.hide() : (this.addEvent(), void this.giftRecharge())
		},
		checkUser: function(e) {
			if (c.check()) return !0;
			switch (e) {
			case "cq":
				c.show("login", {
					source: "click_gift_chouqin"
				});
				break;
			case "gift":
				c.show("login", {
					source: "click_gift_send"
				});
				break;
			case "batch-send":
				c.show("login", {
					source: "click_gift_batch_send"
				});
				break;
			default:
				c.show("login")
			}
			return !1
		},
		CFMGiftcheck: function(t) {
			if ($ROOM.cfmGiftList && !([].concat($ROOM.cfmGiftList).indexOf(t) < 0) && 1 === +$ROOM.show_status) {
				var i = {
					room_id: $ROOM.room_id,
					gift_id: t
				};
				e.ajax("/special/tencentieg/hasCfmGameEffect", {
					type: "post",
					dataType: "json",
					data: i,
					success: function(t) {
						0 === +t.error && t.data.effect_tip && e.dialog.tips_black(t.data.effect_tip, 2)
					},
					error: function() {
						e.dialog.tips_black("查询失败", 1.5)
					}
				})
			}
		},
		addEvent: function() {
			var t = this,
				a = this.doms;
			a.giftContent.on({
				click: function() {
					var a = e(this),
						n = a.data("type"),
						s = a.data("noble") || 0;
					if ("gift" === n && i.trigger("dys", {
						key: "dys.room.gift.click",
						gfid: a.data("giftid")
					}), "cq" === n && i.trigger("dys", {
						key: "dys.room.gift.chouqin.click"
					}), !t.checkUser(e(this).data("type"))) return !1;
					x.nobleInfo.nl;
					return !x.nobleInfo.load || 1 !== s || 0 != x.nobleInfo.nl && 0 != x.nobleInfo.noble_gift ? void("gift" === n && t.giftSend({
						target: a,
						number: 1,
						batch: 0
					})) : void t.showNobleError()
				},
				mouseenter: function() {
					var i = e(this),
						n = (i.data("send"), parseFloat(i.data("name")), e("#gift-content")),
						s = n.find('[data-type="gift-info-panel"]');
					x.panelWidth = s.outerWidth();
					var r = n.find(".firstpay-warp"),
						o = 0;
					clearTimeout(x.timer), x.currentGiftId = i.data("giftid"), s.css("width", "auto"), x.prevGiftId !== x.currentGiftId && u.getGift().done(function(e) {
						x.giftConfigData = e, t.config.giftConfigData = e, t.updateGiftInfo()
					}), r && r.length && !r.is(":hidden") && (o = r.outerWidth(!0)), x.panelWidth = s.outerWidth(), s.find(".icon--conner-mark").length && (x.panelWidth += 12), x.panelWidth < 388 ? x.panelWidth = 388 : "", x.panelWidth > 500 ? x.panelWidth = 500 : "", s.stop(!0, !0).removeClass("out");
					var l = a.giftContent.offset(),
						c = i.offset(),
						d = c.left - (l.left + o) - x.panelWidth / 2 + i.width() / 2 + 4,
						f = c.top - l.top - i.height() - 5;
					return s.css("width", x.panelWidth), s.animate({
						left: d,
						bottom: -f
					}, x.delay, function() {
						s.show()
					}), t.CFMGiftcheck(i.data("giftid")), !1
				},
				mouseleave: function() {
					var t = e("#gift-content"),
						i = t.find('[data-type="gift-info-panel"]');
					return clearTimeout(x.timer), x.timer = setTimeout(function() {
						i.stop(!0, !0).hide().addClass("out")
					}, x.delay), !1
				}
			}, "[data-giftid]"), a.giftContent.on("click", '[data-type="toggle"]', function(t) {
				var a = e("#gift-content"),
					n = a.find('[data-type="gift-info-panel"]');
				n.find('[data-type="gift-info-panel-form"]').stop(!0, !0).slideToggle(200), e(this).toggleClass("slideDown"), i.trigger("dys", {
					key: "dys.room.giftSend.multi.send.show",
					gfid: x.currentGiftId
				}), t.stopPropagation()
			}).on({
				mouseenter: function() {
					clearTimeout(x.timer)
				},
				mouseleave: function() {
					var t = e("#gift-content"),
						i = t.find('[data-type="gift-info-panel"]');
					clearTimeout(x.timer), x.timer = setTimeout(function() {
						i.stop(!0, !0).hide().addClass("out")
					}, x.delay + 400)
				}
			}, '[data-type="gift-info-panel"]'), a.giftContent.on("click", "[data-gift-number]", function(t) {
				t.stopPropagation(), e(this).addClass("cur").siblings().removeClass("cur"), x.currentNumber = e(this).data("gift-number"), x.batchSwitch && e('[data-type="batch-send"]').removeClass("disabled"), e(".JS_batchgiftinput").addClass("hide"), e('.JS_batchgiftinput[data-gift-number="' + x.currentNumber + '"]').removeClass("hide"), e(".gift-form-userdefult input").val(x.currentNumber)
			}).on("focus", ".gift-form-userdefult", function() {
				e(this).addClass("cur").siblings().removeClass("cur");
				var i = e(this).find("input").val() || 0;
				t.checkNum(i) ? (x.currentNumber = i, e('[data-type="batch-send"]').removeClass("disabled")) : (x.currentNumber = 0, e('[data-type="batch-send"]').addClass("disabled")), e(".JS_batchgiftinput").addClass("hide"), e('.JS_batchgiftinput[data-gift-number="' + x.currentNumber + '"]').removeClass("hide")
			}).on("keyup blur", ".gift-form-userdefult", function() {
				e(this).addClass("cur").siblings().removeClass("cur");
				var i = e(this).find("input").val() || 0;
				t.checkNum(i) ? (x.currentNumber = i, e('[data-type="batch-send"]').removeClass("disabled")) : (x.currentNumber = 0, e('[data-type="batch-send"]').addClass("disabled")), e(".JS_batchgiftinput").addClass("hide"), e('.JS_batchgiftinput[data-gift-number="' + x.currentNumber + '"]').removeClass("hide")
			}).on("click", '[data-type="batch-send"]', function() {
				if (e(this).hasClass("disabled") || !x.batchSwitch || !t.checkUser(e(this).data("type"))) return !1;
				var i = a.giftContent.find('[data-giftid="' + x.currentGiftId + '"]'),
					n = i.data("noble") || 0;
				return 1 !== n || x.nobleInfo.nl ? void t.giftSend({
					target: i,
					number: x.currentNumber || 0,
					batch: 1
				}) : (a.giftInfoPanel.stop(!0, !0).hide().addClass("out"), void t.showNobleError())
			});
			var s = x.lowYcConfig;
			f.reg("room_data_handler", function(e) {
				var a = n.decode(e).too(),
					r = 0,
					o = 0,
					l = 0,
					c = 0,
					d = +s.willSendGold;
				"rechargenotify" == a.type && (t.lowYCDialog && (t.lowYCDialog.hide(), t.isNoYCFloatHide = !1), r = a.bl || 0, o = t.formatDecimals(r / 100, 2), l = a.rm || 0, c = t.formatDecimals(l / 100, 2), i.trigger("mod.userinfo.change", {
					current: {
						gold: o
					}
				}), s.isShortGold && d && c >= d ? t.remindYCSuccess(a) : t.remindSimpleSuc(a))
			})
		},
		checkNum: function(e) {
			var t = /^[1-9]\d*$/;
			return t.test(e) ? !(1 > e || e > 9999) : !1
		},
		giftSend: function(t) {
			if (o.get("sys.uid") == o.get("room.owner_uid")) return void e.dialog.tips_black("不能给自己赠送礼物");
			var a = this,
				n = e(t.target),
				s = n.data("giftid"),
				r = n.data("send"),
				l = n.data("exp"),
				c = n.data("face"),
				d = {
					gid: s,
					send: r,
					exp: l,
					count: 1,
					sdn: t.number,
					sid: o.get("sys.uid"),
					did: o.get("room.owner_uid"),
					rid: o.get("room.room_id"),
					batch: t.batch,
					faceEffect: c,
					num: 1
				},
				u = "full" === i.fire("mod.video.state.get") ? 2 : 1,
				f = x.giftConfigData[s];
			x.CGIFT.current = s, (1 === t.batch || p.hasNext(s)) && (d.delay = n.data("bi") || 0), p.push(s, d), 1 == r && p.next(s, function(e) {
				a.sendYW(e)
			}), 2 == r && p.next(s, function(e) {
				a.sendYC(e)
			}), 1 == t.batch && i.trigger("dys", {
				key: "dys.room.giftSend.multi.send",
				gfid: t.gid,
				yc: f && f.pc || "",
				num: t.number,
				name: t.target.data("giftname"),
				src_type: u
			})
		},
		handleFaceEffect: function(t, i) {
			var a = o.get("sys.nickname"),
				n = o.get("sys.uid"),
				s = "faceEffectNoRemind_" + a + "_" + n;
			if (m.get(s)) i(t.gid);
			else {
				var r = ['<div class="face-effect">', '    <div class="face-effect-header"></div>', '    <div class="face-effect-close JS_faceclose"></div>', '    <div class="face-effect-dialog">', '        <div class="face-effect-content">', '            <div class="face-effect-txt1">主播非手机颜值开播，无法匹配礼物脸部特效</div>', '            <div class="face-effect-txt2">特效不重要！我的爱依然浓烈~</div>', '            <div class="face-effect-bottom">', '                <div class="face-effect-remind">', '                    <div class="face-effect-checkbox JS_facenomind"></div>', '                    <div class="face-effect-noremind">不再提示</div>', "                </div>", '                <div class="face-effect-send JS_facesend" data-gid="' + t.gid + '">我要赠送礼物</div>', "            </div>", "        </div>", "    </div>", "</div>"].join("");
				e(".face-effect").remove(), e("body").append(r), e(".JS_facesend").on("click", function(t) {
					var a = e(t.target),
						n = a.data("gid");
					i(n), e(".face-effect").addClass("hide");
					var r = e(".JS_facenomind");
					r.hasClass("face-effect-nochecked") || m.get(s) || m.set(s, 1)
				}), e(".JS_facenomind").on("click", function(t) {
					e(".JS_facenomind").toggleClass("face-effect-nochecked")
				}), e(".JS_faceclose").on("click", function() {
					e(".face-effect").addClass("hide")
				})
			}
		},
		sendYW: function(e) {
			var t = n.encode([{
				name: "type",
				value: "dn_s_gf"
			}, {
				name: "gfid",
				value: e.gid
			}, {
				name: "num",
				value: e.sdn || e.num
			}]);
			x.CGIFT[e.gid] = {
				type: "dn_s_gf",
				gid: e.gid,
				sid: e.sid,
				did: e.did,
				rid: e.rid,
				exp: e.exp,
				dy: o.get("room.device_id"),
				num: e.num,
				sdn: e.sdn
			}, f.exe("js_giveGift", t)
		},
		sendYC: function(t) {
			var n, s, r, l, c = this,
				d = "full" === i.fire("mod.video.state.get") ? 2 : 1,
				u = x.giftConfigData[t.gid];
			s = function() {
				e.dialog.tips_black("赠送礼物失败！", 1.5), p.clear(), i.trigger("mod.gift.batch.switch.open"), i.trigger("dys", {
					key: "dys.room.giftSend.send.fail",
					gfid: t.gid,
					yc: u && u.pc || ""
				})
			}, n = function(a) {
				var n = a.result,
					s = {},
					r = a.data && a.data.ry || 0,
					o = 0;
				if (0 == n) this.fxPopGX({
					gid: a.data.gid || t.gid,
					num: a.data.gx * a.data.num,
					ywnum: r,
					sendNum: a.data.num
				}), 1 === +a.data.relive && (f.exe("js_get_relive_card"), i.trigger("room.activity.get.lifecard"), e.dialog.tips_black("复活卡+1，请等待题目推送")), i.trigger("dys", {
					key: "dys.room.giftSend.send.success",
					gfid: t.gid,
					yc: u && u.pc || "",
					src_type: d
				}), p.unlock(a.data.gid), p.hasNext() ? p.next(a.data.gid, function(e) {
					c.sendYC(e)
				}) : (p.clear(), i.trigger("mod.gift.batch.switch.open")), s = {
					gold: a.data.sb / 100,
					ngold: a.data.noble_gold / 100
				}, r && (s.silver = (parseInt(e("#js-stats-and-actions").find('[data-login-user="silver"]').text(), 10) || 0) + (parseInt(r, 10) || 0)), i.trigger("mod.userinfo.change", {
					current: s
				}), parseInt(a.data.noble_gold_black) && e('[data-login-content="yes"] .y3').hide(), 4 === +y && +t.gid === +v && i.trigger("mod.room.spring.activity.follow"), i.trigger("room.rotaryDraw.listen.getTicket", a.data), i.trigger("room.giftprop.send.success.land", a.data.gid), i.trigger("room.giftprop.send.success.loveheadline", a.data.gid), i.trigger("room.giftprop.send.success.valentine2018", a.data.gid), i.trigger("room.giftprop.send.success.starmagic", a.data.gid), i.trigger("room.giftprop.send.success.foolday2018", a.data.gid), i.trigger("room.giftprop.send.success.drawrebate", a.data.gid);
				else if (3 == n) {
					var l = a.data || {},
						m = l.pc || 0,
						h = {},
						b = x.lowYcConfig;
					o = c.formatDecimals(m / 100, 2), h.relCostGold = o, +o > 2e3 ? b.sendFlag && (b.sendFlag = !1, e.dialog.tips_black("鱼翅余额不足，请充值~"), setTimeout(function() {
						b.sendFlag = !0, i.trigger("room.com.show.iframe.pay")
					}, 1500)) : (10 > +o ? h.rechargeCostGold = 10 : h.rechargeCostGold = Math.ceil(o), c.remindYCLow(h, t, u), c.autoSendOrder(h)), i.trigger("mod.gift.batch.switch.open")
				} else 170001 == n ? g.init({
					dys_type: 2
				}) : (e.dialog.tips_black(a.msg, 1.5), p.clear(), i.trigger("mod.gift.batch.switch.open"))
			}, l = {
				num: t.num,
				sdn: t.sdn,
				sid: t.sid,
				did: t.did,
				rid: t.rid,
				exp: t.exp,
				dy: o.get("room.device_id")
			}, r = e.extend(!0, {
				gid: t.gid
			}, l), r[$SYS.tn] = a.get($SYS.tvk) || "", x.CGIFT[t.gid] = r, x.SENDDATA[t.gid] = l;
			var m = o.get("room.isVertical");
			!t.faceEffect || m ? e.ajax("/member/gift/send/" + t.gid, {
				type: "post",
				dataType: "json",
				data: l,
				success: e.proxy(n, this),
				error: s
			}) : c.handleFaceEffect(t, function(t) {
				var i = x.SENDDATA[t];
				e.ajax("/member/gift/send/" + t, {
					type: "post",
					dataType: "json",
					data: i,
					success: e.proxy(n, c),
					error: s
				})
			})
		},
		showYWLowDlg: function() {
			var t = this,
				a = t.adInfo,
				n = '<div class="aui_content">',
				s = [];
			if (a) {
				var r = a.srcid.replace(/鱼丸/g, '<span class="highlight">鱼丸</span>');
				n += '<i class="ad-img"></i><p>赠送失败，鱼丸不足！</p><div class="ad-content" data-dysign="30013" data-dysign-gid="' + a.gid + '" data-dysign-mid="' + a.mid + '"><p class="ad-title">' + r + "</p></div>", s = [{
					content: "立即前往",
					className: "ok-btn",
					callback: function() {
						t.isNoYCFloatHide = !1, window.open(a.link), this.hide(), i.trigger("mod.sign.dot", "30013")
					}
				}, {
					content: "暂时不了",
					className: "cancel-btn",
					callback: function() {
						t.isNoYCFloatHide = !1, this.hide()
					}
				}]
			} else n += '<i class="ad-img no-btn"></i><p>赠送失败，鱼丸不足！</p><div>';
			e.dy_dialog(n, {
				title: "提示",
				className: "gift-error",
				mask: 1,
				width: "420px",
				height: "283px",
				buttons: s,
				afterHide: function() {
					t.isNoYCFloatHide = !1
				}
			})
		},
		remindYWLow: function() {
			var e = this;
			e.isNoYCFloatHide || (e.isNoYCFloatHide = !0, e.showYWLowDlg = C.showYWLowDlg, e.adInfo ? e.showYWLowDlg() : l.getAdInfo("30013", function(t) {
				if (t[0]) {
					var i = t[0] || {},
						a = l.helper.innerLink(i);
					e.adInfo = {
						srcid: i.srcid,
						gid: i.gid,
						mid: i.mid,
						link: a
					}
				}
				e.showYWLowDlg(), l.exposure()
			}))
		},
		remindYCLow: function(t, a, n) {
			var r = this,
				o = x.lowYcConfig || {};
			r.lowYCDialog && (r.lowYCDialog.hide(), r.isNoYCFloatHide = !1), o.willSendGift = n.gift_pic, o.willSendGiftNum = a.sdn, o.willSendGiftName = n.name, o.isShortGold = !0, o.giftId = a.gid, o.willSendGold = t.relCostGold;
			var l = ['<div class="yc-tips-wraper">', '<div class="yc-tips-txt">', '<div class="yc-tips-title">', "鱼翅不足", "</div>", '<div class="yc-tips-nums">', '扫码快速充值<span class="yc-tips-nums-sp"><span class="js-tips-values"><%= rechargeVal%></span>鱼翅</span>', "</div>", '<a class="yc-open-iframe js-yc-open-iframe" href="javascript:;">其他金额充值&gt;</a>', "</div>", '<div class="yc-tips-code-content">', '<div class="yc-tips-code J_qrcode_content">', '<img src = "<%=defaultLoading%>"/>', "</div>", '<div class="yc-code-txt">微信/支付宝扫码付款</div>', "</div>", "</div>"].join(""),
				c = s.compile(l),
				d = c({
					rechargeVal: t.rechargeCostGold || "--",
					defaultLoading: o.loadingImg
				});
			r.isNoYCFloatHide || (r.isNoYCFloatHide = !0, r.lowYCDialog = e.dy_dialog(d, {
				title: "充值提示",
				className: "JS-yc-tips-wraper",
				width: 380,
				height: 260,
				mask: 1,
				afterHide: function() {
					r.isNoYCFloatHide = !1
				}
			}), p.clear("yc"), i.trigger("dys", {
				key: "dys.room.giftSend.charge.show",
				gfid: x.currentGiftId
			}))
		},
		remindYCSuccess: function(t) {
			var a = this,
				n = t || {},
				r = n.rm || 0,
				o = x.lowYcConfig || {},
				l = ['<div class="main-title">', '恭喜成功充值<span class="yc-tips-nums-sp"><%=rechargeGold%>鱼翅</span>', "</div>", '<div class="main-content">', '<div class="send-gift-icon"><img src="<%=lowYcConfig.willSendGift%>" alt=""></div>', '<div class="send-gift-txt">', '点击按钮消费<span class="yc-tips-nums-sp"><%=lowYcConfig.willSendGold%>鱼翅</span>赠送<span class="yc-tips-nums-sp">“<%=lowYcConfig.willSendGiftName%>”×<%=lowYcConfig.willSendGiftNum%></span>', "</div>", "</div>"].join(""),
				c = s.compile(l),
				d = c({
					rechargeGold: a.formatDecimals(r / 100, 2),
					lowYcConfig: o
				});
			a.isNoYCFloatHide || (a.isNoYCFloatHide = !0, e.dy_dialog(d, {
				title: "充值成功",
				className: "JS-yc-tips-wraper JS-yc-success-wraper",
				mask: 1,
				width: "390px",
				height: "310px",
				buttons: [{
					id: "pay-dialog-btn-confirm",
					content: "立即赠送",
					callback: function() {
						this.hide(), a.isNoYCFloatHide = !1, h.render().done(function() {
							var t = e('#gift-content [data-type=gift][data-giftid="' + o.giftId + '"]');
							t && t.length ? i.trigger("mod.gift.draw.batch.send", {
								target: t,
								number: +o.willSendGiftNum,
								batch: +o.willSendGiftNum > 1 ? 1 : 0
							}) : e.dialog.tips_black("赠送失败")
						})
					}
				}],
				afterHide: function() {
					a.isNoYCFloatHide = !1
				}
			}))
		},
		remindSimpleSuc: function(t) {
			var i = this,
				a = t || {},
				n = a.rm || 0,
				r = ['<div class="main-title">', '恭喜成功充值<span class="yc-tips-nums-sp"><%=rechargeGold%>鱼翅</span>', "</div>"].join(""),
				o = s.compile(r),
				l = o({
					rechargeGold: i.formatDecimals(n / 100, 2)
				});
			i.isNoYCFloatHide || (i.isNoYCFloatHide = !0, e.dy_dialog(l, {
				title: "充值成功",
				className: "JS-yc-tips-wraper JS-yc-success-wraper",
				mask: 1,
				width: "390px",
				height: "250px",
				buttons: [],
				afterHide: function() {
					i.isNoYCFloatHide = !1
				}
			}))
		},
		formatDecimals: function(e, t) {
			var i = new RegExp("(\\.\\d{" + t + "})\\d*$"),
				a = e + "",
				n = a.replace(i, "$1");
			return n = this.formatDotZero(n)
		},
		formatDotZero: function(e) {
			var t = /(\.\d+)0+$/;
			return e = e.replace(t, "$1"), parseInt(e, 10) == e && (e = parseInt(e, 10)), e
		},
		fxPopGX: function(t) {
			var a, n, s, r, o, l = this.doms.giftContent.find("[data-giftid=" + t.gid + "]"),
				c = l.offset(),
				d = t.ywnum > 0;
			i.fire("room.rotaryDraw.return.config").done(function(i) {
				var u = m.get("RotaryDraw_getTicket_tipShow");
				if (1 == i.is_open && t && t.gid == i.gift_id) {
					if (!(u > 0)) return;
					a = e('<span class="gift-success-tip-num">赠送成功，探险券+' + t.sendNum * i.gift_rebate_coupon + "</span>"), e("body").append(a), n = c.top - a.height(), s = c.left + (l.width() - a.width()) / 2, r = "-=10px", o = 500
				} else d ? (a = e('<span class="gift-success-tip-num">+' + t.ywnum + "鱼丸</span>"), e("body").append(a), n = c.top - a.height(), s = c.left + (l.width() - a.width()) / 2, r = "-=10px", o = 500) : (a = e('<span class="gift-success-tip">赠送成功</span>'), e("body").append(a), n = c.top + l.height() - a.height(), s = c.left - a.outerWidth(!0), r = "-=50px", o = "slow");
				a.show(), a.css({
					top: n,
					left: s
				}).animate({
					top: r
				}, o).fadeOut("slow", function() {
					e(this).remove()
				})
			})
		},
		updateGiftInfo: function() {
			var t, i, a, n, r, l, c, d = this,
				u = e("#gift-content"),
				f = u.find('[data-type="gift-info-panel-cont"]'),
				p = x.giftConfigData[x.currentGiftId],
				h = this.doms.giftContent.find('[data-giftid="' + x.currentGiftId + '"]'),
				g = h.data("type") || "",
				v = h.data("explain") || "",
				y = h.data("noble") || 0,
				k = [],
				w = [],
				C = (T.searchGiftBatter(x.currentGiftId), h.data("devote") || 0),
				S = h.data("price") || 0,
				I = h.data("send") || 0,
				j = h.data("exp") || 0,
				$ = h.data("intimate") || 0,
				D = b.act_gift_id == x.currentGiftId ? 1 : 0,
				L = b.act_gift_name || "",
				R = b.user_return_gold_amount || "",
				A = "",
				N = "",
				E = "",
				B = 0,
				M = {};
			p ? (l = p.batchNum || [], c = p.hit || [], A = p.culture_content, N = p.desc_content_1, E = p.desc_content_2, B = p.isBatchGift, M = p.batchTemp || {}) : (l = "".split(","), c = []);
			for (var O = 0, P = l.length; P > O; O++)"" !== l[O] && k.push(l[O]);
			for (var F = 0, z = c.length; z > F; F++) c[F].is_show && w.push(c[F]);
			t = ["<%if ( isReturnBag ) { %>", '<div class="giftReturn-gift-wrap">', '<div class="giftReturn-gift-txt">', '<p class="giftReturn-gift-yellow">活动期间每日首次赠送<span><%= returnBagGiftName %></span>可额外领取：</p>', "<p><%= returnGoldNum %>鱼丸+海量粉丝道具（最多得100个）</p>", "</div>", "</div>", "<% } %>", "<%if ( batchPreset.length > 0 ) { %>", '<div class="giftReturn-gift-content">', "<% } else { %>", '<div class="gift-not-batch giftReturn-gift-content">', "<% } %>", '<% if ( type === "gift" ) { %>', "<% if (giftFlagData) { %>", '<div class="icon--conner-mark <%= giftFlagData.flagClass %>">', "<span><%= giftFlagData.flagName %></span>", "</div>", "<% } %>", '<div class="gift-info-panel-brief">', '<div class="gift-info-panel-img">', '<img src="<%= gifticon %>"><i></i>', "</div>", "<h4><strong><%= giftname %></strong><em>(<%= name %>", "<% if (returnYw) { %> 可返<%=returnYw  %>鱼丸<% } %>", ")</em>", "<% if (isDoubleIntimacy == 1 && exp > 0 && isDoubleIntimacyShow) { %>", '<span class="intimacy-label intimacy-label-show">(亲密度X2)</span>', "<% } %>", "</h4>", "<% if (!isBatchGift){%>", "<p>", "<% if(devote >0){%>", '<b>贡献 +<span title="<%= devote %>"><%= devote4Short %></span> </b>', "<% } %>", "<% if(exp >0){%>", '<b>经验 +<span title="<%= exp %>"><%= exp4Short %></span> </b>', "<% } %>", "<% if(intimate >0 ){%>", '<b>亲密度 +<span title="<%= intimate %>"><%= intimate4Short %></span> </b>', "<% } %>", "</p>", '<p class="gift-info-intro"><%= explain %></p>', "<p><em><%= intro %></em></p>", "<% } else { %>", '<p class="gift-info-panel-slogan"><em><%= culture_content %></em></p>', "<p><b><%= desc_content_1 %></b></p>", "<p><b><%= desc_content_2 %></b></p>", "<% }%>", "</div>", "<% if ( batchPreset.length <= 0) { %>", '<span class="gift-countdown hide"><em>--:--</em>内可连击</span>', "<% } %>", "<% if ( effect.length > 0 ) { %>", '<div class="gift-info-panel-explain">', "<% for (var i = 0, length = effect.length; i < length; i++) { %>", "<% var item = effect[i]; %>", "<p>连击<b><%= item.count %></b>次将", "<% if ( item.bt == 1 ) { %>", "触发房间广播特效", "<% } else if ( item.bt == 2 ) { %>", "触发网站广播特效", "<% } %>", "<% if ( item.bt > 0 && item.type > 0) { %>", "，并", "<% } %>", "<% if ( item.type > 0 ) { %>", "获得<em><%= item.name %></em><%= item.time_str %>", "<% } %>", "</p>", "<% } %>", "</div>", "<% } %>", "<% if(freeList.length > 0){%>", '<div class="double-hit" data-id="<%= giftid%>">', '<div class="double-hit-info">', "<% for( var j = 0; j< freeList.length&& j< 3; j++){ %>", "<% var giveitem = freeList[j];%>", '<p>连击<span class="double-hit-sign">&times;<%= giveitem.combo_num%></span>可获得<span class="double-hit-sign"><%= giveitem.name %></span>', "</p>", "<%}%>", '<a class="double-hit-more" href="javascript:;">奖品数量有限哦！点击查看活动详情&gt;</a>', "</div>", "</div>", "<%}%>", "<% } else { %>", '<div class="gift-info-panel-brief">', '<div class="gift-info-panel-img">', '<img src="<%= gifticon %>"><i></i>', "</div>", "<h4><strong><%= giftname %></strong><em>(<%= name %>)</em></h4>", "<% for (var i = 0, len = explain.length; i < len; i++) { %>", "<p><%= explain[i] %></p>", "<% } %>", "</div>", "<% } %>", "</div>", "<% if ( batchPreset.length > 0 ) { %>", "<% if ( effect.length > 0 ) { %>", '<div class="gift-info-panel-give" data-type="gift-info-give">', "<% } else { %>", '<div class="gift-info-panel-give gift-info-panel-give-not-explain" data-type="gift-info-give">', "<% } %>", '<span class="gift-countdown hide"><em>--:--</em>内可连击</span>', '<div class="gift-info-panel-form" style="display: block;" data-gid="<%=giftid%>" data-type="gift-info-panel-form">', "<% for (var i = 0, length = batchPreset.length; i < length; i++) { %>", "<% if (i < 5) { %>", '<a href="javascript:;" data-gift-number="<%= batchPreset[i] %>"><%= batchPreset[i] %></a>', " \r\n ", "<% } %>", "<% } %>", '<span href="javascript:;" class="gift-form-userdefult">', '<input type="text" placeholder="自定义" maxlength="4" />', "</span>", "<% if ( batchSwitch ) { %>", '<a href="javascript:;" class="gift-info-panel-form-send" data-type="batch-send">赠送</a>', "<% } %>", '<span class="justify-fix"></span>', "</div>", '<div class="gift-info-panel-attention">', "<% for (var i = 0, length = batchPreset.length; i < length; i++) { %>", "<% if (i == 0) {%>", '<span class="JS_batchgiftinput" data-gift-number="<%= batchPreset[i] %>">', "<% } else {%>", '<span class="JS_batchgiftinput hide" data-gift-number="<%= batchPreset[i] %>">', "<% }%>", '<span>"<%=batchTemp[batchPreset[i]].desc%>"：</span>', "<% if (giftType == 2) { %>", '<span class="gift-info-panel-red"><%=formatPrice(devote * batchPreset[i] / 10)%>鱼翅</span>', "<% } else if (giftType == 1) { %>", '<span class="gift-info-panel-red"><%=formatPrice(price * batchPreset[i])%>鱼丸</span>', "<% } %>", "</span>", "<% } %>", "</div>", "</div>", "<% } %>"].join(""), i = s.compile(t);
			var G = [];
			n = this.getGiftFlagData(x.currentGiftId), n ? r = {
				flagClass: n,
				flagName: p.gift_active_text || "礼物"
			} : 1 == y ? r = {
				flagClass: "icon--conner-mark-b1",
				flagName: "贵族"
			} : 2 == y && (r = {
				flagClass: "icon--conner-mark-b3",
				flagName: "周星"
			}), a = i({
				type: g,
				gifticon: h.data("gifticon") || o.get("sys.web_url") + "app/douyu/res/page/room-normal/loading.gif",
				giftname: h.data("giftname") || "",
				giftid: x.currentGiftId,
				name: h.data("name") || "",
				devote: C,
				price: S,
				giftType: I,
				formatPrice: d.formatPrice,
				exp: j,
				intimate: $,
				devote4Short: _(C),
				exp4Short: _(j),
				intimate4Short: _($),
				intro: h.data("intro") || "",
				explain: "gift" != g ? v.split("/") : v,
				effect: w,
				batchPreset: k,
				batchSwitch: x.batchSwitch,
				isNoble: y,
				freeList: G,
				isDoubleIntimacy: m.get("doubleIntimacy"),
				giftFlagData: r,
				returnYw: x.ywReturnSwitch && h.data("returnyw") || "",
				isReturnBag: D,
				returnBagGiftName: L,
				returnGoldNum: R,
				culture_content: A,
				desc_content_1: N,
				desc_content_2: E,
				isBatchGift: B,
				batchTemp: M
			}), f.html(a), x.prevGiftId = x.currentGiftId, f.find("[data-gift-number]").eq(0).click(), e(".gift-form-userdefult input").val(1)
		},
		formatPrice: function(e) {
			return e != parseInt(e) && (e = Number.prototype.toFixed.call(e, 1)), e
		},
		getGiftFlagData: function(e) {
			var t, i = x.giftConfigData[e];
			if (!i) return !1;
			switch (parseInt(i.gift_active_icon_style, 10)) {
			case 1:
				t = "icon--conner-mark-b1";
				break;
			case 2:
				t = "icon--conner-mark-b2";
				break;
			case 3:
				t = "icon--conner-mark-b3";
				break;
			default:
				t = !1
			}
			return t
		},
		showNobleError: function() {
			var t = "开通贵族",
				a = x.nobleInfo;
			0 == a.noble_gift ? t = "升级贵族" : 0 == a.nl && a.npl > 0 && (t = "续费贵族");
			var n = ['<div class="noble--error">', '<a class="noble-error--close" href="javascript:;">×</a>', '<div class="nobel-error--main">', '<i class="nobel-error--icon"></i>', '<div class="error-main--content">', '<h3 class="content--title">', "您还不是贵族用户", "</h3>", "<p>", "贵族礼物-你的贵族专属特权", "</p>", '<a class="btn" href="javascript:;">', t, "</a>", "</div>", "</div>", "</div>"].join("");
			if (!this.nobleErrorPanel) {
				var s = this;
				this.nobleErrorPanel = e(n), this.doms.giftContent.find(".g-list").append(this.nobleErrorPanel), this.nobleErrorPanel.on("click", ".noble-error--close", function() {
					s.hideNobleError()
				}).on("click", ".btn", function() {
					s.hideNobleError(), i.trigger("mod.normal.noble.buy")
				})
			}
			this.nobleErrorPanel.fadeIn(), k.hideExpandGiftPanel()
		},
		hideNobleError: function() {
			this.nobleErrorPanel.fadeOut()
		},
		giftRecharge: function() {
			var t = e("body"),
				a = this;
			t.on("click", ".js-yc-open-iframe", function() {
				i.trigger("room.com.show.iframe.pay"), a.isNoYCFloatHide = !1, a.lowYCDialog && a.lowYCDialog.hide()
			})
		},
		autoSendOrder: function(t) {
			var i = x.lowYcConfig,
				a = i.getCodeUrl,
				n = e(".J_qrcode_content"),
				s = o.get("room.room_id"),
				r = {
					product_id: "DYTV_Product_Gold_1",
					number: t.rechargeCostGold,
					source: "dy_gift",
					room_id: s
				},
				l = "canvas";
			"Microsoft Internet Explorer" === navigator.appName && parseInt(navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/)[1], 10) < 9 && (l = "table"), e.ajax({
				url: a,
				type: "GET",
				dataType: "jsonp",
				data: r
			}).done(function(t) {
				0 === +t.error && t.data && t.data.code_url ? (n.html(""), n.qrcode({
					render: l,
					width: 110,
					height: 110,
					text: t.data.code_url
				})) : e.dialog.tips_black(t.msg)
			}).fail(function() {
				e.dialog.tips_black("网络错误")
			})
		}
	}), k = {
		giftTipsKey: "moreGiftTipsShowed",
		cacheList: [],
		$actions: e("#js-stats-and-actions"),
		$giftContent: e("#gift-content"),
		maxFoldLength: 45,
		actionExpandStatus: !1,
		actionOuterWidth: 70,
		actionLayout: function() {
			if (k.moreActionBtnWrap) {
				var t = k.$actions.find(".action-item");
				if (k.actionList.hide().append(t), k.moreActionBtnWrap.hide(), 0 !== t.length) {
					var a = 0,
						n = 0;
					k.$giftContent.is(":visible") ? (a = k.$giftContent.outerWidth(), n = parseInt(k.$giftContent.css("marginLeft"), 10) || 0) : a = e(".room-waring-close").outerWidth();
					var s = k.$actions.width(),
						r = e(".task-Getyw").width(),
						o = 0;
					"full" === i.fire("mod.video.state.get") && (o = e(".uinfo-ywyc").width() + 10);
					var l = s - a - n - r - o,
						c = e(".action-item[data-fold=0][data-hide!=1]"),
						d = e(".action-item[data-fold=1][data-hide!=1]"),
						u = d.length,
						f = c.length,
						p = Math.floor(l / k.actionOuterWidth);
					p >= f + u ? (d.show(), c.show(), k.actionList.show()) : p > f ? (k.moreActionBtnWrap.show(), k.resizeFoldCont(u), k.foldCont.append(d), d.show(), c.show(), k.actionList.show()) : (c.slice(p).hide(), k.foldCont.append(d), c.slice(0, p).show(), k.actionList.show()), k.collectActionDys(k.$actions.find(".action-list .action-item")), k.packActionGift()
				}
			}
		},
		resizeFoldCont: function(e) {
			var t = e > 9 ? 9 : e,
				i = t * k.actionOuterWidth;
			k.foldCont.width(i), k.foldPanel.width(i - 10)
		},
		render: function() {
			var t = ['<div class="action-list fl">', "</div>", '<div class="more-action-btn-wrap fl">', '   <div class="more-action-btn">', "   </div>", '   <div class="item-expand-panel expand-action-panel">', '       <div class="item-expand-cont clearfix">', "       </div>", '       <div class="expand-arrow">', '           <div class="expand-arrow-bg"></div>', '           <div class="expand-arrow-over"></div>', "       </div>", '       <div class="cover"></div>', "   </div>", "</div>"].join("");
			e(".task-Getyw").after(t), k.renderActionList()
		},
		renderActionList: function() {
			var t = ["<% for ( var i=0; i<list.length ;i++ ){%>", "<% var item = list[i];  %>", "<% if(item){ %>", "<% if (item.activity_link.length > 0){ %>", '<a href="<%= item.activity_link %>" target="_blank"', "<% }else{ %>", "<div", "<% } %>", ' class="action-item" data-fold="<%= item.fold %>" data-flag="<%=item.activity_flag%>" data-hide="<% if(item.activity_flag){ %>1<%} else {%>0<%}%>" data-id="<%=item.id%>">', "<% if( item.icon_default ) {%>", '<img class="action-img" src="<%= item.icon_default %>" width="60" height="40" data-default="<%= item.icon_default %>"  data-hover="<%= item.icon_hover || item.icon_default %>"/>', "<%}%>", "<% if (item.icon_hover_title.length > 0){%>", '<span class="tips"><%= item.icon_hover_title%></span>', "<%}%>", "<% if (item.activity_link.length > 0){ %>", "</a>", "<% }else{ %>", "</div>", "<% } %>", "<% } %>", "<% } %>"].join("");
			k.addActionList(o.get("room.giftActivity.unfold") || [], 0), k.addActionList(o.get("room.giftActivity.fold") || [], 1);
			var i = s.compile(t),
				a = i({
					list: k.cacheList
				});
			e("#js-stats-and-actions .action-list").html(a)
		},
		getDoms: function() {
			k.moreActionBtnWrap = e(".more-action-btn-wrap"), k.moreActionBtn = e(".more-action-btn"), k.foldCont = k.moreActionBtnWrap.find(".item-expand-cont"), k.foldPanel = k.moreActionBtnWrap.find(".expand-action-panel"), k.actionList = k.$actions.find(".action-list")
		},
		init: function() {
			this.render(), this.getDoms(), e("#container").on("click.actionExpand", function(t) {
				var i = e(t.target).closest(".gift-info-panel,.item-expand-panel,.more-gift-btn,.more-action-btn-wrap");
				0 === i.length && k.packActionGift()
			}), e("#room-task-trigger,.get-yw .get-box,.backpack-btn").on("click", k.packActionGift), k.moreActionBtn.on("click", function(e) {
				if (k.moreActionBtnWrap.hasClass("expand")) k.hideActionPanel(), i.trigger("dys", {
					key: "dys.room.normal.action.expand",
					stat: 2
				});
				else {
					var t = k.foldPanel.outerWidth(),
						a = k.moreActionBtn.offset(),
						n = k.$actions.offset(),
						s = a.left - n.left;
					s > t && (s = t - 70), k.foldPanel.css({
						left: -s
					}), k.foldPanel.find(".expand-arrow").css({
						left: s + 30
					}), k.moreActionBtnWrap.addClass("expand"), i.trigger("dys", {
						key: "dys.room.normal.action.expand",
						stat: 1
					}), k.actionExpandStatus !== !0 && (k.collectActionDys(k.moreActionBtnWrap.find(".action-item")), k.actionExpandStatus = !0)
				}
				return k.hideExpandGiftPanel(), !1
			}), e("#gift-content").on("click", ".more-gift-btn", function(e) {
				return k.toggleExpandGiftPanel(), i.trigger("dys", {
					key: "dys.room.gift.more.click"
				}), !1
			}).on("mouseenter", ".more-gift-btn", function() {
				var t = e(this);
				return t.hasClass("expand") ? t.attr("title", "点击收起礼物") : t.attr("title", "点击查看更多礼物"), !1
			}), e("#gift-content").on("click", ".expand-gift-panel-close", function() {
				return k.toggleExpandGiftPanel(), !1
			}), k.$actions.on({
				mouseenter: function() {
					var t = e(this),
						i = t.find(".tips"),
						a = i.outerWidth() / 2,
						n = t.offset().left;
					a = n + 30 > a ? a : 30 + n, i.css({
						left: -a
					}), t.stop().animate({
						top: -4
					}, 200);
					var s = t.find(".action-img");
					s.attr("src", s.data("hover"))
				},
				mouseleave: function() {
					var t = e(this);
					t.stop().animate({
						top: 0
					}, 200);
					var i = t.find(".action-img");
					i.attr("src", i.data("default"))
				},
				click: function() {
					i.trigger("dys", {
						key: "dys.room.normal.action.click",
						active_id: e(this).data("id"),
						is_fold: e(this).data("fold")
					})
				}
			}, ".action-item"), k.actionLayout()
		},
		collectActionDys: function(t) {
			t.each(function() {
				var t = e(this);
				"1" === t.data("dysshow") || t.is(":hidden") || (t.data("dysshow", "1"), i.trigger("dys", {
					key: "dys.room.normal.action.activity",
					active_id: t.data("id")
				}))
			})
		},
		packActionGift: function() {
			k.hideActionPanel(), k.hideExpandGiftPanel()
		},
		hideActionPanel: function() {
			k.moreActionBtnWrap.removeClass("expand")
		},
		hideExpandGiftPanel: function() {
			e(".giftInfoPanel").hide(), e(".more-gift-btn").removeClass("expand"), k.foldPanel.removeClass("expand")
		},
		toggleExpandGiftPanel: function() {
			e(".more-gift-btn").toggleClass("expand"), e('[data-type="gift-info-panel"]').hide(), e(".expand-gift-panel").toggleClass("expand"), k.hideActionPanel()
		},
		showExpandGiftPanel: function() {
			e(".more-gift-btn").addClass("expand"), e('[data-type="gift-info-panel"]').hide(), e(".expand-gift-panel").addClass("expand"), k.hideActionPanel()
		},
		addActionList: function(e, t) {
			for (var i = 0; i < e.length; i++) {
				var a = e[i];
				a.fold = t, k.cacheList.push(a)
			}
		},
		addAction: function(t) {
			var i = e(".action-item[data-flag=" + t.flag + "]");
			if (0 === i.length) e(t.dom).hide();
			else {
				var a = i.find(".tips");
				i.html(t.dom), t.tips && t.tips.length > 0 ? i.append('<span class="tips">' + t.tips + "</span>") : i.append(a), i.attr("data-hide", "0")
			}
			k.actionLayout()
		},
		hideAction: function(t) {
			e(".action-item[data-flag=" + t.flag + "]").hide().attr("data-hide", "1"), k.actionLayout()
		}
	}, T = {
		hoverPropStatus: !1,
		doms: {
			giftBox: e("#gift-content"),
			propBox: e(".backpack")
		},
		config: {
			hoverIndex: "",
			giftBattertimer: "",
			roundBatterTimer: "",
			cssTimer: "",
			giftBatterData: {},
			propConfigData: {}
		},
		init: function() {
			this.bindEvent()
		},
		getRestTime: function(e) {
			var t, i;
			return e = e ? parseInt(e, 10) : 0, t = new Date, t.setDate(t.getDate() + e), t.setHours(24), t.setMinutes(0), t.setSeconds(0), i = t.getTime() - (new Date).getTime()
		},
		formatTime: function(e) {
			return 0 == e ? "00" : 10 > e ? "0" + e : e
		},
		refrushPropPos: function(e) {
			var t = this.doms;
			t.$panel = t.propBox.find(".prop-info-panel");
			var i, a, n, s, r = (t.$panel.find(".gift-countdown"), t.$panel.find(".prop-info-panel-cont")),
				o = this.doms.propBox.find(".prop-page .prop").eq(this.config.hoverIndex),
				l = o.index();
			r && r.length && (clearTimeout(this.cssTimer), this.cssTimer = setTimeout(function() {
				i = t.$panel.outerWidth() < 280 ? 280 : t.$panel.outerWidth(), a = t.$panel.outerHeight(), n = (i - 280) / 2, s = a - 132, t.$panel.css({
					left: -47 - n + l % 5 * 68,
					top: -62 - s + 68 * Math.floor(l / 5)
				}).fadeIn("fast")
			}, 10))
		},
		hidePropInfoBatter: function() {
			this.doms.propBox.find(".gift-countdown").addClass("hide")
		},
		addGiftBatter: function(e) {
			var t = this.doms.giftBox.find('.gift-item[data-giftid="' + e + '"]'),
				i = this.doms.propBox.find('.prop-page .prop[data-giftid="' + e + '"]'),
				a = t.find(".gift-mask"),
				n = i.find(".gift-mask");
			x.currentGiftId == e, i && i.length && (this.doms.propBox.find(".gift-countdown").removeClass("hide"), this.refrushPropPos(e)), a && a.length ? a.fadeIn() : t.append('<em class="gift-mask"></em>'), n && n.length ? n.fadeIn() : i.prepend('<em class="gift-mask"></em>')
		},
		removeGiftBatter: function(e) {
			var t = this.doms.giftBox.find('.gift-item[data-giftid="' + e + '"]'),
				i = this.doms.propBox.find('.prop-page .prop[data-giftid="' + e + '"]'),
				a = this.doms.propBox.find(".prop-info-panel .gift-countdown");
			x.currentGiftId == e, a.data("gid") == e && (this.doms.propBox.find('.prop-info-panel .gift-countdown[data-gid="' + e + '"]').addClass("hide"), this.refrushPropPos(e)), t.find(".gift-mask").fadeOut(), i.find(".gift-mask").fadeOut()
		},
		showGiftBatterTime: function(e, t) {
			var i = this.doms.propBox.find(".prop-info-panel .gift-countdown").find("em"),
				a = parseInt(e / 1e3, 10),
				n = parseInt(a / 60, 10),
				s = a - 60 * n;
			n = this.formatTime(n), s = this.formatTime(s), i.text(n + ":" + s).parent().attr("data-gid", t)
		},
		giftBatterTimeRun: function(e, t) {
			var i = this,
				a = +new Date;
			0 >= e - a || (i.showGiftBatterTime(e - a, t), clearTimeout(this.config.giftBattertimer), this.config.giftBattertimer = setTimeout(function() {
				i.giftBatterTimeRun(e, t)
			}, 500))
		},
		searchGiftBatter: function(e) {
			var t, i = this,
				a = i.config.propConfigData || {},
				n = this.config.giftBatterData,
				s = +(new Date).getTime();
			return n ? n[e] ? (t = n[e].giftEndTime - s, 0 >= t ? (delete n[e], !1) : (this.addGiftBatter(e), (x.currentGiftId == e || a[e] || i.hoverPropStatus) && this.giftBatterTimeRun(n[e].giftEndTime, e), n[e].giftEndTime)) : !1 : void 0
		},
		roundStatusGiftBatter: function() {
			var e = this,
				t = this.config.giftBatterData,
				i = +(new Date).getTime(),
				a = !1;
			for (var n in t) t[n] && (a = !0, i = (new Date).getTime(), i >= t[n].giftEndTime && (this.removeGiftBatter(n), delete t[n]));
			a && (clearTimeout(this.config.roundBatterTimer), this.config.roundBatterTimer = setTimeout(function() {
				e.roundStatusGiftBatter()
			}, 1e3))
		},
		roundStatusPropBatter: function() {
			var e = this,
				t = this.config.giftBatterData,
				i = +(new Date).getTime();
			for (var a in t) t[a] && (i = (new Date).getTime(), i < t[a].giftEndTime && e.addGiftBatter(a))
		},
		updateGiftBatterData: function(e) {
			var t = this;
			e && (t.config.giftBatterData[e.giftId] = {
				giftId: e.giftId,
				giftBatterTime: e.giftBatterTime,
				giftEndTime: (new Date).getTime() + parseInt(e.giftBatterTime, 10)
			}, t.roundStatusGiftBatter(), t.searchGiftBatter(e.giftId))
		},
		getGiftBatterData: function(e) {
			for (var t, i = [], a = n.isArray(e.lst) ? n.decode(e.lst) : [{
				value: e.lst
			}], s = 0; s < a.length; s++) t = a[s], t && t.value && (t = n.decode(t.value).too(), i.push(t), this.updateGiftBatterData({
				giftId: t.gid,
				giftBatterTime: 1e3 * t.st
			}));
			return i
		},
		bindEvent: function() {
			var e = this;
			f.reg("room_data_handler", function(t) {
				var i = n.decode(t).too();
				"gst" == i.type && h.render().done(function() {
					u.getProp().done(function(t) {
						e.config.propConfigData = t || {}, e.getGiftBatterData(i)
					})
				})
			}), i.on("mod.gift.send.batter.update", function(t) {
				u.getProp().done(function(i) {
					e.config.propConfigData = i || {}, e.updateGiftBatterData(t)
				})
			}), i.on("mod.prop.hover.batter.search", function(t, i) {
				var a;
				e.config.hoverIndex = i, e.hoverPropStatus = !0, e.hoverPropStatus = !1, u.getProp().done(function(i) {
					e.config.propConfigData = i || {}, a = e.searchGiftBatter(t), a || e.hidePropInfoBatter()
				})
			}), i.on("mod.prop.open.batter.update", function(t) {
				e.roundStatusPropBatter()
			})
		}
	}, i.on("mod.normal.gift.expand", function() {
		k.actionLayout()
	}), i.on("mod.chat.action.view.add", function(e) {
		k.addAction(e)
	}), i.on("mod.chat.action.view.hide", function(e) {
		k.hideAction(e)
	}), i.on("mod.chat.expandGiftPanel.show", function(e) {
		k.showExpandGiftPanel()
	}), i.on("mod.chat.expandGiftPanel.hide", function(e) {
		k.hideExpandGiftPanel()
	}), i.on("mod.gift.batch.switch.open", function() {
		C && (x.batchSwitch = !0, C.doms.giftInfoPanel.find('[data-type="batch-send"]').removeClass("disabled").removeAttr("title"))
	}), i.on("mod.gift.yw.res", function(t) {
		var a = "full" === i.fire("mod.video.state.get") ? 2 : 1,
			s = null,
			r = function() {
				C && (t = n.decode(t).too(), s = x.giftConfigData[t.gfid], "dsgr" === t.type && (0 == t.r ? (i.trigger("dys", {
					key: "dys.room.giftSend.send.success",
					gfid: t.gfid,
					yw: s && s.pc || "",
					src_type: a
				}), C.fxPopGX({
					gid: t.gfid,
					num: t.ms / 100
				}), p.unlock(t.gfid), p.hasNext() ? p.next(t.gfid, function(e) {
					C.sendYW(e)
				}) : (p.clear(), i.trigger("mod.gift.batch.switch.open")), i.trigger("mod.userinfo.update.yw", t.sb)) : 283 == t.r ? C.remindYWLow() : (e.dialog.tips_black(x.ERR[t.r] || "未知错误：" + t.r, 1.5), p.clear(), i.trigger("mod.gift.batch.switch.open"))))
			};
		u.getGift().done(function(e) {
			x.giftConfigData = e, r()
		})
	}), i.on("mod.gift.exp.up", function(e) {
		var t = x.CGIFT[e.gid];
		if (t && t.exp) {
			var a = null;
			e && (a = e.silver), i.trigger("mod.userinfo.change", {
				change: {
					exp: t.exp * t.sdn,
					silver: a,
					type: "yuwan"
				}
			})
		}
	}), i.on("mod.gift.auto.send.set", function(e) {
		e || p.clear()
	}), i.on("mod.room.chat.gift.noble.info", function(e) {
		var t = x.nobleInfo;
		if (t.load = !0, t.nl = e.nl, e.nl > 0) {
			var i = $ROOM.nobleConfig[e.nl] || {};
			t.noble_gift = i.noble_gift, t.npl = e.npl
		}
	}), i.on("mod.gift.draw.batch.send", function(e) {
		u.getGift().done(function(t) {
			x.giftConfigData = t, C.giftSend(e)
		})
	}), i.on("mod.gift.spring.activity.send", function(e) {
		u.getGift().done(function(t) {
			x.giftConfigData = t, C.giftSend(e)
		})
	}), i.on("mod.gift.draw.fish.dialog", function() {
		C.remindYWLow()
	});
	var I = {
		init: function(e) {
			return C = new w(e), k.init(), T.init(), C
		},
		loadYwReturnSwitch: function() {
			return S.load()
		}
	};
	return I
}), define("douyu/page/room/normal/mod/gift/constants", function() {
	var e = {
		VERSION: "room.gift."
	},
		t = {
			GIFT_BEGIN: "begin",
			GIFT_ROCKET: "rocket",
			GIFT_ROCKET_SIMPLE: "rocketSimple",
			GIFT_OWNER_ROCKET: "ownerRocket",
			GIFT_OWNER_ROCKET_SIMPLE: "ownerRocketSimple",
			GIFT_BATCH_SIMPLE: "batchSimple",
			GIFT_OWNER_BATCH_SIMPLE: "ownerBatchSimple",
			GIFT_PLANE: "plane",
			GIFT_PLANE_SIMPLE: "planeSimple",
			GIFT_OWNER_PLANE: "ownerPlane",
			GIFT_OWNER_PLANE_SIMPLE: "ownerPlaneSimple",
			GIFT_COMMON: "common",
			GIFT_COMMON_SIMPLE: "commonSimple",
			GIFT_OWNER_COMMON: "ownerCommon",
			GIFT_OWNER_COMMON_SIMPLE: "ownerCommonSimple",
			GIFT_SUPER: "super",
			GIFT_SUPER_SIMPLE: "superSimple",
			GIFT_OWNER_SUPER: "ownerSuper",
			GIFT_OWNER_SUPER_SIMPLE: "ownerSuperSimple",
			GIFT_NORMAL: "normal",
			GIFT_NORMAL_SIMPLE: "normalSimple",
			GIFT_PECK: "peck",
			GiFT_USENTER_LIST: "userEnterList",
			GiFT_BANNER_LIST: "userEnterBanners",
			OPEN_NOBLE_PUSH: "openNoblePush",
			OPEN_NOBLE: "openNoble",
			OPEN_NOBLE_SIMPLE: "openNobleSimple",
			RAISE_UP: "raiseUp",
			RAISE_SMALL_UP: "raiseSmallUp",
			BATCH_UP: "batchUp",
			BATCH_SMALL_UP: "batchSmallUp",
			PLANE_UP: "planeUp",
			PLANE_SMALL_UP: "planeSmallUp",
			COMMON_UP: "commonUp",
			COMMON_SMALL_UP: "commonSmallUp",
			SUPER_UP: "superUp",
			SUPER_SMALL_UP: "superSmallUp",
			BANNER: "banner",
			DROP_DOWN: "dropDown",
			TREASURE_BOX: "treasureBox",
			NOBLE_TREASURE_BOX: "nobleTreasureBOx",
			RAISE_UP_CONTROLLER: "raiseUpController",
			BANNER_CONTROLLER: "bannerController",
			DROP_DOWN_CONTROLLER: "dropDownController",
			TREASURE_BOX_CONTROLLER: "treasureBoxController",
			IS_LOGIN_CONTROLLER: "isLoginStatus",
			RAISE_UP_VIEW: "raiseUpView",
			BANNER_VIEW: "bannerView",
			DROP_DOWN_VIEW: "dropDownView",
			TREASURE_BOX_VIEW: "treasureBoxView",
			TREASURE_OVER_TIME: "treasureOverTime",
			TREASURE_ALL_EMPTY: "allGiftOver",
			GET_GIFT_DATA: "getgiftdata",
			GET_GIFT_BACK: "getGiftBack",
			GIFT_DESTORY: "giftDestory",
			GIFT_GET_LUCYKING: "giftGetLuckKing",
			GIFT_SENDER_IS_BAN: "giftsenderisban",
			GET_IS_BAN_USER: "getIsBanUsers",
			CHECK_USER_IS_BAN: "checkUserIsBan",
			GIFT_BAN_TIPS: "giftBanTips"
		},
		i = function() {
			for (var i in t) t[i] = e.VERSION + t[i];
			return t.VERSION = e.VERSION, t
		}();
	return i
}), define("douyu/page/room/normal/mod/gift/timer", function() {
	var e = function() {
			function e() {
				this.time = 0, this.isRunning = !1, this._callback = null, this._interval = 0, this.last = 0
			}
			return e.prototype.increase = function(e, t, i, a) {
				return this._run(0)(e, t, i, a), this
			}, e.prototype.decrease = function(e, t, i, a) {
				return this._run(1)(e, t, i, a), this
			}, e.prototype._run = function(e) {
				var t = this;
				return e && (t._set = t.time), function(i, a, n, s) {
					if (t.isRunning) return !1;
					t.isRunning = !0, t._callback = n, t._interval = i, t._tick = a || 1e3, t._finish = s ||
					function() {}, t.last = e;
					var r = +new Date;
					!
					function o() {
						var s = +new Date,
							l = parseInt((s - r) / 1e3);
						return n(t.time / 1e3), e ? t.time -= a : t.time += a, t.time < 0 || i && l >= i ? (t.stop(), void t._finish()) : void(t.times = setTimeout(function() {
							o()
						}, a))
					}()
				}
			}, e.prototype.set = function(e) {
				return this.isRunning ? !1 : (this.time = 1e3 * e, void(this._time = this.time))
			}, e.prototype.stop = function() {
				clearTimeout(this.times), this.time = null, this.isRunning = !1
			}, e.prototype.parse = function() {
				clearTimeout(this.times), this.isRunning = !1
			}, e.prototype.restore = function() {
				this.last ? this.decrease(this._interval, this._tick, this._callback, this._finish) : this.increase(this._interval, this._tick, this._callback, this._finish)
			}, e.prototype.restart = function() {
				this.stop(), this._time && (this.time = this._time), this.restore()
			}, e
		}();
	return e
}), define("douyu/page/room/normal/mod/gift/controller/geetest", ["jquery", "shark/class", "shark/observer"], function(e, t, i) {
	var a = {
		type: null,
		fast: {
			idpre: "gt-captcha-",
			count: 0
		}
	},
		n = t({
			init: function(t) {
				this.config = e.extend(!0, {}, {
					target: null
				}, t), this.render()
			},
			nextId: function() {
				return a.fast.idpre + ++a.fast.count
			},
			getResult: function() {
				return this.config.result
			},
			check: function(e) {
				this.buildAsync(e)
			},
			render: function() {
				this.config.$tar = e(this.config.target), this.config.$el = this.config.$tar.find(".captcha-gt")
			},
			build: function(e) {
				var t = this.nextId(),
					i = this,
					a = "zh-cn",
					n = {},
					s = this.config.success,
					r = this.config.error;
				return "en" === $SYS.lang && (a = $SYS.lang), this.config.$el.html('<div id="' + t + '"></div>'), this.config.result = null, n = {
					gt: e.gt,
					challenge: e.challenge,
					offline: !e.success,
					new_captcha: !0,
					product: "float",
					lang: a
				}, window.initGeetest ? void window.initGeetest(n, function(e) {
					e.appendTo("#" + t), e.onSuccess(function() {
						i.config.result = i.plugin.getValidate(), s(i.config.result)
					}), e.onError(function() {
						i.config.result = null, r()
					}), i.plugin = e
				}) : void r()
			},
			buildAsync: function(e) {
				var t = this,
					i = location.protocol;
				require.use([i + "//static.geetest.com/static/tools/gt.js"], function() {
					t.build(e)
				})
			},
			refresh: function() {
				this.plugin.reset(), this.config.result = null
			},
			show: function() {
				this.config.$el.show()
			},
			hide: function() {
				this.config.$el.hide()
			},
			destroy: function() {
				this.plugin.destroy()
			}
		}),
		s = {
			init: function(e, t, i, s) {
				var r = new n({
					target: e,
					product: "float",
					success: i ||
					function() {},
					error: s ||
					function() {}
				});
				return r.check(t), {
					refresh: function() {
						r.refresh()
					},
					isFast: function() {
						return "fast" === a.type
					},
					getFastResult: function() {
						return r.getResult()
					},
					destroy: function() {
						return r.destroy()
					}
				}
			}
		};
	return s
}), define("douyu/page/room/normal/mod/gift/model/treasure", ["douyu/context"], function(e) {
	function t(e, t) {
		var i = "";
		switch (t) {
		case "ready":
			i = e && e.length ? e.join("<br />") : "领取未开始，请您耐心等待...<br />多发弹幕可提升领取几率哦~";
			break;
		case "finish":
			i = e && e.length ? e.join("<br />") : "神秘宝箱已开启，手慢无！~"
		}
		return i
	}
	function i(i, a) {
		var s = (new Date).getTime(),
			r = 1e3 * (Math.floor(5 * Math.random()) + 1),
			o = parseInt(1e3 * i.sd, 10) || 0,
			l = i.ot - i.tm || 0,
			c = i.dt - i.tm || 0,
			d = {
				isValid: c > 0 ? 1 : 0,
				roomId: parseInt(i.rid, 10),
				treasureId: parseInt(i.rpid, 10),
				treasureType: parseInt(i.rpt, 10),
				treasureCloseBg: a[i.rpt] && a[i.rpt].web_wait_img ? a[i.rpt].web_wait_img : n.closeBg,
				treasureOpenBg: a[i.rpt] && a[i.rpt].web_open_img ? a[i.rpt].web_open_img : n.openBg,
				senderName: a[i.rpt] && a[i.rpt].treasure_name ? a[i.rpt].treasure_name : i.snk,
				senderAvatar: i.sic ? e.get("sys.avatar_url") + "upload/" + i.sic + "_small.jpg" : e.get("sys.web_url") + "app/douyu/res/com/defaultAvatar.png?v=20180511",
				senderUid: +i.sid,
				readyDesc: t(a[i.rpt].count_down_describe, "ready"),
				finishDesc: t(a[i.rpt].receive_describe, "finish"),
				effectTime: o,
				surplusTime: void 0 !== l && l >= 0 ? 1e3 * l + s + r : s + r,
				destroyTime: void 0 !== c && c >= 0 ? 1e3 * c + s + r : s + r,
				delayTime: r
			};
		return d
	}
	function a(i, a, s, r) {
		var o = (new Date).getTime(),
			l = 1e3 * (Math.floor(5 * Math.random()) + 1),
			c = s || [],
			d = [],
			u = 0,
			f = 0,
			p = 0,
			m = 0,
			h = {},
			g = {},
			v = {},
			y = 0,
			b = 0;
		for (f; f < i.length; f++) for (h = i[f], p = 0; p < c.length; p++) + h.rpid === +c[p] && (i.splice(f, 1), f--);
		for (m; m < i.length; m++) g = i[m], u = parseInt(1e3 * g.sd, 10) || 0, y = g.ot - a || 0, b = g.dt - a || 0, v = {
			isValid: b > 0 ? 1 : 0,
			roomId: $ROOM.room_id,
			treasureId: parseInt(g.rpid, 10),
			treasureType: parseInt(g.rpt, 10),
			treasureCloseBg: r[g.rpt] && r[g.rpt].web_wait_img ? r[g.rpt].web_wait_img : n.closeBg,
			treasureOpenBg: r[g.rpt] && r[g.rpt].web_open_img ? r[g.rpt].web_open_img : n.openBg,
			senderName: r[g.rpt] && r[g.rpt].treasure_name ? r[g.rpt].treasure_name : g.snk,
			senderAvatar: g.sic ? e.get("sys.avatar_url") + "upload/" + g.sic + "_small.jpg" : e.get("sys.web_url") + "app/douyu/res/com/defaultAvatar.png?v=20180511",
			senderUid: +g.sid,
			readyDesc: t(r[g.rpt].count_down_describe, "ready"),
			finishDesc: t(r[g.rpt].receive_describe, "finish"),
			effectTime: u,
			surplusTime: void 0 !== (void 0 !== y && y >= 0) ? 1e3 * y + o + l : o + l,
			destroyTime: void 0 !== b && b >= 0 ? 1e3 * b + o + l : o + l,
			delayTime: l
		}, v.isValid && d.push(v);
		return d.sort(function(e, t) {
			return e.surplusTime > t.surplusTime ? 1 : -1
		}), d
	}
	var n = {
		openBg: e.get("sys.web_url") + "app/douyu/res/page/room-normal/gift/peck-open.png?v=20180517",
		closeBg: e.get("sys.web_url") + "app/douyu/res/page/room-normal/gift/peck-close.png?v=20180517"
	};
	return {
		mapItem: i,
		mapList: a
	}
}), define("douyu/page/room/normal/mod/gift/view/treasure", ["jquery", "shark/util/lang/1.0", "shark/util/template/2.0", "shark/observer", "douyu/context"], function(e, t, i, a, n) {
	var s = e(".chat"),
		r = e("#js-chat-speak"),
		o = {
			init: function() {
				var e = t.string.join('<div class="peck peck-loading" id="treasure">', '<div class="peck-num"><span>x</span>', '<strong class="peck-number"></strong><i></i>', "</div>", '<div class="peck-tip">', '<div class="peck-tip-container">', '<div class="peck-tip-top">', '<img class="peck-tip-img" src="' + $SYS.res_url + 'douyu/images/defaultAvatar.png?20180507&amp;size=small"/>', '<div class="peck-tip-content">', '<span class="peck-tip-uname" title=""></span>', '<p class="peck-tip-status"></p>', '<i class="peck-tip-arrow peck-tip-arrow1"></i>', '<i class="peck-tip-arrow peck-tip-arrow2"></i>', "</div>", "</div>", "</div>", "</div>", '<div class="peck-status"><div class="peck-cd">', '</div><div class="peck-cdn">loading...</div>', "</div>", '<div class="peck-check-box" id="geetest-box">', '<span class="peck-check-lsq"></span>', '<span class="peck-check-off" data-geebox="off">×</span>', '<i class="peck-border-trg1"></i><i class="peck-border-trg2"></i>', '<div class="peck-check-title"><span>验证通过</span>后可以获得宝箱礼物</div>', '<div class="peck-check-inp clearfix">', '    <div class="captcha-gt"></div>', "</div>", "    </div>", "</div>");
				s.append(e)
			},
			dropDownStatus: function(e, t) {
				var i = s.find("#treasure"),
					a = s.outerHeight(!0) - (r.outerHeight(!0) || 0) - i.height() - 82,
					n = e.type,
					o = e.item;
				i.find(".peck-status").hide(), "Entrance" === n ? (i.show().css({
					top: a,
					backgroundImage: "url(" + o.treasureCloseBg + ")"
				}), "function" == typeof t ? t() : "") : "Polling" === n ? i.show().css({
					top: 0,
					backgroundImage: "url(" + o.treasureCloseBg + ")"
				}).animate({
					top: a
				}, 500, function() {
					"function" == typeof t ? t() : ""
				}) : (i.show().css({
					top: a,
					backgroundImage: "url(" + o.treasureCloseBg + ")"
				}), "function" == typeof t ? t() : "")
			},
			loadStatus: function(e, t) {
				var i = s.find("#treasure"),
					a = i.find(".peck-num"),
					n = e.item,
					o = e.queueLen,
					l = s.outerHeight(!0) - (r.outerHeight(!0) || 0) - i.height() - 82;
				i.find(".peck-number").text(o), o > 1 ? a.show() : a.hide(), i.css({
					top: l
				}), i.find(".peck-status").show(), i.find(".peck-tip-img").attr("src", n.senderAvatar), i.find(".peck-tip-uname").text(n.senderName).attr("title", n.senderName), i.find(".peck-tip-status").html(n.readyDesc), i.find(".peck-cdn").text("loading..."), i.removeClass("peck-open peck-close").addClass("peck-loading").find(".peck-cd").stop(!0, !0).css("width", 0).animate({
					width: "100%"
				}, n.delayTime, function() {
					i.removeClass("peck-loading peck-open").addClass("peck-close"), "function" == typeof t ? t() : ""
				})
			},
			countDownStatus: function(e) {
				var t = s.find("#treasure"),
					i = t.find(".peck-num"),
					a = e.queueLen,
					n = s.outerHeight(!0) - (r.outerHeight(!0) || 0) - t.height() - 82;
				t.find(".peck-number").text(a), a > 1 ? i.show() : i.hide(), t.css({
					top: n
				}), e.isDrawStatus ? (t.css({
					backgroundImage: "url(" + e.treasureBg + ")"
				}).removeClass("peck-close peck-loading").addClass("peck-open").find(".peck-cdn").text(e.timeText), t.find(".peck-tip-status").html(e.finishDesc)) : t.css({
					backgroundImage: "url(" + e.treasureBg + ")"
				}).find(".peck-cdn").text(e.timeText), e.bindStatus > 0 && t.find(".peck-cdn").addClass("noBind")
			},
			bindStatus: function() {
				var e, a;
				return e = t.string.join("{{ if (status > 0) }}", '<div class="peck-tips">', '<a href="javascript:;" data-type="close" class="peck-tips-close"></a>', "<p>", "绑定", "{{ if (status === 1) }}", "<span>手机</span>", "{{ /if }}", "后，才可以领取宝箱里的鱼丸哦！", "</p>", '<p class="link"><a href="/member/cp/cpBindPhone">立即绑定</a></p>', "</div>", "{{ /if }}"), a = i.compile(e)
			},
			luckUser: function() {
				var e, a;
				return e = t.string.join('<div class="gift-box-2000" data-gift="king">', "{{ if (isBestLuck) }}", '<div class="bonus-enter-wang">', '<div class="bonus-enter-wang-top"></div>', '<div class="bonus-enter-wang-bottom">', '恭喜<span class="bonus-name">{{ getName }}</span>领取了', '<span class="bonus-name">{{ sendName }}</span>派送的宝箱！获得<span class="bonus-detail">{{ ywNum }}鱼丸</span>，成为本场手气王！', "</div>", "</div>", "{{ else }}", '<div class="bonus-enter">', '恭喜<span class="bonus-name">{{ getName }}</span>领取了', '<span class="bonus-name">{{ sendName }}</span>派送的宝箱触发<span class="bonus-detail">暴击', "{{ if (rate > 1) }}", "X{{ rate }}", "{{ /if }}", "</span>获得", '<span class="bonus-detail">{{ ywNum }}鱼丸</span>', "</div>", "{{ /if }}", "</div>"), a = i.compile(e)
			}
		};
	return {
		init: o.init,
		drop: o.dropDownStatus,
		load: o.loadStatus,
		conut: o.countDownStatus,
		bind: o.bindStatus(),
		luckUser: o.luckUser()
	}
}), define("douyu/page/room/normal/mod/gift/base/extends", function() {
	var e = this && this.__extends ||
	function() {
		var e = Object.setPrototypeOf || {
			__proto__: []
		}
		instanceof Array &&
		function(e, t) {
			e.__proto__ = t
		} ||
		function(e, t) {
			for (var i in t) t.hasOwnProperty(i) && (e[i] = t[i])
		};
		return function(t, i) {
			function a() {
				this.constructor = t
			}
			e(t, i), t.prototype = null === i ? Object.create(i) : (a.prototype = i.prototype, new a)
		}
	}();
	return e
}), define("douyu/page/room/normal/mod/gift/base/model", ["douyu/page/room/normal/mod/gift/base/extends"], function(e) {
	var t = function() {
			function e(e, t) {
				this.data = e, this.localMapping = t
			}
			return e.prototype.toBackendModel = function() {}, e.prototype.fromBackendModel = function(e) {
				var t = {};
				for (var i in this.backendModelMap) {
					var a = this.backendModelMap[i];
					"string" == typeof a ? t[i] = e[a] : "function" == typeof a && (t[i] = a(e))
				}
				return this.data = t, this
			}, e
		}();
	return t
}), define("douyu/page/room/normal/mod/gift/base/queue", function() {
	var e = function() {
			function e() {
				var e = this;
				this.jobs = [], this.dfd = $.Deferred(), this.dfd.then(function() {
					e.feed()
				}), this.currentJobDfd = null
			}
			return e.prototype.addJob = function(e) {
				this.jobs.push(e), this.currentJobDfd || this.feed()
			}, e.prototype.removeJob = function(e) {}, e.prototype.feed = function() {
				var e = this.jobs.shift(),
					t = this;
				e ? this.dfd.then(function() {
					return this.currentJobDfd = e(), this.currentJobDfd
				}).then(function() {
					t.feed()
				}) : this.currentJobDfd = null
			}, e.prototype.run = function() {
				this.dfd.resolve()
			}, e.prototype.stop = function() {
				alert("stop queue"), this.currentJobDfd && this.currentJobDfd.reject()
			}, e.prototype.pause = function() {}, e
		}();
	return e
}), define("douyu/page/room/normal/mod/gift/model/commonmodel", ["jquery", "douyu/context", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/base/model", "douyu/page/room/normal/mod/gift/constants"], function(e, t, i, a, n) {
	var s = t.get("sys.web_url"),
		r = function(t) {
			function a(i, a) {
				var n = t.call(this, i, a) || this;
				return this.useFullData = {}, n.backendModelMap = e.extend({
					effect: "ef",
					smallGiftAnimateImg: function(e) {
						var t = e.small_effect_icon;
						if (e.small_effect_icon) return e.small_effect_icon;
						switch (parseInt(e.ef, 10)) {
						case 1:
							t = s + "app/douyu/res/page/room-normal/gift/rocketSmall.png?v=20170616";
							break;
						case 2:
							t = s + "app/douyu/res/page/room-normal/gift/planeSmall.png?v=20170616";
							break;
						case 3:
							t = s + "app/douyu/res/page/room-normal/gift/kissSmall.png?v=20170616";
							break;
						case 4:
							t = s + "app/douyu/res/page/room-normal/gift/carSmall.png?v=20170616";
							break;
						case 5:
							t = s + "app/douyu/res/page/room-normal/gift/shipSmall.png?v=20170616";
							break;
						case 101:
							t = s + "app/douyu/res/page/room-normal/gift/superRocketSmall.png?v=20170616"
						}
						return t
					},
					bigGiftAnimateImg: function(e) {
						var t = e.big_effect_icon;
						if (e.big_effect_icon) return e.big_effect_icon;
						switch (parseInt(e.ef, 10)) {
						case 1:
							t = s + "app/douyu/res/page/room-normal/gift/rocket.gif?v=20160322";
							break;
						case 2:
							t = s + "app/douyu/res/page/room-normal/gift/plane.png?v=20160322";
							break;
						case 3:
							break;
						case 4:
							break;
						case 5:
							break;
						case 101:
						}
						return t
					},
					effectIcon: function(e) {
						return (e.effect_icon || "").replace(/https?:/, "")
					},
					batchTemp: function(e) {
						return e.batchTemp || {}
					},
					batchNumArray: function(e) {
						var t = e.batchTemp || {},
							i = [];
						for (var a in t) i.push(a);
						return i.sort(function(e, t) {
							return e - t
						}), i
					},
					batchSmallIcon: function(e) {
						return e.pc_full_icon
					},
					giftAnimateAttachImg: function(e) {
						return e.swf ? e.swf : "/common/douyu/images/giftbatter/frog.swf?v=20170616"
					},
					giftAnimateAttachSwf: function(e) {
						var t = e.web_flash;
						if (e.web_flash) return e.web_flash = e.web_flash.replace(/https?:/, ""), e.web_flash;
						switch (parseInt(e.ef, 10)) {
						case 101:
							t = "/common/douyu/images/giftbatter/super-rocket.swf?v=20170616"
						}
						return t
					},
					giftIconImg: "gift_pic",
					bannerSenderNameColor: "urgb",
					giftName: "name",
					bannerGiftNameColor: "grgb",
					bannerBgImg: "bimg",
					bannerGiftImg: "himg",
					bannerWordColor: "drgb",
					bannerGiftBorderColor: "brgb",
					contribution: "devote",
					price: "pc",
					isBannerStay: "is_stay",
					bannerStayTime: "stay_time",
					effectType: "type",
					isNobleEffectShow: "is_special",
					openNobleBg: function(e) {
						var t = e.nobleBg;
						return e.nobleBg ? e.nobleBg : t = s + "/app/douyu/res/page/noble/noble-" + parseInt(e.nobleLev, 10) + ".png?v=20170916"
					},
					openNobleLev: "nobleLev",
					openNobleEffectFlash: function(e) {
						var t = e.nobleFlash;
						return e.nobleFlash ? (e.nobleFlash = e.nobleFlash.replace(/https?:/, ""), e.nobleFlash) : t = "/common/douyu/images/giftbatter/open-noble-" + parseInt(e.nobleLev, 10) + ".swf?v=20170916"
					}
				}, a), n.fromBackendModel(i), n
			}
			return i(a, t), a.prototype.mergeData = function(t) {
				var i = {};
				e.extend(!0, i, this.data, t.data), this.useFullData = i
			}, a
		}(a);
	return r
}), define("douyu/com/preload-file", ["jquery", "shark/util/storage/1.0"], function(e, t) {
	var i = {
		startLoadTime: 0,
		loadTimeOut: 5e3,
		expiredTime: 2592e3,
		movieIdOuter: "preload-movie-outer",
		movieIdInner: "preload-movie-inner",
		loadUrl: "",
		preloadFlag: "DY_preload_file",
		loopTimer: null,
		loopCheck: 200,
		deferred: null,
		fileTypes: {
			jpg: 0,
			jpeg: 0,
			png: 0,
			gif: 0,
			swf: 1
		}
	},
		a = {
			isIE: function() {
				return !!(window.ActiveXObject || "ActiveXObject" in window)
			},
			isPreloadFile: function() {
				var e = i.loadUrl.substring(i.loadUrl.indexOf("/") + 1),
					a = t.get(i.preloadFlag) || {};
				return !!a[e]
			},
			savePreloadFlag: function() {
				var e = i.loadUrl.substring(i.loadUrl.indexOf("/") + 1),
					a = t.get(i.preloadFlag) || {};
				a[e] = 1, t.set(i.preloadFlag, a, i.expiredTime)
			},
			addFlashTemplate: function() {
				var t = i,
					a = ['<object style="position:absolute; left:-9999px;" id="' + t.movieIdOuter + '" name="' + t.movieIdOuter + '" class="preload-movie-file" border="0" type="application/x-shockwave-flash" ', 'width="200" ', 'height="200">', '<param name="movie" value=" ' + t.loadUrl + ' ">', "</object>", '<embed style="position:absolute; left:-9999px;" src="' + t.loadUrl + '" id="' + t.movieIdInner + '" name="' + t.movieIdInner + '" ', ' width="200" height="200"></embed>'].join("");
				e("body").append(a)
			},
			removeFlashTemplate: function() {
				var t = e("#" + i.movieIdOuter);
				t && t.length && t.remove()
			},
			getLoadPrecent: function(e) {
				var t = 0;
				try {
					t = e.PercentLoaded()
				} catch (i) {}
				return t
			},
			listenFlashState: function() {
				var e = i,
					t = this.isIE(),
					a = t ? i.movieIdOuter : i.movieIdInner,
					n = document.getElementById(a),
					s = (new Date).getTime();
				return s - i.startLoadTime >= i.loadTimeOut ? e.deferred.resolve() : this.getLoadPrecent(n) >= 100 ? (clearInterval(e.loopTimer), this.removeFlashTemplate(), this.savePreloadFlag(), e.deferred.resolve()) : void 0
			},
			loadPng: function() {
				var e = new Image,
					t = i;
				return e.src = t.loadUrl, e.complete ? t.deferred.resolve() : void(e.onload = function() {
					return t.deferred.resolve()
				})
			},
			loadMovie: function(e) {
				var t = i,
					a = this;
				t.startLoadTime = (new Date).getTime(), a.addFlashTemplate(), t.loopTimer = setInterval(function() {
					a.listenFlashState()
				}, t.loopCheck)
			},
			checkFile: function(t) {
				var n, s = i,
					r = a;
				if (s.loadUrl = t, s.deferred = e.Deferred(), r.removeFlashTemplate(), !s.loadUrl) return s.deferred.reject();
				if (r.isPreloadFile()) return s.deferred.resolve();
				switch (n = s.loadUrl.indexOf("?") > 0 ? s.loadUrl.substring(0, s.loadUrl.lastIndexOf("?")) : s.loadUrl, n = n.substring(n.lastIndexOf(".") + 1).toLowerCase(), s.fileTypes[n]) {
				case 0:
					r.loadPng();
					break;
				case 1:
					r.loadMovie()
				}
				return s.deferred
			}
		};
	return {
		load: a.checkFile
	}
}), define("douyu/page/room/normal/mod/gift/base/view", ["jquery", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/base/queue", "douyu/page/room/normal/mod/gift/model/commonmodel", "douyu/com/get-gift-configs"], function(e, t, i, a, n) {
	var s = function() {
			function e(t) {
				this.element = t, this.giftConfig = e.giftDictionary, this.propConfig = e.propDictionary
			}
			return e.prototype.render = function() {
				throw new Error("子类必须实现该方法")
			}, e
		}();
	return s.giftDictionary = function() {
		var t, i = {},
			s = e.Deferred();
		return n.getGift().done(function(e) {
			t = e || {};
			for (var n in t) i[n] = new a(t[n]);
			return i
		}), s
	}(), s.propDictionary = function() {
		var t, i = {},
			s = e.Deferred();
		return n.getGift().done(function(e) {
			t = e || {};
			for (var n in t) i[n] = new a(t[n]);
			return i
		}), s
	}(), s
}), define("douyu/page/room/normal/mod/gift/view/open-noble", ["shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "shark/util/storage/1.0", "douyu/context", "douyu/com/preload-file", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/base/view", "douyu/page/room/normal/mod/gift/base/queue"], function(e, t, i, a, n, s, r, o, l, c) {
	var d = {
		isIE8: !("addEventListener" in window),
		webUrl: n.get("sys.web_url")
	},
		u = function(a) {
			function n(e) {
				var t = a.call(this, e) || this;
				return t.nobleEffectTime = {
					7: 4e3,
					1: 4e3,
					2: 4e3,
					3: 5e3,
					4: 6e3,
					5: 8e3,
					6: 1e4
				}, t.chatBox = e && e.chatBox || $("#js-chat-cont"), t.chatNobleEffectBox = $('<div class="noble-open-animation"></div>'), t.nobleHtml = {
					openNoble: n.prototype.effectTemp()
				}, t.chatBox.append(t.chatNobleEffectBox), t.chatNobleEffectBox.hide(), t.queue = new c, t.queue.run(), t
			}
			return o(n, a), n.prototype.effectTemp = function() {
				var e, a;
				return a = t.string.join('<div class="noble-open-effect-wrap">', '<div class="flash-wrap">', '<object id="open-noble-chat-flash" class="open-noble-chat-flash" border="0" type="application/x-shockwave-flash" ', 'align="middle" ', 'allowscriptaccess="always" ', 'allowfullscreen="true" ', 'allowfullscreeninteractive="true" ', 'wmode="transparent" ', 'width="100%" ', 'height="100%">', '<param name="src" value="{{ giftData.openNobleEffectFlash }}">', '<param name="quality" value="high">', '<param name="allowscriptaccess" value="always">', '<param name="allowfullscreen" value="true">', '<param name="wmode" value="transparent">', '<param name="allowFullScreenInteractive" value="true">', '<param name="flashvars" value="">', "</object>", "</div>", '<div class="noble-open-info">', '<span class="noble-pic">', '<img src="{{ giftData.openNobleAvatar }}" />', "</span>", '<img class="noble-open-info-bg" src="{{ giftData.openNobleBg }}" />', '<div class="noble-name">', '<span class="noble-name-txt" title="{{ giftData.senderName }}">{{ giftData.senderName }}</span>', '<span class="noble-id">开通{{ giftData.giftName }}</span>', "</div>", "</div>", "</div>"), e = i.compile(a)
			}, n.prototype.render = function(t, i) {
				var a, n = this,
					s = t.useFullData,
					o = n.nobleEffectTime[s.openNobleLev] || 4e3;
				d.isIE8 && (s.openNobleBg = d.webUrl + "/app/douyu/res/page/noble/noble-ie-" + parseInt(s.openNobleLev, 10) + ".png?v=20170916"), a = function() {
					var t = $.Deferred();
					return n.chatNobleEffectBox.animate({
						left: 0
					}, {
						duration: o,
						start: function() {
							var e = n.nobleHtml.openNoble({
								giftData: s
							});
							n.chatNobleEffectBox.html(e).show()
						},
						complete: function() {
							n.chatNobleEffectBox.hide().html(""), t.resolve(), e.fire(r.CHECK_USER_IS_BAN, s.senderId) || i()
						}
					}), t.name = "openNoble", t
				}, this.queue.addJob(a)
			}, n
		}(l);
	return {
		OpenNobleView: u
	}
}), !
function(e) {
	"object" == typeof exports && "undefined" != typeof module ? module.exports = e() : "function" == typeof define && define.amd ? define([], e) : ("undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : this).JSZip = e()
}(function() {
	return function e(t, i, a) {
		function n(r, o) {
			if (!i[r]) {
				if (!t[r]) {
					var l = "function" == typeof require && require;
					if (!o && l) return l(r, !0);
					if (s) return s(r, !0);
					var c = new Error("Cannot find module '" + r + "'");
					throw c.code = "MODULE_NOT_FOUND", c
				}
				var d = i[r] = {
					exports: {}
				};
				t[r][0].call(d.exports, function(e) {
					var i = t[r][1][e];
					return n(i || e)
				}, d, d.exports, e, t, i, a)
			}
			return i[r].exports
		}
		for (var s = "function" == typeof require && require, r = 0; r < a.length; r++) n(a[r]);
		return n
	}({
		1: [function(e, t, i) {
			"use strict";
			var a = e("./utils"),
				n = e("./support"),
				s = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
			i.encode = function(e) {
				for (var t, i, n, r, o, l, c, d = [], u = 0, f = e.length, p = f, m = "string" !== a.getTypeOf(e); u < e.length;) p = f - u, m ? (t = e[u++], i = f > u ? e[u++] : 0, n = f > u ? e[u++] : 0) : (t = e.charCodeAt(u++), i = f > u ? e.charCodeAt(u++) : 0, n = f > u ? e.charCodeAt(u++) : 0), r = t >> 2, o = (3 & t) << 4 | i >> 4, l = p > 1 ? (15 & i) << 2 | n >> 6 : 64, c = p > 2 ? 63 & n : 64, d.push(s.charAt(r) + s.charAt(o) + s.charAt(l) + s.charAt(c));
				return d.join("")
			}, i.decode = function(e) {
				var t, i, a, r, o, l, c = 0,
					d = 0,
					u = "data:";
				if (e.substr(0, u.length) === u) throw new Error("Invalid base64 input, it looks like a data url.");
				var f, p = 3 * (e = e.replace(/[^A-Za-z0-9\+\/\=]/g, "")).length / 4;
				if (e.charAt(e.length - 1) === s.charAt(64) && p--, e.charAt(e.length - 2) === s.charAt(64) && p--, p % 1 != 0) throw new Error("Invalid base64 input, bad content length.");
				for (f = n.uint8array ? new Uint8Array(0 | p) : new Array(0 | p); c < e.length;) t = s.indexOf(e.charAt(c++)) << 2 | (r = s.indexOf(e.charAt(c++))) >> 4, i = (15 & r) << 4 | (o = s.indexOf(e.charAt(c++))) >> 2, a = (3 & o) << 6 | (l = s.indexOf(e.charAt(c++))), f[d++] = t, 64 !== o && (f[d++] = i), 64 !== l && (f[d++] = a);
				return f
			}
		}, {
			"./support": 30,
			"./utils": 32
		}],
		2: [function(e, t, i) {
			"use strict";

			function a(e, t, i, a, n) {
				this.compressedSize = e, this.uncompressedSize = t, this.crc32 = i, this.compression = a, this.compressedContent = n
			}
			var n = e("./external"),
				s = e("./stream/DataWorker"),
				r = e("./stream/DataLengthProbe"),
				o = e("./stream/Crc32Probe");
			r = e("./stream/DataLengthProbe"), a.prototype = {
				getContentWorker: function() {
					var e = new s(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new r("data_length")),
						t = this;
					return e.on("end", function() {
						if (this.streamInfo.data_length !== t.uncompressedSize) throw new Error("Bug : uncompressed data size mismatch")
					}), e
				},
				getCompressedWorker: function() {
					return new s(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize", this.compressedSize).withStreamInfo("uncompressedSize", this.uncompressedSize).withStreamInfo("crc32", this.crc32).withStreamInfo("compression", this.compression)
				}
			}, a.createWorkerFrom = function(e, t, i) {
				return e.pipe(new o).pipe(new r("uncompressedSize")).pipe(t.compressWorker(i)).pipe(new r("compressedSize")).withStreamInfo("compression", t)
			}, t.exports = a
		}, {
			"./external": 6,
			"./stream/Crc32Probe": 25,
			"./stream/DataLengthProbe": 26,
			"./stream/DataWorker": 27
		}],
		3: [function(e, t, i) {
			"use strict";
			var a = e("./stream/GenericWorker");
			i.STORE = {
				magic: "\x00\x00",
				compressWorker: function(e) {
					return new a("STORE compression")
				},
				uncompressWorker: function() {
					return new a("STORE decompression")
				}
			}, i.DEFLATE = e("./flate")
		}, {
			"./flate": 7,
			"./stream/GenericWorker": 28
		}],
		4: [function(e, t, i) {
			"use strict";
			var a = e("./utils"),
				n = function() {
					for (var e, t = [], i = 0; 256 > i; i++) {
						e = i;
						for (var a = 0; 8 > a; a++) e = 1 & e ? 3988292384 ^ e >>> 1 : e >>> 1;
						t[i] = e
					}
					return t
				}();
			t.exports = function(e, t) {
				return void 0 !== e && e.length ? "string" !== a.getTypeOf(e) ?
				function(e, t, i, a) {
					var s = n,
						r = a + i;
					e ^= -1;
					for (var o = a; r > o; o++) e = e >>> 8 ^ s[255 & (e ^ t[o])];
					return -1 ^ e
				}(0 | t, e, e.length, 0) : function(e, t, i, a) {
					var s = n,
						r = a + i;
					e ^= -1;
					for (var o = a; r > o; o++) e = e >>> 8 ^ s[255 & (e ^ t.charCodeAt(o))];
					return -1 ^ e
				}(0 | t, e, e.length, 0) : 0
			}
		}, {
			"./utils": 32
		}],
		5: [function(e, t, i) {
			"use strict";
			i.base64 = !1, i.binary = !1, i.dir = !1, i.createFolders = !0, i.date = null, i.compression = null, i.compressionOptions = null, i.comment = null, i.unixPermissions = null, i.dosPermissions = null
		}, {}],
		6: [function(e, t, i) {
			"use strict";
			var a;
			a = "undefined" != typeof Promise ? Promise : e("lie"), t.exports = {
				Promise: a
			}
		}, {
			lie: 58
		}],
		7: [function(e, t, i) {
			"use strict";

			function a(e, t) {
				o.call(this, "FlateWorker/" + e), this._pako = new s[e]({
					raw: !0,
					level: t.level || -1
				}), this.meta = {};
				var i = this;
				this._pako.onData = function(e) {
					i.push({
						data: e,
						meta: i.meta
					})
				}
			}
			var n = "undefined" != typeof Uint8Array && "undefined" != typeof Uint16Array && "undefined" != typeof Uint32Array,
				s = e("pako"),
				r = e("./utils"),
				o = e("./stream/GenericWorker"),
				l = n ? "uint8array" : "array";
			i.magic = "\b\x00", r.inherits(a, o), a.prototype.processChunk = function(e) {
				this.meta = e.meta, this._pako.push(r.transformTo(l, e.data), !1)
			}, a.prototype.flush = function() {
				o.prototype.flush.call(this), this._pako.push([], !0)
			}, a.prototype.cleanUp = function() {
				o.prototype.cleanUp.call(this), this._pako = null
			}, i.compressWorker = function(e) {
				return new a("Deflate", e)
			}, i.uncompressWorker = function() {
				return new a("Inflate", {})
			}
		}, {
			"./stream/GenericWorker": 28,
			"./utils": 32,
			pako: 59
		}],
		8: [function(e, t, i) {
			"use strict";

			function a(e, t, i, a) {
				s.call(this, "ZipFileWorker"), this.bytesWritten = 0, this.zipComment = t, this.zipPlatform = i, this.encodeFileName = a, this.streamFiles = e, this.accumulate = !1, this.contentBuffer = [], this.dirRecords = [], this.currentSourceOffset = 0, this.entriesCount = 0, this.currentFile = null, this._sources = []
			}
			var n = e("../utils"),
				s = e("../stream/GenericWorker"),
				r = e("../utf8"),
				o = e("../crc32"),
				l = e("../signature"),
				c = function(e, t) {
					var i, a = "";
					for (i = 0; t > i; i++) a += String.fromCharCode(255 & e), e >>>= 8;
					return a
				},
				d = function(e, t, i, a, s, d) {
					var u, f, p = e.file,
						m = e.compression,
						h = d !== r.utf8encode,
						g = n.transformTo("string", d(p.name)),
						v = n.transformTo("string", r.utf8encode(p.name)),
						y = p.comment,
						b = n.transformTo("string", d(y)),
						k = n.transformTo("string", r.utf8encode(y)),
						w = v.length !== p.name.length,
						_ = k.length !== y.length,
						x = "",
						C = "",
						T = "",
						S = p.dir,
						I = p.date,
						j = {
							crc32: 0,
							compressedSize: 0,
							uncompressedSize: 0
						};
					t && !i || (j.crc32 = e.crc32, j.compressedSize = e.compressedSize, j.uncompressedSize = e.uncompressedSize);
					var $ = 0;
					t && ($ |= 8), h || !w && !_ || ($ |= 2048);
					var D, L, R, A = 0,
						N = 0;
					S && (A |= 16), "UNIX" === s ? (N = 798, D = p.unixPermissions, L = S, (R = D) || (R = L ? 16893 : 33204), A |= (65535 & R) << 16) : (N = 20, A |= 63 & (p.dosPermissions || 0)), u = I.getUTCHours(), u <<= 6, u |= I.getUTCMinutes(), u <<= 5, u |= I.getUTCSeconds() / 2, f = I.getUTCFullYear() - 1980, f <<= 4, f |= I.getUTCMonth() + 1, f <<= 5, f |= I.getUTCDate(), w && (C = c(1, 1) + c(o(g), 4) + v, x += "up" + c(C.length, 2) + C), _ && (T = c(1, 1) + c(o(b), 4) + k, x += "uc" + c(T.length, 2) + T);
					var E = "";
					return E += "\n\x00", E += c($, 2), E += m.magic, E += c(u, 2), E += c(f, 2), E += c(j.crc32, 4), E += c(j.compressedSize, 4), E += c(j.uncompressedSize, 4), E += c(g.length, 2), E += c(x.length, 2), {
						fileRecord: l.LOCAL_FILE_HEADER + E + g + x,
						dirRecord: l.CENTRAL_FILE_HEADER + c(N, 2) + E + c(b.length, 2) + "\x00\x00\x00\x00" + c(A, 4) + c(a, 4) + g + x + b
					}
				};
			n.inherits(a, s), a.prototype.push = function(e) {
				var t = e.meta.percent || 0,
					i = this.entriesCount,
					a = this._sources.length;
				this.accumulate ? this.contentBuffer.push(e) : (this.bytesWritten += e.data.length, s.prototype.push.call(this, {
					data: e.data,
					meta: {
						currentFile: this.currentFile,
						percent: i ? (t + 100 * (i - a - 1)) / i : 100
					}
				}))
			}, a.prototype.openedSource = function(e) {
				this.currentSourceOffset = this.bytesWritten, this.currentFile = e.file.name;
				var t = this.streamFiles && !e.file.dir;
				if (t) {
					var i = d(e, t, !1, this.currentSourceOffset, this.zipPlatform, this.encodeFileName);
					this.push({
						data: i.fileRecord,
						meta: {
							percent: 0
						}
					})
				} else this.accumulate = !0
			}, a.prototype.closedSource = function(e) {
				this.accumulate = !1;
				var t, i = this.streamFiles && !e.file.dir,
					a = d(e, i, !0, this.currentSourceOffset, this.zipPlatform, this.encodeFileName);
				if (this.dirRecords.push(a.dirRecord), i) this.push({
					data: (t = e, l.DATA_DESCRIPTOR + c(t.crc32, 4) + c(t.compressedSize, 4) + c(t.uncompressedSize, 4)),
					meta: {
						percent: 100
					}
				});
				else for (this.push({
					data: a.fileRecord,
					meta: {
						percent: 0
					}
				}); this.contentBuffer.length;) this.push(this.contentBuffer.shift());
				this.currentFile = null
			}, a.prototype.flush = function() {
				for (var e = this.bytesWritten, t = 0; t < this.dirRecords.length; t++) this.push({
					data: this.dirRecords[t],
					meta: {
						percent: 100
					}
				});
				var i, a, s, r, o, d, u = this.bytesWritten - e,
					f = (i = this.dirRecords.length, a = u, s = e, r = this.zipComment, o = this.encodeFileName, d = n.transformTo("string", o(r)), l.CENTRAL_DIRECTORY_END + "\x00\x00\x00\x00" + c(i, 2) + c(i, 2) + c(a, 4) + c(s, 4) + c(d.length, 2) + d);
				this.push({
					data: f,
					meta: {
						percent: 100
					}
				})
			}, a.prototype.prepareNextSource = function() {
				this.previous = this._sources.shift(), this.openedSource(this.previous.streamInfo), this.isPaused ? this.previous.pause() : this.previous.resume()
			}, a.prototype.registerPrevious = function(e) {
				this._sources.push(e);
				var t = this;
				return e.on("data", function(e) {
					t.processChunk(e)
				}), e.on("end", function() {
					t.closedSource(t.previous.streamInfo), t._sources.length ? t.prepareNextSource() : t.end()
				}), e.on("error", function(e) {
					t.error(e)
				}), this
			}, a.prototype.resume = function() {
				return !!s.prototype.resume.call(this) && (!this.previous && this._sources.length ? (this.prepareNextSource(), !0) : this.previous || this._sources.length || this.generatedError ? void 0 : (this.end(), !0))
			}, a.prototype.error = function(e) {
				var t = this._sources;
				if (!s.prototype.error.call(this, e)) return !1;
				for (var i = 0; i < t.length; i++) try {
					t[i].error(e)
				} catch (e) {}
				return !0
			}, a.prototype.lock = function() {
				s.prototype.lock.call(this);
				for (var e = this._sources, t = 0; t < e.length; t++) e[t].lock()
			}, t.exports = a
		}, {
			"../crc32": 4,
			"../signature": 23,
			"../stream/GenericWorker": 28,
			"../utf8": 31,
			"../utils": 32
		}],
		9: [function(e, t, i) {
			"use strict";
			var a = e("../compressions"),
				n = e("./ZipFileWorker");
			i.generateWorker = function(e, t, i) {
				var s = new n(t.streamFiles, i, t.platform, t.encodeFileName),
					r = 0;
				try {
					e.forEach(function(e, i) {
						r++;
						var n = function(e, t) {
								var i = e || t,
									n = a[i];
								if (!n) throw new Error(i + " is not a valid compression method !");
								return n
							}(i.options.compression, t.compression),
							o = i.options.compressionOptions || t.compressionOptions || {},
							l = i.dir,
							c = i.date;
						i._compressWorker(n, o).withStreamInfo("file", {
							name: e,
							dir: l,
							date: c,
							comment: i.comment || "",
							unixPermissions: i.unixPermissions,
							dosPermissions: i.dosPermissions
						}).pipe(s)
					}), s.entriesCount = r
				} catch (e) {
					s.error(e)
				}
				return s
			}
		}, {
			"../compressions": 3,
			"./ZipFileWorker": 8
		}],
		10: [function(e, t, i) {
			"use strict";

			function a() {
				if (!(this instanceof a)) return new a;
				if (arguments.length) throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");
				this.files = {}, this.comment = null, this.root = "", this.clone = function() {
					var e = new a;
					for (var t in this)"function" != typeof this[t] && (e[t] = this[t]);
					return e
				}
			}(a.prototype = e("./object")).loadAsync = e("./load"), a.support = e("./support"), a.defaults = e("./defaults"), a.version = "3.1.3", a.loadAsync = function(e, t) {
				return (new a).loadAsync(e, t)
			}, a.external = e("./external"), t.exports = a
		}, {
			"./defaults": 5,
			"./external": 6,
			"./load": 11,
			"./object": 15,
			"./support": 30
		}],
		11: [function(e, t, i) {
			"use strict";

			function a(e) {
				return new s.Promise(function(t, i) {
					var a = e.decompressed.getContentWorker().pipe(new l);
					a.on("error", function(e) {
						i(e)
					}).on("end", function() {
						a.streamInfo.crc32 !== e.decompressed.crc32 ? i(new Error("Corrupted zip : CRC32 mismatch")) : t()
					}).resume()
				})
			}
			var n = e("./utils"),
				s = e("./external"),
				r = e("./utf8"),
				o = (n = e("./utils"), e("./zipEntries")),
				l = e("./stream/Crc32Probe"),
				c = e("./nodejsUtils");
			t.exports = function(e, t) {
				var i = this;
				return t = n.extend(t || {}, {
					base64: !1,
					checkCRC32: !1,
					optimizedBinaryString: !1,
					createFolders: !1,
					decodeFileName: r.utf8decode
				}), c.isNode && c.isStream(e) ? s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")) : n.prepareContent("the loaded zip file", e, !0, t.optimizedBinaryString, t.base64).then(function(e) {
					var i = new o(t);
					return i.load(e), i
				}).then(function(e) {
					var i = [s.Promise.resolve(e)],
						n = e.files;
					if (t.checkCRC32) for (var r = 0; r < n.length; r++) i.push(a(n[r]));
					return s.Promise.all(i)
				}).then(function(e) {
					for (var a = e.shift(), n = a.files, s = 0; s < n.length; s++) {
						var r = n[s];
						i.file(r.fileNameStr, r.decompressed, {
							binary: !0,
							optimizedBinaryString: !0,
							date: r.date,
							dir: r.dir,
							comment: r.fileCommentStr.length ? r.fileCommentStr : null,
							unixPermissions: r.unixPermissions,
							dosPermissions: r.dosPermissions,
							createFolders: t.createFolders
						})
					}
					return a.zipComment.length && (i.comment = a.zipComment), i
				})
			}
		}, {
			"./external": 6,
			"./nodejsUtils": 14,
			"./stream/Crc32Probe": 25,
			"./utf8": 31,
			"./utils": 32,
			"./zipEntries": 33
		}],
		12: [function(e, t, i) {
			"use strict";

			function a(e, t) {
				s.call(this, "Nodejs stream input adapter for " + e), this._upstreamEnded = !1, this._bindStream(t)
			}
			var n = e("../utils"),
				s = e("../stream/GenericWorker");
			n.inherits(a, s), a.prototype._bindStream = function(e) {
				var t = this;
				(this._stream = e).pause(), e.on("data", function(e) {
					t.push({
						data: e,
						meta: {
							percent: 0
						}
					})
				}).on("error", function(e) {
					t.isPaused ? this.generatedError = e : t.error(e)
				}).on("end", function() {
					t.isPaused ? t._upstreamEnded = !0 : t.end()
				})
			}, a.prototype.pause = function() {
				return !!s.prototype.pause.call(this) && (this._stream.pause(), !0)
			}, a.prototype.resume = function() {
				return !!s.prototype.resume.call(this) && (this._upstreamEnded ? this.end() : this._stream.resume(), !0)
			}, t.exports = a
		}, {
			"../stream/GenericWorker": 28,
			"../utils": 32
		}],
		13: [function(e, t, i) {
			"use strict";

			function a(e, t, i) {
				n.call(this, t), this._helper = e;
				var a = this;
				e.on("data", function(e, t) {
					a.push(e) || a._helper.pause(), i && i(t)
				}).on("error", function(e) {
					a.emit("error", e)
				}).on("end", function() {
					a.push(null)
				})
			}
			var n = e("readable-stream").Readable;
			e("util").inherits(a, n), a.prototype._read = function() {
				this._helper.resume()
			}, t.exports = a
		}, {
			"readable-stream": 16,
			util: void 0
		}],
		14: [function(e, t, i) {
			"use strict";
			t.exports = {
				isNode: "undefined" != typeof Buffer,
				newBuffer: function(e, t) {
					return new Buffer(e, t)
				},
				isBuffer: function(e) {
					return Buffer.isBuffer(e)
				},
				isStream: function(e) {
					return e && "function" == typeof e.on && "function" == typeof e.pause && "function" == typeof e.resume
				}
			}
		}, {}],
		15: [function(e, t, i) {
			"use strict";

			function a(e) {
				return "[object RegExp]" === Object.prototype.toString.call(e)
			}
			var n = e("./utf8"),
				s = e("./utils"),
				r = e("./stream/GenericWorker"),
				o = e("./stream/StreamHelper"),
				l = e("./defaults"),
				c = e("./compressedObject"),
				d = e("./zipObject"),
				u = e("./generate"),
				f = e("./nodejsUtils"),
				p = e("./nodejs/NodejsStreamInputAdapter"),
				m = function(e, t, i) {
					var a, n = s.getTypeOf(t),
						o = s.extend(i || {}, l);
					o.date = o.date || new Date, null !== o.compression && (o.compression = o.compression.toUpperCase()), "string" == typeof o.unixPermissions && (o.unixPermissions = parseInt(o.unixPermissions, 8)), o.unixPermissions && 16384 & o.unixPermissions && (o.dir = !0), o.dosPermissions && 16 & o.dosPermissions && (o.dir = !0), o.dir && (e = g(e)), o.createFolders && (a = h(e)) && v.call(this, a, !0);
					var u = "string" === n && !1 === o.binary && !1 === o.base64;
					i && void 0 !== i.binary || (o.binary = !u), (t instanceof c && 0 === t.uncompressedSize || o.dir || !t || 0 === t.length) && (o.base64 = !1, o.binary = !0, t = "", o.compression = "STORE", n = "string");
					var m;
					m = t instanceof c || t instanceof r ? t : f.isNode && f.isStream(t) ? new p(e, t) : s.prepareContent(e, t, o.binary, o.optimizedBinaryString, o.base64);
					var y = new d(e, m, o);
					this.files[e] = y
				},
				h = function(e) {
					"/" === e.slice(-1) && (e = e.substring(0, e.length - 1));
					var t = e.lastIndexOf("/");
					return t > 0 ? e.substring(0, t) : ""
				},
				g = function(e) {
					return "/" !== e.slice(-1) && (e += "/"), e
				},
				v = function(e, t) {
					return t = void 0 !== t ? t : l.createFolders, e = g(e), this.files[e] || m.call(this, e, null, {
						dir: !0,
						createFolders: t
					}), this.files[e]
				},
				y = {
					load: function() {
						throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")
					},
					forEach: function(e) {
						var t, i, a;
						for (t in this.files) this.files.hasOwnProperty(t) && (a = this.files[t], (i = t.slice(this.root.length, t.length)) && t.slice(0, this.root.length) === this.root && e(i, a))
					},
					filter: function(e) {
						var t = [];
						return this.forEach(function(i, a) {
							e(i, a) && t.push(a)
						}), t
					},
					file: function(e, t, i) {
						if (1 === arguments.length) {
							if (a(e)) {
								var n = e;
								return this.filter(function(e, t) {
									return !t.dir && n.test(e)
								})
							}
							var s = this.files[this.root + e];
							return s && !s.dir ? s : null
						}
						return e = this.root + e, m.call(this, e, t, i), this
					},
					folder: function(e) {
						if (!e) return this;
						if (a(e)) return this.filter(function(t, i) {
							return i.dir && e.test(t)
						});
						var t = this.root + e,
							i = v.call(this, t),
							n = this.clone();
						return n.root = i.name, n
					},
					remove: function(e) {
						e = this.root + e;
						var t = this.files[e];
						if (t || ("/" !== e.slice(-1) && (e += "/"), t = this.files[e]), t && !t.dir) delete this.files[e];
						else for (var i = this.filter(function(t, i) {
							return i.name.slice(0, e.length) === e
						}), a = 0; a < i.length; a++) delete this.files[i[a].name];
						return this
					},
					generate: function(e) {
						throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")
					},
					generateInternalStream: function(e) {
						var t, i = {};
						try {
							if ((i = s.extend(e || {}, {
								streamFiles: !1,
								compression: "STORE",
								compressionOptions: null,
								type: "",
								platform: "DOS",
								comment: null,
								mimeType: "application/zip",
								encodeFileName: n.utf8encode
							})).type = i.type.toLowerCase(), i.compression = i.compression.toUpperCase(), "binarystring" === i.type && (i.type = "string"), !i.type) throw new Error("No output type specified.");
							s.checkSupport(i.type), "darwin" !== i.platform && "freebsd" !== i.platform && "linux" !== i.platform && "sunos" !== i.platform || (i.platform = "UNIX"), "win32" === i.platform && (i.platform = "DOS");
							var a = i.comment || this.comment || "";
							t = u.generateWorker(this, i, a)
						} catch (e) {
							(t = new r("error")).error(e)
						}
						return new o(t, i.type || "string", i.mimeType)
					},
					generateAsync: function(e, t) {
						return this.generateInternalStream(e).accumulate(t)
					},
					generateNodeStream: function(e, t) {
						return (e = e || {}).type || (e.type = "nodebuffer"), this.generateInternalStream(e).toNodejsStream(t)
					}
				};
			t.exports = y
		}, {
			"./compressedObject": 2,
			"./defaults": 5,
			"./generate": 9,
			"./nodejs/NodejsStreamInputAdapter": 12,
			"./nodejsUtils": 14,
			"./stream/GenericWorker": 28,
			"./stream/StreamHelper": 29,
			"./utf8": 31,
			"./utils": 32,
			"./zipObject": 35
		}],
		16: [function(e, t, i) {
			t.exports = e("stream")
		}, {
			stream: void 0
		}],
		17: [function(e, t, i) {
			"use strict";

			function a(e) {
				n.call(this, e);
				for (var t = 0; t < this.data.length; t++) e[t] = 255 & e[t]
			}
			var n = e("./DataReader");
			e("../utils").inherits(a, n), a.prototype.byteAt = function(e) {
				return this.data[this.zero + e]
			}, a.prototype.lastIndexOfSignature = function(e) {
				for (var t = e.charCodeAt(0), i = e.charCodeAt(1), a = e.charCodeAt(2), n = e.charCodeAt(3), s = this.length - 4; s >= 0; --s) if (this.data[s] === t && this.data[s + 1] === i && this.data[s + 2] === a && this.data[s + 3] === n) return s - this.zero;
				return -1
			}, a.prototype.readAndCheckSignature = function(e) {
				var t = e.charCodeAt(0),
					i = e.charCodeAt(1),
					a = e.charCodeAt(2),
					n = e.charCodeAt(3),
					s = this.readData(4);
				return t === s[0] && i === s[1] && a === s[2] && n === s[3]
			}, a.prototype.readData = function(e) {
				if (this.checkOffset(e), 0 === e) return [];
				var t = this.data.slice(this.zero + this.index, this.zero + this.index + e);
				return this.index += e, t
			}, t.exports = a
		}, {
			"../utils": 32,
			"./DataReader": 18
		}],
		18: [function(e, t, i) {
			"use strict";

			function a(e) {
				this.data = e, this.length = e.length, this.index = 0, this.zero = 0
			}
			var n = e("../utils");
			a.prototype = {
				checkOffset: function(e) {
					this.checkIndex(this.index + e)
				},
				checkIndex: function(e) {
					if (this.length < this.zero + e || 0 > e) throw new Error("End of data reached (data length = " + this.length + ", asked index = " + e + "). Corrupted zip ?")
				},
				setIndex: function(e) {
					this.checkIndex(e), this.index = e
				},
				skip: function(e) {
					this.setIndex(this.index + e)
				},
				byteAt: function(e) {},
				readInt: function(e) {
					var t, i = 0;
					for (this.checkOffset(e), t = this.index + e - 1; t >= this.index; t--) i = (i << 8) + this.byteAt(t);
					return this.index += e, i
				},
				readString: function(e) {
					return n.transformTo("string", this.readData(e))
				},
				readData: function(e) {},
				lastIndexOfSignature: function(e) {},
				readAndCheckSignature: function(e) {},
				readDate: function() {
					var e = this.readInt(4);
					return new Date(Date.UTC(1980 + (e >> 25 & 127), (e >> 21 & 15) - 1, e >> 16 & 31, e >> 11 & 31, e >> 5 & 63, (31 & e) << 1))
				}
			}, t.exports = a
		}, {
			"../utils": 32
		}],
		19: [function(e, t, i) {
			"use strict";

			function a(e) {
				n.call(this, e)
			}
			var n = e("./Uint8ArrayReader");
			e("../utils").inherits(a, n), a.prototype.readData = function(e) {
				this.checkOffset(e);
				var t = this.data.slice(this.zero + this.index, this.zero + this.index + e);
				return this.index += e, t
			}, t.exports = a
		}, {
			"../utils": 32,
			"./Uint8ArrayReader": 21
		}],
		20: [function(e, t, i) {
			"use strict";

			function a(e) {
				n.call(this, e)
			}
			var n = e("./DataReader");
			e("../utils").inherits(a, n), a.prototype.byteAt = function(e) {
				return this.data.charCodeAt(this.zero + e)
			}, a.prototype.lastIndexOfSignature = function(e) {
				return this.data.lastIndexOf(e) - this.zero
			}, a.prototype.readAndCheckSignature = function(e) {
				return e === this.readData(4)
			}, a.prototype.readData = function(e) {
				this.checkOffset(e);
				var t = this.data.slice(this.zero + this.index, this.zero + this.index + e);
				return this.index += e, t
			}, t.exports = a
		}, {
			"../utils": 32,
			"./DataReader": 18
		}],
		21: [function(e, t, i) {
			"use strict";

			function a(e) {
				n.call(this, e)
			}
			var n = e("./ArrayReader");
			e("../utils").inherits(a, n), a.prototype.readData = function(e) {
				if (this.checkOffset(e), 0 === e) return new Uint8Array(0);
				var t = this.data.subarray(this.zero + this.index, this.zero + this.index + e);
				return this.index += e, t
			}, t.exports = a
		}, {
			"../utils": 32,
			"./ArrayReader": 17
		}],
		22: [function(e, t, i) {
			"use strict";
			var a = e("../utils"),
				n = e("../support"),
				s = e("./ArrayReader"),
				r = e("./StringReader"),
				o = e("./NodeBufferReader"),
				l = e("./Uint8ArrayReader");
			t.exports = function(e) {
				var t = a.getTypeOf(e);
				return a.checkSupport(t), "string" !== t || n.uint8array ? "nodebuffer" === t ? new o(e) : n.uint8array ? new l(a.transformTo("uint8array", e)) : new s(a.transformTo("array", e)) : new r(e)
			}
		}, {
			"../support": 30,
			"../utils": 32,
			"./ArrayReader": 17,
			"./NodeBufferReader": 19,
			"./StringReader": 20,
			"./Uint8ArrayReader": 21
		}],
		23: [function(e, t, i) {
			"use strict";
			i.LOCAL_FILE_HEADER = "PK", i.CENTRAL_FILE_HEADER = "PK", i.CENTRAL_DIRECTORY_END = "PK", i.ZIP64_CENTRAL_DIRECTORY_LOCATOR = "PK", i.ZIP64_CENTRAL_DIRECTORY_END = "PK", i.DATA_DESCRIPTOR = "PK\b"
		}, {}],
		24: [function(e, t, i) {
			"use strict";

			function a(e) {
				n.call(this, "ConvertWorker to " + e), this.destType = e
			}
			var n = e("./GenericWorker"),
				s = e("../utils");
			s.inherits(a, n), a.prototype.processChunk = function(e) {
				this.push({
					data: s.transformTo(this.destType, e.data),
					meta: e.meta
				})
			}, t.exports = a
		}, {
			"../utils": 32,
			"./GenericWorker": 28
		}],
		25: [function(e, t, i) {
			"use strict";

			function a() {
				n.call(this, "Crc32Probe"), this.withStreamInfo("crc32", 0)
			}
			var n = e("./GenericWorker"),
				s = e("../crc32");
			e("../utils").inherits(a, n), a.prototype.processChunk = function(e) {
				this.streamInfo.crc32 = s(e.data, this.streamInfo.crc32 || 0), this.push(e)
			}, t.exports = a
		}, {
			"../crc32": 4,
			"../utils": 32,
			"./GenericWorker": 28
		}],
		26: [function(e, t, i) {
			"use strict";

			function a(e) {
				s.call(this, "DataLengthProbe for " + e), this.propName = e, this.withStreamInfo(e, 0)
			}
			var n = e("../utils"),
				s = e("./GenericWorker");
			n.inherits(a, s), a.prototype.processChunk = function(e) {
				if (e) {
					var t = this.streamInfo[this.propName] || 0;
					this.streamInfo[this.propName] = t + e.data.length
				}
				s.prototype.processChunk.call(this, e)
			}, t.exports = a
		}, {
			"../utils": 32,
			"./GenericWorker": 28
		}],
		27: [function(e, t, i) {
			"use strict";

			function a(e) {
				s.call(this, "DataWorker");
				var t = this;
				this.dataIsReady = !1, this.index = 0, this.max = 0, this.data = null, this.type = "", this._tickScheduled = !1, e.then(function(e) {
					t.dataIsReady = !0, t.data = e, t.max = e && e.length || 0, t.type = n.getTypeOf(e), t.isPaused || t._tickAndRepeat()
				}, function(e) {
					t.error(e)
				})
			}
			var n = e("../utils"),
				s = e("./GenericWorker");
			n.inherits(a, s), a.prototype.cleanUp = function() {
				s.prototype.cleanUp.call(this), this.data = null
			}, a.prototype.resume = function() {
				return !!s.prototype.resume.call(this) && (!this._tickScheduled && this.dataIsReady && (this._tickScheduled = !0, n.delay(this._tickAndRepeat, [], this)), !0)
			}, a.prototype._tickAndRepeat = function() {
				this._tickScheduled = !1, this.isPaused || this.isFinished || (this._tick(), this.isFinished || (n.delay(this._tickAndRepeat, [], this), this._tickScheduled = !0))
			}, a.prototype._tick = function() {
				if (this.isPaused || this.isFinished) return !1;
				var e = null,
					t = Math.min(this.max, this.index + 16384);
				if (this.index >= this.max) return this.end();
				switch (this.type) {
				case "string":
					e = this.data.substring(this.index, t);
					break;
				case "uint8array":
					e = this.data.subarray(this.index, t);
					break;
				case "array":
				case "nodebuffer":
					e = this.data.slice(this.index, t)
				}
				return this.index = t, this.push({
					data: e,
					meta: {
						percent: this.max ? this.index / this.max * 100 : 0
					}
				})
			}, t.exports = a
		}, {
			"../utils": 32,
			"./GenericWorker": 28
		}],
		28: [function(e, t, i) {
			"use strict";

			function a(e) {
				this.name = e || "default", this.streamInfo = {}, this.generatedError = null, this.extraStreamInfo = {}, this.isPaused = !0, this.isFinished = !1, this.isLocked = !1, this._listeners = {
					data: [],
					end: [],
					error: []
				}, this.previous = null
			}
			a.prototype = {
				push: function(e) {
					this.emit("data", e)
				},
				end: function() {
					if (this.isFinished) return !1;
					this.flush();
					try {
						this.emit("end"), this.cleanUp(), this.isFinished = !0
					} catch (e) {
						this.emit("error", e)
					}
					return !0
				},
				error: function(e) {
					return !this.isFinished && (this.isPaused ? this.generatedError = e : (this.isFinished = !0, this.emit("error", e), this.previous && this.previous.error(e), this.cleanUp()), !0)
				},
				on: function(e, t) {
					return this._listeners[e].push(t), this
				},
				cleanUp: function() {
					this.streamInfo = this.generatedError = this.extraStreamInfo = null, this._listeners = []
				},
				emit: function(e, t) {
					if (this._listeners[e]) for (var i = 0; i < this._listeners[e].length; i++) this._listeners[e][i].call(this, t)
				},
				pipe: function(e) {
					return e.registerPrevious(this)
				},
				registerPrevious: function(e) {
					if (this.isLocked) throw new Error("The stream '" + this + "' has already been used.");
					this.streamInfo = e.streamInfo, this.mergeStreamInfo(), this.previous = e;
					var t = this;
					return e.on("data", function(e) {
						t.processChunk(e)
					}), e.on("end", function() {
						t.end()
					}), e.on("error", function(e) {
						t.error(e)
					}), this
				},
				pause: function() {
					return !this.isPaused && !this.isFinished && (this.isPaused = !0, this.previous && this.previous.pause(), !0)
				},
				resume: function() {
					if (!this.isPaused || this.isFinished) return !1;
					var e = this.isPaused = !1;
					return this.generatedError && (this.error(this.generatedError), e = !0), this.previous && this.previous.resume(), !e
				},
				flush: function() {},
				processChunk: function(e) {
					this.push(e)
				},
				withStreamInfo: function(e, t) {
					return this.extraStreamInfo[e] = t, this.mergeStreamInfo(), this
				},
				mergeStreamInfo: function() {
					for (var e in this.extraStreamInfo) this.extraStreamInfo.hasOwnProperty(e) && (this.streamInfo[e] = this.extraStreamInfo[e])
				},
				lock: function() {
					if (this.isLocked) throw new Error("The stream '" + this + "' has already been used.");
					this.isLocked = !0, this.previous && this.previous.lock()
				},
				toString: function() {
					var e = "Worker " + this.name;
					return this.previous ? this.previous + " -> " + e : e
				}
			}, t.exports = a
		}, {}],
		29: [function(e, t, i) {
			"use strict";

			function a(e, t) {
				var i, a = 0,
					n = null,
					s = 0;
				for (i = 0; i < t.length; i++) s += t[i].length;
				switch (e) {
				case "string":
					return t.join("");
				case "array":
					return Array.prototype.concat.apply([], t);
				case "uint8array":
					for (n = new Uint8Array(s), i = 0; i < t.length; i++) n.set(t[i], a), a += t[i].length;
					return n;
				case "nodebuffer":
					return Buffer.concat(t);
				default:
					throw new Error("concat : unsupported type '" + e + "'")
				}
			}
			function n(e, t) {
				return new u.Promise(function(i, n) {
					var s = [],
						o = e._internalType,
						l = e._outputType,
						d = e._mimeType;
					e.on("data", function(e, i) {
						s.push(e), t && t(i)
					}).on("error", function(e) {
						s = [], n(e)
					}).on("end", function() {
						try {
							var e = function(e, t, i, n) {
									var s = null;
									switch (e) {
									case "blob":
										return r.newBlob(i, n);
									case "base64":
										return s = a(t, i), c.encode(s);
									default:
										return s = a(t, i), r.transformTo(e, s)
									}
								}(l, o, s, d);
							i(e)
						} catch (e) {
							n(e)
						}
						s = []
					}).resume()
				})
			}
			function s(e, t, i) {
				var a = t;
				switch (t) {
				case "blob":
					a = "arraybuffer";
					break;
				case "arraybuffer":
					a = "uint8array";
					break;
				case "base64":
					a = "string"
				}
				try {
					this._internalType = a, this._outputType = t, this._mimeType = i, r.checkSupport(a), this._worker = e.pipe(new o(a)), e.lock()
				} catch (e) {
					this._worker = new l("error"), this._worker.error(e)
				}
			}
			var r = e("../utils"),
				o = e("./ConvertWorker"),
				l = e("./GenericWorker"),
				c = e("../base64"),
				d = e("../support"),
				u = e("../external"),
				f = null;
			if (d.nodestream) try {
				f = e("../nodejs/NodejsStreamOutputAdapter")
			} catch (e) {}
			s.prototype = {
				accumulate: function(e) {
					return n(this, e)
				},
				on: function(e, t) {
					var i = this;
					return "data" === e ? this._worker.on(e, function(e) {
						t.call(i, e.data, e.meta)
					}) : this._worker.on(e, function() {
						r.delay(t, arguments, i)
					}), this
				},
				resume: function() {
					return r.delay(this._worker.resume, [], this._worker), this
				},
				pause: function() {
					return this._worker.pause(), this
				},
				toNodejsStream: function(e) {
					if (r.checkSupport("nodestream"), "nodebuffer" !== this._outputType) throw new Error(this._outputType + " is not supported by this method");
					return new f(this, {
						objectMode: "nodebuffer" !== this._outputType
					}, e)
				}
			}, t.exports = s
		}, {
			"../base64": 1,
			"../external": 6,
			"../nodejs/NodejsStreamOutputAdapter": 13,
			"../support": 30,
			"../utils": 32,
			"./ConvertWorker": 24,
			"./GenericWorker": 28
		}],
		30: [function(e, t, i) {
			"use strict";
			if (i.base64 = !0, i.array = !0, i.string = !0, i.arraybuffer = "undefined" != typeof ArrayBuffer && "undefined" != typeof Uint8Array, i.nodebuffer = "undefined" != typeof Buffer, i.uint8array = "undefined" != typeof Uint8Array, "undefined" == typeof ArrayBuffer) i.blob = !1;
			else {
				var a = new ArrayBuffer(0);
				try {
					i.blob = 0 === new Blob([a], {
						type: "application/zip"
					}).size
				} catch (e) {
					try {
						var n = new(window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder);
						n.append(a), i.blob = 0 === n.getBlob("application/zip").size
					} catch (e) {
						i.blob = !1
					}
				}
			}
			try {
				i.nodestream = !! e("readable-stream").Readable
			} catch (e) {
				i.nodestream = !1
			}
		}, {
			"readable-stream": 16
		}],
		31: [function(e, t, i) {
			"use strict";

			function a() {
				l.call(this, "utf-8 decode"), this.leftOver = null
			}
			function n() {
				l.call(this, "utf-8 encode")
			}
			for (var s = e("./utils"), r = e("./support"), o = e("./nodejsUtils"), l = e("./stream/GenericWorker"), c = new Array(256), d = 0; 256 > d; d++) c[d] = d >= 252 ? 6 : d >= 248 ? 5 : d >= 240 ? 4 : d >= 224 ? 3 : d >= 192 ? 2 : 1;
			c[254] = c[254] = 1, i.utf8encode = function(e) {
				return r.nodebuffer ? o.newBuffer(e, "utf-8") : function(e) {
					var t, i, a, n, s, o = e.length,
						l = 0;
					for (n = 0; o > n; n++) 55296 == (64512 & (i = e.charCodeAt(n))) && o > n + 1 && 56320 == (64512 & (a = e.charCodeAt(n + 1))) && (i = 65536 + (i - 55296 << 10) + (a - 56320), n++), l += 128 > i ? 1 : 2048 > i ? 2 : 65536 > i ? 3 : 4;
					for (t = r.uint8array ? new Uint8Array(l) : new Array(l), n = s = 0; l > s; n++) 55296 == (64512 & (i = e.charCodeAt(n))) && o > n + 1 && 56320 == (64512 & (a = e.charCodeAt(n + 1))) && (i = 65536 + (i - 55296 << 10) + (a - 56320), n++), 128 > i ? t[s++] = i : (2048 > i ? t[s++] = 192 | i >>> 6 : (65536 > i ? t[s++] = 224 | i >>> 12 : (t[s++] = 240 | i >>> 18, t[s++] = 128 | i >>> 12 & 63), t[s++] = 128 | i >>> 6 & 63), t[s++] = 128 | 63 & i);
					return t
				}(e)
			}, i.utf8decode = function(e) {
				return r.nodebuffer ? s.transformTo("nodebuffer", e).toString("utf-8") : function(e) {
					var t, i, a, n, r = e.length,
						o = new Array(2 * r);
					for (t = i = 0; r > t;) if ((a = e[t++]) < 128) o[i++] = a;
					else if (4 < (n = c[a])) o[i++] = 65533, t += n - 1;
					else {
						for (a &= 2 === n ? 31 : 3 === n ? 15 : 7; n > 1 && r > t;) a = a << 6 | 63 & e[t++], n--;
						n > 1 ? o[i++] = 65533 : 65536 > a ? o[i++] = a : (a -= 65536, o[i++] = 55296 | a >> 10 & 1023, o[i++] = 56320 | 1023 & a)
					}
					return o.length !== i && (o.subarray ? o = o.subarray(0, i) : o.length = i), s.applyFromCharCode(o)
				}(e = s.transformTo(r.uint8array ? "uint8array" : "array", e))
			}, s.inherits(a, l), a.prototype.processChunk = function(e) {
				var t = s.transformTo(r.uint8array ? "uint8array" : "array", e.data);
				if (this.leftOver && this.leftOver.length) {
					if (r.uint8array) {
						var a = t;
						(t = new Uint8Array(a.length + this.leftOver.length)).set(this.leftOver, 0), t.set(a, this.leftOver.length)
					} else t = this.leftOver.concat(t);
					this.leftOver = null
				}
				var n = function(e, t) {
						var i;
						for ((t = t || e.length) > e.length && (t = e.length), i = t - 1; i >= 0 && 128 == (192 & e[i]);) i--;
						return 0 > i ? t : 0 === i ? t : i + c[e[i]] > t ? i : t
					}(t),
					o = t;
				n !== t.length && (r.uint8array ? (o = t.subarray(0, n), this.leftOver = t.subarray(n, t.length)) : (o = t.slice(0, n), this.leftOver = t.slice(n, t.length))), this.push({
					data: i.utf8decode(o),
					meta: e.meta
				})
			}, a.prototype.flush = function() {
				this.leftOver && this.leftOver.length && (this.push({
					data: i.utf8decode(this.leftOver),
					meta: {}
				}), this.leftOver = null)
			}, i.Utf8DecodeWorker = a, s.inherits(n, l), n.prototype.processChunk = function(e) {
				this.push({
					data: i.utf8encode(e.data),
					meta: e.meta
				})
			}, i.Utf8EncodeWorker = n
		}, {
			"./nodejsUtils": 14,
			"./stream/GenericWorker": 28,
			"./support": 30,
			"./utils": 32
		}],
		32: [function(e, t, i) {
			"use strict";

			function a(e) {
				return e
			}
			function n(e, t) {
				for (var i = 0; i < e.length; ++i) t[i] = 255 & e.charCodeAt(i);
				return t
			}
			function s(e) {
				var t = 65536,
					a = i.getTypeOf(e),
					n = !0;
				if ("uint8array" === a ? n = f.applyCanBeUsed.uint8array : "nodebuffer" === a && (n = f.applyCanBeUsed.nodebuffer), n) for (; t > 1;) try {
					return f.stringifyByChunk(e, a, t)
				} catch (e) {
					t = Math.floor(t / 2)
				}
				return f.stringifyByChar(e)
			}
			function r(e, t) {
				for (var i = 0; i < e.length; i++) t[i] = e[i];
				return t
			}
			var o = e("./support"),
				l = e("./base64"),
				c = e("./nodejsUtils"),
				d = e("core-js/library/fn/set-immediate"),
				u = e("./external");
			i.newBlob = function(e, t) {
				i.checkSupport("blob");
				try {
					return new Blob(e, {
						type: t
					})
				} catch (a) {
					try {
						for (var n = new(window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder), s = 0; s < e.length; s++) n.append(e[s]);
						return n.getBlob(t)
					} catch (a) {
						throw new Error("Bug : can't construct the Blob.")
					}
				}
			};
			var f = {
				stringifyByChunk: function(e, t, i) {
					var a = [],
						n = 0,
						s = e.length;
					if (i >= s) return String.fromCharCode.apply(null, e);
					for (; s > n;)"array" === t || "nodebuffer" === t ? a.push(String.fromCharCode.apply(null, e.slice(n, Math.min(n + i, s)))) : a.push(String.fromCharCode.apply(null, e.subarray(n, Math.min(n + i, s)))), n += i;
					return a.join("")
				},
				stringifyByChar: function(e) {
					for (var t = "", i = 0; i < e.length; i++) t += String.fromCharCode(e[i]);
					return t
				},
				applyCanBeUsed: {
					uint8array: function() {
						try {
							return o.uint8array && 1 === String.fromCharCode.apply(null, new Uint8Array(1)).length
						} catch (e) {
							return !1
						}
					}(),
					nodebuffer: function() {
						try {
							return o.nodebuffer && 1 === String.fromCharCode.apply(null, c.newBuffer(1)).length
						} catch (e) {
							return !1
						}
					}()
				}
			};
			i.applyFromCharCode = s;
			var p = {};
			p.string = {
				string: a,
				array: function(e) {
					return n(e, new Array(e.length))
				},
				arraybuffer: function(e) {
					return p.string.uint8array(e).buffer
				},
				uint8array: function(e) {
					return n(e, new Uint8Array(e.length))
				},
				nodebuffer: function(e) {
					return n(e, c.newBuffer(e.length))
				}
			}, p.array = {
				string: s,
				array: a,
				arraybuffer: function(e) {
					return new Uint8Array(e).buffer
				},
				uint8array: function(e) {
					return new Uint8Array(e)
				},
				nodebuffer: function(e) {
					return c.newBuffer(e)
				}
			}, p.arraybuffer = {
				string: function(e) {
					return s(new Uint8Array(e))
				},
				array: function(e) {
					return r(new Uint8Array(e), new Array(e.byteLength))
				},
				arraybuffer: a,
				uint8array: function(e) {
					return new Uint8Array(e)
				},
				nodebuffer: function(e) {
					return c.newBuffer(new Uint8Array(e))
				}
			}, p.uint8array = {
				string: s,
				array: function(e) {
					return r(e, new Array(e.length))
				},
				arraybuffer: function(e) {
					var t = new Uint8Array(e.length);
					return e.length && t.set(e, 0), t.buffer
				},
				uint8array: a,
				nodebuffer: function(e) {
					return c.newBuffer(e)
				}
			}, p.nodebuffer = {
				string: s,
				array: function(e) {
					return r(e, new Array(e.length))
				},
				arraybuffer: function(e) {
					return p.nodebuffer.uint8array(e).buffer
				},
				uint8array: function(e) {
					return r(e, new Uint8Array(e.length))
				},
				nodebuffer: a
			}, i.transformTo = function(e, t) {
				if (t || (t = ""), !e) return t;
				i.checkSupport(e);
				var a = i.getTypeOf(t);
				return p[a][e](t)
			}, i.getTypeOf = function(e) {
				return "string" == typeof e ? "string" : "[object Array]" === Object.prototype.toString.call(e) ? "array" : o.nodebuffer && c.isBuffer(e) ? "nodebuffer" : o.uint8array && e instanceof Uint8Array ? "uint8array" : o.arraybuffer && e instanceof ArrayBuffer ? "arraybuffer" : void 0
			}, i.checkSupport = function(e) {
				if (!o[e.toLowerCase()]) throw new Error(e + " is not supported by this platform")
			}, i.MAX_VALUE_16BITS = 65535, i.MAX_VALUE_32BITS = -1, i.pretty = function(e) {
				var t, i, a = "";
				for (i = 0; i < (e || "").length; i++) a += "\\x" + ((t = e.charCodeAt(i)) < 16 ? "0" : "") + t.toString(16).toUpperCase();
				return a
			}, i.delay = function(e, t, i) {
				d(function() {
					e.apply(i || null, t || [])
				})
			}, i.inherits = function(e, t) {
				var i = function() {};
				i.prototype = t.prototype, e.prototype = new i
			}, i.extend = function() {
				var e, t, i = {};
				for (e = 0; e < arguments.length; e++) for (t in arguments[e]) arguments[e].hasOwnProperty(t) && void 0 === i[t] && (i[t] = arguments[e][t]);
				return i
			}, i.prepareContent = function(e, t, a, s, r) {
				return u.Promise.resolve(t).then(function(e) {
					return o.blob && (e instanceof Blob || -1 !== ["[object File]", "[object Blob]"].indexOf(Object.prototype.toString.call(e))) && "undefined" != typeof FileReader ? new u.Promise(function(t, i) {
						var a = new FileReader;
						a.onload = function(e) {
							t(e.target.result)
						}, a.onerror = function(e) {
							i(e.target.error)
						}, a.readAsArrayBuffer(e)
					}) : e
				}).then(function(t) {
					var c, d = i.getTypeOf(t);
					return d ? ("arraybuffer" === d ? t = i.transformTo("uint8array", t) : "string" === d && (r ? t = l.decode(t) : a && !0 !== s && (t = n(c = t, o.uint8array ? new Uint8Array(c.length) : new Array(c.length)))), t) : u.Promise.reject(new Error("The data of '" + e + "' is in an unsupported format !"))
				})
			}
		}, {
			"./base64": 1,
			"./external": 6,
			"./nodejsUtils": 14,
			"./support": 30,
			"core-js/library/fn/set-immediate": 36
		}],
		33: [function(e, t, i) {
			"use strict";

			function a(e) {
				this.files = [], this.loadOptions = e
			}
			var n = e("./reader/readerFor"),
				s = e("./utils"),
				r = e("./signature"),
				o = e("./zipEntry"),
				l = (e("./utf8"), e("./support"));
			a.prototype = {
				checkSignature: function(e) {
					if (!this.reader.readAndCheckSignature(e)) {
						this.reader.index -= 4;
						var t = this.reader.readString(4);
						throw new Error("Corrupted zip or bug : unexpected signature (" + s.pretty(t) + ", expected " + s.pretty(e) + ")")
					}
				},
				isSignature: function(e, t) {
					var i = this.reader.index;
					this.reader.setIndex(e);
					var a = this.reader.readString(4) === t;
					return this.reader.setIndex(i), a
				},
				readBlockEndOfCentral: function() {
					this.diskNumber = this.reader.readInt(2), this.diskWithCentralDirStart = this.reader.readInt(2), this.centralDirRecordsOnThisDisk = this.reader.readInt(2), this.centralDirRecords = this.reader.readInt(2), this.centralDirSize = this.reader.readInt(4), this.centralDirOffset = this.reader.readInt(4), this.zipCommentLength = this.reader.readInt(2);
					var e = this.reader.readData(this.zipCommentLength),
						t = l.uint8array ? "uint8array" : "array",
						i = s.transformTo(t, e);
					this.zipComment = this.loadOptions.decodeFileName(i)
				},
				readBlockZip64EndOfCentral: function() {
					this.zip64EndOfCentralSize = this.reader.readInt(8), this.reader.skip(4), this.diskNumber = this.reader.readInt(4), this.diskWithCentralDirStart = this.reader.readInt(4), this.centralDirRecordsOnThisDisk = this.reader.readInt(8), this.centralDirRecords = this.reader.readInt(8), this.centralDirSize = this.reader.readInt(8), this.centralDirOffset = this.reader.readInt(8), this.zip64ExtensibleData = {};
					for (var e, t, i, a = this.zip64EndOfCentralSize - 44; a > 0;) e = this.reader.readInt(2), t = this.reader.readInt(4), i = this.reader.readData(t), this.zip64ExtensibleData[e] = {
						id: e,
						length: t,
						value: i
					}
				},
				readBlockZip64EndOfCentralLocator: function() {
					if (this.diskWithZip64CentralDirStart = this.reader.readInt(4), this.relativeOffsetEndOfZip64CentralDir = this.reader.readInt(8), this.disksCount = this.reader.readInt(4), 1 < this.disksCount) throw new Error("Multi-volumes zip are not supported")
				},
				readLocalFiles: function() {
					var e, t;
					for (e = 0; e < this.files.length; e++) t = this.files[e], this.reader.setIndex(t.localHeaderOffset), this.checkSignature(r.LOCAL_FILE_HEADER), t.readLocalPart(this.reader), t.handleUTF8(), t.processAttributes()
				},
				readCentralDir: function() {
					var e;
					for (this.reader.setIndex(this.centralDirOffset); this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(e = new o({
						zip64: this.zip64
					}, this.loadOptions)).readCentralPart(this.reader), this.files.push(e);
					if (this.centralDirRecords !== this.files.length && 0 !== this.centralDirRecords && 0 === this.files.length) throw new Error("Corrupted zip or bug: expected " + this.centralDirRecords + " records in central dir, got " + this.files.length)
				},
				readEndOfCentral: function() {
					var e = this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);
					if (0 > e) throw this.isSignature(0, r.LOCAL_FILE_HEADER) ? new Error("Corrupted zip : can't find end of central directory") : new Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html");
					this.reader.setIndex(e);
					var t = e;
					if (this.checkSignature(r.CENTRAL_DIRECTORY_END), this.readBlockEndOfCentral(), this.diskNumber === s.MAX_VALUE_16BITS || this.diskWithCentralDirStart === s.MAX_VALUE_16BITS || this.centralDirRecordsOnThisDisk === s.MAX_VALUE_16BITS || this.centralDirRecords === s.MAX_VALUE_16BITS || this.centralDirSize === s.MAX_VALUE_32BITS || this.centralDirOffset === s.MAX_VALUE_32BITS) {
						if (this.zip64 = !0, (e = this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR)) < 0) throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");
						if (this.reader.setIndex(e), this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR), this.readBlockZip64EndOfCentralLocator(), !this.isSignature(this.relativeOffsetEndOfZip64CentralDir, r.ZIP64_CENTRAL_DIRECTORY_END) && (this.relativeOffsetEndOfZip64CentralDir = this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END), this.relativeOffsetEndOfZip64CentralDir < 0)) throw new Error("Corrupted zip : can't find the ZIP64 end of central directory");
						this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir), this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END), this.readBlockZip64EndOfCentral()
					}
					var i = this.centralDirOffset + this.centralDirSize;
					this.zip64 && (i += 20, i += 12 + this.zip64EndOfCentralSize);
					var a = t - i;
					if (a > 0) this.isSignature(t, r.CENTRAL_FILE_HEADER) || (this.reader.zero = a);
					else if (0 > a) throw new Error("Corrupted zip: missing " + Math.abs(a) + " bytes.")
				},
				prepareReader: function(e) {
					this.reader = n(e)
				},
				load: function(e) {
					this.prepareReader(e), this.readEndOfCentral(), this.readCentralDir(), this.readLocalFiles()
				}
			}, t.exports = a
		}, {
			"./reader/readerFor": 22,
			"./signature": 23,
			"./support": 30,
			"./utf8": 31,
			"./utils": 32,
			"./zipEntry": 34
		}],
		34: [function(e, t, i) {
			"use strict";

			function a(e, t) {
				this.options = e, this.loadOptions = t
			}
			var n = e("./reader/readerFor"),
				s = e("./utils"),
				r = e("./compressedObject"),
				o = e("./crc32"),
				l = e("./utf8"),
				c = e("./compressions"),
				d = e("./support");
			a.prototype = {
				isEncrypted: function() {
					return 1 == (1 & this.bitFlag)
				},
				useUTF8: function() {
					return 2048 == (2048 & this.bitFlag)
				},
				readLocalPart: function(e) {
					var t, i;
					if (e.skip(22), this.fileNameLength = e.readInt(2), i = e.readInt(2), this.fileName = e.readData(this.fileNameLength), e.skip(i), -1 === this.compressedSize || -1 === this.uncompressedSize) throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");
					if (null === (t = function(e) {
						for (var t in c) if (c.hasOwnProperty(t) && c[t].magic === e) return c[t];
						return null
					}(this.compressionMethod))) throw new Error("Corrupted zip : compression " + s.pretty(this.compressionMethod) + " unknown (inner file : " + s.transformTo("string", this.fileName) + ")");
					this.decompressed = new r(this.compressedSize, this.uncompressedSize, this.crc32, t, e.readData(this.compressedSize))
				},
				readCentralPart: function(e) {
					this.versionMadeBy = e.readInt(2), e.skip(2), this.bitFlag = e.readInt(2), this.compressionMethod = e.readString(2), this.date = e.readDate(), this.crc32 = e.readInt(4), this.compressedSize = e.readInt(4), this.uncompressedSize = e.readInt(4);
					var t = e.readInt(2);
					if (this.extraFieldsLength = e.readInt(2), this.fileCommentLength = e.readInt(2), this.diskNumberStart = e.readInt(2), this.internalFileAttributes = e.readInt(2), this.externalFileAttributes = e.readInt(4), this.localHeaderOffset = e.readInt(4), this.isEncrypted()) throw new Error("Encrypted zip are not supported");
					e.skip(t), this.readExtraFields(e), this.parseZIP64ExtraField(e), this.fileComment = e.readData(this.fileCommentLength)
				},
				processAttributes: function() {
					this.unixPermissions = null, this.dosPermissions = null;
					var e = this.versionMadeBy >> 8;
					this.dir = !! (16 & this.externalFileAttributes), 0 === e && (this.dosPermissions = 63 & this.externalFileAttributes), 3 === e && (this.unixPermissions = this.externalFileAttributes >> 16 & 65535), this.dir || "/" !== this.fileNameStr.slice(-1) || (this.dir = !0)
				},
				parseZIP64ExtraField: function(e) {
					if (this.extraFields[1]) {
						var t = n(this.extraFields[1].value);
						this.uncompressedSize === s.MAX_VALUE_32BITS && (this.uncompressedSize = t.readInt(8)), this.compressedSize === s.MAX_VALUE_32BITS && (this.compressedSize = t.readInt(8)), this.localHeaderOffset === s.MAX_VALUE_32BITS && (this.localHeaderOffset = t.readInt(8)), this.diskNumberStart === s.MAX_VALUE_32BITS && (this.diskNumberStart = t.readInt(4))
					}
				},
				readExtraFields: function(e) {
					var t, i, a, n = e.index + this.extraFieldsLength;
					for (this.extraFields || (this.extraFields = {}); e.index < n;) t = e.readInt(2), i = e.readInt(2), a = e.readData(i), this.extraFields[t] = {
						id: t,
						length: i,
						value: a
					}
				},
				handleUTF8: function() {
					var e = d.uint8array ? "uint8array" : "array";
					if (this.useUTF8()) this.fileNameStr = l.utf8decode(this.fileName), this.fileCommentStr = l.utf8decode(this.fileComment);
					else {
						var t = this.findExtraFieldUnicodePath();
						if (null !== t) this.fileNameStr = t;
						else {
							var i = s.transformTo(e, this.fileName);
							this.fileNameStr = this.loadOptions.decodeFileName(i)
						}
						var a = this.findExtraFieldUnicodeComment();
						if (null !== a) this.fileCommentStr = a;
						else {
							var n = s.transformTo(e, this.fileComment);
							this.fileCommentStr = this.loadOptions.decodeFileName(n)
						}
					}
				},
				findExtraFieldUnicodePath: function() {
					var e = this.extraFields[28789];
					if (e) {
						var t = n(e.value);
						return 1 !== t.readInt(1) ? null : o(this.fileName) !== t.readInt(4) ? null : l.utf8decode(t.readData(e.length - 5))
					}
					return null
				},
				findExtraFieldUnicodeComment: function() {
					var e = this.extraFields[25461];
					if (e) {
						var t = n(e.value);
						return 1 !== t.readInt(1) ? null : o(this.fileComment) !== t.readInt(4) ? null : l.utf8decode(t.readData(e.length - 5))
					}
					return null
				}
			}, t.exports = a
		}, {
			"./compressedObject": 2,
			"./compressions": 3,
			"./crc32": 4,
			"./reader/readerFor": 22,
			"./support": 30,
			"./utf8": 31,
			"./utils": 32
		}],
		35: [function(e, t, i) {
			"use strict";
			var a = e("./stream/StreamHelper"),
				n = e("./stream/DataWorker"),
				s = e("./utf8"),
				r = e("./compressedObject"),
				o = e("./stream/GenericWorker"),
				l = function(e, t, i) {
					this.name = e, this.dir = i.dir, this.date = i.date, this.comment = i.comment, this.unixPermissions = i.unixPermissions, this.dosPermissions = i.dosPermissions, this._data = t, this._dataBinary = i.binary, this.options = {
						compression: i.compression,
						compressionOptions: i.compressionOptions
					}
				};
			l.prototype = {
				internalStream: function(e) {
					var t = e.toLowerCase(),
						i = "string" === t || "text" === t;
					"binarystring" !== t && "text" !== t || (t = "string");
					var n = this._decompressWorker(),
						r = !this._dataBinary;
					return r && !i && (n = n.pipe(new s.Utf8EncodeWorker)), !r && i && (n = n.pipe(new s.Utf8DecodeWorker)), new a(n, t, "")
				},
				async: function(e, t) {
					return this.internalStream(e).accumulate(t)
				},
				nodeStream: function(e, t) {
					return this.internalStream(e || "nodebuffer").toNodejsStream(t)
				},
				_compressWorker: function(e, t) {
					if (this._data instanceof r && this._data.compression.magic === e.magic) return this._data.getCompressedWorker();
					var i = this._decompressWorker();
					return this._dataBinary || (i = i.pipe(new s.Utf8EncodeWorker)), r.createWorkerFrom(i, e, t)
				},
				_decompressWorker: function() {
					return this._data instanceof r ? this._data.getContentWorker() : this._data instanceof o ? this._data : new n(this._data)
				}
			};
			for (var c = ["asText", "asBinary", "asNodeBuffer", "asUint8Array", "asArrayBuffer"], d = function() {
					throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")
				}, u = 0; u < c.length; u++) l.prototype[c[u]] = d;
			t.exports = l
		}, {
			"./compressedObject": 2,
			"./stream/DataWorker": 27,
			"./stream/GenericWorker": 28,
			"./stream/StreamHelper": 29,
			"./utf8": 31
		}],
		36: [function(e, t, i) {
			e("../modules/web.immediate"), t.exports = e("../modules/_core").setImmediate
		}, {
			"../modules/_core": 40,
			"../modules/web.immediate": 56
		}],
		37: [function(e, t, i) {
			t.exports = function(e) {
				if ("function" != typeof e) throw TypeError(e + " is not a function!");
				return e
			}
		}, {}],
		38: [function(e, t, i) {
			var a = e("./_is-object");
			t.exports = function(e) {
				if (!a(e)) throw TypeError(e + " is not an object!");
				return e
			}
		}, {
			"./_is-object": 51
		}],
		39: [function(e, t, i) {
			var a = {}.toString;
			t.exports = function(e) {
				return a.call(e).slice(8, -1)
			}
		}, {}],
		40: [function(e, t, i) {
			var a = t.exports = {
				version: "2.3.0"
			};
			"number" == typeof __e && (__e = a)
		}, {}],
		41: [function(e, t, i) {
			var a = e("./_a-function");
			t.exports = function(e, t, i) {
				if (a(e), void 0 === t) return e;
				switch (i) {
				case 1:
					return function(i) {
						return e.call(t, i)
					};
				case 2:
					return function(i, a) {
						return e.call(t, i, a)
					};
				case 3:
					return function(i, a, n) {
						return e.call(t, i, a, n)
					}
				}
				return function() {
					return e.apply(t, arguments)
				}
			}
		}, {
			"./_a-function": 37
		}],
		42: [function(e, t, i) {
			t.exports = !e("./_fails")(function() {
				return 7 != Object.defineProperty({}, "a", {
					get: function() {
						return 7
					}
				}).a
			})
		}, {
			"./_fails": 45
		}],
		43: [function(e, t, i) {
			var a = e("./_is-object"),
				n = e("./_global").document,
				s = a(n) && a(n.createElement);
			t.exports = function(e) {
				return s ? n.createElement(e) : {}
			}
		}, {
			"./_global": 46,
			"./_is-object": 51
		}],
		44: [function(e, t, i) {
			var a = e("./_global"),
				n = e("./_core"),
				s = e("./_ctx"),
				r = e("./_hide"),
				o = "prototype",
				l = function(e, t, i) {
					var c, d, u, f = e & l.F,
						p = e & l.G,
						m = e & l.S,
						h = e & l.P,
						g = e & l.B,
						v = e & l.W,
						y = p ? n : n[t] || (n[t] = {}),
						b = y[o],
						k = p ? a : m ? a[t] : (a[t] || {})[o];
					for (c in p && (i = t), i)(d = !f && k && void 0 !== k[c]) && c in y || (u = d ? k[c] : i[c], y[c] = p && "function" != typeof k[c] ? i[c] : g && d ? s(u, a) : v && k[c] == u ?
					function(e) {
						var t = function(t, i, a) {
								if (this instanceof e) {
									switch (arguments.length) {
									case 0:
										return new e;
									case 1:
										return new e(t);
									case 2:
										return new e(t, i)
									}
									return new e(t, i, a)
								}
								return e.apply(this, arguments)
							};
						return t[o] = e[o], t
					}(u) : h && "function" == typeof u ? s(Function.call, u) : u, h && ((y.virtual || (y.virtual = {}))[c] = u, e & l.R && b && !b[c] && r(b, c, u)))
				};
			l.F = 1, l.G = 2, l.S = 4, l.P = 8, l.B = 16, l.W = 32, l.U = 64, l.R = 128, t.exports = l
		}, {
			"./_core": 40,
			"./_ctx": 41,
			"./_global": 46,
			"./_hide": 47
		}],
		45: [function(e, t, i) {
			t.exports = function(e) {
				try {
					return !!e()
				} catch (e) {
					return !0
				}
			}
		}, {}],
		46: [function(e, t, i) {
			var a = t.exports = "undefined" != typeof window && window.Math == Math ? window : "undefined" != typeof self && self.Math == Math ? self : Function("return this")();
			"number" == typeof __g && (__g = a)
		}, {}],
		47: [function(e, t, i) {
			var a = e("./_object-dp"),
				n = e("./_property-desc");
			t.exports = e("./_descriptors") ?
			function(e, t, i) {
				return a.f(e, t, n(1, i))
			} : function(e, t, i) {
				return e[t] = i, e
			}
		}, {
			"./_descriptors": 42,
			"./_object-dp": 52,
			"./_property-desc": 53
		}],
		48: [function(e, t, i) {
			t.exports = e("./_global").document && document.documentElement
		}, {
			"./_global": 46
		}],
		49: [function(e, t, i) {
			t.exports = !e("./_descriptors") && !e("./_fails")(function() {
				return 7 != Object.defineProperty(e("./_dom-create")("div"), "a", {
					get: function() {
						return 7
					}
				}).a
			})
		}, {
			"./_descriptors": 42,
			"./_dom-create": 43,
			"./_fails": 45
		}],
		50: [function(e, t, i) {
			t.exports = function(e, t, i) {
				var a = void 0 === i;
				switch (t.length) {
				case 0:
					return a ? e() : e.call(i);
				case 1:
					return a ? e(t[0]) : e.call(i, t[0]);
				case 2:
					return a ? e(t[0], t[1]) : e.call(i, t[0], t[1]);
				case 3:
					return a ? e(t[0], t[1], t[2]) : e.call(i, t[0], t[1], t[2]);
				case 4:
					return a ? e(t[0], t[1], t[2], t[3]) : e.call(i, t[0], t[1], t[2], t[3])
				}
				return e.apply(i, t)
			}
		}, {}],
		51: [function(e, t, i) {
			t.exports = function(e) {
				return "object" == typeof e ? null !== e : "function" == typeof e
			}
		}, {}],
		52: [function(e, t, i) {
			var a = e("./_an-object"),
				n = e("./_ie8-dom-define"),
				s = e("./_to-primitive"),
				r = Object.defineProperty;
			i.f = e("./_descriptors") ? Object.defineProperty : function(e, t, i) {
				if (a(e), t = s(t, !0), a(i), n) try {
					return r(e, t, i)
				} catch (e) {}
				if ("get" in i || "set" in i) throw TypeError("Accessors not supported!");
				return "value" in i && (e[t] = i.value), e
			}
		}, {
			"./_an-object": 38,
			"./_descriptors": 42,
			"./_ie8-dom-define": 49,
			"./_to-primitive": 55
		}],
		53: [function(e, t, i) {
			t.exports = function(e, t) {
				return {
					enumerable: !(1 & e),
					configurable: !(2 & e),
					writable: !(4 & e),
					value: t
				}
			}
		}, {}],
		54: [function(e, t, i) {
			var a, n, s, r = e("./_ctx"),
				o = e("./_invoke"),
				l = e("./_html"),
				c = e("./_dom-create"),
				d = e("./_global"),
				u = d.process,
				f = d.setImmediate,
				p = d.clearImmediate,
				m = d.MessageChannel,
				h = 0,
				g = {},
				v = "onreadystatechange",
				y = function() {
					var e = +this;
					if (g.hasOwnProperty(e)) {
						var t = g[e];
						delete g[e], t()
					}
				},
				b = function(e) {
					y.call(e.data)
				};
			f && p || (f = function(e) {
				for (var t = [], i = 1; arguments.length > i;) t.push(arguments[i++]);
				return g[++h] = function() {
					o("function" == typeof e ? e : Function(e), t)
				}, a(h), h
			}, p = function(e) {
				delete g[e]
			}, "process" == e("./_cof")(u) ? a = function(e) {
				u.nextTick(r(y, e, 1))
			} : m ? (s = (n = new m).port2, n.port1.onmessage = b, a = r(s.postMessage, s, 1)) : d.addEventListener && "function" == typeof postMessage && !d.importScripts ? (a = function(e) {
				d.postMessage(e + "", "*")
			}, d.addEventListener("message", b, !1)) : a = v in c("script") ?
			function(e) {
				l.appendChild(c("script"))[v] = function() {
					l.removeChild(this), y.call(e)
				}
			} : function(e) {
				setTimeout(r(y, e, 1), 0)
			}), t.exports = {
				set: f,
				clear: p
			}
		}, {
			"./_cof": 39,
			"./_ctx": 41,
			"./_dom-create": 43,
			"./_global": 46,
			"./_html": 48,
			"./_invoke": 50
		}],
		55: [function(e, t, i) {
			var a = e("./_is-object");
			t.exports = function(e, t) {
				if (!a(e)) return e;
				var i, n;
				if (t && "function" == typeof(i = e.toString) && !a(n = i.call(e))) return n;
				if ("function" == typeof(i = e.valueOf) && !a(n = i.call(e))) return n;
				if (!t && "function" == typeof(i = e.toString) && !a(n = i.call(e))) return n;
				throw TypeError("Can't convert object to primitive value")
			}
		}, {
			"./_is-object": 51
		}],
		56: [function(e, t, i) {
			var a = e("./_export"),
				n = e("./_task");
			a(a.G + a.B, {
				setImmediate: n.set,
				clearImmediate: n.clear
			})
		}, {
			"./_export": 44,
			"./_task": 54
		}],
		57: [function(e, t, i) {
			(function(e) {
				"use strict";

				function i() {
					c = !0;
					for (var e, t, i = d.length; i;) {
						for (t = d, d = [], e = -1; ++e < i;) t[e]();
						i = d.length
					}
					c = !1
				}
				var a, n = e.MutationObserver || e.WebKitMutationObserver;
				if (n) {
					var s = 0,
						r = new n(i),
						o = e.document.createTextNode("");
					r.observe(o, {
						characterData: !0
					}), a = function() {
						o.data = s = ++s % 2
					}
				} else if (e.setImmediate || void 0 === e.MessageChannel) a = "document" in e && "onreadystatechange" in e.document.createElement("script") ?
				function() {
					var t = e.document.createElement("script");
					t.onreadystatechange = function() {
						i(), t.onreadystatechange = null, t.parentNode.removeChild(t), t = null
					}, e.document.documentElement.appendChild(t)
				} : function() {
					setTimeout(i, 0)
				};
				else {
					var l = new e.MessageChannel;
					l.port1.onmessage = i, a = function() {
						l.port2.postMessage(0)
					}
				}
				var c, d = [];
				t.exports = function(e) {
					1 !== d.push(e) || c || a()
				}
			}).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
		}, {}],
		58: [function(e, t, i) {
			"use strict";

			function a() {}
			function n(e) {
				if ("function" != typeof e) throw new TypeError("resolver must be a function");
				this.state = m, this.queue = [], this.outcome = void 0, e !== a && l(this, e)
			}
			function s(e, t, i) {
				this.promise = e, "function" == typeof t && (this.onFulfilled = t, this.callFulfilled = this.otherCallFulfilled), "function" == typeof i && (this.onRejected = i, this.callRejected = this.otherCallRejected)
			}
			function r(e, t, i) {
				d(function() {
					var a;
					try {
						a = t(i)
					} catch (a) {
						return u.reject(e, a)
					}
					a === e ? u.reject(e, new TypeError("Cannot resolve promise with itself")) : u.resolve(e, a)
				})
			}
			function o(e) {
				var t = e && e.then;
				return e && "object" == typeof e && "function" == typeof t ?
				function() {
					t.apply(e, arguments)
				} : void 0
			}
			function l(e, t) {
				function i(t) {
					n || (n = !0, u.reject(e, t))
				}
				function a(t) {
					n || (n = !0, u.resolve(e, t))
				}
				var n = !1,
					s = c(function() {
						t(a, i)
					});
				"error" === s.status && i(s.value)
			}
			function c(e, t) {
				var i = {};
				try {
					i.value = e(t), i.status = "success"
				} catch (e) {
					i.status = "error", i.value = e
				}
				return i
			}
			var d = e("immediate"),
				u = {},
				f = ["REJECTED"],
				p = ["FULFILLED"],
				m = ["PENDING"];
			(t.exports = n).prototype["catch"] = function(e) {
				return this.then(null, e)
			}, n.prototype.then = function(e, t) {
				if ("function" != typeof e && this.state === p || "function" != typeof t && this.state === f) return this;
				var i = new this.constructor(a);
				return this.state !== m ? r(i, this.state === p ? e : t, this.outcome) : this.queue.push(new s(i, e, t)), i
			}, s.prototype.callFulfilled = function(e) {
				u.resolve(this.promise, e)
			}, s.prototype.otherCallFulfilled = function(e) {
				r(this.promise, this.onFulfilled, e)
			}, s.prototype.callRejected = function(e) {
				u.reject(this.promise, e)
			}, s.prototype.otherCallRejected = function(e) {
				r(this.promise, this.onRejected, e)
			}, u.resolve = function(e, t) {
				var i = c(o, t);
				if ("error" === i.status) return u.reject(e, i.value);
				var a = i.value;
				if (a) l(e, a);
				else {
					e.state = p, e.outcome = t;
					for (var n = -1, s = e.queue.length; ++n < s;) e.queue[n].callFulfilled(t)
				}
				return e
			}, u.reject = function(e, t) {
				e.state = f, e.outcome = t;
				for (var i = -1, a = e.queue.length; ++i < a;) e.queue[i].callRejected(t);
				return e
			}, n.resolve = function(e) {
				return e instanceof this ? e : u.resolve(new this(a), e)
			}, n.reject = function(e) {
				var t = new this(a);
				return u.reject(t, e)
			}, n.all = function(e) {
				function t(e, t) {
					i.resolve(e).then(function(e) {
						r[t] = e, ++o !== n || s || (s = !0, u.resolve(c, r))
					}, function(e) {
						s || (s = !0, u.reject(c, e))
					})
				}
				var i = this;
				if ("[object Array]" !== Object.prototype.toString.call(e)) return this.reject(new TypeError("must be an array"));
				var n = e.length,
					s = !1;
				if (!n) return this.resolve([]);
				for (var r = new Array(n), o = 0, l = -1, c = new this(a); ++l < n;) t(e[l], l);
				return c
			}, n.race = function(e) {
				var t = this;
				if ("[object Array]" !== Object.prototype.toString.call(e)) return this.reject(new TypeError("must be an array"));
				var i, n = e.length,
					s = !1;
				if (!n) return this.resolve([]);
				for (var r = -1, o = new this(a); ++r < n;) i = e[r], t.resolve(i).then(function(e) {
					s || (s = !0, u.resolve(o, e))
				}, function(e) {
					s || (s = !0, u.reject(o, e))
				});
				return o
			}
		}, {
			immediate: 57
		}],
		59: [function(e, t, i) {
			"use strict";
			var a = {};
			(0, e("./lib/utils/common").assign)(a, e("./lib/deflate"), e("./lib/inflate"), e("./lib/zlib/constants")), t.exports = a
		}, {
			"./lib/deflate": 60,
			"./lib/inflate": 61,
			"./lib/utils/common": 62,
			"./lib/zlib/constants": 65
		}],
		60: [function(e, t, i) {
			"use strict";

			function a(e) {
				if (!(this instanceof a)) return new a(e);
				this.options = r.assign({
					level: f,
					method: m,
					chunkSize: 16384,
					windowBits: 15,
					memLevel: 8,
					strategy: p,
					to: ""
				}, e || {});
				var t = this.options;
				t.raw && 0 < t.windowBits ? t.windowBits = -t.windowBits : t.gzip && 0 < t.windowBits && t.windowBits < 16 && (t.windowBits += 16), this.err = 0, this.msg = "", this.ended = !1, this.chunks = [], this.strm = new c, this.strm.avail_out = 0;
				var i = s.deflateInit2(this.strm, t.level, t.method, t.windowBits, t.memLevel, t.strategy);
				if (i !== u) throw new Error(l[i]);
				if (t.header && s.deflateSetHeader(this.strm, t.header), t.dictionary) {
					var n;
					if (n = "string" == typeof t.dictionary ? o.string2buf(t.dictionary) : "[object ArrayBuffer]" === d.call(t.dictionary) ? new Uint8Array(t.dictionary) : t.dictionary, (i = s.deflateSetDictionary(this.strm, n)) !== u) throw new Error(l[i]);
					this._dict_set = !0
				}
			}
			function n(e, t) {
				var i = new a(t);
				if (i.push(e, !0), i.err) throw i.msg;
				return i.result
			}
			var s = e("./zlib/deflate"),
				r = e("./utils/common"),
				o = e("./utils/strings"),
				l = e("./zlib/messages"),
				c = e("./zlib/zstream"),
				d = Object.prototype.toString,
				u = 0,
				f = -1,
				p = 0,
				m = 8;
			a.prototype.push = function(e, t) {
				var i, a, n = this.strm,
					l = this.options.chunkSize;
				if (this.ended) return !1;
				a = t === ~~t ? t : !0 === t ? 4 : 0, "string" == typeof e ? n.input = o.string2buf(e) : "[object ArrayBuffer]" === d.call(e) ? n.input = new Uint8Array(e) : n.input = e, n.next_in = 0, n.avail_in = n.input.length;
				do {
					if (0 === n.avail_out && (n.output = new r.Buf8(l), n.next_out = 0, n.avail_out = l), 1 !== (i = s.deflate(n, a)) && i !== u) return this.onEnd(i), !(this.ended = !0);
					0 !== n.avail_out && (0 !== n.avail_in || 4 !== a && 2 !== a) || ("string" === this.options.to ? this.onData(o.buf2binstring(r.shrinkBuf(n.output, n.next_out))) : this.onData(r.shrinkBuf(n.output, n.next_out)))
				} while ((0 < n.avail_in || 0 === n.avail_out) && 1 !== i);
				return 4 === a ? (i = s.deflateEnd(this.strm), this.onEnd(i), this.ended = !0, i === u) : 2 !== a || (this.onEnd(u), !(n.avail_out = 0))
			}, a.prototype.onData = function(e) {
				this.chunks.push(e)
			}, a.prototype.onEnd = function(e) {
				e === u && ("string" === this.options.to ? this.result = this.chunks.join("") : this.result = r.flattenChunks(this.chunks)), this.chunks = [], this.err = e, this.msg = this.strm.msg
			}, i.Deflate = a, i.deflate = n, i.deflateRaw = function(e, t) {
				return (t = t || {}).raw = !0, n(e, t)
			}, i.gzip = function(e, t) {
				return (t = t || {}).gzip = !0, n(e, t)
			}
		}, {
			"./utils/common": 62,
			"./utils/strings": 63,
			"./zlib/deflate": 67,
			"./zlib/messages": 72,
			"./zlib/zstream": 74
		}],
		61: [function(e, t, i) {
			"use strict";

			function a(e) {
				if (!(this instanceof a)) return new a(e);
				this.options = r.assign({
					chunkSize: 16384,
					windowBits: 0,
					to: ""
				}, e || {});
				var t = this.options;
				t.raw && 0 <= t.windowBits && t.windowBits < 16 && (t.windowBits = -t.windowBits, 0 === t.windowBits && (t.windowBits = -15)), !(0 <= t.windowBits && t.windowBits < 16) || e && e.windowBits || (t.windowBits += 32), 15 < t.windowBits && t.windowBits < 48 && 0 == (15 & t.windowBits) && (t.windowBits |= 15), this.err = 0, this.msg = "", this.ended = !1, this.chunks = [], this.strm = new d, this.strm.avail_out = 0;
				var i = s.inflateInit2(this.strm, t.windowBits);
				if (i !== l.Z_OK) throw new Error(c[i]);
				this.header = new u, s.inflateGetHeader(this.strm, this.header)
			}
			function n(e, t) {
				var i = new a(t);
				if (i.push(e, !0), i.err) throw i.msg;
				return i.result
			}
			var s = e("./zlib/inflate"),
				r = e("./utils/common"),
				o = e("./utils/strings"),
				l = e("./zlib/constants"),
				c = e("./zlib/messages"),
				d = e("./zlib/zstream"),
				u = e("./zlib/gzheader"),
				f = Object.prototype.toString;
			a.prototype.push = function(e, t) {
				var i, a, n, c, d, u, p = this.strm,
					m = this.options.chunkSize,
					h = this.options.dictionary,
					g = !1;
				if (this.ended) return !1;
				a = t === ~~t ? t : !0 === t ? l.Z_FINISH : l.Z_NO_FLUSH, "string" == typeof e ? p.input = o.binstring2buf(e) : "[object ArrayBuffer]" === f.call(e) ? p.input = new Uint8Array(e) : p.input = e, p.next_in = 0, p.avail_in = p.input.length;
				do {
					if (0 === p.avail_out && (p.output = new r.Buf8(m), p.next_out = 0, p.avail_out = m), (i = s.inflate(p, l.Z_NO_FLUSH)) === l.Z_NEED_DICT && h && (u = "string" == typeof h ? o.string2buf(h) : "[object ArrayBuffer]" === f.call(h) ? new Uint8Array(h) : h, i = s.inflateSetDictionary(this.strm, u)), i === l.Z_BUF_ERROR && !0 === g && (i = l.Z_OK, g = !1), i !== l.Z_STREAM_END && i !== l.Z_OK) return this.onEnd(i), !(this.ended = !0);
					p.next_out && (0 !== p.avail_out && i !== l.Z_STREAM_END && (0 !== p.avail_in || a !== l.Z_FINISH && a !== l.Z_SYNC_FLUSH) || ("string" === this.options.to ? (n = o.utf8border(p.output, p.next_out), c = p.next_out - n, d = o.buf2string(p.output, n), p.next_out = c, p.avail_out = m - c, c && r.arraySet(p.output, p.output, n, c, 0), this.onData(d)) : this.onData(r.shrinkBuf(p.output, p.next_out)))), 0 === p.avail_in && 0 === p.avail_out && (g = !0)
				} while ((0 < p.avail_in || 0 === p.avail_out) && i !== l.Z_STREAM_END);
				return i === l.Z_STREAM_END && (a = l.Z_FINISH), a === l.Z_FINISH ? (i = s.inflateEnd(this.strm), this.onEnd(i), this.ended = !0, i === l.Z_OK) : a !== l.Z_SYNC_FLUSH || (this.onEnd(l.Z_OK), !(p.avail_out = 0))
			}, a.prototype.onData = function(e) {
				this.chunks.push(e)
			}, a.prototype.onEnd = function(e) {
				e === l.Z_OK && ("string" === this.options.to ? this.result = this.chunks.join("") : this.result = r.flattenChunks(this.chunks)), this.chunks = [], this.err = e, this.msg = this.strm.msg
			}, i.Inflate = a, i.inflate = n, i.inflateRaw = function(e, t) {
				return (t = t || {}).raw = !0, n(e, t)
			}, i.ungzip = n
		}, {
			"./utils/common": 62,
			"./utils/strings": 63,
			"./zlib/constants": 65,
			"./zlib/gzheader": 68,
			"./zlib/inflate": 70,
			"./zlib/messages": 72,
			"./zlib/zstream": 74
		}],
		62: [function(e, t, i) {
			"use strict";
			var a = "undefined" != typeof Uint8Array && "undefined" != typeof Uint16Array && "undefined" != typeof Int32Array;
			i.assign = function(e) {
				for (var t = Array.prototype.slice.call(arguments, 1); t.length;) {
					var i = t.shift();
					if (i) {
						if ("object" != typeof i) throw new TypeError(i + "must be non-object");
						for (var a in i) i.hasOwnProperty(a) && (e[a] = i[a])
					}
				}
				return e
			}, i.shrinkBuf = function(e, t) {
				return e.length === t ? e : e.subarray ? e.subarray(0, t) : (e.length = t, e)
			};
			var n = {
				arraySet: function(e, t, i, a, n) {
					if (t.subarray && e.subarray) e.set(t.subarray(i, i + a), n);
					else for (var s = 0; a > s; s++) e[n + s] = t[i + s]
				},
				flattenChunks: function(e) {
					var t, i, a, n, s, r;
					for (t = a = 0, i = e.length; i > t; t++) a += e[t].length;
					for (r = new Uint8Array(a), t = n = 0, i = e.length; i > t; t++) s = e[t], r.set(s, n), n += s.length;
					return r
				}
			},
				s = {
					arraySet: function(e, t, i, a, n) {
						for (var s = 0; a > s; s++) e[n + s] = t[i + s]
					},
					flattenChunks: function(e) {
						return [].concat.apply([], e)
					}
				};
			i.setTyped = function(e) {
				e ? (i.Buf8 = Uint8Array, i.Buf16 = Uint16Array, i.Buf32 = Int32Array, i.assign(i, n)) : (i.Buf8 = Array, i.Buf16 = Array, i.Buf32 = Array, i.assign(i, s))
			}, i.setTyped(a)
		}, {}],
		63: [function(e, t, i) {
			"use strict";

			function a(e, t) {
				if (65537 > t && (e.subarray && r || !e.subarray && s)) return String.fromCharCode.apply(null, n.shrinkBuf(e, t));
				for (var i = "", a = 0; t > a; a++) i += String.fromCharCode(e[a]);
				return i
			}
			var n = e("./common"),
				s = !0,
				r = !0;
			try {
				String.fromCharCode.apply(null, [0])
			} catch (e) {
				s = !1
			}
			try {
				String.fromCharCode.apply(null, new Uint8Array(1))
			} catch (e) {
				r = !1
			}
			for (var o = new n.Buf8(256), l = 0; 256 > l; l++) o[l] = l >= 252 ? 6 : l >= 248 ? 5 : l >= 240 ? 4 : l >= 224 ? 3 : l >= 192 ? 2 : 1;
			o[254] = o[254] = 1, i.string2buf = function(e) {
				var t, i, a, s, r, o = e.length,
					l = 0;
				for (s = 0; o > s; s++) 55296 == (64512 & (i = e.charCodeAt(s))) && o > s + 1 && 56320 == (64512 & (a = e.charCodeAt(s + 1))) && (i = 65536 + (i - 55296 << 10) + (a - 56320), s++), l += 128 > i ? 1 : 2048 > i ? 2 : 65536 > i ? 3 : 4;
				for (t = new n.Buf8(l), s = r = 0; l > r; s++) 55296 == (64512 & (i = e.charCodeAt(s))) && o > s + 1 && 56320 == (64512 & (a = e.charCodeAt(s + 1))) && (i = 65536 + (i - 55296 << 10) + (a - 56320), s++), 128 > i ? t[r++] = i : (2048 > i ? t[r++] = 192 | i >>> 6 : (65536 > i ? t[r++] = 224 | i >>> 12 : (t[r++] = 240 | i >>> 18, t[r++] = 128 | i >>> 12 & 63), t[r++] = 128 | i >>> 6 & 63), t[r++] = 128 | 63 & i);
				return t
			}, i.buf2binstring = function(e) {
				return a(e, e.length)
			}, i.binstring2buf = function(e) {
				for (var t = new n.Buf8(e.length), i = 0, a = t.length; a > i; i++) t[i] = e.charCodeAt(i);
				return t
			}, i.buf2string = function(e, t) {
				var i, n, s, r, l = t || e.length,
					c = new Array(2 * l);
				for (i = n = 0; l > i;) if ((s = e[i++]) < 128) c[n++] = s;
				else if (4 < (r = o[s])) c[n++] = 65533, i += r - 1;
				else {
					for (s &= 2 === r ? 31 : 3 === r ? 15 : 7; r > 1 && l > i;) s = s << 6 | 63 & e[i++], r--;
					r > 1 ? c[n++] = 65533 : 65536 > s ? c[n++] = s : (s -= 65536, c[n++] = 55296 | s >> 10 & 1023, c[n++] = 56320 | 1023 & s)
				}
				return a(c, n)
			}, i.utf8border = function(e, t) {
				var i;
				for ((t = t || e.length) > e.length && (t = e.length), i = t - 1; i >= 0 && 128 == (192 & e[i]);) i--;
				return 0 > i ? t : 0 === i ? t : i + o[e[i]] > t ? i : t
			}
		}, {
			"./common": 62
		}],
		64: [function(e, t, i) {
			"use strict";
			t.exports = function(e, t, i, a) {
				for (var n = 65535 & e | 0, s = e >>> 16 & 65535 | 0, r = 0; 0 !== i;) {
					for (i -= r = i > 2e3 ? 2e3 : i; s = s + (n = n + t[a++] | 0) | 0, --r;);
					n %= 65521, s %= 65521
				}
				return n | s << 16 | 0
			}
		}, {}],
		65: [function(e, t, i) {
			"use strict";
			t.exports = {
				Z_NO_FLUSH: 0,
				Z_PARTIAL_FLUSH: 1,
				Z_SYNC_FLUSH: 2,
				Z_FULL_FLUSH: 3,
				Z_FINISH: 4,
				Z_BLOCK: 5,
				Z_TREES: 6,
				Z_OK: 0,
				Z_STREAM_END: 1,
				Z_NEED_DICT: 2,
				Z_ERRNO: -1,
				Z_STREAM_ERROR: -2,
				Z_DATA_ERROR: -3,
				Z_BUF_ERROR: -5,
				Z_NO_COMPRESSION: 0,
				Z_BEST_SPEED: 1,
				Z_BEST_COMPRESSION: 9,
				Z_DEFAULT_COMPRESSION: -1,
				Z_FILTERED: 1,
				Z_HUFFMAN_ONLY: 2,
				Z_RLE: 3,
				Z_FIXED: 4,
				Z_DEFAULT_STRATEGY: 0,
				Z_BINARY: 0,
				Z_TEXT: 1,
				Z_UNKNOWN: 2,
				Z_DEFLATED: 8
			}
		}, {}],
		66: [function(e, t, i) {
			"use strict";
			var a = function() {
					for (var e, t = [], i = 0; 256 > i; i++) {
						e = i;
						for (var a = 0; 8 > a; a++) e = 1 & e ? 3988292384 ^ e >>> 1 : e >>> 1;
						t[i] = e
					}
					return t
				}();
			t.exports = function(e, t, i, n) {
				var s = a,
					r = n + i;
				e ^= -1;
				for (var o = n; r > o; o++) e = e >>> 8 ^ s[255 & (e ^ t[o])];
				return -1 ^ e
			}
		}, {}],
		67: [function(e, t, i) {
			"use strict";

			function a(e, t) {
				return e.msg = C[t], t
			}
			function n(e) {
				return (e << 1) - (e > 4 ? 9 : 0)
			}
			function s(e) {
				for (var t = e.length; 0 <= --t;) e[t] = 0
			}
			function r(e) {
				var t = e.state,
					i = t.pending;
				i > e.avail_out && (i = e.avail_out), 0 !== i && (k.arraySet(e.output, t.pending_buf, t.pending_out, i, e.next_out), e.next_out += i, t.pending_out += i, e.total_out += i, e.avail_out -= i, t.pending -= i, 0 === t.pending && (t.pending_out = 0))
			}
			function o(e, t) {
				w._tr_flush_block(e, 0 <= e.block_start ? e.block_start : -1, e.strstart - e.block_start, t), e.block_start = e.strstart, r(e.strm)
			}
			function l(e, t) {
				e.pending_buf[e.pending++] = t
			}
			function c(e, t) {
				e.pending_buf[e.pending++] = t >>> 8 & 255, e.pending_buf[e.pending++] = 255 & t
			}
			function d(e, t) {
				var i, a, n = e.max_chain_length,
					s = e.strstart,
					r = e.prev_length,
					o = e.nice_match,
					l = e.strstart > e.w_size - z ? e.strstart - (e.w_size - z) : 0,
					c = e.window,
					d = e.w_mask,
					u = e.prev,
					f = e.strstart + F,
					p = c[s + r - 1],
					m = c[s + r];
				e.prev_length >= e.good_match && (n >>= 2), o > e.lookahead && (o = e.lookahead);
				do
				if (c[(i = t) + r] === m && c[i + r - 1] === p && c[i] === c[s] && c[++i] === c[s + 1]) {
					s += 2, i++;
					do;
					while (c[++s] === c[++i] && c[++s] === c[++i] && c[++s] === c[++i] && c[++s] === c[++i] && c[++s] === c[++i] && c[++s] === c[++i] && c[++s] === c[++i] && c[++s] === c[++i] && f > s);
					if (a = F - (f - s), s = f - F, a > r) {
						if (e.match_start = t, o <= (r = a)) break;
						p = c[s + r - 1], m = c[s + r]
					}
				}
				while ((t = u[t & d]) > l && 0 != --n);
				return r <= e.lookahead ? r : e.lookahead
			}
			function u(e) {
				var t, i, a, n, s, r, o, l, c, d, u = e.w_size;
				do {
					if (n = e.window_size - e.lookahead - e.strstart, e.strstart >= u + (u - z)) {
						for (k.arraySet(e.window, e.window, u, u, 0), e.match_start -= u, e.strstart -= u, e.block_start -= u, t = i = e.hash_size; a = e.head[--t], e.head[t] = a >= u ? a - u : 0, --i;);
						for (t = i = u; a = e.prev[--t], e.prev[t] = a >= u ? a - u : 0, --i;);
						n += u
					}
					if (0 === e.strm.avail_in) break;
					if (r = e.strm, o = e.window, l = e.strstart + e.lookahead, c = n, d = void 0, d = r.avail_in, d > c && (d = c), i = 0 === d ? 0 : (r.avail_in -= d, k.arraySet(o, r.input, r.next_in, d, l), 1 === r.state.wrap ? r.adler = _(r.adler, o, d, l) : 2 === r.state.wrap && (r.adler = x(r.adler, o, d, l)), r.next_in += d, r.total_in += d, d), e.lookahead += i, e.lookahead + e.insert >= P) for (s = e.strstart - e.insert, e.ins_h = e.window[s], e.ins_h = (e.ins_h << e.hash_shift ^ e.window[s + 1]) & e.hash_mask; e.insert && (e.ins_h = (e.ins_h << e.hash_shift ^ e.window[s + P - 1]) & e.hash_mask, e.prev[s & e.w_mask] = e.head[e.ins_h], e.head[e.ins_h] = s, s++, e.insert--, !(e.lookahead + e.insert < P)););
				} while (e.lookahead < z && 0 !== e.strm.avail_in)
			}
			function f(e, t) {
				for (var i, a;;) {
					if (e.lookahead < z) {
						if (u(e), e.lookahead < z && t === T) return q;
						if (0 === e.lookahead) break
					}
					if (i = 0, e.lookahead >= P && (e.ins_h = (e.ins_h << e.hash_shift ^ e.window[e.strstart + P - 1]) & e.hash_mask, i = e.prev[e.strstart & e.w_mask] = e.head[e.ins_h], e.head[e.ins_h] = e.strstart), 0 !== i && e.strstart - i <= e.w_size - z && (e.match_length = d(e, i)), e.match_length >= P) if (a = w._tr_tally(e, e.strstart - e.match_start, e.match_length - P), e.lookahead -= e.match_length, e.match_length <= e.max_lazy_match && e.lookahead >= P) {
						for (e.match_length--; e.strstart++, e.ins_h = (e.ins_h << e.hash_shift ^ e.window[e.strstart + P - 1]) & e.hash_mask, i = e.prev[e.strstart & e.w_mask] = e.head[e.ins_h], e.head[e.ins_h] = e.strstart, 0 != --e.match_length;);
						e.strstart++
					} else e.strstart += e.match_length, e.match_length = 0, e.ins_h = e.window[e.strstart], e.ins_h = (e.ins_h << e.hash_shift ^ e.window[e.strstart + 1]) & e.hash_mask;
					else a = w._tr_tally(e, 0, e.window[e.strstart]), e.lookahead--, e.strstart++;
					if (a && (o(e, !1), 0 === e.strm.avail_out)) return q
				}
				return e.insert = e.strstart < P - 1 ? e.strstart : P - 1, t === S ? (o(e, !0), 0 === e.strm.avail_out ? H : V) : e.last_lit && (o(e, !1), 0 === e.strm.avail_out) ? q : W
			}
			function p(e, t) {
				for (var i, a, n;;) {
					if (e.lookahead < z) {
						if (u(e), e.lookahead < z && t === T) return q;
						if (0 === e.lookahead) break
					}
					if (i = 0, e.lookahead >= P && (e.ins_h = (e.ins_h << e.hash_shift ^ e.window[e.strstart + P - 1]) & e.hash_mask, i = e.prev[e.strstart & e.w_mask] = e.head[e.ins_h], e.head[e.ins_h] = e.strstart), e.prev_length = e.match_length, e.prev_match = e.match_start, e.match_length = P - 1, 0 !== i && e.prev_length < e.max_lazy_match && e.strstart - i <= e.w_size - z && (e.match_length = d(e, i), e.match_length <= 5 && (1 === e.strategy || e.match_length === P && 4096 < e.strstart - e.match_start) && (e.match_length = P - 1)), e.prev_length >= P && e.match_length <= e.prev_length) {
						for (n = e.strstart + e.lookahead - P, a = w._tr_tally(e, e.strstart - 1 - e.prev_match, e.prev_length - P), e.lookahead -= e.prev_length - 1, e.prev_length -= 2; ++e.strstart <= n && (e.ins_h = (e.ins_h << e.hash_shift ^ e.window[e.strstart + P - 1]) & e.hash_mask, i = e.prev[e.strstart & e.w_mask] = e.head[e.ins_h], e.head[e.ins_h] = e.strstart), 0 != --e.prev_length;);
						if (e.match_available = 0, e.match_length = P - 1, e.strstart++, a && (o(e, !1), 0 === e.strm.avail_out)) return q
					} else if (e.match_available) {
						if ((a = w._tr_tally(e, 0, e.window[e.strstart - 1])) && o(e, !1), e.strstart++, e.lookahead--, 0 === e.strm.avail_out) return q
					} else e.match_available = 1, e.strstart++, e.lookahead--
				}
				return e.match_available && (a = w._tr_tally(e, 0, e.window[e.strstart - 1]), e.match_available = 0), e.insert = e.strstart < P - 1 ? e.strstart : P - 1, t === S ? (o(e, !0), 0 === e.strm.avail_out ? H : V) : e.last_lit && (o(e, !1), 0 === e.strm.avail_out) ? q : W
			}
			function m(e, t, i, a, n) {
				this.good_length = e, this.max_lazy = t, this.nice_length = i, this.max_chain = a, this.func = n
			}
			function h() {
				this.strm = null, this.status = 0, this.pending_buf = null, this.pending_buf_size = 0, this.pending_out = 0, this.pending = 0, this.wrap = 0, this.gzhead = null, this.gzindex = 0, this.method = R, this.last_flush = -1, this.w_size = 0, this.w_bits = 0, this.w_mask = 0, this.window = null, this.window_size = 0, this.prev = null, this.head = null, this.ins_h = 0, this.hash_size = 0, this.hash_bits = 0, this.hash_mask = 0, this.hash_shift = 0, this.block_start = 0, this.match_length = 0, this.prev_match = 0, this.match_available = 0, this.strstart = 0, this.match_start = 0, this.lookahead = 0, this.prev_length = 0, this.max_chain_length = 0, this.max_lazy_match = 0, this.level = 0, this.strategy = 0, this.good_match = 0, this.nice_match = 0, this.dyn_ltree = new k.Buf16(2 * M), this.dyn_dtree = new k.Buf16(2 * (2 * E + 1)), this.bl_tree = new k.Buf16(2 * (2 * B + 1)), s(this.dyn_ltree), s(this.dyn_dtree), s(this.bl_tree), this.l_desc = null, this.d_desc = null, this.bl_desc = null, this.bl_count = new k.Buf16(O + 1), this.heap = new k.Buf16(2 * N + 1), s(this.heap), this.heap_len = 0, this.heap_max = 0, this.depth = new k.Buf16(2 * N + 1), s(this.depth), this.l_buf = 0, this.lit_bufsize = 0, this.last_lit = 0, this.d_buf = 0, this.opt_len = 0, this.static_len = 0, this.matches = 0, this.insert = 0, this.bi_buf = 0, this.bi_valid = 0
			}
			function g(e) {
				var t;
				return e && e.state ? (e.total_in = e.total_out = 0, e.data_type = L, (t = e.state).pending = 0, t.pending_out = 0, t.wrap < 0 && (t.wrap = -t.wrap), t.status = t.wrap ? G : U, e.adler = 2 === t.wrap ? 0 : 1, t.last_flush = T, w._tr_init(t), I) : a(e, j)
			}
			function v(e) {
				var t, i = g(e);
				return i === I && ((t = e.state).window_size = 2 * t.w_size, s(t.head), t.max_lazy_match = b[t.level].max_lazy, t.good_match = b[t.level].good_length, t.nice_match = b[t.level].nice_length, t.max_chain_length = b[t.level].max_chain, t.strstart = 0, t.block_start = 0, t.lookahead = 0, t.insert = 0, t.match_length = t.prev_length = P - 1, t.match_available = 0, t.ins_h = 0), i
			}
			function y(e, t, i, n, s, r) {
				if (!e) return j;
				var o = 1;
				if (t === $ && (t = 6), 0 > n ? (o = 0, n = -n) : n > 15 && (o = 2, n -= 16), 1 > s || s > A || i !== R || 8 > n || n > 15 || 0 > t || t > 9 || 0 > r || r > D) return a(e, j);
				8 === n && (n = 9);
				var l = new h;
				return (e.state = l).strm = e, l.wrap = o, l.gzhead = null, l.w_bits = n, l.w_size = 1 << l.w_bits, l.w_mask = l.w_size - 1, l.hash_bits = s + 7, l.hash_size = 1 << l.hash_bits, l.hash_mask = l.hash_size - 1, l.hash_shift = ~~ ((l.hash_bits + P - 1) / P), l.window = new k.Buf8(2 * l.w_size), l.head = new k.Buf16(l.hash_size), l.prev = new k.Buf16(l.w_size), l.lit_bufsize = 1 << s + 6, l.pending_buf_size = 4 * l.lit_bufsize, l.pending_buf = new k.Buf8(l.pending_buf_size), l.d_buf = 1 * l.lit_bufsize, l.l_buf = 3 * l.lit_bufsize, l.level = t, l.strategy = r, l.method = i, v(e)
			}
			var b, k = e("../utils/common"),
				w = e("./trees"),
				_ = e("./adler32"),
				x = e("./crc32"),
				C = e("./messages"),
				T = 0,
				S = 4,
				I = 0,
				j = -2,
				$ = -1,
				D = 4,
				L = 2,
				R = 8,
				A = 9,
				N = 286,
				E = 30,
				B = 19,
				M = 2 * N + 1,
				O = 15,
				P = 3,
				F = 258,
				z = F + P + 1,
				G = 42,
				U = 113,
				q = 1,
				W = 2,
				H = 3,
				V = 4;
			b = [new m(0, 0, 0, 0, function(e, t) {
				var i = 65535;
				for (i > e.pending_buf_size - 5 && (i = e.pending_buf_size - 5);;) {
					if (e.lookahead <= 1) {
						if (u(e), 0 === e.lookahead && t === T) return q;
						if (0 === e.lookahead) break
					}
					e.strstart += e.lookahead, e.lookahead = 0;
					var a = e.block_start + i;
					if ((0 === e.strstart || e.strstart >= a) && (e.lookahead = e.strstart - a, e.strstart = a, o(e, !1), 0 === e.strm.avail_out)) return q;
					if (e.strstart - e.block_start >= e.w_size - z && (o(e, !1), 0 === e.strm.avail_out)) return q
				}
				return e.insert = 0, t === S ? (o(e, !0), 0 === e.strm.avail_out ? H : V) : (e.strstart > e.block_start && (o(e, !1), e.strm.avail_out), q)
			}), new m(4, 4, 8, 4, f), new m(4, 5, 16, 8, f), new m(4, 6, 32, 32, f), new m(4, 4, 16, 16, p), new m(8, 16, 32, 32, p), new m(8, 16, 128, 128, p), new m(8, 32, 128, 256, p), new m(32, 128, 258, 1024, p), new m(32, 258, 258, 4096, p)], i.deflateInit = function(e, t) {
				return y(e, t, R, 15, 8, 0)
			}, i.deflateInit2 = y, i.deflateReset = v, i.deflateResetKeep = g, i.deflateSetHeader = function(e, t) {
				return e && e.state ? 2 !== e.state.wrap ? j : (e.state.gzhead = t, I) : j
			}, i.deflate = function(e, t) {
				var i, d, f, p;
				if (!e || !e.state || t > 5 || 0 > t) return e ? a(e, j) : j;
				if (d = e.state, !e.output || !e.input && 0 !== e.avail_in || 666 === d.status && t !== S) return a(e, 0 === e.avail_out ? -5 : j);
				if (d.strm = e, i = d.last_flush, d.last_flush = t, d.status === G) if (2 === d.wrap) e.adler = 0, l(d, 31), l(d, 139), l(d, 8), d.gzhead ? (l(d, (d.gzhead.text ? 1 : 0) + (d.gzhead.hcrc ? 2 : 0) + (d.gzhead.extra ? 4 : 0) + (d.gzhead.name ? 8 : 0) + (d.gzhead.comment ? 16 : 0)), l(d, 255 & d.gzhead.time), l(d, d.gzhead.time >> 8 & 255), l(d, d.gzhead.time >> 16 & 255), l(d, d.gzhead.time >> 24 & 255), l(d, 9 === d.level ? 2 : 2 <= d.strategy || d.level < 2 ? 4 : 0), l(d, 255 & d.gzhead.os), d.gzhead.extra && d.gzhead.extra.length && (l(d, 255 & d.gzhead.extra.length), l(d, d.gzhead.extra.length >> 8 & 255)), d.gzhead.hcrc && (e.adler = x(e.adler, d.pending_buf, d.pending, 0)), d.gzindex = 0, d.status = 69) : (l(d, 0), l(d, 0), l(d, 0), l(d, 0), l(d, 0), l(d, 9 === d.level ? 2 : 2 <= d.strategy || d.level < 2 ? 4 : 0), l(d, 3), d.status = U);
				else {
					var m = R + (d.w_bits - 8 << 4) << 8;
					m |= (2 <= d.strategy || d.level < 2 ? 0 : d.level < 6 ? 1 : 6 === d.level ? 2 : 3) << 6, 0 !== d.strstart && (m |= 32), m += 31 - m % 31, d.status = U, c(d, m), 0 !== d.strstart && (c(d, e.adler >>> 16), c(d, 65535 & e.adler)), e.adler = 1
				}
				if (69 === d.status) if (d.gzhead.extra) {
					for (f = d.pending; d.gzindex < (65535 & d.gzhead.extra.length) && (d.pending !== d.pending_buf_size || (d.gzhead.hcrc && d.pending > f && (e.adler = x(e.adler, d.pending_buf, d.pending - f, f)), r(e), f = d.pending, d.pending !== d.pending_buf_size));) l(d, 255 & d.gzhead.extra[d.gzindex]), d.gzindex++;
					d.gzhead.hcrc && d.pending > f && (e.adler = x(e.adler, d.pending_buf, d.pending - f, f)), d.gzindex === d.gzhead.extra.length && (d.gzindex = 0, d.status = 73)
				} else d.status = 73;
				if (73 === d.status) if (d.gzhead.name) {
					f = d.pending;
					do {
						if (d.pending === d.pending_buf_size && (d.gzhead.hcrc && d.pending > f && (e.adler = x(e.adler, d.pending_buf, d.pending - f, f)), r(e), f = d.pending, d.pending === d.pending_buf_size)) {
							p = 1;
							break
						}
						l(d, p = d.gzindex < d.gzhead.name.length ? 255 & d.gzhead.name.charCodeAt(d.gzindex++) : 0)
					} while (0 !== p);
					d.gzhead.hcrc && d.pending > f && (e.adler = x(e.adler, d.pending_buf, d.pending - f, f)), 0 === p && (d.gzindex = 0, d.status = 91)
				} else d.status = 91;
				if (91 === d.status) if (d.gzhead.comment) {
					f = d.pending;
					do {
						if (d.pending === d.pending_buf_size && (d.gzhead.hcrc && d.pending > f && (e.adler = x(e.adler, d.pending_buf, d.pending - f, f)), r(e), f = d.pending, d.pending === d.pending_buf_size)) {
							p = 1;
							break
						}
						l(d, p = d.gzindex < d.gzhead.comment.length ? 255 & d.gzhead.comment.charCodeAt(d.gzindex++) : 0)
					} while (0 !== p);
					d.gzhead.hcrc && d.pending > f && (e.adler = x(e.adler, d.pending_buf, d.pending - f, f)), 0 === p && (d.status = 103)
				} else d.status = 103;
				if (103 === d.status && (d.gzhead.hcrc ? (d.pending + 2 > d.pending_buf_size && r(e), d.pending + 2 <= d.pending_buf_size && (l(d, 255 & e.adler), l(d, e.adler >> 8 & 255), e.adler = 0, d.status = U)) : d.status = U), 0 !== d.pending) {
					if (r(e), 0 === e.avail_out) return d.last_flush = -1, I
				} else if (0 === e.avail_in && n(t) <= n(i) && t !== S) return a(e, -5);
				if (666 === d.status && 0 !== e.avail_in) return a(e, -5);
				if (0 !== e.avail_in || 0 !== d.lookahead || t !== T && 666 !== d.status) {
					var h = 2 === d.strategy ?
					function(e, t) {
						for (var i;;) {
							if (0 === e.lookahead && (u(e), 0 === e.lookahead)) {
								if (t === T) return q;
								break
							}
							if (e.match_length = 0, i = w._tr_tally(e, 0, e.window[e.strstart]), e.lookahead--, e.strstart++, i && (o(e, !1), 0 === e.strm.avail_out)) return q
						}
						return e.insert = 0, t === S ? (o(e, !0), 0 === e.strm.avail_out ? H : V) : e.last_lit && (o(e, !1), 0 === e.strm.avail_out) ? q : W
					}(d, t) : 3 === d.strategy ?
					function(e, t) {
						for (var i, a, n, s, r = e.window;;) {
							if (e.lookahead <= F) {
								if (u(e), e.lookahead <= F && t === T) return q;
								if (0 === e.lookahead) break
							}
							if (e.match_length = 0, e.lookahead >= P && 0 < e.strstart && (a = r[n = e.strstart - 1]) === r[++n] && a === r[++n] && a === r[++n]) {
								s = e.strstart + F;
								do;
								while (a === r[++n] && a === r[++n] && a === r[++n] && a === r[++n] && a === r[++n] && a === r[++n] && a === r[++n] && a === r[++n] && s > n);
								e.match_length = F - (s - n), e.match_length > e.lookahead && (e.match_length = e.lookahead)
							}
							if (e.match_length >= P ? (i = w._tr_tally(e, 1, e.match_length - P), e.lookahead -= e.match_length, e.strstart += e.match_length, e.match_length = 0) : (i = w._tr_tally(e, 0, e.window[e.strstart]), e.lookahead--, e.strstart++), i && (o(e, !1), 0 === e.strm.avail_out)) return q
						}
						return e.insert = 0, t === S ? (o(e, !0), 0 === e.strm.avail_out ? H : V) : e.last_lit && (o(e, !1), 0 === e.strm.avail_out) ? q : W
					}(d, t) : b[d.level].func(d, t);
					if (h !== H && h !== V || (d.status = 666), h === q || h === H) return 0 === e.avail_out && (d.last_flush = -1), I;
					if (h === W && (1 === t ? w._tr_align(d) : 5 !== t && (w._tr_stored_block(d, 0, 0, !1), 3 === t && (s(d.head), 0 === d.lookahead && (d.strstart = 0, d.block_start = 0, d.insert = 0))), r(e), 0 === e.avail_out)) return d.last_flush = -1, I
				}
				return t !== S ? I : d.wrap <= 0 ? 1 : (2 === d.wrap ? (l(d, 255 & e.adler), l(d, e.adler >> 8 & 255), l(d, e.adler >> 16 & 255), l(d, e.adler >> 24 & 255), l(d, 255 & e.total_in), l(d, e.total_in >> 8 & 255), l(d, e.total_in >> 16 & 255), l(d, e.total_in >> 24 & 255)) : (c(d, e.adler >>> 16), c(d, 65535 & e.adler)), r(e), 0 < d.wrap && (d.wrap = -d.wrap), 0 !== d.pending ? I : 1)
			}, i.deflateEnd = function(e) {
				var t;
				return e && e.state ? (t = e.state.status) !== G && 69 !== t && 73 !== t && 91 !== t && 103 !== t && t !== U && 666 !== t ? a(e, j) : (e.state = null, t === U ? a(e, -3) : I) : j
			}, i.deflateSetDictionary = function(e, t) {
				var i, a, n, r, o, l, c, d, f = t.length;
				if (!e || !e.state) return j;
				if (2 === (r = (i = e.state).wrap) || 1 === r && i.status !== G || i.lookahead) return j;
				for (1 === r && (e.adler = _(e.adler, t, f, 0)), i.wrap = 0, f >= i.w_size && (0 === r && (s(i.head), i.strstart = 0, i.block_start = 0, i.insert = 0), d = new k.Buf8(i.w_size), k.arraySet(d, t, f - i.w_size, i.w_size, 0), t = d, f = i.w_size), o = e.avail_in, l = e.next_in, c = e.input, e.avail_in = f, e.next_in = 0, e.input = t, u(i); i.lookahead >= P;) {
					for (a = i.strstart, n = i.lookahead - (P - 1); i.ins_h = (i.ins_h << i.hash_shift ^ i.window[a + P - 1]) & i.hash_mask, i.prev[a & i.w_mask] = i.head[i.ins_h], i.head[i.ins_h] = a, a++, --n;);
					i.strstart = a, i.lookahead = P - 1, u(i)
				}
				return i.strstart += i.lookahead, i.block_start = i.strstart, i.insert = i.lookahead, i.lookahead = 0, i.match_length = i.prev_length = P - 1, i.match_available = 0, e.next_in = l, e.input = c, e.avail_in = o, i.wrap = r, I
			}, i.deflateInfo = "pako deflate (from Nodeca project)"
		}, {
			"../utils/common": 62,
			"./adler32": 64,
			"./crc32": 66,
			"./messages": 72,
			"./trees": 73
		}],
		68: [function(e, t, i) {
			"use strict";
			t.exports = function() {
				this.text = 0, this.time = 0, this.xflags = 0, this.os = 0, this.extra = null, this.extra_len = 0, this.name = "", this.comment = "", this.hcrc = 0, this.done = !1
			}
		}, {}],
		69: [function(e, t, i) {
			"use strict";
			t.exports = function(e, t) {
				var i, a, n, s, r, o, l, c, d, u, f, p, m, h, g, v, y, b, k, w, _, x, C, T, S;
				i = e.state, a = e.next_in, T = e.input, n = a + (e.avail_in - 5), s = e.next_out, S = e.output, r = s - (t - e.avail_out), o = s + (e.avail_out - 257), l = i.dmax, c = i.wsize, d = i.whave, u = i.wnext, f = i.window, p = i.hold, m = i.bits, h = i.lencode, g = i.distcode, v = (1 << i.lenbits) - 1, y = (1 << i.distbits) - 1;
				e: do {
					15 > m && (p += T[a++] << m, m += 8, p += T[a++] << m, m += 8), b = h[p & v];
					t: for (;;) {
						if (p >>>= k = b >>> 24, m -= k, 0 === (k = b >>> 16 & 255)) S[s++] = 65535 & b;
						else {
							if (!(16 & k)) {
								if (0 == (64 & k)) {
									b = h[(65535 & b) + (p & (1 << k) - 1)];
									continue t
								}
								if (32 & k) {
									i.mode = 12;
									break e
								}
								e.msg = "invalid literal/length code", i.mode = 30;
								break e
							}
							w = 65535 & b, (k &= 15) && (k > m && (p += T[a++] << m, m += 8), w += p & (1 << k) - 1, p >>>= k, m -= k), 15 > m && (p += T[a++] << m, m += 8, p += T[a++] << m, m += 8), b = g[p & y];
							i: for (;;) {
								if (p >>>= k = b >>> 24, m -= k, !(16 & (k = b >>> 16 & 255))) {
									if (0 == (64 & k)) {
										b = g[(65535 & b) + (p & (1 << k) - 1)];
										continue i
									}
									e.msg = "invalid distance code", i.mode = 30;
									break e
								}
								if (_ = 65535 & b, m < (k &= 15) && (p += T[a++] << m, (m += 8) < k && (p += T[a++] << m, m += 8)), l < (_ += p & (1 << k) - 1)) {
									e.msg = "invalid distance too far back", i.mode = 30;
									break e
								}
								if (p >>>= k, m -= k, (k = s - r) < _) {
									if (d < (k = _ - k) && i.sane) {
										e.msg = "invalid distance too far back", i.mode = 30;
										break e
									}
									if (C = f, (x = 0) === u) {
										if (x += c - k, w > k) {
											for (w -= k; S[s++] = f[x++], --k;);
											x = s - _, C = S
										}
									} else if (k > u) {
										if (x += c + u - k, (k -= u) < w) {
											for (w -= k; S[s++] = f[x++], --k;);
											if (x = 0, w > u) {
												for (w -= k = u; S[s++] = f[x++], --k;);
												x = s - _, C = S
											}
										}
									} else if (x += u - k, w > k) {
										for (w -= k; S[s++] = f[x++], --k;);
										x = s - _, C = S
									}
									for (; w > 2;) S[s++] = C[x++], S[s++] = C[x++], S[s++] = C[x++], w -= 3;
									w && (S[s++] = C[x++], w > 1 && (S[s++] = C[x++]))
								} else {
									for (x = s - _; S[s++] = S[x++], S[s++] = S[x++], S[s++] = S[x++], 2 < (w -= 3););
									w && (S[s++] = S[x++], w > 1 && (S[s++] = S[x++]))
								}
								break
							}
						}
						break
					}
				}
				while (n > a && o > s);
				a -= w = m >> 3, p &= (1 << (m -= w << 3)) - 1, e.next_in = a, e.next_out = s, e.avail_in = n > a ? n - a + 5 : 5 - (a - n), e.avail_out = o > s ? o - s + 257 : 257 - (s - o), i.hold = p, i.bits = m
			}
		}, {}],
		70: [function(e, t, i) {
			"use strict";

			function a(e) {
				return (e >>> 24 & 255) + (e >>> 8 & 65280) + ((65280 & e) << 8) + ((255 & e) << 24)
			}
			function n() {
				this.mode = 0, this.last = !1, this.wrap = 0, this.havedict = !1, this.flags = 0, this.dmax = 0, this.check = 0, this.total = 0, this.head = null, this.wbits = 0, this.wsize = 0, this.whave = 0, this.wnext = 0, this.window = null, this.hold = 0, this.bits = 0, this.length = 0, this.offset = 0, this.extra = 0, this.lencode = null, this.distcode = null, this.lenbits = 0, this.distbits = 0, this.ncode = 0, this.nlen = 0, this.ndist = 0, this.have = 0, this.next = null, this.lens = new p.Buf16(320), this.work = new p.Buf16(288), this.lendyn = null, this.distdyn = null, this.sane = 0, this.back = 0, this.was = 0
			}
			function s(e) {
				var t;
				return e && e.state ? (t = e.state, e.total_in = e.total_out = t.total = 0, e.msg = "", t.wrap && (e.adler = 1 & t.wrap), t.mode = _, t.last = 0, t.havedict = 0, t.dmax = 32768, t.head = null, t.hold = 0, t.bits = 0, t.lencode = t.lendyn = new p.Buf32(x), t.distcode = t.distdyn = new p.Buf32(C), t.sane = 1, t.back = -1, k) : w
			}
			function r(e) {
				var t;
				return e && e.state ? ((t = e.state).wsize = 0, t.whave = 0, t.wnext = 0, s(e)) : w
			}
			function o(e, t) {
				var i, a;
				return e && e.state ? (a = e.state, 0 > t ? (i = 0, t = -t) : (i = 1 + (t >> 4), 48 > t && (t &= 15)), t && (8 > t || t > 15) ? w : (null !== a.window && a.wbits !== t && (a.window = null), a.wrap = i, a.wbits = t, r(e))) : w
			}
			function l(e, t) {
				var i, a;
				return e ? (a = new n, (e.state = a).window = null, (i = o(e, t)) !== k && (e.state = null), i) : w
			}
			function c(e) {
				if (T) {
					var t;
					for (u = new p.Buf32(512), f = new p.Buf32(32), t = 0; 144 > t;) e.lens[t++] = 8;
					for (; 256 > t;) e.lens[t++] = 9;
					for (; 280 > t;) e.lens[t++] = 7;
					for (; 288 > t;) e.lens[t++] = 8;
					for (v(y, e.lens, 0, 288, u, 0, e.work, {
						bits: 9
					}), t = 0; 32 > t;) e.lens[t++] = 5;
					v(b, e.lens, 0, 32, f, 0, e.work, {
						bits: 5
					}), T = !1
				}
				e.lencode = u, e.lenbits = 9, e.distcode = f, e.distbits = 5
			}
			function d(e, t, i, a) {
				var n, s = e.state;
				return null === s.window && (s.wsize = 1 << s.wbits, s.wnext = 0, s.whave = 0, s.window = new p.Buf8(s.wsize)), a >= s.wsize ? (p.arraySet(s.window, t, i - s.wsize, s.wsize, 0), s.wnext = 0, s.whave = s.wsize) : (a < (n = s.wsize - s.wnext) && (n = a), p.arraySet(s.window, t, i - a, n, s.wnext), (a -= n) ? (p.arraySet(s.window, t, i - a, a, 0), s.wnext = a, s.whave = s.wsize) : (s.wnext += n, s.wnext === s.wsize && (s.wnext = 0), s.whave < s.wsize && (s.whave += n))), 0
			}
			var u, f, p = e("../utils/common"),
				m = e("./adler32"),
				h = e("./crc32"),
				g = e("./inffast"),
				v = e("./inftrees"),
				y = 1,
				b = 2,
				k = 0,
				w = -2,
				_ = 1,
				x = 852,
				C = 592,
				T = !0;
			i.inflateReset = r, i.inflateReset2 = o, i.inflateResetKeep = s, i.inflateInit = function(e) {
				return l(e, 15)
			}, i.inflateInit2 = l, i.inflate = function(e, t) {
				var i, n, s, r, o, l, u, f, x, C, T, S, I, j, $, D, L, R, A, N, E, B, M, O, P = 0,
					F = new p.Buf8(4),
					z = [16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15];
				if (!e || !e.state || !e.output || !e.input && 0 !== e.avail_in) return w;
				12 === (i = e.state).mode && (i.mode = 13), o = e.next_out, s = e.output, u = e.avail_out, r = e.next_in, n = e.input, l = e.avail_in, f = i.hold, x = i.bits, C = l, T = u, B = k;
				e: for (;;) switch (i.mode) {
				case _:
					if (0 === i.wrap) {
						i.mode = 13;
						break
					}
					for (; 16 > x;) {
						if (0 === l) break e;
						l--, f += n[r++] << x, x += 8
					}
					if (2 & i.wrap && 35615 === f) {
						F[i.check = 0] = 255 & f, F[1] = f >>> 8 & 255, i.check = h(i.check, F, 2, 0), x = f = 0, i.mode = 2;
						break
					}
					if (i.flags = 0, i.head && (i.head.done = !1), !(1 & i.wrap) || (((255 & f) << 8) + (f >> 8)) % 31) {
						e.msg = "incorrect header check", i.mode = 30;
						break
					}
					if (8 != (15 & f)) {
						e.msg = "unknown compression method", i.mode = 30;
						break
					}
					if (x -= 4, E = 8 + (15 & (f >>>= 4)), 0 === i.wbits) i.wbits = E;
					else if (E > i.wbits) {
						e.msg = "invalid window size", i.mode = 30;
						break
					}
					i.dmax = 1 << E, e.adler = i.check = 1, i.mode = 512 & f ? 10 : 12, x = f = 0;
					break;
				case 2:
					for (; 16 > x;) {
						if (0 === l) break e;
						l--, f += n[r++] << x, x += 8
					}
					if (i.flags = f, 8 != (255 & i.flags)) {
						e.msg = "unknown compression method", i.mode = 30;
						break
					}
					if (57344 & i.flags) {
						e.msg = "unknown header flags set", i.mode = 30;
						break
					}
					i.head && (i.head.text = f >> 8 & 1), 512 & i.flags && (F[0] = 255 & f, F[1] = f >>> 8 & 255, i.check = h(i.check, F, 2, 0)), x = f = 0, i.mode = 3;
				case 3:
					for (; 32 > x;) {
						if (0 === l) break e;
						l--, f += n[r++] << x, x += 8
					}
					i.head && (i.head.time = f), 512 & i.flags && (F[0] = 255 & f, F[1] = f >>> 8 & 255, F[2] = f >>> 16 & 255, F[3] = f >>> 24 & 255, i.check = h(i.check, F, 4, 0)), x = f = 0, i.mode = 4;
				case 4:
					for (; 16 > x;) {
						if (0 === l) break e;
						l--, f += n[r++] << x, x += 8
					}
					i.head && (i.head.xflags = 255 & f, i.head.os = f >> 8), 512 & i.flags && (F[0] = 255 & f, F[1] = f >>> 8 & 255, i.check = h(i.check, F, 2, 0)), x = f = 0, i.mode = 5;
				case 5:
					if (1024 & i.flags) {
						for (; 16 > x;) {
							if (0 === l) break e;
							l--, f += n[r++] << x, x += 8
						}
						i.length = f, i.head && (i.head.extra_len = f), 512 & i.flags && (F[0] = 255 & f, F[1] = f >>> 8 & 255, i.check = h(i.check, F, 2, 0)), x = f = 0
					} else i.head && (i.head.extra = null);
					i.mode = 6;
				case 6:
					if (1024 & i.flags && (l < (S = i.length) && (S = l), S && (i.head && (E = i.head.extra_len - i.length, i.head.extra || (i.head.extra = new Array(i.head.extra_len)), p.arraySet(i.head.extra, n, r, S, E)), 512 & i.flags && (i.check = h(i.check, n, S, r)), l -= S, r += S, i.length -= S), i.length)) break e;
					i.length = 0, i.mode = 7;
				case 7:
					if (2048 & i.flags) {
						if (0 === l) break e;
						for (S = 0; E = n[r + S++], i.head && E && i.length < 65536 && (i.head.name += String.fromCharCode(E)), E && l > S;);
						if (512 & i.flags && (i.check = h(i.check, n, S, r)), l -= S, r += S, E) break e
					} else i.head && (i.head.name = null);
					i.length = 0, i.mode = 8;
				case 8:
					if (4096 & i.flags) {
						if (0 === l) break e;
						for (S = 0; E = n[r + S++], i.head && E && i.length < 65536 && (i.head.comment += String.fromCharCode(E)), E && l > S;);
						if (512 & i.flags && (i.check = h(i.check, n, S, r)), l -= S, r += S, E) break e
					} else i.head && (i.head.comment = null);
					i.mode = 9;
				case 9:
					if (512 & i.flags) {
						for (; 16 > x;) {
							if (0 === l) break e;
							l--, f += n[r++] << x, x += 8
						}
						if (f !== (65535 & i.check)) {
							e.msg = "header crc mismatch", i.mode = 30;
							break
						}
						x = f = 0
					}
					i.head && (i.head.hcrc = i.flags >> 9 & 1, i.head.done = !0), e.adler = i.check = 0, i.mode = 12;
					break;
				case 10:
					for (; 32 > x;) {
						if (0 === l) break e;
						l--, f += n[r++] << x, x += 8
					}
					e.adler = i.check = a(f), x = f = 0, i.mode = 11;
				case 11:
					if (0 === i.havedict) return e.next_out = o, e.avail_out = u, e.next_in = r, e.avail_in = l, i.hold = f, i.bits = x, 2;
					e.adler = i.check = 1, i.mode = 12;
				case 12:
					if (5 === t || 6 === t) break e;
				case 13:
					if (i.last) {
						f >>>= 7 & x, x -= 7 & x, i.mode = 27;
						break
					}
					for (; 3 > x;) {
						if (0 === l) break e;
						l--, f += n[r++] << x, x += 8
					}
					switch (i.last = 1 & f, x -= 1, 3 & (f >>>= 1)) {
					case 0:
						i.mode = 14;
						break;
					case 1:
						if (c(i), i.mode = 20, 6 === t) {
							f >>>= 2, x -= 2;
							break e
						}
						break;
					case 2:
						i.mode = 17;
						break;
					case 3:
						e.msg = "invalid block type", i.mode = 30
					}
					f >>>= 2, x -= 2;
					break;
				case 14:
					for (f >>>= 7 & x, x -= 7 & x; 32 > x;) {
						if (0 === l) break e;
						l--, f += n[r++] << x, x += 8
					}
					if ((65535 & f) != (f >>> 16 ^ 65535)) {
						e.msg = "invalid stored block lengths", i.mode = 30;
						break
					}
					if (i.length = 65535 & f, x = f = 0, i.mode = 15, 6 === t) break e;
				case 15:
					i.mode = 16;
				case 16:
					if (S = i.length) {
						if (S > l && (S = l), S > u && (S = u), 0 === S) break e;
						p.arraySet(s, n, r, S, o), l -= S, r += S, u -= S, o += S, i.length -= S;
						break
					}
					i.mode = 12;
					break;
				case 17:
					for (; 14 > x;) {
						if (0 === l) break e;
						l--, f += n[r++] << x, x += 8
					}
					if (i.nlen = 257 + (31 & f), f >>>= 5, x -= 5, i.ndist = 1 + (31 & f), f >>>= 5, x -= 5, i.ncode = 4 + (15 & f), f >>>= 4, x -= 4, 286 < i.nlen || 30 < i.ndist) {
						e.msg = "too many length or distance symbols", i.mode = 30;
						break
					}
					i.have = 0, i.mode = 18;
				case 18:
					for (; i.have < i.ncode;) {
						for (; 3 > x;) {
							if (0 === l) break e;
							l--, f += n[r++] << x, x += 8
						}
						i.lens[z[i.have++]] = 7 & f, f >>>= 3, x -= 3
					}
					for (; i.have < 19;) i.lens[z[i.have++]] = 0;
					if (i.lencode = i.lendyn, i.lenbits = 7, M = {
						bits: i.lenbits
					}, B = v(0, i.lens, 0, 19, i.lencode, 0, i.work, M), i.lenbits = M.bits, B) {
						e.msg = "invalid code lengths set", i.mode = 30;
						break
					}
					i.have = 0, i.mode = 19;
				case 19:
					for (; i.have < i.nlen + i.ndist;) {
						for (; D = (P = i.lencode[f & (1 << i.lenbits) - 1]) >>> 16 & 255, L = 65535 & P, !(($ = P >>> 24) <= x);) {
							if (0 === l) break e;
							l--, f += n[r++] << x, x += 8
						}
						if (16 > L) f >>>= $, x -= $, i.lens[i.have++] = L;
						else {
							if (16 === L) {
								for (O = $ + 2; O > x;) {
									if (0 === l) break e;
									l--, f += n[r++] << x, x += 8
								}
								if (f >>>= $, x -= $, 0 === i.have) {
									e.msg = "invalid bit length repeat", i.mode = 30;
									break
								}
								E = i.lens[i.have - 1], S = 3 + (3 & f), f >>>= 2, x -= 2
							} else if (17 === L) {
								for (O = $ + 3; O > x;) {
									if (0 === l) break e;
									l--, f += n[r++] << x, x += 8
								}
								x -= $, E = 0, S = 3 + (7 & (f >>>= $)), f >>>= 3, x -= 3
							} else {
								for (O = $ + 7; O > x;) {
									if (0 === l) break e;
									l--, f += n[r++] << x, x += 8
								}
								x -= $, E = 0, S = 11 + (127 & (f >>>= $)), f >>>= 7, x -= 7
							}
							if (i.have + S > i.nlen + i.ndist) {
								e.msg = "invalid bit length repeat", i.mode = 30;
								break
							}
							for (; S--;) i.lens[i.have++] = E
						}
					}
					if (30 === i.mode) break;
					if (0 === i.lens[256]) {
						e.msg = "invalid code -- missing end-of-block", i.mode = 30;
						break
					}
					if (i.lenbits = 9, M = {
						bits: i.lenbits
					}, B = v(y, i.lens, 0, i.nlen, i.lencode, 0, i.work, M), i.lenbits = M.bits, B) {
						e.msg = "invalid literal/lengths set", i.mode = 30;
						break
					}
					if (i.distbits = 6, i.distcode = i.distdyn, M = {
						bits: i.distbits
					}, B = v(b, i.lens, i.nlen, i.ndist, i.distcode, 0, i.work, M), i.distbits = M.bits, B) {
						e.msg = "invalid distances set", i.mode = 30;
						break
					}
					if (i.mode = 20, 6 === t) break e;
				case 20:
					i.mode = 21;
				case 21:
					if (l >= 6 && u >= 258) {
						e.next_out = o, e.avail_out = u, e.next_in = r, e.avail_in = l, i.hold = f, i.bits = x, g(e, T), o = e.next_out, s = e.output, u = e.avail_out, r = e.next_in, n = e.input, l = e.avail_in, f = i.hold, x = i.bits, 12 === i.mode && (i.back = -1);
						break
					}
					for (i.back = 0; D = (P = i.lencode[f & (1 << i.lenbits) - 1]) >>> 16 & 255, L = 65535 & P, !(($ = P >>> 24) <= x);) {
						if (0 === l) break e;
						l--, f += n[r++] << x, x += 8
					}
					if (D && 0 == (240 & D)) {
						for (R = $, A = D, N = L; D = (P = i.lencode[N + ((f & (1 << R + A) - 1) >> R)]) >>> 16 & 255, L = 65535 & P, !(R + ($ = P >>> 24) <= x);) {
							if (0 === l) break e;
							l--, f += n[r++] << x, x += 8
						}
						f >>>= R, x -= R, i.back += R
					}
					if (f >>>= $, x -= $, i.back += $, i.length = L, 0 === D) {
						i.mode = 26;
						break
					}
					if (32 & D) {
						i.back = -1, i.mode = 12;
						break
					}
					if (64 & D) {
						e.msg = "invalid literal/length code", i.mode = 30;
						break
					}
					i.extra = 15 & D, i.mode = 22;
				case 22:
					if (i.extra) {
						for (O = i.extra; O > x;) {
							if (0 === l) break e;
							l--, f += n[r++] << x, x += 8
						}
						i.length += f & (1 << i.extra) - 1, f >>>= i.extra, x -= i.extra, i.back += i.extra
					}
					i.was = i.length, i.mode = 23;
				case 23:
					for (; D = (P = i.distcode[f & (1 << i.distbits) - 1]) >>> 16 & 255, L = 65535 & P, !(($ = P >>> 24) <= x);) {
						if (0 === l) break e;
						l--, f += n[r++] << x, x += 8
					}
					if (0 == (240 & D)) {
						for (R = $, A = D, N = L; D = (P = i.distcode[N + ((f & (1 << R + A) - 1) >> R)]) >>> 16 & 255, L = 65535 & P, !(R + ($ = P >>> 24) <= x);) {
							if (0 === l) break e;
							l--, f += n[r++] << x, x += 8
						}
						f >>>= R, x -= R, i.back += R
					}
					if (f >>>= $, x -= $, i.back += $, 64 & D) {
						e.msg = "invalid distance code", i.mode = 30;
						break
					}
					i.offset = L, i.extra = 15 & D, i.mode = 24;
				case 24:
					if (i.extra) {
						for (O = i.extra; O > x;) {
							if (0 === l) break e;
							l--, f += n[r++] << x, x += 8
						}
						i.offset += f & (1 << i.extra) - 1, f >>>= i.extra, x -= i.extra, i.back += i.extra
					}
					if (i.offset > i.dmax) {
						e.msg = "invalid distance too far back", i.mode = 30;
						break
					}
					i.mode = 25;
				case 25:
					if (0 === u) break e;
					if (S = T - u, i.offset > S) {
						if ((S = i.offset - S) > i.whave && i.sane) {
							e.msg = "invalid distance too far back", i.mode = 30;
							break
						}
						S > i.wnext ? (S -= i.wnext, I = i.wsize - S) : I = i.wnext - S, S > i.length && (S = i.length), j = i.window
					} else j = s, I = o - i.offset, S = i.length;
					for (S > u && (S = u), u -= S, i.length -= S; s[o++] = j[I++], --S;);
					0 === i.length && (i.mode = 21);
					break;
				case 26:
					if (0 === u) break e;
					s[o++] = i.length, u--, i.mode = 21;
					break;
				case 27:
					if (i.wrap) {
						for (; 32 > x;) {
							if (0 === l) break e;
							l--, f |= n[r++] << x, x += 8
						}
						if (T -= u, e.total_out += T, i.total += T, T && (e.adler = i.check = i.flags ? h(i.check, s, T, o - T) : m(i.check, s, T, o - T)), T = u, (i.flags ? f : a(f)) !== i.check) {
							e.msg = "incorrect data check", i.mode = 30;
							break
						}
						x = f = 0
					}
					i.mode = 28;
				case 28:
					if (i.wrap && i.flags) {
						for (; 32 > x;) {
							if (0 === l) break e;
							l--, f += n[r++] << x, x += 8
						}
						if (f !== (4294967295 & i.total)) {
							e.msg = "incorrect length check", i.mode = 30;
							break
						}
						x = f = 0
					}
					i.mode = 29;
				case 29:
					B = 1;
					break e;
				case 30:
					B = -3;
					break e;
				case 31:
					return -4;
				case 32:
				default:
					return w
				}
				return e.next_out = o,
				e.avail_out = u,
				e.next_in = r,
				e.avail_in = l,
				i.hold = f,
				i.bits = x,
				(i.wsize || T !== e.avail_out && i.mode < 30 && (i.mode < 27 || 4 !== t)) && d(e, e.output, e.next_out, T - e.avail_out) ? (i.mode = 31, -4) : (C -= e.avail_in, T -= e.avail_out, e.total_in += C, e.total_out += T, i.total += T, i.wrap && T && (e.adler = i.check = i.flags ? h(i.check, s, T, e.next_out - T) : m(i.check, s, T, e.next_out - T)), e.data_type = i.bits + (i.last ? 64 : 0) + (12 === i.mode ? 128 : 0) + (20 === i.mode || 15 === i.mode ? 256 : 0), (0 === C && 0 === T || 4 === t) && B === k && (B = -5), B)
			}, i.inflateEnd = function(e) {
				if (!e || !e.state) return w;
				var t = e.state;
				return t.window && (t.window = null), e.state = null, k
			}, i.inflateGetHeader = function(e, t) {
				var i;
				return e && e.state ? 0 == (2 & (i = e.state).wrap) ? w : ((i.head = t).done = !1, k) : w
			}, i.inflateSetDictionary = function(e, t) {
				var i, a = t.length;
				return e && e.state ? 0 !== (i = e.state).wrap && 11 !== i.mode ? w : 11 === i.mode && m(1, t, a, 0) !== i.check ? -3 : d(e, t, a, a) ? (i.mode = 31, -4) : (i.havedict = 1, k) : w
			}, i.inflateInfo = "pako inflate (from Nodeca project)"
		}, {
			"../utils/common": 62,
			"./adler32": 64,
			"./crc32": 66,
			"./inffast": 69,
			"./inftrees": 71
		}],
		71: [function(e, t, i) {
			"use strict";
			var a = e("../utils/common"),
				n = [3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31, 35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0],
				s = [16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 18, 18, 18, 18, 19, 19, 19, 19, 20, 20, 20, 20, 21, 21, 21, 21, 16, 72, 78],
				r = [1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193, 257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145, 8193, 12289, 16385, 24577, 0, 0],
				o = [16, 16, 16, 16, 17, 17, 18, 18, 19, 19, 20, 20, 21, 21, 22, 22, 23, 23, 24, 24, 25, 25, 26, 26, 27, 27, 28, 28, 29, 29, 64, 64];
			t.exports = function(e, t, i, l, c, d, u, f) {
				var p, m, h, g, v, y, b, k, w, _ = f.bits,
					x = 0,
					C = 0,
					T = 0,
					S = 0,
					I = 0,
					j = 0,
					$ = 0,
					D = 0,
					L = 0,
					R = 0,
					A = null,
					N = 0,
					E = new a.Buf16(16),
					B = new a.Buf16(16),
					M = null,
					O = 0;
				for (x = 0; 15 >= x; x++) E[x] = 0;
				for (C = 0; l > C; C++) E[t[i + C]]++;
				for (I = _, S = 15; S >= 1 && 0 === E[S]; S--);
				if (I > S && (I = S), 0 === S) return c[d++] = 20971520, c[d++] = 20971520, f.bits = 1, 0;
				for (T = 1; S > T && 0 === E[T]; T++);
				for (T > I && (I = T), x = D = 1; 15 >= x; x++) if (D <<= 1, (D -= E[x]) < 0) return -1;
				if (D > 0 && (0 === e || 1 !== S)) return -1;
				for (B[1] = 0, x = 1; 15 > x; x++) B[x + 1] = B[x] + E[x];
				for (C = 0; l > C; C++) 0 !== t[i + C] && (u[B[t[i + C]]++] = C);
				if (0 === e ? (A = M = u, y = 19) : 1 === e ? (A = n, N -= 257, M = s, O -= 257, y = 256) : (A = r, M = o, y = -1), x = T, v = d, h = -1, g = (L = 1 << (j = I)) - 1, 1 === e && L > 852 || 2 === e && L > 592) return 1;
				for ($ = C = R = 0;;) {
					for (b = x - $, u[C] < y ? (k = 0, w = u[C]) : u[C] > y ? (k = M[O + u[C]], w = A[N + u[C]]) : (k = 96, w = 0), p = 1 << x - $, T = m = 1 << j; c[v + (R >> $) + (m -= p)] = b << 24 | k << 16 | w | 0, 0 !== m;);
					for (p = 1 << x - 1; R & p;) p >>= 1;
					if (0 !== p ? (R &= p - 1, R += p) : R = 0, C++, 0 == --E[x]) {
						if (x === S) break;
						x = t[i + u[C]]
					}
					if (x > I && (R & g) !== h) {
						for (0 === $ && ($ = I), v += T, D = 1 << (j = x - $); S > j + $ && !((D -= E[j + $]) <= 0);) j++, D <<= 1;
						if (L += 1 << j, 1 === e && L > 852 || 2 === e && L > 592) return 1;
						c[h = R & g] = I << 24 | j << 16 | v - d | 0
					}
				}
				return 0 !== R && (c[v + R] = x - $ << 24 | 64 << 16 | 0), f.bits = I, 0
			}
		}, {
			"../utils/common": 62
		}],
		72: [function(e, t, i) {
			"use strict";
			t.exports = {
				2: "need dictionary",
				1: "stream end",
				0: "",
				"-1": "file error",
				"-2": "stream error",
				"-3": "data error",
				"-4": "insufficient memory",
				"-5": "buffer error",
				"-6": "incompatible version"
			}
		}, {}],
		73: [function(e, t, i) {
			"use strict";

			function a(e) {
				for (var t = e.length; 0 <= --t;) e[t] = 0
			}
			function n(e, t, i, a, n) {
				this.static_tree = e, this.extra_bits = t, this.extra_base = i, this.elems = a, this.max_length = n, this.has_stree = e && e.length
			}
			function s(e, t) {
				this.dyn_tree = e, this.max_code = 0, this.stat_desc = t
			}
			function r(e) {
				return 256 > e ? q[e] : q[256 + (e >>> 7)]
			}
			function o(e, t) {
				e.pending_buf[e.pending++] = 255 & t, e.pending_buf[e.pending++] = t >>> 8 & 255
			}
			function l(e, t, i) {
				e.bi_valid > R - i ? (e.bi_buf |= t << e.bi_valid & 65535, o(e, e.bi_buf), e.bi_buf = t >> R - e.bi_valid, e.bi_valid += i - R) : (e.bi_buf |= t << e.bi_valid & 65535, e.bi_valid += i)
			}
			function c(e, t, i) {
				l(e, i[2 * t], i[2 * t + 1])
			}
			function d(e, t) {
				for (var i = 0; i |= 1 & e, e >>>= 1, i <<= 1, 0 < --t;);
				return i >>> 1
			}
			function u(e, t, i) {
				var a, n, s = new Array(L + 1),
					r = 0;
				for (a = 1; L >= a; a++) s[a] = r = r + i[a - 1] << 1;
				for (n = 0; t >= n; n++) {
					var o = e[2 * n + 1];
					0 !== o && (e[2 * n] = d(s[o]++, o))
				}
			}
			function f(e) {
				var t;
				for (t = 0; I > t; t++) e.dyn_ltree[2 * t] = 0;
				for (t = 0; j > t; t++) e.dyn_dtree[2 * t] = 0;
				for (t = 0; $ > t; t++) e.bl_tree[2 * t] = 0;
				e.dyn_ltree[2 * N] = 1, e.opt_len = e.static_len = 0, e.last_lit = e.matches = 0
			}
			function p(e) {
				8 < e.bi_valid ? o(e, e.bi_buf) : 0 < e.bi_valid && (e.pending_buf[e.pending++] = e.bi_buf), e.bi_buf = 0, e.bi_valid = 0
			}
			function m(e, t, i, a) {
				var n = 2 * t,
					s = 2 * i;
				return e[n] < e[s] || e[n] === e[s] && a[t] <= a[i]
			}
			function h(e, t, i) {
				for (var a = e.heap[i], n = i << 1; n <= e.heap_len && (n < e.heap_len && m(t, e.heap[n + 1], e.heap[n], e.depth) && n++, !m(t, a, e.heap[n], e.depth));) e.heap[i] = e.heap[n], i = n, n <<= 1;
				e.heap[i] = a
			}
			function g(e, t, i) {
				var a, n, s, o, d = 0;
				if (0 !== e.last_lit) for (; a = e.pending_buf[e.d_buf + 2 * d] << 8 | e.pending_buf[e.d_buf + 2 * d + 1], n = e.pending_buf[e.l_buf + d], d++, 0 === a ? c(e, n, t) : (c(e, (s = W[n]) + S + 1, t), 0 !== (o = O[s]) && l(e, n -= H[s], o), c(e, s = r(--a), i), 0 !== (o = P[s]) && l(e, a -= V[s], o)), d < e.last_lit;);
				c(e, N, t)
			}
			function v(e, t) {
				var i, a, n, s = t.dyn_tree,
					r = t.stat_desc.static_tree,
					o = t.stat_desc.has_stree,
					l = t.stat_desc.elems,
					c = -1;
				for (e.heap_len = 0, e.heap_max = D, i = 0; l > i; i++) 0 !== s[2 * i] ? (e.heap[++e.heap_len] = c = i, e.depth[i] = 0) : s[2 * i + 1] = 0;
				for (; e.heap_len < 2;) s[2 * (n = e.heap[++e.heap_len] = 2 > c ? ++c : 0)] = 1, e.depth[n] = 0, e.opt_len--, o && (e.static_len -= r[2 * n + 1]);
				for (t.max_code = c, i = e.heap_len >> 1; i >= 1; i--) h(e, s, i);
				for (n = l; i = e.heap[1], e.heap[1] = e.heap[e.heap_len--], h(e, s, 1), a = e.heap[1], e.heap[--e.heap_max] = i, e.heap[--e.heap_max] = a, s[2 * n] = s[2 * i] + s[2 * a], e.depth[n] = (e.depth[i] >= e.depth[a] ? e.depth[i] : e.depth[a]) + 1, s[2 * i + 1] = s[2 * a + 1] = n, e.heap[1] = n++, h(e, s, 1), 2 <= e.heap_len;);
				e.heap[--e.heap_max] = e.heap[1], function(e, t) {
					var i, a, n, s, r, o, l = t.dyn_tree,
						c = t.max_code,
						d = t.stat_desc.static_tree,
						u = t.stat_desc.has_stree,
						f = t.stat_desc.extra_bits,
						p = t.stat_desc.extra_base,
						m = t.stat_desc.max_length,
						h = 0;
					for (s = 0; L >= s; s++) e.bl_count[s] = 0;
					for (l[2 * e.heap[e.heap_max] + 1] = 0, i = e.heap_max + 1; D > i; i++) m < (s = l[2 * l[2 * (a = e.heap[i]) + 1] + 1] + 1) && (s = m, h++), l[2 * a + 1] = s, a > c || (e.bl_count[s]++, r = 0, a >= p && (r = f[a - p]), o = l[2 * a], e.opt_len += o * (s + r), u && (e.static_len += o * (d[2 * a + 1] + r)));
					if (0 !== h) {
						do {
							for (s = m - 1; 0 === e.bl_count[s];) s--;
							e.bl_count[s]--, e.bl_count[s + 1] += 2, e.bl_count[m]--, h -= 2
						} while (h > 0);
						for (s = m; 0 !== s; s--) for (a = e.bl_count[s]; 0 !== a;) c < (n = e.heap[--i]) || (l[2 * n + 1] !== s && (e.opt_len += (s - l[2 * n + 1]) * l[2 * n], l[2 * n + 1] = s), a--)
					}
				}(e, t), u(s, c, e.bl_count)
			}
			function y(e, t, i) {
				var a, n, s = -1,
					r = t[1],
					o = 0,
					l = 7,
					c = 4;
				for (0 === r && (l = 138, c = 3), t[2 * (i + 1) + 1] = 65535, a = 0; i >= a; a++) n = r, r = t[2 * (a + 1) + 1], ++o < l && n === r || (c > o ? e.bl_tree[2 * n] += o : 0 !== n ? (n !== s && e.bl_tree[2 * n]++, e.bl_tree[2 * E]++) : 10 >= o ? e.bl_tree[2 * B]++ : e.bl_tree[2 * M]++, s = n, (o = 0) === r ? (l = 138, c = 3) : n === r ? (l = 6, c = 3) : (l = 7, c = 4))
			}
			function b(e, t, i) {
				var a, n, s = -1,
					r = t[1],
					o = 0,
					d = 7,
					u = 4;
				for (0 === r && (d = 138, u = 3), a = 0; i >= a; a++) if (n = r, r = t[2 * (a + 1) + 1], !(++o < d && n === r)) {
					if (u > o) for (; c(e, n, e.bl_tree), 0 != --o;);
					else 0 !== n ? (n !== s && (c(e, n, e.bl_tree), o--), c(e, E, e.bl_tree), l(e, o - 3, 2)) : 10 >= o ? (c(e, B, e.bl_tree), l(e, o - 3, 3)) : (c(e, M, e.bl_tree), l(e, o - 11, 7));
					s = n, (o = 0) === r ? (d = 138, u = 3) : n === r ? (d = 6, u = 3) : (d = 7, u = 4)
				}
			}
			function k(e, t, i, a) {
				var n, s, r, c;
				l(e, (C << 1) + (a ? 1 : 0), 3), s = t, r = i, c = !0, p(n = e), c && (o(n, r), o(n, ~r)), w.arraySet(n.pending_buf, n.window, s, r, n.pending), n.pending += r
			}
			var w = e("../utils/common"),
				_ = 0,
				x = 1,
				C = 0,
				T = 29,
				S = 256,
				I = S + 1 + T,
				j = 30,
				$ = 19,
				D = 2 * I + 1,
				L = 15,
				R = 16,
				A = 7,
				N = 256,
				E = 16,
				B = 17,
				M = 18,
				O = [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0],
				P = [0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13],
				F = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 3, 7],
				z = [16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15],
				G = new Array(2 * (I + 2));
			a(G);
			var U = new Array(2 * j);
			a(U);
			var q = new Array(512);
			a(q);
			var W = new Array(256);
			a(W);
			var H = new Array(T);
			a(H);
			var V = new Array(j);
			a(V);
			var J, Y, K, Z = !1;
			i._tr_init = function(e) {
				Z || (function() {
					var e, t, i, a, s, r = new Array(L + 1);
					for (a = i = 0; T - 1 > a; a++) for (H[a] = i, e = 0; e < 1 << O[a]; e++) W[i++] = a;
					for (W[i - 1] = a, a = s = 0; 16 > a; a++) for (V[a] = s, e = 0; e < 1 << P[a]; e++) q[s++] = a;
					for (s >>= 7; j > a; a++) for (V[a] = s << 7, e = 0; e < 1 << P[a] - 7; e++) q[256 + s++] = a;
					for (t = 0; L >= t; t++) r[t] = 0;
					for (e = 0; 143 >= e;) G[2 * e + 1] = 8, e++, r[8]++;
					for (; 255 >= e;) G[2 * e + 1] = 9, e++, r[9]++;
					for (; 279 >= e;) G[2 * e + 1] = 7, e++, r[7]++;
					for (; 287 >= e;) G[2 * e + 1] = 8, e++, r[8]++;
					for (u(G, I + 1, r), e = 0; j > e; e++) U[2 * e + 1] = 5, U[2 * e] = d(e, 5);
					J = new n(G, O, S + 1, I, L), Y = new n(U, P, 0, j, L), K = new n(new Array(0), F, 0, $, A)
				}(), Z = !0), e.l_desc = new s(e.dyn_ltree, J), e.d_desc = new s(e.dyn_dtree, Y), e.bl_desc = new s(e.bl_tree, K), e.bi_buf = 0, e.bi_valid = 0, f(e)
			}, i._tr_stored_block = k, i._tr_flush_block = function(e, t, i, a) {
				var n, s, r = 0;
				0 < e.level ? (2 === e.strm.data_type && (e.strm.data_type = function(e) {
					var t, i = 4093624447;
					for (t = 0; 31 >= t; t++, i >>>= 1) if (1 & i && 0 !== e.dyn_ltree[2 * t]) return _;
					if (0 !== e.dyn_ltree[18] || 0 !== e.dyn_ltree[20] || 0 !== e.dyn_ltree[26]) return x;
					for (t = 32; S > t; t++) if (0 !== e.dyn_ltree[2 * t]) return x;
					return _
				}(e)), v(e, e.l_desc), v(e, e.d_desc), r = function(e) {
					var t;
					for (y(e, e.dyn_ltree, e.l_desc.max_code), y(e, e.dyn_dtree, e.d_desc.max_code), v(e, e.bl_desc), t = $ - 1; t >= 3 && 0 === e.bl_tree[2 * z[t] + 1]; t--);
					return e.opt_len += 3 * (t + 1) + 5 + 5 + 4, t
				}(e), n = e.opt_len + 3 + 7 >>> 3, (s = e.static_len + 3 + 7 >>> 3) <= n && (n = s)) : n = s = i + 5, n >= i + 4 && -1 !== t ? k(e, t, i, a) : 4 === e.strategy || s === n ? (l(e, 2 + (a ? 1 : 0), 3), g(e, G, U)) : (l(e, 4 + (a ? 1 : 0), 3), function(e, t, i, a) {
					var n;
					for (l(e, t - 257, 5), l(e, i - 1, 5), l(e, a - 4, 4), n = 0; a > n; n++) l(e, e.bl_tree[2 * z[n] + 1], 3);
					b(e, e.dyn_ltree, t - 1), b(e, e.dyn_dtree, i - 1)
				}(e, e.l_desc.max_code + 1, e.d_desc.max_code + 1, r + 1), g(e, e.dyn_ltree, e.dyn_dtree)), f(e), a && p(e)
			}, i._tr_tally = function(e, t, i) {
				return e.pending_buf[e.d_buf + 2 * e.last_lit] = t >>> 8 & 255, e.pending_buf[e.d_buf + 2 * e.last_lit + 1] = 255 & t, e.pending_buf[e.l_buf + e.last_lit] = 255 & i, e.last_lit++, 0 === t ? e.dyn_ltree[2 * i]++ : (e.matches++, t--, e.dyn_ltree[2 * (W[i] + S + 1)]++, e.dyn_dtree[2 * r(t)]++), e.last_lit === e.lit_bufsize - 1
			}, i._tr_align = function(e) {
				var t;
				l(e, 2, 3), c(e, N, G), 16 === (t = e).bi_valid ? (o(t, t.bi_buf), t.bi_buf = 0, t.bi_valid = 0) : 8 <= t.bi_valid && (t.pending_buf[t.pending++] = 255 & t.bi_buf, t.bi_buf >>= 8, t.bi_valid -= 8)
			}
		}, {
			"../utils/common": 62
		}],
		74: [function(e, t, i) {
			"use strict";
			t.exports = function() {
				this.input = null, this.next_in = 0, this.avail_in = 0, this.total_in = 0, this.output = null, this.next_out = 0, this.avail_out = 0, this.total_out = 0, this.msg = "", this.state = null, this.data_type = 2, this.adler = 0
			}
		}, {}]
	}, {}, [10])(10)
}), function(e) {
	"object" == typeof exports ? module.exports = e() : "function" == typeof define && define.amd ? define(e) : "undefined" != typeof window ? window.JSZipUtils = e() : "undefined" != typeof global ? global.JSZipUtils = e() : "undefined" != typeof self && (self.JSZipUtils = e())
}(function() {
	return function e(t, i, a) {
		function n(r, o) {
			if (!i[r]) {
				if (!t[r]) {
					var l = "function" == typeof require && require;
					if (!o && l) return l(r, !0);
					if (s) return s(r, !0);
					throw new Error("Cannot find module '" + r + "'")
				}
				var c = i[r] = {
					exports: {}
				};
				t[r][0].call(c.exports, function(e) {
					var i = t[r][1][e];
					return n(i || e)
				}, c, c.exports, e, t, i, a)
			}
			return i[r].exports
		}
		for (var s = "function" == typeof require && require, r = 0; r < a.length; r++) n(a[r]);
		return n
	}({
		1: [function(e, t, i) {
			"use strict";

			function a() {
				try {
					return new window.XMLHttpRequest
				} catch (e) {}
			}
			var n = {};
			n._getBinaryFromXHR = function(e) {
				return e.response || e.responseText
			};
			var s = window.ActiveXObject ?
			function() {
				return a() ||
				function() {
					try {
						return new window.ActiveXObject("Microsoft.XMLHTTP")
					} catch (e) {}
				}()
			} : a;
			n.getBinaryContent = function(e, t) {
				try {
					var i = s();
					i.open("GET", e, !0), "responseType" in i && (i.responseType = "arraybuffer"), i.overrideMimeType && i.overrideMimeType("text/plain; charset=x-user-defined"), i.onreadystatechange = function(a) {
						var s, r;
						if (4 === i.readyState) if (200 === i.status || 0 === i.status) {
							r = s = null;
							try {
								s = n._getBinaryFromXHR(i)
							} catch (a) {
								r = new Error(a)
							}
							t(r, s)
						} else t(new Error("Ajax error for " + e + " : " + this.status + " " + this.statusText), null)
					}, i.send()
				} catch (a) {
					t(new Error(a), null)
				}
			}, t.exports = n
		}, {}]
	}, {}, [1])(1)
});
var svgaLib = function(e) {
		function t(a) {
			if (i[a]) return i[a].exports;
			var n = i[a] = {
				i: a,
				l: !1,
				exports: {}
			};
			return e[a].call(n.exports, n, n.exports, t), n.l = !0, n.exports
		}
		var i = {};
		return t.m = e, t.c = i, t.d = function(e, i, a) {
			t.o(e, i) || Object.defineProperty(e, i, {
				configurable: !1,
				enumerable: !0,
				get: a
			})
		}, t.n = function(e) {
			var i = e && e.__esModule ?
			function() {
				return e["default"]
			} : function() {
				return e
			};
			return t.d(i, "a", i), i
		}, t.o = function(e, t) {
			return Object.prototype.hasOwnProperty.call(e, t)
		}, t.p = "", t(t.s = 28)
	}([function(e, t, i) {
		"use strict";
		var a, n, s = e.exports = i(2),
			r = i(17);
		s.codegen = i(47), s.fetch = i(48), s.path = i(49), s.fs = s.inquire("fs"), s.toArray = function(e) {
			if (e) {
				for (var t = Object.keys(e), i = new Array(t.length), a = 0; a < t.length;) i[a] = e[t[a++]];
				return i
			}
			return []
		}, s.toObject = function(e) {
			for (var t = {}, i = 0; i < e.length;) {
				var a = e[i++],
					n = e[i++];
				void 0 !== n && (t[a] = n)
			}
			return t
		};
		var o = /\\/g,
			l = /"/g;
		s.isReserved = function(e) {
			return /^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)
		}, s.safeProp = function(e) {
			return !/^[$\w_]+$/.test(e) || s.isReserved(e) ? '["' + e.replace(o, "\\\\").replace(l, '\\"') + '"]' : "." + e
		}, s.ucFirst = function(e) {
			return e.charAt(0).toUpperCase() + e.substring(1)
		};
		var c = /_([a-z])/g;
		s.camelCase = function(e) {
			return e.substring(0, 1) + e.substring(1).replace(c, function(e, t) {
				return t.toUpperCase()
			})
		}, s.compareFieldsById = function(e, t) {
			return e.id - t.id
		}, s.decorateType = function(e, t) {
			if (e.$type) return t && e.$type.name !== t && (s.decorateRoot.remove(e.$type), e.$type.name = t, s.decorateRoot.add(e.$type)), e.$type;
			a || (a = i(19));
			var n = new a(t || e.name);
			return s.decorateRoot.add(n), n.ctor = e, Object.defineProperty(e, "$type", {
				value: n,
				enumerable: !1
			}), Object.defineProperty(e.prototype, "$type", {
				value: n,
				enumerable: !1
			}), n
		};
		var d = 0;
		s.decorateEnum = function(e) {
			if (e.$type) return e.$type;
			n || (n = i(1));
			var t = new n("Enum" + d++, e);
			return s.decorateRoot.add(t), Object.defineProperty(e, "$type", {
				value: t,
				enumerable: !1
			}), t
		}, Object.defineProperty(s, "decorateRoot", {
			get: function() {
				return r.decorated || (r.decorated = new(i(27)))
			}
		})
	}, function(e, t, i) {
		"use strict";

		function a(e, t, i, a, s) {
			if (n.call(this, e, i), t && "object" != typeof t) throw TypeError("values must be an object");
			if (this.valuesById = {}, this.values = Object.create(this.valuesById), this.comment = a, this.comments = s || {}, this.reserved = void 0, t) for (var r = Object.keys(t), o = 0; o < r.length; ++o)"number" == typeof t[r[o]] && (this.valuesById[this.values[r[o]] = t[r[o]]] = r[o])
		}
		e.exports = a;
		var n = i(4);
		((a.prototype = Object.create(n.prototype)).constructor = a).className = "Enum";
		var s = i(6),
			r = i(0);
		a.fromJSON = function(e, t) {
			var i = new a(e, t.values, t.options, t.comment, t.comments);
			return i.reserved = t.reserved, i
		}, a.prototype.toJSON = function(e) {
			var t = !! e && Boolean(e.keepComments);
			return r.toObject(["options", this.options, "values", this.values, "reserved", this.reserved && this.reserved.length ? this.reserved : void 0, "comment", t ? this.comment : void 0, "comments", t ? this.comments : void 0])
		}, a.prototype.add = function(e, t, i) {
			if (!r.isString(e)) throw TypeError("name must be a string");
			if (!r.isInteger(t)) throw TypeError("id must be an integer");
			if (void 0 !== this.values[e]) throw Error("duplicate name '" + e + "' in " + this);
			if (this.isReservedId(t)) throw Error("id " + t + " is reserved in " + this);
			if (this.isReservedName(e)) throw Error("name '" + e + "' is reserved in " + this);
			if (void 0 !== this.valuesById[t]) {
				if (!this.options || !this.options.allow_alias) throw Error("duplicate id " + t + " in " + this);
				this.values[e] = t
			} else this.valuesById[this.values[e] = t] = e;
			return this.comments[e] = i || null, this
		}, a.prototype.remove = function(e) {
			if (!r.isString(e)) throw TypeError("name must be a string");
			var t = this.values[e];
			if (null == t) throw Error("name '" + e + "' does not exist in " + this);
			return delete this.valuesById[t], delete this.values[e], delete this.comments[e], this
		}, a.prototype.isReservedId = function(e) {
			return s.isReservedId(this.reserved, e)
		}, a.prototype.isReservedName = function(e) {
			return s.isReservedName(this.reserved, e)
		}
	}, function(e, t, i) {
		"use strict";
		(function(e) {
			function a(e, t, i) {
				for (var a = Object.keys(t), n = 0; n < a.length; ++n) void 0 !== e[a[n]] && i || (e[a[n]] = t[a[n]]);
				return e
			}
			function n(e) {
				function t(e, i) {
					return this instanceof t ? (Object.defineProperty(this, "message", {
						get: function() {
							return e
						}
					}), Error.captureStackTrace ? Error.captureStackTrace(this, t) : Object.defineProperty(this, "stack", {
						value: (new Error).stack || ""
					}), i && a(this, i), void 0) : new t(e, i)
				}
				return (t.prototype = Object.create(Error.prototype)).constructor = t, Object.defineProperty(t.prototype, "name", {
					get: function() {
						return e
					}
				}), t.prototype.toString = function() {
					return this.name + ": " + this.message
				}, t
			}
			var s = t;
			s.asPromise = i(14), s.base64 = i(38), s.EventEmitter = i(39), s["float"] = i(40), s.inquire = i(15), s.utf8 = i(41), s.pool = i(42), s.LongBits = i(43), s.emptyArray = Object.freeze ? Object.freeze([]) : [], s.emptyObject = Object.freeze ? Object.freeze({}) : {}, s.isNode = Boolean(e.process && e.process.versions && e.process.versions.node), s.isInteger = Number.isInteger ||
			function(e) {
				return "number" == typeof e && isFinite(e) && Math.floor(e) === e
			}, s.isString = function(e) {
				return "string" == typeof e || e instanceof String
			}, s.isObject = function(e) {
				return e && "object" == typeof e
			}, s.isset = s.isSet = function(e, t) {
				var i = e[t];
				return !(null == i || !e.hasOwnProperty(t)) && ("object" != typeof i || 0 < (Array.isArray(i) ? i.length : Object.keys(i).length))
			}, s.Buffer = function() {
				try {
					var e = s.inquire("buffer").Buffer;
					return e.prototype.utf8Write ? e : null
				} catch (e) {
					return null
				}
			}(), s._Buffer_from = null, s._Buffer_allocUnsafe = null, s.newBuffer = function(e) {
				return "number" == typeof e ? s.Buffer ? s._Buffer_allocUnsafe(e) : new s.Array(e) : s.Buffer ? s._Buffer_from(e) : "undefined" == typeof Uint8Array ? e : new Uint8Array(e)
			}, s.Array = "undefined" != typeof Uint8Array ? Uint8Array : Array, s.Long = e.dcodeIO && e.dcodeIO.Long || s.inquire("long"), s.key2Re = /^true|false|0|1$/, s.key32Re = /^-?(?:0|[1-9][0-9]*)$/, s.key64Re = /^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/, s.longToHash = function(e) {
				return e ? s.LongBits.from(e).toHash() : s.LongBits.zeroHash
			}, s.longFromHash = function(e, t) {
				var i = s.LongBits.fromHash(e);
				return s.Long ? s.Long.fromBits(i.lo, i.hi, t) : i.toNumber(Boolean(t))
			}, s.merge = a, s.lcFirst = function(e) {
				return e.charAt(0).toLowerCase() + e.substring(1)
			}, s.newError = n, s.ProtocolError = n("ProtocolError"), s.oneOfGetter = function(e) {
				for (var t = {}, i = 0; i < e.length; ++i) t[e[i]] = 1;
				return function() {
					for (var e = Object.keys(this), i = e.length - 1; i > -1; --i) if (1 === t[e[i]] && void 0 !== this[e[i]] && null !== this[e[i]]) return e[i]
				}
			}, s.oneOfSetter = function(e) {
				return function(t) {
					for (var i = 0; i < e.length; ++i) e[i] !== t && delete this[e[i]]
				}
			}, s.toJSONOptions = {
				longs: String,
				enums: String,
				bytes: String,
				json: !0
			}, s._configure = function() {
				var e = s.Buffer;
				e ? (s._Buffer_from = e.from !== Uint8Array.from && e.from ||
				function(t, i) {
					return new e(t, i)
				}, s._Buffer_allocUnsafe = e.allocUnsafe ||
				function(t) {
					return new e(t)
				}) : s._Buffer_from = s._Buffer_allocUnsafe = null
			}
		}).call(t, i(37))
	}, function(e, t, i) {
		"use strict";
		Object.defineProperty(t, "__esModule", {
			value: !0
		}), t.BezierPath = function a(e, t, i) {
			!
			function(e, t) {
				if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
			}(this, a), this._d = e, this._transform = t, this._styles = i
		}
	}, function(e, t, i) {
		"use strict";

		function a(e, t) {
			if (!s.isString(e)) throw TypeError("name must be a string");
			if (t && !s.isObject(t)) throw TypeError("options must be an object");
			this.options = t, this.name = e, this.parent = null, this.resolved = !1, this.comment = null, this.filename = null
		}(e.exports = a).className = "ReflectionObject";
		var n, s = i(0);
		Object.defineProperties(a.prototype, {
			root: {
				get: function() {
					for (var e = this; null !== e.parent;) e = e.parent;
					return e
				}
			},
			fullName: {
				get: function() {
					for (var e = [this.name], t = this.parent; t;) e.unshift(t.name), t = t.parent;
					return e.join(".")
				}
			}
		}), a.prototype.toJSON = function() {
			throw Error()
		}, a.prototype.onAdd = function(e) {
			this.parent && this.parent !== e && this.parent.remove(this), this.parent = e, this.resolved = !1;
			var t = e.root;
			t instanceof n && t._handleAdd(this)
		}, a.prototype.onRemove = function(e) {
			var t = e.root;
			t instanceof n && t._handleRemove(this), this.parent = null, this.resolved = !1
		}, a.prototype.resolve = function() {
			return this.resolved || this.root instanceof n && (this.resolved = !0), this
		}, a.prototype.getOption = function(e) {
			return this.options ? this.options[e] : void 0
		}, a.prototype.setOption = function(e, t, i) {
			return i && this.options && void 0 !== this.options[e] || ((this.options || (this.options = {}))[e] = t), this
		}, a.prototype.setOptions = function(e, t) {
			if (e) for (var i = Object.keys(e), a = 0; a < i.length; ++a) this.setOption(i[a], e[i[a]], t);
			return this
		}, a.prototype.toString = function() {
			var e = this.constructor.className,
				t = this.fullName;
			return t.length ? e + " " + t : e
		}, a._configure = function(e) {
			n = e
		}
	}, function(e, t, i) {
		"use strict";

		function a(e, t, i, a, s, r, d) {
			if (l.isObject(a) ? (d = s, r = a, a = s = void 0) : l.isObject(s) && (d = r, r = s, s = void 0), n.call(this, e, r), !l.isInteger(t) || 0 > t) throw TypeError("id must be a non-negative integer");
			if (!l.isString(i)) throw TypeError("type must be a string");
			if (void 0 !== a && !c.test(a = a.toString().toLowerCase())) throw TypeError("rule must be a string rule");
			if (void 0 !== s && !l.isString(s)) throw TypeError("extend must be a string");
			this.rule = a && "optional" !== a ? a : void 0, this.type = i, this.id = t, this.extend = s || void 0, this.required = "required" === a, this.optional = !this.required, this.repeated = "repeated" === a, this.map = !1, this.message = null, this.partOf = null, this.typeDefault = null, this.defaultValue = null, this["long"] = !! l.Long && void 0 !== o["long"][i], this.bytes = "bytes" === i, this.resolvedType = null, this.extensionField = null, this.declaringField = null, this._packed = null, this.comment = d
		}
		e.exports = a;
		var n = i(4);
		((a.prototype = Object.create(n.prototype)).constructor = a).className = "Field";
		var s, r = i(1),
			o = i(7),
			l = i(0),
			c = /^required|optional|repeated$/;
		a.fromJSON = function(e, t) {
			return new a(e, t.id, t.type, t.rule, t.extend, t.options, t.comment)
		}, Object.defineProperty(a.prototype, "packed", {
			get: function() {
				return null === this._packed && (this._packed = !1 !== this.getOption("packed")), this._packed
			}
		}), a.prototype.setOption = function(e, t, i) {
			return "packed" === e && (this._packed = null), n.prototype.setOption.call(this, e, t, i)
		}, a.prototype.toJSON = function(e) {
			var t = !! e && Boolean(e.keepComments);
			return l.toObject(["rule", "optional" !== this.rule && this.rule || void 0, "type", this.type, "id", this.id, "extend", this.extend, "options", this.options, "comment", t ? this.comment : void 0])
		}, a.prototype.resolve = function() {
			if (this.resolved) return this;
			if (void 0 === (this.typeDefault = o.defaults[this.type]) && (this.resolvedType = (this.declaringField ? this.declaringField.parent : this.parent).lookupTypeOrEnum(this.type), this.resolvedType instanceof s ? this.typeDefault = null : this.typeDefault = this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]), this.options && null != this.options["default"] && (this.typeDefault = this.options["default"], this.resolvedType instanceof r && "string" == typeof this.typeDefault && (this.typeDefault = this.resolvedType.values[this.typeDefault])), this.options && (!0 !== this.options.packed && (void 0 === this.options.packed || !this.resolvedType || this.resolvedType instanceof r) || delete this.options.packed, Object.keys(this.options).length || (this.options = void 0)), this["long"]) this.typeDefault = l.Long.fromNumber(this.typeDefault, "u" === this.type.charAt(0)), Object.freeze && Object.freeze(this.typeDefault);
			else if (this.bytes && "string" == typeof this.typeDefault) {
				var e;
				l.base64.test(this.typeDefault) ? l.base64.decode(this.typeDefault, e = l.newBuffer(l.base64.length(this.typeDefault)), 0) : l.utf8.write(this.typeDefault, e = l.newBuffer(l.utf8.length(this.typeDefault)), 0), this.typeDefault = e
			}
			return this.map ? this.defaultValue = l.emptyObject : this.repeated ? this.defaultValue = l.emptyArray : this.defaultValue = this.typeDefault, this.parent instanceof s && (this.parent.ctor.prototype[this.name] = this.defaultValue), n.prototype.resolve.call(this)
		}, a.d = function(e, t, i, n) {
			return "function" == typeof t ? t = l.decorateType(t).name : t && "object" == typeof t && (t = l.decorateEnum(t).name), function(s, r) {
				l.decorateType(s.constructor).add(new a(r, e, t, i, {
					"default": n
				}))
			}
		}, a._configure = function(e) {
			s = e
		}
	}, function(e, t, i) {
		"use strict";

		function a(e, t) {
			if (e && e.length) {
				for (var i = {}, a = 0; a < e.length; ++a) i[e[a].name] = e[a].toJSON(t);
				return i
			}
		}
		function n(e, t) {
			r.call(this, e, t), this.nested = void 0, this._nestedArray = null
		}
		function s(e) {
			return e._nestedArray = null, e
		}
		e.exports = n;
		var r = i(4);
		((n.prototype = Object.create(r.prototype)).constructor = n).className = "Namespace";
		var o, l, c = i(1),
			d = i(5),
			u = i(0);
		n.fromJSON = function(e, t) {
			return new n(e, t.options).addJSON(t.nested)
		}, n.arrayToJSON = a, n.isReservedId = function(e, t) {
			if (e) for (var i = 0; i < e.length; ++i) if ("string" != typeof e[i] && e[i][0] <= t && e[i][1] >= t) return !0;
			return !1
		}, n.isReservedName = function(e, t) {
			if (e) for (var i = 0; i < e.length; ++i) if (e[i] === t) return !0;
			return !1
		}, Object.defineProperty(n.prototype, "nestedArray", {
			get: function() {
				return this._nestedArray || (this._nestedArray = u.toArray(this.nested))
			}
		}), n.prototype.toJSON = function(e) {
			return u.toObject(["options", this.options, "nested", a(this.nestedArray, e)])
		}, n.prototype.addJSON = function(e) {
			if (e) for (var t, i = Object.keys(e), a = 0; a < i.length; ++a) t = e[i[a]], this.add((void 0 !== t.fields ? o.fromJSON : void 0 !== t.values ? c.fromJSON : void 0 !== t.methods ? l.fromJSON : void 0 !== t.id ? d.fromJSON : n.fromJSON)(i[a], t));
			return this
		}, n.prototype.get = function(e) {
			return this.nested && this.nested[e] || null
		}, n.prototype.getEnum = function(e) {
			if (this.nested && this.nested[e] instanceof c) return this.nested[e].values;
			throw Error("no such enum: " + e)
		}, n.prototype.add = function(e) {
			if (!(e instanceof d && void 0 !== e.extend || e instanceof o || e instanceof c || e instanceof l || e instanceof n)) throw TypeError("object must be a valid nested object");
			if (this.nested) {
				var t = this.get(e.name);
				if (t) {
					if (!(t instanceof n && e instanceof n) || t instanceof o || t instanceof l) throw Error("duplicate name '" + e.name + "' in " + this);
					for (var i = t.nestedArray, a = 0; a < i.length; ++a) e.add(i[a]);
					this.remove(t), this.nested || (this.nested = {}), e.setOptions(t.options, !0)
				}
			} else this.nested = {};
			return (this.nested[e.name] = e).onAdd(this), s(this)
		}, n.prototype.remove = function(e) {
			if (!(e instanceof r)) throw TypeError("object must be a ReflectionObject");
			if (e.parent !== this) throw Error(e + " is not a member of " + this);
			return delete this.nested[e.name], Object.keys(this.nested).length || (this.nested = void 0), e.onRemove(this), s(this)
		}, n.prototype.define = function(e, t) {
			if (u.isString(e)) e = e.split(".");
			else if (!Array.isArray(e)) throw TypeError("illegal path");
			if (e && e.length && "" === e[0]) throw Error("path must be relative");
			for (var i = this; 0 < e.length;) {
				var a = e.shift();
				if (i.nested && i.nested[a]) {
					if (!((i = i.nested[a]) instanceof n)) throw Error("path conflicts with non-namespace objects")
				} else i.add(i = new n(a))
			}
			return t && i.addJSON(t), i
		}, n.prototype.resolveAll = function() {
			for (var e = this.nestedArray, t = 0; t < e.length;) e[t] instanceof n ? e[t++].resolveAll() : e[t++].resolve();
			return this.resolve()
		}, n.prototype.lookup = function(e, t, i) {
			if ("boolean" == typeof t ? (i = t, t = void 0) : t && !Array.isArray(t) && (t = [t]), u.isString(e) && e.length) {
				if ("." === e) return this.root;
				e = e.split(".")
			} else if (!e.length) return this;
			if ("" === e[0]) return this.root.lookup(e.slice(1), t);
			var a = this.get(e[0]);
			if (a) {
				if (1 === e.length) {
					if (!t || -1 < t.indexOf(a.constructor)) return a
				} else if (a instanceof n && (a = a.lookup(e.slice(1), t, !0))) return a
			} else for (var s = 0; s < this.nestedArray.length; ++s) if (this._nestedArray[s] instanceof n && (a = this._nestedArray[s].lookup(e, t, !0))) return a;
			return null === this.parent || i ? null : this.parent.lookup(e, t)
		}, n.prototype.lookupType = function(e) {
			var t = this.lookup(e, [o]);
			if (!t) throw Error("no such type: " + e);
			return t
		}, n.prototype.lookupEnum = function(e) {
			var t = this.lookup(e, [c]);
			if (!t) throw Error("no such Enum '" + e + "' in " + this);
			return t
		}, n.prototype.lookupTypeOrEnum = function(e) {
			var t = this.lookup(e, [o, c]);
			if (!t) throw Error("no such Type or Enum '" + e + "' in " + this);
			return t
		}, n.prototype.lookupService = function(e) {
			var t = this.lookup(e, [l]);
			if (!t) throw Error("no such Service '" + e + "' in " + this);
			return t
		}, n._configure = function(e, t) {
			o = e, l = t
		}
	}, function(e, t, i) {
		"use strict";

		function a(e, t) {
			var i = 0,
				a = {};
			for (t |= 0; i < e.length;) a[r[i + t]] = e[i++];
			return a
		}
		var n = t,
			s = i(0),
			r = ["double", "float", "int32", "uint32", "sint32", "fixed32", "sfixed32", "int64", "uint64", "sint64", "fixed64", "sfixed64", "bool", "string", "bytes"];
		n.basic = a([1, 5, 0, 0, 0, 5, 5, 0, 0, 0, 1, 1, 0, 2, 2]), n.defaults = a([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, !1, "", s.emptyArray, null]), n["long"] = a([0, 0, 0, 1, 1], 7), n.mapKey = a([0, 0, 0, 5, 5, 0, 0, 0, 1, 1, 0, 2], 2), n.packed = a([1, 5, 0, 0, 0, 5, 5, 0, 0, 0, 1, 1, 0])
	}, function(e, t, i) {
		"use strict";

		function a(e, t, i) {
			this.fn = e, this.len = t, this.next = void 0, this.val = i
		}
		function n() {}
		function s(e) {
			this.head = e.head, this.tail = e.tail, this.len = e.len, this.next = e.states
		}
		function r() {
			this.len = 0, this.head = new a(n, 0, 0), this.tail = this.head, this.states = null
		}
		function o(e, t, i) {
			t[i] = 255 & e
		}
		function l(e, t) {
			this.len = e, this.next = void 0, this.val = t
		}
		function c(e, t, i) {
			for (; e.hi;) t[i++] = 127 & e.lo | 128, e.lo = (e.lo >>> 7 | e.hi << 25) >>> 0, e.hi >>>= 7;
			for (; 127 < e.lo;) t[i++] = 127 & e.lo | 128, e.lo = e.lo >>> 7;
			t[i++] = e.lo
		}
		function d(e, t, i) {
			t[i] = 255 & e, t[i + 1] = e >>> 8 & 255, t[i + 2] = e >>> 16 & 255, t[i + 3] = e >>> 24
		}
		e.exports = r;
		var u, f = i(2),
			p = f.LongBits,
			m = f.base64,
			h = f.utf8;
		r.create = f.Buffer ?
		function() {
			return (r.create = function() {
				return new u
			})()
		} : function() {
			return new r
		}, r.alloc = function(e) {
			return new f.Array(e)
		}, f.Array !== Array && (r.alloc = f.pool(r.alloc, f.Array.prototype.subarray)), r.prototype._push = function(e, t, i) {
			return this.tail = this.tail.next = new a(e, t, i), this.len += t, this
		}, (l.prototype = Object.create(a.prototype)).fn = function(e, t, i) {
			for (; e > 127;) t[i++] = 127 & e | 128, e >>>= 7;
			t[i] = e
		}, r.prototype.uint32 = function(e) {
			return this.len += (this.tail = this.tail.next = new l((e >>>= 0) < 128 ? 1 : 16384 > e ? 2 : 2097152 > e ? 3 : 268435456 > e ? 4 : 5, e)).len, this
		}, r.prototype.int32 = function(e) {
			return 0 > e ? this._push(c, 10, p.fromNumber(e)) : this.uint32(e)
		}, r.prototype.sint32 = function(e) {
			return this.uint32((e << 1 ^ e >> 31) >>> 0)
		}, r.prototype.int64 = r.prototype.uint64 = function(e) {
			var t = p.from(e);
			return this._push(c, t.length(), t)
		}, r.prototype.sint64 = function(e) {
			var t = p.from(e).zzEncode();
			return this._push(c, t.length(), t)
		}, r.prototype.bool = function(e) {
			return this._push(o, 1, e ? 1 : 0)
		}, r.prototype.sfixed32 = r.prototype.fixed32 = function(e) {
			return this._push(d, 4, e >>> 0)
		}, r.prototype.sfixed64 = r.prototype.fixed64 = function(e) {
			var t = p.from(e);
			return this._push(d, 4, t.lo)._push(d, 4, t.hi)
		}, r.prototype["float"] = function(e) {
			return this._push(f["float"].writeFloatLE, 4, e)
		}, r.prototype["double"] = function(e) {
			return this._push(f["float"].writeDoubleLE, 8, e)
		};
		var g = f.Array.prototype.set ?
		function(e, t, i) {
			t.set(e, i)
		} : function(e, t, i) {
			for (var a = 0; a < e.length; ++a) t[i + a] = e[a]
		};
		r.prototype.bytes = function(e) {
			var t = e.length >>> 0;
			if (!t) return this._push(o, 1, 0);
			if (f.isString(e)) {
				var i = r.alloc(t = m.length(e));
				m.decode(e, i, 0), e = i
			}
			return this.uint32(t)._push(g, t, e)
		}, r.prototype.string = function(e) {
			var t = h.length(e);
			return t ? this.uint32(t)._push(h.write, t, e) : this._push(o, 1, 0)
		}, r.prototype.fork = function() {
			return this.states = new s(this), this.head = this.tail = new a(n, 0, 0), this.len = 0, this
		}, r.prototype.reset = function() {
			return this.states ? (this.head = this.states.head, this.tail = this.states.tail, this.len = this.states.len, this.states = this.states.next) : (this.head = this.tail = new a(n, 0, 0), this.len = 0), this
		}, r.prototype.ldelim = function() {
			var e = this.head,
				t = this.tail,
				i = this.len;
			return this.reset().uint32(i), i && (this.tail.next = e.next, this.tail = t, this.len += i), this
		}, r.prototype.finish = function() {
			for (var e = this.head.next, t = this.constructor.alloc(this.len), i = 0; e;) e.fn(e.val, t, i), i += e.len, e = e.next;
			return t
		}, r._configure = function(e) {
			u = e
		}
	}, function(e, t, i) {
		"use strict";

		function a(e, t) {
			return RangeError("index out of range: " + e.pos + " + " + (t || 1) + " > " + e.len)
		}
		function n(e) {
			this.buf = e, this.pos = 0, this.len = e.length
		}
		function s() {
			var e = new u(0, 0),
				t = 0;
			if (!(4 < this.len - this.pos)) {
				for (; 3 > t; ++t) {
					if (this.pos >= this.len) throw a(this);
					if (e.lo = (e.lo | (127 & this.buf[this.pos]) << 7 * t) >>> 0, this.buf[this.pos++] < 128) return e
				}
				return e.lo = (e.lo | (127 & this.buf[this.pos++]) << 7 * t) >>> 0, e
			}
			for (; 4 > t; ++t) if (e.lo = (e.lo | (127 & this.buf[this.pos]) << 7 * t) >>> 0, this.buf[this.pos++] < 128) return e;
			if (e.lo = (e.lo | (127 & this.buf[this.pos]) << 28) >>> 0, e.hi = (e.hi | (127 & this.buf[this.pos]) >> 4) >>> 0, this.buf[this.pos++] < 128) return e;
			if (t = 0, 4 < this.len - this.pos) {
				for (; 5 > t; ++t) if (e.hi = (e.hi | (127 & this.buf[this.pos]) << 7 * t + 3) >>> 0, this.buf[this.pos++] < 128) return e
			} else for (; 5 > t; ++t) {
				if (this.pos >= this.len) throw a(this);
				if (e.hi = (e.hi | (127 & this.buf[this.pos]) << 7 * t + 3) >>> 0, this.buf[this.pos++] < 128) return e
			}
			throw Error("invalid varint encoding")
		}
		function r(e, t) {
			return (e[t - 4] | e[t - 3] << 8 | e[t - 2] << 16 | e[t - 1] << 24) >>> 0
		}
		function o() {
			if (this.pos + 8 > this.len) throw a(this, 8);
			return new u(r(this.buf, this.pos += 4), r(this.buf, this.pos += 4))
		}
		e.exports = n;
		var l, c, d = i(2),
			u = d.LongBits,
			f = d.utf8,
			p = "undefined" != typeof Uint8Array ?
		function(e) {
			if (e instanceof Uint8Array || Array.isArray(e)) return new n(e);
			throw Error("illegal buffer")
		} : function(e) {
			if (Array.isArray(e)) return new n(e);
			throw Error("illegal buffer")
		};
		n.create = d.Buffer ?
		function(e) {
			return (n.create = function(e) {
				return d.Buffer.isBuffer(e) ? new l(e) : p(e)
			})(e)
		} : p, n.prototype._slice = d.Array.prototype.subarray || d.Array.prototype.slice, n.prototype.uint32 = (c = 4294967295, function() {
			if (c = (127 & this.buf[this.pos]) >>> 0, this.buf[this.pos++] < 128) return c;
			if (c = (c | (127 & this.buf[this.pos]) << 7) >>> 0, this.buf[this.pos++] < 128) return c;
			if (c = (c | (127 & this.buf[this.pos]) << 14) >>> 0, this.buf[this.pos++] < 128) return c;
			if (c = (c | (127 & this.buf[this.pos]) << 21) >>> 0, this.buf[this.pos++] < 128) return c;
			if (c = (c | (15 & this.buf[this.pos]) << 28) >>> 0, this.buf[this.pos++] < 128) return c;
			if ((this.pos += 5) > this.len) throw this.pos = this.len, a(this, 10);
			return c
		}), n.prototype.int32 = function() {
			return 0 | this.uint32()
		}, n.prototype.sint32 = function() {
			var e = this.uint32();
			return e >>> 1 ^ -(1 & e) | 0
		}, n.prototype.bool = function() {
			return 0 !== this.uint32()
		}, n.prototype.fixed32 = function() {
			if (this.pos + 4 > this.len) throw a(this, 4);
			return r(this.buf, this.pos += 4)
		}, n.prototype.sfixed32 = function() {
			if (this.pos + 4 > this.len) throw a(this, 4);
			return 0 | r(this.buf, this.pos += 4)
		}, n.prototype["float"] = function() {
			if (this.pos + 4 > this.len) throw a(this, 4);
			var e = d["float"].readFloatLE(this.buf, this.pos);
			return this.pos += 4, e
		}, n.prototype["double"] = function() {
			if (this.pos + 8 > this.len) throw a(this, 4);
			var e = d["float"].readDoubleLE(this.buf, this.pos);
			return this.pos += 8, e
		}, n.prototype.bytes = function() {
			var e = this.uint32(),
				t = this.pos,
				i = this.pos + e;
			if (i > this.len) throw a(this, e);
			return this.pos += e, Array.isArray(this.buf) ? this.buf.slice(t, i) : t === i ? new this.buf.constructor(0) : this._slice.call(this.buf, t, i)
		}, n.prototype.string = function() {
			var e = this.bytes();
			return f.read(e, 0, e.length)
		}, n.prototype.skip = function(e) {
			if ("number" == typeof e) {
				if (this.pos + e > this.len) throw a(this, e);
				this.pos += e
			} else do
			if (this.pos >= this.len) throw a(this);
			while (128 & this.buf[this.pos++]);
			return this
		}, n.prototype.skipType = function(e) {
			switch (e) {
			case 0:
				this.skip();
				break;
			case 1:
				this.skip(8);
				break;
			case 2:
				this.skip(this.uint32());
				break;
			case 3:
				for (; 4 != (e = 7 & this.uint32());) this.skipType(e);
				break;
			case 5:
				this.skip(4);
				break;
			default:
				throw Error("invalid wire type " + e + " at offset " + this.pos)
			}
			return this
		}, n._configure = function(e) {
			l = e;
			var t = d.Long ? "toLong" : "toNumber";
			d.merge(n.prototype, {
				int64: function() {
					return s.call(this)[t](!1)
				},
				uint64: function() {
					return s.call(this)[t](!0)
				},
				sint64: function() {
					return s.call(this).zzDecode()[t](!1)
				},
				fixed64: function() {
					return o.call(this)[t](!0)
				},
				sfixed64: function() {
					return o.call(this)[t](!1)
				}
			})
		}
	}, function(e, t, i) {
		"use strict";

		function a(e, t, i, a) {
			if (Array.isArray(t) || (i = t, t = void 0), s.call(this, e, i), void 0 !== t && !Array.isArray(t)) throw TypeError("fieldNames must be an Array");
			this.oneof = t || [], this.fieldsArray = [], this.comment = a
		}
		function n(e) {
			if (e.parent) for (var t = 0; t < e.fieldsArray.length; ++t) e.fieldsArray[t].parent || e.parent.add(e.fieldsArray[t])
		}
		e.exports = a;
		var s = i(4);
		((a.prototype = Object.create(s.prototype)).constructor = a).className = "OneOf";
		var r = i(5),
			o = i(0);
		a.fromJSON = function(e, t) {
			return new a(e, t.oneof, t.options, t.comment)
		}, a.prototype.toJSON = function(e) {
			var t = !! e && Boolean(e.keepComments);
			return o.toObject(["options", this.options, "oneof", this.oneof, "comment", t ? this.comment : void 0])
		}, a.prototype.add = function(e) {
			if (!(e instanceof r)) throw TypeError("field must be a Field");
			return e.parent && e.parent !== this.parent && e.parent.remove(e), this.oneof.push(e.name), this.fieldsArray.push(e), n(e.partOf = this), this
		}, a.prototype.remove = function(e) {
			if (!(e instanceof r)) throw TypeError("field must be a Field");
			var t = this.fieldsArray.indexOf(e);
			if (0 > t) throw Error(e + " is not a member of " + this);
			return this.fieldsArray.splice(t, 1), -1 < (t = this.oneof.indexOf(e.name)) && this.oneof.splice(t, 1), e.partOf = null, this
		}, a.prototype.onAdd = function(e) {
			s.prototype.onAdd.call(this, e);
			for (var t = 0; t < this.oneof.length; ++t) {
				var i = e.get(this.oneof[t]);
				i && !i.partOf && (i.partOf = this).fieldsArray.push(i)
			}
			n(this)
		}, a.prototype.onRemove = function(e) {
			for (var t, i = 0; i < this.fieldsArray.length; ++i)(t = this.fieldsArray[i]).parent && t.parent.remove(t);
			s.prototype.onRemove.call(this, e)
		}, a.d = function() {
			for (var e = new Array(arguments.length), t = 0; t < arguments.length;) e[t] = arguments[t++];
			return function(t, i) {
				o.decorateType(t.constructor).add(new a(i, e)), Object.defineProperty(t, i, {
					get: o.oneOfGetter(e),
					set: o.oneOfSetter(e)
				})
			}
		}
	}, function(e, t, i) {
		"use strict";

		function a(e) {
			if (e) for (var t = Object.keys(e), i = 0; i < t.length; ++i) this[t[i]] = e[t[i]]
		}
		e.exports = a;
		var n = i(2);
		a.create = function(e) {
			return this.$type.create(e)
		}, a.encode = function(e, t) {
			return this.$type.encode(e, t)
		}, a.encodeDelimited = function(e, t) {
			return this.$type.encodeDelimited(e, t)
		}, a.decode = function(e) {
			return this.$type.decode(e)
		}, a.decodeDelimited = function(e) {
			return this.$type.decodeDelimited(e)
		}, a.verify = function(e) {
			return this.$type.verify(e)
		}, a.fromObject = function(e) {
			return this.$type.fromObject(e)
		}, a.toObject = function(e, t) {
			return this.$type.toObject(e, t)
		}, a.prototype.toJSON = function() {
			return this.$type.toObject(this, n.toJSONOptions)
		}
	}, function(e, t, i) {
		"use strict";
		Object.defineProperty(t, "__esModule", {
			value: !0
		}), t.EllipsePath = void 0;
		var a = i(3);
		t.EllipsePath = function(e) {
			function t(e, i, a, n, s, r) {
				!
				function(e, t) {
					if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
				}(this, t);
				var o = function(e, t) {
						if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
						return !t || "object" != typeof t && "function" != typeof t ? e : t
					}(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
				return o._x = e, o._y = i, o._radiusX = a, o._radiusY = n, o._transform = s, o._styles = r, o
			}
			return function(e, t) {
				if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
				e.prototype = Object.create(t && t.prototype, {
					constructor: {
						value: e,
						enumerable: !1,
						writable: !0,
						configurable: !0
					}
				}), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
			}(t, a.BezierPath), t
		}()
	}, function(e, t, i) {
		"use strict";
		Object.defineProperty(t, "__esModule", {
			value: !0
		});
		var a = i(34),
			n = JSON.parse('{"nested":{"com":{"nested":{"opensource":{"nested":{"svga":{"options":{"objc_class_prefix":"SVGAProto","java_package":"com.opensource.svgaplayer"},"nested":{"MovieParams":{"fields":{"viewBoxWidth":{"type":"float","id":1},"viewBoxHeight":{"type":"float","id":2},"fps":{"type":"int32","id":3},"frames":{"type":"int32","id":4}}},"SpriteEntity":{"fields":{"imageKey":{"type":"string","id":1},"frames":{"rule":"repeated","type":"FrameEntity","id":2}}},"Layout":{"fields":{"x":{"type":"float","id":1},"y":{"type":"float","id":2},"width":{"type":"float","id":3},"height":{"type":"float","id":4}}},"Transform":{"fields":{"a":{"type":"float","id":1},"b":{"type":"float","id":2},"c":{"type":"float","id":3},"d":{"type":"float","id":4},"tx":{"type":"float","id":5},"ty":{"type":"float","id":6}}},"ShapeEntity":{"oneofs":{"args":{"oneof":["shape","rect","ellipse"]}},"fields":{"type":{"type":"ShapeType","id":1},"shape":{"type":"ShapeArgs","id":2},"rect":{"type":"RectArgs","id":3},"ellipse":{"type":"EllipseArgs","id":4},"styles":{"type":"ShapeStyle","id":10},"transform":{"type":"Transform","id":11}},"nested":{"ShapeType":{"values":{"SHAPE":0,"RECT":1,"ELLIPSE":2,"KEEP":3}},"ShapeArgs":{"fields":{"d":{"type":"string","id":1}}},"RectArgs":{"fields":{"x":{"type":"float","id":1},"y":{"type":"float","id":2},"width":{"type":"float","id":3},"height":{"type":"float","id":4},"cornerRadius":{"type":"float","id":5}}},"EllipseArgs":{"fields":{"x":{"type":"float","id":1},"y":{"type":"float","id":2},"radiusX":{"type":"float","id":3},"radiusY":{"type":"float","id":4}}},"ShapeStyle":{"fields":{"fill":{"type":"RGBAColor","id":1},"stroke":{"type":"RGBAColor","id":2},"strokeWidth":{"type":"float","id":3},"lineCap":{"type":"LineCap","id":4},"lineJoin":{"type":"LineJoin","id":5},"miterLimit":{"type":"float","id":6},"lineDashI":{"type":"float","id":7},"lineDashII":{"type":"float","id":8},"lineDashIII":{"type":"float","id":9}},"nested":{"RGBAColor":{"fields":{"r":{"type":"float","id":1},"g":{"type":"float","id":2},"b":{"type":"float","id":3},"a":{"type":"float","id":4}}},"LineCap":{"values":{"LineCap_BUTT":0,"LineCap_ROUND":1,"LineCap_SQUARE":2}},"LineJoin":{"values":{"LineJoin_MITER":0,"LineJoin_ROUND":1,"LineJoin_BEVEL":2}}}}}},"FrameEntity":{"fields":{"alpha":{"type":"float","id":1},"layout":{"type":"Layout","id":2},"transform":{"type":"Transform","id":3},"clipPath":{"type":"string","id":4},"shapes":{"rule":"repeated","type":"ShapeEntity","id":5}}},"MovieEntity":{"fields":{"version":{"type":"string","id":1},"params":{"type":"MovieParams","id":2},"images":{"keyType":"string","type":"bytes","id":3},"sprites":{"rule":"repeated","type":"SpriteEntity","id":4}}}}}}}}}}}'),
			s = t.proto = a.Root.fromJSON(n);
		t.ProtoMovieEntity = s.lookupType("com.opensource.svga.MovieEntity")
	}, function(e, t, i) {
		"use strict";
		e.exports = function(e, t) {
			for (var i = new Array(arguments.length - 1), a = 0, n = 2, s = !0; n < arguments.length;) i[a++] = arguments[n++];
			return new Promise(function(e, n) {
				i[a] = function(t) {
					if (s) if (s = !1, t) n(t);
					else {
						for (var i = new Array(arguments.length - 1), a = 0; a < i.length;) i[a++] = arguments[a];
						e.apply(null, i)
					}
				};
				try {
					r.apply(t || null, i)
				} catch (r) {
					s && (s = !1, n(r))
				}
			})
		}
	}, function(module, exports, __webpack_require__) {
		"use strict";

		function inquire(moduleName) {
			try {
				var mod = eval("quire".replace(/^/, "re"))(moduleName);
				if (mod && (mod.length || Object.keys(mod).length)) return mod
			} catch (e) {}
			return null
		}
		module.exports = inquire
	}, function(e, t, i) {
		"use strict";
		t.Service = i(46)
	}, function(e, t, i) {
		"use strict";
		e.exports = {}
	}, function(e, t, i) {
		"use strict";

		function a(e, t, i, a) {
			return t.resolvedType.group ? e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)", i, a, (t.id << 3 | 3) >>> 0, (t.id << 3 | 4) >>> 0) : e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()", i, a, (t.id << 3 | 2) >>> 0)
		}
		e.exports = function(e) {
			for (var t, i = r.codegen(["m", "w"], e.name + "$encode")("if(!w)")("w=Writer.create()"), o = e.fieldsArray.slice().sort(r.compareFieldsById), l = 0; l < o.length; ++l) {
				var c = o[l].resolve(),
					d = e._fieldsArray.indexOf(c),
					u = c.resolvedType instanceof n ? "int32" : c.type,
					f = s.basic[u];
				t = "m" + r.safeProp(c.name), c.map ? (i("if(%s!=null&&m.hasOwnProperty(%j)){", t, c.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){", t)("w.uint32(%i).fork().uint32(%i).%s(ks[i])", (c.id << 3 | 2) >>> 0, 8 | s.mapKey[c.keyType], c.keyType), void 0 === f ? i("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()", d, t) : i(".uint32(%i).%s(%s[ks[i]]).ldelim()", 16 | f, u, t), i("}")("}")) : c.repeated ? (i("if(%s!=null&&%s.length){", t, t), c.packed && void 0 !== s.packed[u] ? i("w.uint32(%i).fork()", (c.id << 3 | 2) >>> 0)("for(var i=0;i<%s.length;++i)", t)("w.%s(%s[i])", u, t)("w.ldelim()") : (i("for(var i=0;i<%s.length;++i)", t), void 0 === f ? a(i, c, d, t + "[i]") : i("w.uint32(%i).%s(%s[i])", (c.id << 3 | f) >>> 0, u, t)), i("}")) : (c.optional && i("if(%s!=null&&m.hasOwnProperty(%j))", t, c.name), void 0 === f ? a(i, c, d, t) : i("w.uint32(%i).%s(%s)", (c.id << 3 | f) >>> 0, u, t))
			}
			return i("return w")
		};
		var n = i(1),
			s = i(7),
			r = i(0)
	}, function(e, t, i) {
		"use strict";

		function a(e, t) {
			s.call(this, e, t), this.fields = {}, this.oneofs = void 0, this.extensions = void 0, this.reserved = void 0, this.group = void 0, this._fieldsById = null, this._fieldsArray = null, this._oneofsArray = null, this._ctor = null
		}
		function n(e) {
			return e._fieldsById = e._fieldsArray = e._oneofsArray = null, delete e.encode, delete e.decode, delete e.verify, e
		}
		e.exports = a;
		var s = i(6);
		((a.prototype = Object.create(s.prototype)).constructor = a).className = "Type";
		var r = i(1),
			o = i(10),
			l = i(5),
			c = i(20),
			d = i(21),
			u = i(11),
			f = i(9),
			p = i(8),
			m = i(0),
			h = i(18),
			g = i(23),
			v = i(24),
			y = i(25),
			b = i(26);
		Object.defineProperties(a.prototype, {
			fieldsById: {
				get: function() {
					if (this._fieldsById) return this._fieldsById;
					this._fieldsById = {};
					for (var e = Object.keys(this.fields), t = 0; t < e.length; ++t) {
						var i = this.fields[e[t]],
							a = i.id;
						if (this._fieldsById[a]) throw Error("duplicate id " + a + " in " + this);
						this._fieldsById[a] = i
					}
					return this._fieldsById
				}
			},
			fieldsArray: {
				get: function() {
					return this._fieldsArray || (this._fieldsArray = m.toArray(this.fields))
				}
			},
			oneofsArray: {
				get: function() {
					return this._oneofsArray || (this._oneofsArray = m.toArray(this.oneofs))
				}
			},
			ctor: {
				get: function() {
					return this._ctor || (this.ctor = a.generateConstructor(this)())
				},
				set: function(e) {
					var t = e.prototype;
					t instanceof u || ((e.prototype = new u).constructor = e, m.merge(e.prototype, t)), e.$type = e.prototype.$type = this, m.merge(e, u, !0), this._ctor = e;
					for (var i = 0; i < this.fieldsArray.length; ++i) this._fieldsArray[i].resolve();
					var a = {};
					for (i = 0; i < this.oneofsArray.length; ++i) a[this._oneofsArray[i].resolve().name] = {
						get: m.oneOfGetter(this._oneofsArray[i].oneof),
						set: m.oneOfSetter(this._oneofsArray[i].oneof)
					};
					i && Object.defineProperties(e.prototype, a)
				}
			}
		}), a.generateConstructor = function(e) {
			for (var t, i = m.codegen(["p"], e.name), a = 0; a < e.fieldsArray.length; ++a)(t = e._fieldsArray[a]).map ? i("this%s={}", m.safeProp(t.name)) : t.repeated && i("this%s=[]", m.safeProp(t.name));
			return i("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")
		}, a.fromJSON = function(e, t) {
			var i = new a(e, t.options);
			i.extensions = t.extensions, i.reserved = t.reserved;
			for (var n = Object.keys(t.fields), u = 0; u < n.length; ++u) i.add((void 0 !== t.fields[n[u]].keyType ? c.fromJSON : l.fromJSON)(n[u], t.fields[n[u]]));
			if (t.oneofs) for (n = Object.keys(t.oneofs), u = 0; u < n.length; ++u) i.add(o.fromJSON(n[u], t.oneofs[n[u]]));
			if (t.nested) for (n = Object.keys(t.nested), u = 0; u < n.length; ++u) {
				var f = t.nested[n[u]];
				i.add((void 0 !== f.id ? l.fromJSON : void 0 !== f.fields ? a.fromJSON : void 0 !== f.values ? r.fromJSON : void 0 !== f.methods ? d.fromJSON : s.fromJSON)(n[u], f))
			}
			return t.extensions && t.extensions.length && (i.extensions = t.extensions), t.reserved && t.reserved.length && (i.reserved = t.reserved), t.group && (i.group = !0), t.comment && (i.comment = t.comment), i
		}, a.prototype.toJSON = function(e) {
			var t = s.prototype.toJSON.call(this, e),
				i = !! e && Boolean(e.keepComments);
			return m.toObject(["options", t && t.options || void 0, "oneofs", s.arrayToJSON(this.oneofsArray, e), "fields", s.arrayToJSON(this.fieldsArray.filter(function(e) {
				return !e.declaringField
			}), e) || {}, "extensions", this.extensions && this.extensions.length ? this.extensions : void 0, "reserved", this.reserved && this.reserved.length ? this.reserved : void 0, "group", this.group || void 0, "nested", t && t.nested || void 0, "comment", i ? this.comment : void 0])
		}, a.prototype.resolveAll = function() {
			for (var e = this.fieldsArray, t = 0; t < e.length;) e[t++].resolve();
			var i = this.oneofsArray;
			for (t = 0; t < i.length;) i[t++].resolve();
			return s.prototype.resolveAll.call(this)
		}, a.prototype.get = function(e) {
			return this.fields[e] || this.oneofs && this.oneofs[e] || this.nested && this.nested[e] || null
		}, a.prototype.add = function(e) {
			if (this.get(e.name)) throw Error("duplicate name '" + e.name + "' in " + this);
			if (e instanceof l && void 0 === e.extend) {
				if (this._fieldsById ? this._fieldsById[e.id] : this.fieldsById[e.id]) throw Error("duplicate id " + e.id + " in " + this);
				if (this.isReservedId(e.id)) throw Error("id " + e.id + " is reserved in " + this);
				if (this.isReservedName(e.name)) throw Error("name '" + e.name + "' is reserved in " + this);
				return e.parent && e.parent.remove(e), (this.fields[e.name] = e).message = this, e.onAdd(this), n(this)
			}
			return e instanceof o ? (this.oneofs || (this.oneofs = {}), (this.oneofs[e.name] = e).onAdd(this), n(this)) : s.prototype.add.call(this, e)
		}, a.prototype.remove = function(e) {
			if (e instanceof l && void 0 === e.extend) {
				if (!this.fields || this.fields[e.name] !== e) throw Error(e + " is not a member of " + this);
				return delete this.fields[e.name], e.parent = null, e.onRemove(this), n(this)
			}
			if (e instanceof o) {
				if (!this.oneofs || this.oneofs[e.name] !== e) throw Error(e + " is not a member of " + this);
				return delete this.oneofs[e.name], e.parent = null, e.onRemove(this), n(this)
			}
			return s.prototype.remove.call(this, e)
		}, a.prototype.isReservedId = function(e) {
			return s.isReservedId(this.reserved, e)
		}, a.prototype.isReservedName = function(e) {
			return s.isReservedName(this.reserved, e)
		}, a.prototype.create = function(e) {
			return new this.ctor(e)
		}, a.prototype.setup = function() {
			for (var e = this.fullName, t = [], i = 0; i < this.fieldsArray.length; ++i) t.push(this._fieldsArray[i].resolve().resolvedType);
			this.encode = h(this)({
				Writer: p,
				types: t,
				util: m
			}), this.decode = g(this)({
				Reader: f,
				types: t,
				util: m
			}), this.verify = v(this)({
				types: t,
				util: m
			}), this.fromObject = y.fromObject(this)({
				types: t,
				util: m
			}), this.toObject = y.toObject(this)({
				types: t,
				util: m
			});
			var a = b[e];
			if (a) {
				var n = Object.create(this);
				n.fromObject = this.fromObject, this.fromObject = a.fromObject.bind(n), n.toObject = this.toObject, this.toObject = a.toObject.bind(n)
			}
			return this
		}, a.prototype.encode = function(e, t) {
			return this.setup().encode(e, t)
		}, a.prototype.encodeDelimited = function(e, t) {
			return this.encode(e, t && t.len ? t.fork() : t).ldelim()
		}, a.prototype.decode = function(e, t) {
			return this.setup().decode(e, t)
		}, a.prototype.decodeDelimited = function(e) {
			return e instanceof f || (e = f.create(e)), this.decode(e, e.uint32())
		}, a.prototype.verify = function(e) {
			return this.setup().verify(e)
		}, a.prototype.fromObject = function(e) {
			return this.setup().fromObject(e)
		}, a.prototype.toObject = function(e, t) {
			return this.setup().toObject(e, t)
		}, a.d = function(e) {
			return function(t) {
				m.decorateType(t, e)
			}
		}
	}, function(e, t, i) {
		"use strict";

		function a(e, t, i, a, s, o) {
			if (n.call(this, e, t, a, void 0, void 0, s, o), !r.isString(i)) throw TypeError("keyType must be a string");
			this.keyType = i, this.resolvedKeyType = null, this.map = !0
		}
		e.exports = a;
		var n = i(5);
		((a.prototype = Object.create(n.prototype)).constructor = a).className = "MapField";
		var s = i(7),
			r = i(0);
		a.fromJSON = function(e, t) {
			return new a(e, t.id, t.keyType, t.type, t.options, t.comment)
		}, a.prototype.toJSON = function(e) {
			var t = !! e && Boolean(e.keepComments);
			return r.toObject(["keyType", this.keyType, "type", this.type, "id", this.id, "extend", this.extend, "options", this.options, "comment", t ? this.comment : void 0])
		}, a.prototype.resolve = function() {
			if (this.resolved) return this;
			if (void 0 === s.mapKey[this.keyType]) throw Error("invalid key type: " + this.keyType);
			return n.prototype.resolve.call(this)
		}, a.d = function(e, t, i) {
			return "function" == typeof i ? i = r.decorateType(i).name : i && "object" == typeof i && (i = r.decorateEnum(i).name), function(n, s) {
				r.decorateType(n.constructor).add(new a(s, e, t, i))
			}
		}
	}, function(e, t, i) {
		"use strict";

		function a(e, t) {
			s.call(this, e, t), this.methods = {}, this._methodsArray = null
		}
		function n(e) {
			return e._methodsArray = null, e
		}
		e.exports = a;
		var s = i(6);
		((a.prototype = Object.create(s.prototype)).constructor = a).className = "Service";
		var r = i(22),
			o = i(0),
			l = i(16);
		a.fromJSON = function(e, t) {
			var i = new a(e, t.options);
			if (t.methods) for (var n = Object.keys(t.methods), s = 0; s < n.length; ++s) i.add(r.fromJSON(n[s], t.methods[n[s]]));
			return t.nested && i.addJSON(t.nested), i.comment = t.comment, i
		}, a.prototype.toJSON = function(e) {
			var t = s.prototype.toJSON.call(this, e),
				i = !! e && Boolean(e.keepComments);
			return o.toObject(["options", t && t.options || void 0, "methods", s.arrayToJSON(this.methodsArray, e) || {}, "nested", t && t.nested || void 0, "comment", i ? this.comment : void 0])
		}, Object.defineProperty(a.prototype, "methodsArray", {
			get: function() {
				return this._methodsArray || (this._methodsArray = o.toArray(this.methods))
			}
		}), a.prototype.get = function(e) {
			return this.methods[e] || s.prototype.get.call(this, e)
		}, a.prototype.resolveAll = function() {
			for (var e = this.methodsArray, t = 0; t < e.length; ++t) e[t].resolve();
			return s.prototype.resolve.call(this)
		}, a.prototype.add = function(e) {
			if (this.get(e.name)) throw Error("duplicate name '" + e.name + "' in " + this);
			return e instanceof r ? n((this.methods[e.name] = e).parent = this) : s.prototype.add.call(this, e)
		}, a.prototype.remove = function(e) {
			if (e instanceof r) {
				if (this.methods[e.name] !== e) throw Error(e + " is not a member of " + this);
				return delete this.methods[e.name], e.parent = null, n(this)
			}
			return s.prototype.remove.call(this, e)
		}, a.prototype.create = function(e, t, i) {
			for (var a, n = new l.Service(e, t, i), s = 0; s < this.methodsArray.length; ++s) {
				var r = o.lcFirst((a = this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g, "");
				n[r] = o.codegen(["r", "c"], o.isReserved(r) ? r + "_" : r)("return this.rpcCall(m,q,s,r,c)")({
					m: a,
					q: a.resolvedRequestType.ctor,
					s: a.resolvedResponseType.ctor
				})
			}
			return n
		}
	}, function(e, t, i) {
		"use strict";

		function a(e, t, i, a, r, o, l, c) {
			if (s.isObject(r) ? (l = r, r = o = void 0) : s.isObject(o) && (l = o, o = void 0), void 0 !== t && !s.isString(t)) throw TypeError("type must be a string");
			if (!s.isString(i)) throw TypeError("requestType must be a string");
			if (!s.isString(a)) throw TypeError("responseType must be a string");
			n.call(this, e, l), this.type = t || "rpc", this.requestType = i, this.requestStream = !! r || void 0, this.responseType = a, this.responseStream = !! o || void 0, this.resolvedRequestType = null, this.resolvedResponseType = null, this.comment = c
		}
		e.exports = a;
		var n = i(4);
		((a.prototype = Object.create(n.prototype)).constructor = a).className = "Method";
		var s = i(0);
		a.fromJSON = function(e, t) {
			return new a(e, t.type, t.requestType, t.responseType, t.requestStream, t.responseStream, t.options, t.comment)
		}, a.prototype.toJSON = function(e) {
			var t = !! e && Boolean(e.keepComments);
			return s.toObject(["type", "rpc" !== this.type && this.type || void 0, "requestType", this.requestType, "requestStream", this.requestStream, "responseType", this.responseType, "responseStream", this.responseStream, "options", this.options, "comment", t ? this.comment : void 0])
		}, a.prototype.resolve = function() {
			return this.resolved ? this : (this.resolvedRequestType = this.parent.lookupType(this.requestType), this.resolvedResponseType = this.parent.lookupType(this.responseType), n.prototype.resolve.call(this))
		}
	}, function(e, t, i) {
		"use strict";
		e.exports = function(e) {
			var t = s.codegen(["r", "l"], e.name + "$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor" + (e.fieldsArray.filter(function(e) {
				return e.map
			}).length ? ",k" : ""))("while(r.pos<c){")("var t=r.uint32()");
			e.group && t("if((t&7)===4)")("break"), t("switch(t>>>3){");
			for (var i = 0; i < e.fieldsArray.length; ++i) {
				var r = e._fieldsArray[i].resolve(),
					o = r.resolvedType instanceof a ? "int32" : r.type,
					l = "m" + s.safeProp(r.name);
				t("case %i:", r.id), r.map ? (t("r.skip().pos++")("if(%s===util.emptyObject)", l)("%s={}", l)("k=r.%s()", r.keyType)("r.pos++"), void 0 !== n["long"][r.keyType] ? void 0 === n.basic[o] ? t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())', l, i) : t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()', l, o) : void 0 === n.basic[o] ? t("%s[k]=types[%i].decode(r,r.uint32())", l, i) : t("%s[k]=r.%s()", l, o)) : r.repeated ? (t("if(!(%s&&%s.length))", l, l)("%s=[]", l), void 0 !== n.packed[o] && t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())", l, o)("}else"), void 0 === n.basic[o] ? t(r.resolvedType.group ? "%s.push(types[%i].decode(r))" : "%s.push(types[%i].decode(r,r.uint32()))", l, i) : t("%s.push(r.%s())", l, o)) : void 0 === n.basic[o] ? t(r.resolvedType.group ? "%s=types[%i].decode(r)" : "%s=types[%i].decode(r,r.uint32())", l, i) : t("%s=r.%s()", l, o), t("break")
			}
			for (t("default:")("r.skipType(t&7)")("break")("}")("}"), i = 0; i < e._fieldsArray.length; ++i) {
				var c = e._fieldsArray[i];
				c.required && t("if(!m.hasOwnProperty(%j))", c.name)("throw util.ProtocolError(%j,{instance:m})", "missing required '" + c.name + "'")
			}
			return t("return m")
		};
		var a = i(1),
			n = i(7),
			s = i(0)
	}, function(e, t, i) {
		"use strict";

		function a(e, t) {
			return e.name + ": " + t + (e.repeated && "array" !== t ? "[]" : e.map && "object" !== t ? "{k:" + e.keyType + "}" : "") + " expected"
		}
		function n(e, t, i, n) {
			if (t.resolvedType) if (t.resolvedType instanceof r) {
				e("switch(%s){", n)("default:")("return%j", a(t, "enum value"));
				for (var s = Object.keys(t.resolvedType.values), o = 0; o < s.length; ++o) e("case %i:", t.resolvedType.values[s[o]]);
				e("break")("}")
			} else e("{")("var e=types[%i].verify(%s);", i, n)("if(e)")("return%j+e", t.name + ".")("}");
			else switch (t.type) {
			case "int32":
			case "uint32":
			case "sint32":
			case "fixed32":
			case "sfixed32":
				e("if(!util.isInteger(%s))", n)("return%j", a(t, "integer"));
				break;
			case "int64":
			case "uint64":
			case "sint64":
			case "fixed64":
			case "sfixed64":
				e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))", n, n, n, n)("return%j", a(t, "integer|Long"));
				break;
			case "float":
			case "double":
				e('if(typeof %s!=="number")', n)("return%j", a(t, "number"));
				break;
			case "bool":
				e('if(typeof %s!=="boolean")', n)("return%j", a(t, "boolean"));
				break;
			case "string":
				e("if(!util.isString(%s))", n)("return%j", a(t, "string"));
				break;
			case "bytes":
				e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))', n, n, n)("return%j", a(t, "buffer"))
			}
			return e
		}
		function s(e, t, i) {
			switch (t.keyType) {
			case "int32":
			case "uint32":
			case "sint32":
			case "fixed32":
			case "sfixed32":
				e("if(!util.key32Re.test(%s))", i)("return%j", a(t, "integer key"));
				break;
			case "int64":
			case "uint64":
			case "sint64":
			case "fixed64":
			case "sfixed64":
				e("if(!util.key64Re.test(%s))", i)("return%j", a(t, "integer|Long key"));
				break;
			case "bool":
				e("if(!util.key2Re.test(%s))", i)("return%j", a(t, "boolean key"))
			}
			return e
		}
		e.exports = function(e) {
			var t = o.codegen(["m"], e.name + "$verify")('if(typeof m!=="object"||m===null)')("return%j", "object expected"),
				i = e.oneofsArray,
				r = {};
			i.length && t("var p={}");
			for (var l = 0; l < e.fieldsArray.length; ++l) {
				var c = e._fieldsArray[l].resolve(),
					d = "m" + o.safeProp(c.name);
				if (c.optional && t("if(%s!=null&&m.hasOwnProperty(%j)){", d, c.name), c.map) t("if(!util.isObject(%s))", d)("return%j", a(c, "object"))("var k=Object.keys(%s)", d)("for(var i=0;i<k.length;++i){"), s(t, c, "k[i]"), n(t, c, l, d + "[k[i]]")("}");
				else if (c.repeated) t("if(!Array.isArray(%s))", d)("return%j", a(c, "array"))("for(var i=0;i<%s.length;++i){", d), n(t, c, l, d + "[i]")("}");
				else {
					if (c.partOf) {
						var u = o.safeProp(c.partOf.name);
						1 === r[c.partOf.name] && t("if(p%s===1)", u)("return%j", c.partOf.name + ": multiple values"), r[c.partOf.name] = 1, t("p%s=1", u)
					}
					n(t, c, l, d)
				}
				c.optional && t("}")
			}
			return t("return null")
		};
		var r = i(1),
			o = i(0)
	}, function(e, t, i) {
		"use strict";

		function a(e, t, i, a) {
			if (t.resolvedType) if (t.resolvedType instanceof r) {
				e("switch(d%s){", a);
				for (var n = t.resolvedType.values, s = Object.keys(n), o = 0; o < s.length; ++o) t.repeated && n[s[o]] === t.typeDefault && e("default:"), e("case%j:", s[o])("case %i:", n[s[o]])("m%s=%j", a, n[s[o]])("break");
				e("}")
			} else e('if(typeof d%s!=="object")', a)("throw TypeError(%j)", t.fullName + ": object expected")("m%s=types[%i].fromObject(d%s)", a, i, a);
			else {
				var l = !1;
				switch (t.type) {
				case "double":
				case "float":
					e("m%s=Number(d%s)", a, a);
					break;
				case "uint32":
				case "fixed32":
					e("m%s=d%s>>>0", a, a);
					break;
				case "int32":
				case "sint32":
				case "sfixed32":
					e("m%s=d%s|0", a, a);
					break;
				case "uint64":
					l = !0;
				case "int64":
				case "sint64":
				case "fixed64":
				case "sfixed64":
					e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j", a, a, l)('else if(typeof d%s==="string")', a)("m%s=parseInt(d%s,10)", a, a)('else if(typeof d%s==="number")', a)("m%s=d%s", a, a)('else if(typeof d%s==="object")', a)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)", a, a, a, l ? "true" : "");
					break;
				case "bytes":
					e('if(typeof d%s==="string")', a)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)", a, a, a)("else if(d%s.length)", a)("m%s=d%s", a, a);
					break;
				case "string":
					e("m%s=String(d%s)", a, a);
					break;
				case "bool":
					e("m%s=Boolean(d%s)", a, a)
				}
			}
			return e
		}
		function n(e, t, i, a) {
			if (t.resolvedType) t.resolvedType instanceof r ? e("d%s=o.enums===String?types[%i].values[m%s]:m%s", a, i, a, a) : e("d%s=types[%i].toObject(m%s,o)", a, i, a);
			else {
				var n = !1;
				switch (t.type) {
				case "double":
				case "float":
					e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s", a, a, a, a);
					break;
				case "uint64":
					n = !0;
				case "int64":
				case "sint64":
				case "fixed64":
				case "sfixed64":
					e('if(typeof m%s==="number")', a)("d%s=o.longs===String?String(m%s):m%s", a, a, a)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s", a, a, a, a, n ? "true" : "", a);
					break;
				case "bytes":
					e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s", a, a, a, a, a);
					break;
				default:
					e("d%s=m%s", a, a)
				}
			}
			return e
		}
		var s = t,
			r = i(1),
			o = i(0);
		s.fromObject = function(e) {
			var t = e.fieldsArray,
				i = o.codegen(["d"], e.name + "$fromObject")("if(d instanceof this.ctor)")("return d");
			if (!t.length) return i("return new this.ctor");
			i("var m=new this.ctor");
			for (var n = 0; n < t.length; ++n) {
				var s = t[n].resolve(),
					l = o.safeProp(s.name);
				s.map ? (i("if(d%s){", l)('if(typeof d%s!=="object")', l)("throw TypeError(%j)", s.fullName + ": object expected")("m%s={}", l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){", l), a(i, s, n, l + "[ks[i]]")("}")("}")) : s.repeated ? (i("if(d%s){", l)("if(!Array.isArray(d%s))", l)("throw TypeError(%j)", s.fullName + ": array expected")("m%s=[]", l)("for(var i=0;i<d%s.length;++i){", l), a(i, s, n, l + "[i]")("}")("}")) : (s.resolvedType instanceof r || i("if(d%s!=null){", l), a(i, s, n, l), s.resolvedType instanceof r || i("}"))
			}
			return i("return m")
		}, s.toObject = function(e) {
			var t = e.fieldsArray.slice().sort(o.compareFieldsById);
			if (!t.length) return o.codegen()("return {}");
			for (var i = o.codegen(["m", "o"], e.name + "$toObject")("if(!o)")("o={}")("var d={}"), a = [], s = [], l = [], c = 0; c < t.length; ++c) t[c].partOf || (t[c].resolve().repeated ? a : t[c].map ? s : l).push(t[c]);
			if (a.length) {
				for (i("if(o.arrays||o.defaults){"), c = 0; c < a.length; ++c) i("d%s=[]", o.safeProp(a[c].name));
				i("}")
			}
			if (s.length) {
				for (i("if(o.objects||o.defaults){"), c = 0; c < s.length; ++c) i("d%s={}", o.safeProp(s[c].name));
				i("}")
			}
			if (l.length) {
				for (i("if(o.defaults){"), c = 0; c < l.length; ++c) {
					var d = l[c],
						u = o.safeProp(d.name);
					d.resolvedType instanceof r ? i("d%s=o.enums===String?%j:%j", u, d.resolvedType.valuesById[d.typeDefault], d.typeDefault) : d["long"] ? i("if(util.Long){")("var n=new util.Long(%i,%i,%j)", d.typeDefault.low, d.typeDefault.high, d.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n", u)("}else")("d%s=o.longs===String?%j:%i", u, d.typeDefault.toString(), d.typeDefault.toNumber()) : d.bytes ? i("d%s=o.bytes===String?%j:%s", u, String.fromCharCode.apply(String, d.typeDefault), "[" + Array.prototype.slice.call(d.typeDefault).join(",") + "]") : i("d%s=%j", u, d.typeDefault)
				}
				i("}")
			}
			var f = !1;
			for (c = 0; c < t.length; ++c) {
				d = t[c];
				var p = e._fieldsArray.indexOf(d);
				u = o.safeProp(d.name), d.map ? (f || (f = !0, i("var ks2")), i("if(m%s&&(ks2=Object.keys(m%s)).length){", u, u)("d%s={}", u)("for(var j=0;j<ks2.length;++j){"), n(i, d, p, u + "[ks2[j]]")("}")) : d.repeated ? (i("if(m%s&&m%s.length){", u, u)("d%s=[]", u)("for(var j=0;j<m%s.length;++j){", u), n(i, d, p, u + "[j]")("}")) : (i("if(m%s!=null&&m.hasOwnProperty(%j)){", u, d.name), n(i, d, p, u), d.partOf && i("if(o.oneofs)")("d%s=%j", o.safeProp(d.partOf.name), d.name)), i("}")
			}
			return i("return d")
		}
	}, function(e, t, i) {
		"use strict";
		var a = t,
			n = i(11);
		a[".google.protobuf.Any"] = {
			fromObject: function(e) {
				if (e && e["@type"]) {
					var t = this.lookup(e["@type"]);
					if (t) {
						var i = "." === e["@type"].charAt(0) ? e["@type"].substr(1) : e["@type"];
						return this.create({
							type_url: "/" + i,
							value: t.encode(t.fromObject(e)).finish()
						})
					}
				}
				return this.fromObject(e)
			},
			toObject: function(e, t) {
				if (t && t.json && e.type_url && e.value) {
					var i = e.type_url.substring(e.type_url.lastIndexOf("/") + 1),
						a = this.lookup(i);
					a && (e = a.decode(e.value))
				}
				if (!(e instanceof this.ctor) && e instanceof n) {
					var s = e.$type.toObject(e, t);
					return s["@type"] = e.$type.fullName, s
				}
				return this.toObject(e, t)
			}
		}
	}, function(e, t, i) {
		"use strict";

		function a(e) {
			r.call(this, "", e), this.deferred = [], this.files = []
		}
		function n() {}
		function s(e, t) {
			var i = t.parent.lookup(t.extend);
			if (i) {
				var a = new d(t.fullName, t.id, t.type, t.rule, void 0, t.options);
				return (a.declaringField = t).extensionField = a, i.add(a), !0
			}
			return !1
		}
		e.exports = a;
		var r = i(6);
		((a.prototype = Object.create(r.prototype)).constructor = a).className = "Root";
		var o, l, c, d = i(5),
			u = i(1),
			f = i(10),
			p = i(0);
		a.fromJSON = function(e, t) {
			return t || (t = new a), e.options && t.setOptions(e.options), t.addJSON(e.nested)
		}, a.prototype.resolvePath = p.path.resolve, a.prototype.load = function h(e, t, i) {
			function a(e, t) {
				if (i) {
					var a = i;
					if (i = null, d) throw e;
					a(e, t)
				}
			}
			function s(e, i) {
				try {
					if (p.isString(i) && "{" === i.charAt(0) && (i = JSON.parse(i)), p.isString(i)) {
						l.filename = e;
						var n, s = l(i, o, t),
							c = 0;
						if (s.imports) for (; c < s.imports.length; ++c)(n = o.resolvePath(e, s.imports[c])) && r(n);
						if (s.weakImports) for (c = 0; c < s.weakImports.length; ++c)(n = o.resolvePath(e, s.weakImports[c])) && r(n, !0)
					} else o.setOptions(i.options).addJSON(i.nested)
				} catch (e) {
					a(e)
				}
				d || u || a(null, o)
			}
			function r(e, t) {
				var n = e.lastIndexOf("google/protobuf/");
				if (n > -1) {
					var r = e.substring(n);
					r in c && (e = r)
				}
				if (!(-1 < o.files.indexOf(e))) if (o.files.push(e), e in c) d ? s(e, c[e]) : (++u, setTimeout(function() {
					--u, s(e, c[e])
				}));
				else if (d) {
					var l;
					try {
						l = p.fs.readFileSync(e).toString("utf8")
					} catch (n) {
						return void(t || a(n))
					}
					s(e, l)
				} else++u, p.fetch(e, function(n, r) {
					--u, i && (n ? t ? u || a(null, o) : a(n) : s(e, r))
				})
			}
			"function" == typeof t && (i = t, t = void 0);
			var o = this;
			if (!i) return p.asPromise(h, o, e, t);
			var d = i === n,
				u = 0;
			p.isString(e) && (e = [e]);
			for (var f, m = 0; m < e.length; ++m)(f = o.resolvePath("", e[m])) && r(f);
			return d ? o : void(u || a(null, o))
		}, a.prototype.loadSync = function(e, t) {
			if (!p.isNode) throw Error("not supported");
			return this.load(e, t, n)
		}, a.prototype.resolveAll = function() {
			if (this.deferred.length) throw Error("unresolvable extensions: " + this.deferred.map(function(e) {
				return "'extend " + e.extend + "' in " + e.parent.fullName
			}).join(", "));
			return r.prototype.resolveAll.call(this)
		};
		var m = /^[A-Z]/;
		a.prototype._handleAdd = function(e) {
			if (e instanceof d) void 0 === e.extend || e.extensionField || s(0, e) || this.deferred.push(e);
			else if (e instanceof u) m.test(e.name) && (e.parent[e.name] = e.values);
			else if (!(e instanceof f)) {
				if (e instanceof o) for (var t = 0; t < this.deferred.length;) s(0, this.deferred[t]) ? this.deferred.splice(t, 1) : ++t;
				for (var i = 0; i < e.nestedArray.length; ++i) this._handleAdd(e._nestedArray[i]);
				m.test(e.name) && (e.parent[e.name] = e)
			}
		}, a.prototype._handleRemove = function(e) {
			if (e instanceof d) {
				if (void 0 !== e.extend) if (e.extensionField) e.extensionField.parent.remove(e.extensionField), e.extensionField = null;
				else {
					var t = this.deferred.indexOf(e);
					t > -1 && this.deferred.splice(t, 1)
				}
			} else if (e instanceof u) m.test(e.name) && delete e.parent[e.name];
			else if (e instanceof r) {
				for (var i = 0; i < e.nestedArray.length; ++i) this._handleRemove(e._nestedArray[i]);
				m.test(e.name) && delete e.parent[e.name]
			}
		}, a._configure = function(e, t, i) {
			o = e, l = t, c = i
		}
	}, function(e, t, i) {
		"use strict";
		Object.defineProperty(t, "__esModule", {
			value: !0
		});
		var a = function() {
				function e(e, t) {
					for (var i = 0; i < t.length; i++) {
						var a = t[i];
						a.enumerable = a.enumerable || !1, a.configurable = !0, "value" in a && (a.writable = !0), Object.defineProperty(e, a.key, a)
					}
				}
				return function(t, i, a) {
					return i && e(t.prototype, i), a && e(t, a), t
				}
			}(),
			n = i(29),
			s = i(52),
			r = function() {
				function e() {
					!
					function(e, t) {
						if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
					}(this, e), this.SVGAMap = []
				}
				return a(e, [{
					key: "initDom",
					value: function(e) {
						this.dom = e
					}
				}, {
					key: "addSVGA",
					value: function(e, t, i, a) {
						this.url = e, this.type = t, this.finished = i, this.initok = a, this.loadjszip, this.init()
					}
				}, {
					key: "init",
					value: function() {
						var e = this;
						this.loadjszip = !0, this.player || (this.player = new s.Player(this.dom)), this.parser || (this.parser = new n.Parser(this.dom));
						var t = void 0;
						this.SVGAMap.map(function(i, a) {
							if (i && i.key === e.url) try {
								return e.player.setVideoItem(i.videoItem), e.player.startAnimation(), e.initok(), void(t = i.videoItem)
							} catch (i) {
								e.failure()
							}
						}), t || this.parser.load(this.url, function(t) {
							try {
								1 == e.type && e.player.onFinished(e.finished), e.SVGAMap.push({
									key: e.url,
									videoItem: t
								}), e.player.setVideoItem(t), e.player.startAnimation(), e.initok()
							} catch (t) {
								e.failure()
							}
						}, function() {
							e.failure()
						})
					}
				}, {
					key: "failure",
					value: function() {
						this.finished({
							msg: "err"
						})
					}
				}, {
					key: "disposeSvga",
					value: function() {
						this.player && (this.player.stopAnimation(), this.player.clearDynamicObjects())
					}
				}]), e
			}();
		t["default"] = r
	}, function(e, t, i) {
		"use strict";
		Object.defineProperty(t, "__esModule", {
			value: !0
		}), t.Parser = void 0;
		var a, n = function() {
				function e(e, t) {
					for (var i = 0; i < t.length; i++) {
						var a = t[i];
						a.enumerable = a.enumerable || !1, a.configurable = !0, "value" in a && (a.writable = !0), Object.defineProperty(e, a.key, a)
					}
				}
				return function(t, i, a) {
					return i && e(t.prototype, i), a && e(t, a), t
				}
			}(),
			s = i(30),
			r = i(50),
			o = i(51),
			l = (a = o) && a.__esModule ? a : {
				"default": a
			};
		t.Parser = function() {
			function e() {
				!
				function(e, t) {
					if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
				}(this, e)
			}
			return n(e, [{
				key: "load",
				value: function(e, t, i) {
					this.successHandle = t, this.laodSVGA(e, i)
				}
			}, {
				key: "laodSVGA",
				value: function(e, t) {
					var i = this;
					(0, r.loadAssets)(e, function(e) {
						i.getDataShowSvg(e, t)
					}, t)
				}
			}, {
				key: "getDataShowSvg",
				value: function(e, t) {
					var i = this;
					try {
						JSZip.loadAsync(e).then(function(e) {
							(0, l["default"])(e, function(e) {
								var t = e.movie;
								t.version = e.ver;
								var a = e.images,
									n = new s.VideoEntity(t, a);
								i.successHandle(n)
							})
						})
					} catch (e) {
						t()
					}
				}
			}]), e
		}()
	}, function(e, t, i) {
		"use strict";
		Object.defineProperty(t, "__esModule", {
			value: !0
		}), t.VideoEntity = void 0;
		var a = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ?
		function(e) {
			return typeof e
		} : function(e) {
			return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
		}, n = function() {
			function e(e, t) {
				for (var i = 0; i < t.length; i++) {
					var a = t[i];
					a.enumerable = a.enumerable || !1, a.configurable = !0, "value" in a && (a.writable = !0), Object.defineProperty(e, a.key, a)
				}
			}
			return function(t, i, a) {
				return i && e(t.prototype, i), a && e(t, a), t
			}
		}(), s = i(31), r = i(13).ProtoMovieEntity;
		t.VideoEntity = function() {
			function e(t, i) {
				!
				function(e, t) {
					if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
				}(this, e), this.version = "", this.videoSize = {
					width: 0,
					height: 0
				}, this.FPS = 20, this.frames = 0, this.images = {}, this.sprites = [], "object" === (void 0 === t ? "undefined" : a(t)) && t.$type == r ? ("object" === a(t.params) && (this.version = t.ver, this.videoSize.width = t.params.viewBoxWidth || 0, this.videoSize.height = t.params.viewBoxHeight || 0, this.FPS = t.params.fps || 20, this.frames = t.params.frames || 0), this.resetSprites(t)) : t && (t.movie && (t.movie.viewBox && (this.videoSize.width = parseFloat(t.movie.viewBox.width) || 0, this.videoSize.height = parseFloat(t.movie.viewBox.height) || 0), this.version = t.ver, this.FPS = parseInt(t.movie.fps) || 20, this.frames = parseInt(t.movie.frames) || 0), this.resetSprites(t)), i && (this.images = i)
			}
			return n(e, [{
				key: "resetSprites",
				value: function(e) {
					e.sprites instanceof Array && (this.sprites = e.sprites.map(function(e) {
						return new s.SpriteEntity(e)
					}))
				}
			}]), e
		}()
	}, function(e, t, i) {
		"use strict";
		Object.defineProperty(t, "__esModule", {
			value: !0
		}), t.SpriteEntity = void 0;
		var a = i(32);
		i(3), i(33), i(12), t.SpriteEntity = function n(e) {
			!
			function(e, t) {
				if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
			}(this, n), this.imageKey = null, this.frames = [], this.imageKey = e.imageKey, e.frames && (this.frames = e.frames.map(function(e) {
				return new a.FrameEntity(e)
			}))
		}
	}, function(e, t, i) {
		"use strict";
		Object.defineProperty(t, "__esModule", {
			value: !0
		}), t.FrameEntity = void 0;
		var a = i(3);
		t.FrameEntity = function n(e) {
			!
			function(e, t) {
				if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
			}(this, n), this.alpha = 0, this.transform = {
				a: 1,
				b: 0,
				c: 0,
				d: 1,
				tx: 0,
				ty: 0
			}, this.layout = {
				x: 0,
				y: 0,
				width: 0,
				height: 0
			}, this.nx = 0, this.ny = 0, this.maskPath = null, this.shapes = [], this.alpha = parseFloat(e.alpha) || 0, e.layout && (this.layout.x = parseFloat(e.layout.x) || 0, this.layout.y = parseFloat(e.layout.y) || 0, this.layout.width = parseFloat(e.layout.width) || 0, this.layout.height = parseFloat(e.layout.height) || 0), e.transform && (this.transform.a = parseFloat(e.transform.a) || 1, this.transform.b = parseFloat(e.transform.b) || 0, this.transform.c = parseFloat(e.transform.c) || 0, this.transform.d = parseFloat(e.transform.d) || 1, this.transform.tx = parseFloat(e.transform.tx) || 0, this.transform.ty = parseFloat(e.transform.ty) || 0), e.clipPath && 0 < e.clipPath.length && (this.maskPath = new a.BezierPath(e.clipPath, void 0, {
				fill: "#000000"
			})), e.shapes && (e.shapes instanceof Array && e.shapes.forEach(function(e) {
				switch (e.pathArgs = e.args, e.type) {
				case 0:
					e.type = "shape", e.pathArgs = e.shape;
					break;
				case 1:
					e.type = "rect", e.pathArgs = e.rect;
					break;
				case 2:
					e.type = "ellipse", e.pathArgs = e.ellipse;
					break;
				case 3:
					e.type = "keep"
				}
				if (e.styles) {
					e.styles.fill && ("number" == typeof e.styles.fill.r && (e.styles.fill[0] = e.styles.fill.r), "number" == typeof e.styles.fill.g && (e.styles.fill[1] = e.styles.fill.g), "number" == typeof e.styles.fill.b && (e.styles.fill[2] = e.styles.fill.b), "number" == typeof e.styles.fill.a && (e.styles.fill[3] = e.styles.fill.a)), e.styles.stroke && ("number" == typeof e.styles.stroke.r && (e.styles.stroke[0] = e.styles.stroke.r), "number" == typeof e.styles.stroke.g && (e.styles.stroke[1] = e.styles.stroke.g), "number" == typeof e.styles.stroke.b && (e.styles.stroke[2] = e.styles.stroke.b), "number" == typeof e.styles.stroke.a && (e.styles.stroke[3] = e.styles.stroke.a));
					var t = e.styles.lineDash || [];
					switch (0 < e.styles.lineDashI && t.push(e.styles.lineDashI), 0 < e.styles.lineDashII && (t.length < 1 && t.push(0), t.push(e.styles.lineDashII), t.push(0)), 0 < e.styles.lineDashIII && (t.length < 2 && (t.push(0), t.push(0)), t[2] = e.styles.lineDashIII), e.styles.lineDash = t, e.styles.lineJoin) {
					case 0:
						e.styles.lineJoin = "miter";
						break;
					case 1:
						e.styles.lineJoin = "round";
						break;
					case 2:
						e.styles.lineJoin = "bevel"
					}
					switch (e.styles.lineCap) {
					case 0:
						e.styles.lineCap = "butt";
						break;
					case 1:
						e.styles.lineCap = "round";
						break;
					case 2:
						e.styles.lineCap = "square"
					}
				}
			}), e.shapes[0] && "keep" === e.shapes[0].type ? this.shapes = n.lastShapes : (this.shapes = e.shapes, n.lastShapes = e.shapes));
			var t = this.transform.a * this.layout.x + this.transform.c * this.layout.y + this.transform.tx,
				i = this.transform.a * (this.layout.x + this.layout.width) + this.transform.c * this.layout.y + this.transform.tx,
				s = this.transform.a * this.layout.x + this.transform.c * (this.layout.y + this.layout.height) + this.transform.tx,
				r = this.transform.a * (this.layout.x + this.layout.width) + this.transform.c * (this.layout.y + this.layout.height) + this.transform.tx,
				o = this.transform.b * this.layout.x + this.transform.d * this.layout.y + this.transform.ty,
				l = this.transform.b * (this.layout.x + this.layout.width) + this.transform.d * this.layout.y + this.transform.ty,
				c = this.transform.b * this.layout.x + this.transform.d * (this.layout.y + this.layout.height) + this.transform.ty,
				d = this.transform.b * (this.layout.x + this.layout.width) + this.transform.d * (this.layout.y + this.layout.height) + this.transform.ty;
			this.nx = Math.min(Math.min(s, r), Math.min(t, i)), this.ny = Math.min(Math.min(c, d), Math.min(o, l))
		}
	}, function(e, t, i) {
		"use strict";
		Object.defineProperty(t, "__esModule", {
			value: !0
		}), t.RectPath = void 0;
		var a = i(3);
		t.RectPath = function(e) {
			function t(e, i, a, n, s, r, o) {
				!
				function(e, t) {
					if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
				}(this, t);
				var l = function(e, t) {
						if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
						return !t || "object" != typeof t && "function" != typeof t ? e : t
					}(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
				return l._x = e, l._y = i, l._width = a, l._height = n, l._cornerRadius = s, l._transform = r, l._styles = o, l
			}
			return function(e, t) {
				if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
				e.prototype = Object.create(t && t.prototype, {
					constructor: {
						value: e,
						enumerable: !1,
						writable: !0,
						configurable: !0
					}
				}), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
			}(t, a.BezierPath), t
		}()
	}, function(e, t, i) {
		"use strict";
		e.exports = i(35)
	}, function(e, t, i) {
		"use strict";
		var a = e.exports = i(36);
		a.build = "light", a.load = function(e, t, i) {
			return "function" == typeof t ? (i = t, t = new a.Root) : t || (t = new a.Root), t.load(e, i)
		}, a.loadSync = function(e, t) {
			return t || (t = new a.Root), t.loadSync(e)
		}, a.encoder = i(18), a.decoder = i(23), a.verifier = i(24), a.converter = i(25), a.ReflectionObject = i(4), a.Namespace = i(6), a.Root = i(27), a.Enum = i(1), a.Type = i(19), a.Field = i(5), a.OneOf = i(10), a.MapField = i(20), a.Service = i(21), a.Method = i(22), a.Message = i(11), a.wrappers = i(26), a.types = i(7), a.util = i(0), a.ReflectionObject._configure(a.Root), a.Namespace._configure(a.Type, a.Service), a.Root._configure(a.Type), a.Field._configure(a.Type)
	}, function(e, t, i) {
		"use strict";

		function a() {
			n.Reader._configure(n.BufferReader), n.util._configure()
		}
		var n = t;
		n.build = "minimal", n.Writer = i(8), n.BufferWriter = i(44), n.Reader = i(9), n.BufferReader = i(45), n.util = i(2), n.rpc = i(16), n.roots = i(17), n.configure = a, n.Writer._configure(n.BufferWriter), a()
	}, function(q2, r2) {
		var s2;
		s2 = function() {
			return this
		}();
		try {
			s2 = s2 || Function("return this")() || eval("this")
		} catch (e) {
			"object" == typeof window && (s2 = window)
		}
		q2.exports = s2
	}, function(e, t, i) {
		"use strict";
		var a = t;
		a.length = function(e) {
			var t = e.length;
			if (!t) return 0;
			for (var i = 0; 1 < --t % 4 && "=" === e.charAt(t);)++i;
			return Math.ceil(3 * e.length) / 4 - i
		};
		for (var n = new Array(64), s = new Array(123), r = 0; 64 > r;) s[n[r] = 26 > r ? r + 65 : 52 > r ? r + 71 : 62 > r ? r - 4 : r - 59 | 43] = r++;
		a.encode = function(e, t, i) {
			for (var a, s = null, r = [], o = 0, l = 0; i > t;) {
				var c = e[t++];
				switch (l) {
				case 0:
					r[o++] = n[c >> 2], a = (3 & c) << 4, l = 1;
					break;
				case 1:
					r[o++] = n[a | c >> 4], a = (15 & c) << 2, l = 2;
					break;
				case 2:
					r[o++] = n[a | c >> 6], r[o++] = n[63 & c], l = 0
				}
				o > 8191 && ((s || (s = [])).push(String.fromCharCode.apply(String, r)), o = 0)
			}
			return l && (r[o++] = n[a], r[o++] = 61, 1 === l && (r[o++] = 61)), s ? (o && s.push(String.fromCharCode.apply(String, r.slice(0, o))), s.join("")) : String.fromCharCode.apply(String, r.slice(0, o))
		};
		var o = "invalid encoding";
		a.decode = function(e, t, i) {
			for (var a, n = i, r = 0, l = 0; l < e.length;) {
				var c = e.charCodeAt(l++);
				if (61 === c && r > 1) break;
				if (void 0 === (c = s[c])) throw Error(o);
				switch (r) {
				case 0:
					a = c, r = 1;
					break;
				case 1:
					t[i++] = a << 2 | (48 & c) >> 4, a = c, r = 2;
					break;
				case 2:
					t[i++] = (15 & a) << 4 | (60 & c) >> 2, a = c, r = 3;
					break;
				case 3:
					t[i++] = (3 & a) << 6 | c, r = 0
				}
			}
			if (1 === r) throw Error(o);
			return i - n
		}, a.test = function(e) {
			return /^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(e)
		}
	}, function(e, t, i) {
		"use strict";

		function a() {
			this._listeners = {}
		}(e.exports = a).prototype.on = function(e, t, i) {
			return (this._listeners[e] || (this._listeners[e] = [])).push({
				fn: t,
				ctx: i || this
			}), this
		}, a.prototype.off = function(e, t) {
			if (void 0 === e) this._listeners = {};
			else if (void 0 === t) this._listeners[e] = [];
			else for (var i = this._listeners[e], a = 0; a < i.length;) i[a].fn === t ? i.splice(a, 1) : ++a;
			return this
		}, a.prototype.emit = function(e) {
			var t = this._listeners[e];
			if (t) {
				for (var i = [], a = 1; a < arguments.length;) i.push(arguments[a++]);
				for (a = 0; a < t.length;) t[a].fn.apply(t[a++].ctx, i)
			}
			return this
		}
	}, function(e, t, i) {
		"use strict";

		function a(e) {
			return "undefined" != typeof Float32Array ?
			function() {
				function t(e, t, i) {
					s[0] = e, t[i] = r[0], t[i + 1] = r[1], t[i + 2] = r[2], t[i + 3] = r[3]
				}
				function i(e, t, i) {
					s[0] = e, t[i] = r[3], t[i + 1] = r[2], t[i + 2] = r[1], t[i + 3] = r[0]
				}
				function a(e, t) {
					return r[0] = e[t], r[1] = e[t + 1], r[2] = e[t + 2], r[3] = e[t + 3], s[0]
				}
				function n(e, t) {
					return r[3] = e[t], r[2] = e[t + 1], r[1] = e[t + 2], r[0] = e[t + 3], s[0]
				}
				var s = new Float32Array([-0]),
					r = new Uint8Array(s.buffer),
					o = 128 === r[3];
				e.writeFloatLE = o ? t : i, e.writeFloatBE = o ? i : t, e.readFloatLE = o ? a : n, e.readFloatBE = o ? n : a
			}() : function() {
				function t(e, t, i, a) {
					var n = 0 > t ? 1 : 0;
					if (n && (t = -t), 0 === t) e(1 / t > 0 ? 0 : 2147483648, i, a);
					else if (isNaN(t)) e(2143289344, i, a);
					else if (t > 3.4028234663852886e38) e((n << 31 | 2139095040) >>> 0, i, a);
					else if (1.1754943508222875e-38 > t) e((n << 31 | Math.round(t / 1.401298464324817e-45)) >>> 0, i, a);
					else {
						var s = Math.floor(Math.log(t) / Math.LN2);
						e((n << 31 | s + 127 << 23 | 8388607 & Math.round(t * Math.pow(2, -s) * 8388608)) >>> 0, i, a)
					}
				}
				function i(e, t, i) {
					var a = e(t, i),
						n = 2 * (a >> 31) + 1,
						s = a >>> 23 & 255,
						r = 8388607 & a;
					return 255 === s ? r ? NaN : n * (1 / 0) : 0 === s ? 1.401298464324817e-45 * n * r : n * Math.pow(2, s - 150) * (r + 8388608)
				}
				e.writeFloatLE = t.bind(null, n), e.writeFloatBE = t.bind(null, s), e.readFloatLE = i.bind(null, r), e.readFloatBE = i.bind(null, o)
			}(), "undefined" != typeof Float64Array ?
			function() {
				function t(e, t, i) {
					s[0] = e, t[i] = r[0], t[i + 1] = r[1], t[i + 2] = r[2], t[i + 3] = r[3], t[i + 4] = r[4], t[i + 5] = r[5], t[i + 6] = r[6], t[i + 7] = r[7]
				}
				function i(e, t, i) {
					s[0] = e, t[i] = r[7], t[i + 1] = r[6], t[i + 2] = r[5], t[i + 3] = r[4], t[i + 4] = r[3], t[i + 5] = r[2], t[i + 6] = r[1], t[i + 7] = r[0]
				}
				function a(e, t) {
					return r[0] = e[t], r[1] = e[t + 1], r[2] = e[t + 2], r[3] = e[t + 3], r[4] = e[t + 4], r[5] = e[t + 5], r[6] = e[t + 6], r[7] = e[t + 7], s[0]
				}
				function n(e, t) {
					return r[7] = e[t], r[6] = e[t + 1], r[5] = e[t + 2], r[4] = e[t + 3], r[3] = e[t + 4], r[2] = e[t + 5], r[1] = e[t + 6], r[0] = e[t + 7], s[0]
				}
				var s = new Float64Array([-0]),
					r = new Uint8Array(s.buffer),
					o = 128 === r[7];
				e.writeDoubleLE = o ? t : i, e.writeDoubleBE = o ? i : t, e.readDoubleLE = o ? a : n, e.readDoubleBE = o ? n : a
			}() : function() {
				function t(e, t, i, a, n, s) {
					var r = 0 > a ? 1 : 0;
					if (r && (a = -a), 0 === a) e(0, n, s + t), e(1 / a > 0 ? 0 : 2147483648, n, s + i);
					else if (isNaN(a)) e(0, n, s + t), e(2146959360, n, s + i);
					else if (a > 1.7976931348623157e308) e(0, n, s + t), e((r << 31 | 2146435072) >>> 0, n, s + i);
					else {
						var o;
						if (2.2250738585072014e-308 > a) e((o = a / 5e-324) >>> 0, n, s + t), e((r << 31 | o / 4294967296) >>> 0, n, s + i);
						else {
							var l = Math.floor(Math.log(a) / Math.LN2);
							1024 === l && (l = 1023), e(4503599627370496 * (o = a * Math.pow(2, -l)) >>> 0, n, s + t), e((r << 31 | l + 1023 << 20 | 1048576 * o & 1048575) >>> 0, n, s + i)
						}
					}
				}
				function i(e, t, i, a, n) {
					var s = e(a, n + t),
						r = e(a, n + i),
						o = 2 * (r >> 31) + 1,
						l = r >>> 20 & 2047,
						c = 4294967296 * (1048575 & r) + s;
					return 2047 === l ? c ? NaN : o * (1 / 0) : 0 === l ? 5e-324 * o * c : o * Math.pow(2, l - 1075) * (c + 4503599627370496)
				}
				e.writeDoubleLE = t.bind(null, n, 0, 4), e.writeDoubleBE = t.bind(null, s, 4, 0), e.readDoubleLE = i.bind(null, r, 0, 4), e.readDoubleBE = i.bind(null, o, 4, 0)
			}(), e
		}
		function n(e, t, i) {
			t[i] = 255 & e, t[i + 1] = e >>> 8 & 255, t[i + 2] = e >>> 16 & 255, t[i + 3] = e >>> 24
		}
		function s(e, t, i) {
			t[i] = e >>> 24, t[i + 1] = e >>> 16 & 255, t[i + 2] = e >>> 8 & 255, t[i + 3] = 255 & e
		}
		function r(e, t) {
			return (e[t] | e[t + 1] << 8 | e[t + 2] << 16 | e[t + 3] << 24) >>> 0
		}
		function o(e, t) {
			return (e[t] << 24 | e[t + 1] << 16 | e[t + 2] << 8 | e[t + 3]) >>> 0
		}
		e.exports = a(a)
	}, function(e, t, i) {
		"use strict";
		var a = t;
		a.length = function(e) {
			for (var t = 0, i = 0, a = 0; a < e.length; ++a)(i = e.charCodeAt(a)) < 128 ? t += 1 : 2048 > i ? t += 2 : 55296 == (64512 & i) && 56320 == (64512 & e.charCodeAt(a + 1)) ? (++a, t += 4) : t += 3;
			return t
		}, a.read = function(e, t, i) {
			if (1 > i - t) return "";
			for (var a, n = null, s = [], r = 0; i > t;)(a = e[t++]) < 128 ? s[r++] = a : a > 191 && 224 > a ? s[r++] = (31 & a) << 6 | 63 & e[t++] : a > 239 && 365 > a ? (a = ((7 & a) << 18 | (63 & e[t++]) << 12 | (63 & e[t++]) << 6 | 63 & e[t++]) - 65536, s[r++] = 55296 + (a >> 10), s[r++] = 56320 + (1023 & a)) : s[r++] = (15 & a) << 12 | (63 & e[t++]) << 6 | 63 & e[t++], r > 8191 && ((n || (n = [])).push(String.fromCharCode.apply(String, s)), r = 0);
			return n ? (r && n.push(String.fromCharCode.apply(String, s.slice(0, r))), n.join("")) : String.fromCharCode.apply(String, s.slice(0, r))
		}, a.write = function(e, t, i) {
			for (var a, n, s = i, r = 0; r < e.length; ++r)(a = e.charCodeAt(r)) < 128 ? t[i++] = a : (2048 > a ? t[i++] = a >> 6 | 192 : (55296 == (64512 & a) && 56320 == (64512 & (n = e.charCodeAt(r + 1))) ? (a = 65536 + ((1023 & a) << 10) + (1023 & n), ++r, t[i++] = a >> 18 | 240, t[i++] = a >> 12 & 63 | 128) : t[i++] = a >> 12 | 224, t[i++] = a >> 6 & 63 | 128), t[i++] = 63 & a | 128);
			return i - s
		}
	}, function(e, t, i) {
		"use strict";
		e.exports = function(e, t, i) {
			var a = i || 8192,
				n = a >>> 1,
				s = null,
				r = a;
			return function(i) {
				if (1 > i || i > n) return e(i);
				r + i > a && (s = e(a), r = 0);
				var o = t.call(s, r, r += i);
				return 7 & r && (r = 1 + (7 | r)), o
			}
		}
	}, function(e, t, i) {
		"use strict";

		function a(e, t) {
			this.lo = e >>> 0, this.hi = t >>> 0
		}
		e.exports = a;
		var n = i(2),
			s = a.zero = new a(0, 0);
		s.toNumber = function() {
			return 0
		}, s.zzEncode = s.zzDecode = function() {
			return this
		}, s.length = function() {
			return 1
		};
		var r = a.zeroHash = "\x00\x00\x00\x00\x00\x00\x00\x00";
		a.fromNumber = function(e) {
			if (0 === e) return s;
			var t = 0 > e;
			t && (e = -e);
			var i = e >>> 0,
				n = (e - i) / 4294967296 >>> 0;
			return t && (n = ~n >>> 0, i = ~i >>> 0, 4294967295 < ++i && (i = 0, 4294967295 < ++n && (n = 0))), new a(i, n)
		}, a.from = function(e) {
			if ("number" == typeof e) return a.fromNumber(e);
			if (n.isString(e)) {
				if (!n.Long) return a.fromNumber(parseInt(e, 10));
				e = n.Long.fromString(e)
			}
			return e.low || e.high ? new a(e.low >>> 0, e.high >>> 0) : s
		}, a.prototype.toNumber = function(e) {
			if (!e && this.hi >>> 31) {
				var t = 1 + ~this.lo >>> 0,
					i = ~this.hi >>> 0;
				return t || (i = i + 1 >>> 0), -(t + 4294967296 * i)
			}
			return this.lo + 4294967296 * this.hi
		}, a.prototype.toLong = function(e) {
			return n.Long ? new n.Long(0 | this.lo, 0 | this.hi, Boolean(e)) : {
				low: 0 | this.lo,
				high: 0 | this.hi,
				unsigned: Boolean(e)
			}
		};
		var o = String.prototype.charCodeAt;
		a.fromHash = function(e) {
			return e === r ? s : new a((o.call(e, 0) | o.call(e, 1) << 8 | o.call(e, 2) << 16 | o.call(e, 3) << 24) >>> 0, (o.call(e, 4) | o.call(e, 5) << 8 | o.call(e, 6) << 16 | o.call(e, 7) << 24) >>> 0)
		}, a.prototype.toHash = function() {
			return String.fromCharCode(255 & this.lo, this.lo >>> 8 & 255, this.lo >>> 16 & 255, this.lo >>> 24, 255 & this.hi, this.hi >>> 8 & 255, this.hi >>> 16 & 255, this.hi >>> 24)
		}, a.prototype.zzEncode = function() {
			var e = this.hi >> 31;
			return this.hi = ((this.hi << 1 | this.lo >>> 31) ^ e) >>> 0, this.lo = (this.lo << 1 ^ e) >>> 0, this
		}, a.prototype.zzDecode = function() {
			var e = -(1 & this.lo);
			return this.lo = ((this.lo >>> 1 | this.hi << 31) ^ e) >>> 0, this.hi = (this.hi >>> 1 ^ e) >>> 0, this
		}, a.prototype.length = function() {
			var e = this.lo,
				t = (this.lo >>> 28 | this.hi << 4) >>> 0,
				i = this.hi >>> 24;
			return 0 === i ? 0 === t ? 16384 > e ? 128 > e ? 1 : 2 : 2097152 > e ? 3 : 4 : 16384 > t ? 128 > t ? 5 : 6 : 2097152 > t ? 7 : 8 : 128 > i ? 9 : 10
		}
	}, function(e, t, i) {
		"use strict";

		function a() {
			s.call(this)
		}
		function n(e, t, i) {
			e.length < 40 ? r.utf8.write(e, t, i) : t.utf8Write(e, i)
		}
		e.exports = a;
		var s = i(8);
		(a.prototype = Object.create(s.prototype)).constructor = a;
		var r = i(2),
			o = r.Buffer;
		a.alloc = function(e) {
			return (a.alloc = r._Buffer_allocUnsafe)(e)
		};
		var l = o && o.prototype instanceof Uint8Array && "set" === o.prototype.set.name ?
		function(e, t, i) {
			t.set(e, i)
		} : function(e, t, i) {
			if (e.copy) e.copy(t, i, 0, e.length);
			else for (var a = 0; a < e.length;) t[i++] = e[a++]
		};
		a.prototype.bytes = function(e) {
			r.isString(e) && (e = r._Buffer_from(e, "base64"));
			var t = e.length >>> 0;
			return this.uint32(t), t && this._push(l, t, e), this
		}, a.prototype.string = function(e) {
			var t = o.byteLength(e);
			return this.uint32(t), t && this._push(n, t, e), this
		}
	}, function(e, t, i) {
		"use strict";

		function a(e) {
			n.call(this, e)
		}
		e.exports = a;
		var n = i(9);
		(a.prototype = Object.create(n.prototype)).constructor = a;
		var s = i(2);
		s.Buffer && (a.prototype._slice = s.Buffer.prototype.slice), a.prototype.string = function() {
			var e = this.uint32();
			return this.buf.utf8Slice(this.pos, this.pos = Math.min(this.pos + e, this.len))
		}
	}, function(e, t, i) {
		"use strict";

		function a(e, t, i) {
			if ("function" != typeof e) throw TypeError("rpcImpl must be a function");
			n.EventEmitter.call(this), this.rpcImpl = e, this.requestDelimited = Boolean(t), this.responseDelimited = Boolean(i)
		}
		e.exports = a;
		var n = i(2);
		((a.prototype = Object.create(n.EventEmitter.prototype)).constructor = a).prototype.rpcCall = function s(e, t, i, a, r) {
			if (!a) throw TypeError("request must be specified");
			var o = this;
			if (!r) return n.asPromise(s, o, e, t, i, a);
			if (o.rpcImpl) try {
				return o.rpcImpl(e, t[o.requestDelimited ? "encodeDelimited" : "encode"](a).finish(), function(t, a) {
					if (t) return o.emit("error", t, e), r(t);
					if (null !== a) {
						if (!(a instanceof i)) try {
							a = i[o.responseDelimited ? "decodeDelimited" : "decode"](a)
						} catch (t) {
							return o.emit("error", t, e), r(t)
						}
						return o.emit("data", a, e), r(null, a)
					}
					o.end(!0)
				})
			} catch (s) {
				return o.emit("error", s, e), void setTimeout(function() {
					r(s)
				}, 0)
			} else setTimeout(function() {
				r(Error("already ended"))
			}, 0)
		}, a.prototype.end = function(e) {
			return this.rpcImpl && (e || this.rpcImpl(null, null, null), this.rpcImpl = null, this.emit("end").off()), this
		}
	}, function(e, t, i) {
		"use strict";

		function a(e, t) {
			function i(e) {
				if ("string" != typeof e) {
					var t = n();
					if (a.verbose && console.log("codegen: " + t), t = "return " + t, e) {
						for (var r = Object.keys(e), o = new Array(r.length + 1), l = new Array(r.length), c = 0; c < r.length;) o[c] = r[c], l[c] = e[r[c++]];
						return o[c] = t, Function.apply(null, o).apply(null, l)
					}
					return Function(t)()
				}
				for (var d = new Array(arguments.length - 1), u = 0; u < d.length;) d[u] = arguments[++u];
				if (u = 0, e = e.replace(/%([%dfijs])/g, function(e, t) {
					var i = d[u++];
					switch (t) {
					case "d":
					case "f":
						return String(Number(i));
					case "i":
						return String(Math.floor(i));
					case "j":
						return JSON.stringify(i);
					case "s":
						return String(i)
					}
					return "%"
				}), u !== d.length) throw Error("parameter count mismatch");
				return s.push(e), i
			}
			function n(i) {
				return "function " + (i || t || "") + "(" + (e && e.join(",") || "") + "){\n  " + s.join("\n  ") + "\n}"
			}
			"string" == typeof e && (t = e, e = void 0);
			var s = [];
			return i.toString = n, i
		}(e.exports = a).verbose = !1
	}, function(e, t, i) {
		"use strict";

		function a(e, t, i) {
			return "function" == typeof t ? (i = t, t = {}) : t || (t = {}), i ? !t.xhr && s && s.readFile ? s.readFile(e, function(n, s) {
				return n && "undefined" != typeof XMLHttpRequest ? a.xhr(e, t, i) : n ? i(n) : i(null, t.binary ? s : s.toString("utf8"))
			}) : a.xhr(e, t, i) : n(a, this, e, t)
		}
		e.exports = a;
		var n = i(14),
			s = i(15)("fs");
		a.xhr = function(e, t, i) {
			var a = new XMLHttpRequest;
			a.onreadystatechange = function() {
				if (4 === a.readyState) {
					if (0 !== a.status && 200 !== a.status) return i(Error("status " + a.status));
					if (t.binary) {
						var e = a.response;
						if (!e) {
							e = [];
							for (var n = 0; n < a.responseText.length; ++n) e.push(255 & a.responseText.charCodeAt(n))
						}
						return i(null, "undefined" != typeof Uint8Array ? new Uint8Array(e) : e)
					}
					return i(null, a.responseText)
				}
			}, t.binary && ("overrideMimeType" in a && a.overrideMimeType("text/plain; charset=x-user-defined"), a.responseType = "arraybuffer"), a.open("GET", e), a.send()
		}
	}, function(e, t, i) {
		"use strict";
		var a = t,
			n = a.isAbsolute = function(e) {
				return /^(?:\/|\w+:)/.test(e)
			},
			s = a.normalize = function(e) {
				var t = (e = e.replace(/\\/g, "/").replace(/\/{2,}/g, "/")).split("/"),
					i = n(e),
					a = "";
				i && (a = t.shift() + "/");
				for (var s = 0; s < t.length;)".." === t[s] ? s > 0 && ".." !== t[s - 1] ? t.splice(--s, 2) : i ? t.splice(s, 1) : ++s : "." === t[s] ? t.splice(s, 1) : ++s;
				return a + t.join("/")
			};
		a.resolve = function(e, t, i) {
			return i || (t = s(t)), n(t) ? t : (i || (e = s(e)), (e = e.replace(/(?:\/|^)[^\/]+$/, "")).length ? s(e + "/" + t) : t)
		}
	}, function(e, t, i) {
		"use strict";
		Object.defineProperty(t, "__esModule", {
			value: !0
		});
		var a = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ?
		function(e) {
			return typeof e
		} : function(e) {
			return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
		};
		t.loadAssets = function(e, t, i) {
			"object" === ("undefined" == typeof JSZipUtils ? "undefined" : a(JSZipUtils)) && "function" == typeof JSZip ? JSZipUtils.getBinaryContent(e, function(e, a) {
				if (e) throw i && i(e), console.error(e), e;
				var n = new Uint8Array(a, 0, 4);
				80 == n[0] && 75 == n[1] && 3 == n[2] && 4 == n[3] ? t(a) : i()
			}) : i()
		}
	}, function(e, t, i) {
		"use strict";
		var a = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ?
		function(e) {
			return typeof e
		} : function(e) {
			return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
		}, n = i(13).ProtoMovieEntity, s = function(e) {
			for (var t = [], i = 0; i < e.length; i += 32768) t.push(String.fromCharCode.apply(null, e.subarray(i, i + 32768)));
			return t.join("")
		}, r = {
			decodeAssets: function(e, t) {
				e.file("movie.spec").async("string").then(function(i) {
					var a = JSON.parse(i),
						n = {};
					a.ver = "1.0", r._loadImages(n, e, a, function() {
						t({
							movie: a,
							images: n
						})
					})
				})
			},
			_loadImages: function(e, t, i, o) {
				var l = this;
				if ("object" === (void 0 === i ? "undefined" : a(i)) && i.$type == n) {
					var c = !0;
					if (t) {
						var d = function(a) {
								if (i.images.hasOwnProperty(a)) {
									var n = i.images[a],
										d = s(n);
									return e.hasOwnProperty(a) ? "continue" : (c = !1, t.file(d + ".png").async("base64").then(function(n) {
										e[a] = n, r._loadImages(e, t, i, o)
									}.bind(l)), "break")
								}
							};
						e: for (var u in i.images) switch (d(u)) {
						case "continue":
							continue;
						case "break":
							break e
						}
					} else for (var f in i.images) if (i.images.hasOwnProperty(f)) {
						var p = i.images[f],
							m = s(p);
						e[f] = btoa(m)
					}
					c && o.call(this)
				} else {
					c = !0;
					for (var h in i.images) if (i.images.hasOwnProperty(h)) {
						var g = i.images[h];
						if (e.hasOwnProperty(h)) continue;
						c = !1, t.file(g + ".png").async("base64").then(function(a) {
							e[h] = a, r._loadImages(e, t, i, o)
						}.bind(this));
						break
					}
					c && o.call(this)
				}
			}
		};
		e.exports = function(e, t) {
			r.decodeAssets(e, t)
		}
	}, function(e, t, i) {
		"use strict";
		Object.defineProperty(t, "__esModule", {
			value: !0
		}), t.Player = void 0;
		var a = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ?
		function(e) {
			return typeof e
		} : function(e) {
			return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
		}, n = function() {
			function e(e, t) {
				for (var i = 0; i < t.length; i++) {
					var a = t[i];
					a.enumerable = a.enumerable || !1, a.configurable = !0, "value" in a && (a.writable = !0), Object.defineProperty(e, a.key, a)
				}
			}
			return function(t, i, a) {
				return i && e(t.prototype, i), a && e(t, a), t
			}
		}(), s = i(53), r = i(55);
		t.Player = function() {
			function e(t) {
				!
				function(e, t) {
					if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
				}(this, e), this.loops = 0, this.clearsAfterStop = !0, this.fillMode = "Forward", this._asChild = !1, this._container = void 0, this._renderer = void 0, this._animator = void 0, this._drawingCanvas = void 0, this._contentMode = "AspectFit", this._videoItem = void 0, this._currentFrame = 0, this._dynamicImage = {}, this._dynamicImageTransform = {}, this._dynamicText = {}, this._onFinished = void 0, this._onFrame = void 0, this._onPercentage = void 0, this._container = "string" == typeof t ? document.querySelector(t) : t, this._asChild = void 0 === t, this.initPlayer()
			}
			return n(e, [{
				key: "setVideoItem",
				value: function(e) {
					this._currentFrame = 0, this._videoItem = e, this._renderer.prepare(), this.clear(), this._update()
				}
			}, {
				key: "setContentMode",
				value: function(e) {
					this._contentMode = e, this._update()
				}
			}, {
				key: "setClipsToBounds",
				value: function(e) {
					this._container instanceof HTMLDivElement && (this._container.style.overflowX = this._container.style.overflowY = e ? "hidden" : void 0)
				}
			}, {
				key: "startAnimation",
				value: function(e) {
					this.stopAnimation(!1), this._doStart(void 0, e, void 0)
				}
			}, {
				key: "startAnimationWithRange",
				value: function(e, t) {
					this.stopAnimation(!1), this._doStart(e, t, void 0)
				}
			}, {
				key: "pauseAnimation",
				value: function() {
					this.stopAnimation(!1)
				}
			}, {
				key: "stopAnimation",
				value: function(e) {
					void 0 !== this._animator && this._animator.stop(), void 0 === e && (e = this.clearsAfterStop), e && this.clear()
				}
			}, {
				key: "clear",
				value: function() {
					this._renderer.clear()
				}
			}, {
				key: "stepToFrame",
				value: function(e, t) {
					e >= this._videoItem.frames || 0 > e || (this.pauseAnimation(), this._currentFrame = e, this._update(), t && this._doStart(void 0, !1, this._currentFrame))
				}
			}, {
				key: "stepToPercentage",
				value: function(e, t) {
					var i = parseInt(e * this._videoItem.frames);
					i >= this._videoItem.frames && i > 0 && (i = this._videoItem.frames - 1), this.stepToFrame(i, t)
				}
			}, {
				key: "setImage",
				value: function(e, t, i) {
					this._dynamicImage[t] = e, void 0 !== i && i instanceof Array && 6 == i.length && (this._dynamicImageTransform[t] = i)
				}
			}, {
				key: "setText",
				value: function(e, t) {
					var i = "string" == typeof e ? e : e.text,
						n = ("object" === (void 0 === e ? "undefined" : a(e)) ? e.size : "14px") || "14px",
						s = ("object" === (void 0 === e ? "undefined" : a(e)) ? e.family : "") || "",
						r = ("object" === (void 0 === e ? "undefined" : a(e)) ? e.color : "#000000") || "#000000",
						o = ("object" === (void 0 === e ? "undefined" : a(e)) ? e.offset : {
							x: 0,
							y: 0
						}) || {
							x: 0,
							y: 0
						};
					this._dynamicText[t] = {
						text: i,
						style: n + " " + s,
						color: r,
						offset: o
					}
				}
			}, {
				key: "clearDynamicObjects",
				value: function() {
					this._dynamicImage = {}, this._dynamicImageTransform = {}, this._dynamicText = {}
				}
			}, {
				key: "onFinished",
				value: function(e) {
					this._onFinished = e
				}
			}, {
				key: "onFrame",
				value: function(e) {
					this._onFrame = e
				}
			}, {
				key: "onPercentage",
				value: function(e) {
					this._onPercentage = e
				}
			}, {
				key: "drawOnContext",
				value: function(e, t, i, a, n) {
					this._drawingCanvas && this._videoItem && e.drawImage(this._drawingCanvas, t, i, a || this._videoItem.videoSize.width, n || this._videoItem.videoSize.height)
				}
			}, {
				key: "initPlayer",
				value: function() {
					if (this._container instanceof HTMLDivElement || this._asChild) {
						if (this._container) for (var e = this._container.querySelectorAll("canvas"), t = 0; t < e.length; t++) {
							var i = e[t];
							void 0 !== i && i.__isPlayer && this._container.removeChild(i)
						}
						this._drawingCanvas = document.createElement("canvas"), this._drawingCanvas.__isPlayer = !0, this._drawingCanvas.style.backgroundColor = "transparent", this._container && (this._container.appendChild(this._drawingCanvas), this._container.style.textAlign = "left")
					}
					this._renderer = new s.Renderer(this)
				}
			}, {
				key: "_doStart",
				value: function(e, t, i) {
					var a = this;
					this._animator = new r, void 0 !== e ? (this._animator.startValue = Math.max(0, e.location), this._animator.endValue = Math.min(this._videoItem.frames - 1, e.location + e.length), this._animator.duration = (this._animator.endValue - this._animator.startValue + 1) * (1 / this._videoItem.FPS) * 1e3) : (this._animator.startValue = 0, this._animator.endValue = this._videoItem.frames - 1, this._animator.duration = this._videoItem.frames * (1 / this._videoItem.FPS) * 1e3), this._animator.loops = this.loops <= 0 ? 1 / 0 : 1, this._animator.fillRule = "Backward" === this.fillMode ? 1 : 0, this._animator.onUpdate = function(e) {
						a._currentFrame !== Math.floor(e) && (a._currentFrame = Math.floor(e), a._update(), "function" == typeof a._onFrame && a._onFrame(a._currentFrame), "function" == typeof a._onPercentage && a._onPercentage(parseFloat(a._currentFrame + 1) / parseFloat(a._videoItem.frames)), 1 <= parseFloat(a._currentFrame + 1) / parseFloat(a._videoItem.frames - 1) && (a.pauseAnimation(), a._onFinished()))
					}, this._animator.onEnd = function() {
						a.clearsAfterStop, a._onFinished
					}, !0 === t ? this._animator.reverse(i) : this._animator.start(i)
				}
			}, {
				key: "_resize",
				value: function() {
					var e = !1;
					if (this._drawingCanvas) {
						var t = void 0;
						t = this._drawingCanvas.parentNode ? {
							width: this._drawingCanvas.parentNode.clientWidth,
							height: this._drawingCanvas.parentNode.clientHeight
						} : this._videoItem.videoSize;
						var i = this._videoItem.videoSize;
						if (t.width >= i.width && t.height >= i.height) this._drawingCanvas.width = t.width, this._drawingCanvas.height = t.height, this._drawingCanvas.style.webkitTransform = this._drawingCanvas.style.transform = "", e = !0;
						else {
							if (this._drawingCanvas.width = i.width, this._drawingCanvas.height = i.height, "Fill" === this._contentMode) {
								var a = t.width / i.width,
									n = t.height / i.height,
									s = (i.width * a - i.width) / 2,
									r = (i.height * n - i.height) / 2;
								this._drawingCanvas.style.webkitTransform = this._drawingCanvas.style.transform = "matrix(" + a + ", 0.0, 0.0, " + n + ", " + s + ", " + r + ")"
							} else if ("AspectFit" === this._contentMode || "AspectFill" === this._contentMode) {
								var o = i.width / i.height,
									l = t.width / t.height;
								if (o >= l && "AspectFit" === this._contentMode || l >= o && "AspectFill" === this._contentMode) {
									var c = t.width / i.width,
										d = (i.width * c - i.width) / 2,
										u = (i.height * c - i.height) / 2 + (t.height - i.height * c) / 2;
									this._drawingCanvas.style.webkitTransform = this._drawingCanvas.style.transform = "matrix(" + c + ", 0.0, 0.0, " + c + ", " + d + ", " + u + ")"
								} else if (l > o && "AspectFit" === this._contentMode || o > l && "AspectFill" === this._contentMode) {
									var f = t.height / i.height,
										p = (i.width * f - i.width) / 2 + (t.width - i.width * f) / 2,
										m = (i.height * f - i.height) / 2;
									this._drawingCanvas.style.webkitTransform = this._drawingCanvas.style.transform = "matrix(" + f + ", 0.0, 0.0, " + f + ", " + p + ", " + m + ")"
								}
							}
							this._globalTransform = void 0
						}
					}
					if (void 0 === this._drawingCanvas || !0 === e) {
						var h = 1,
							g = 1,
							v = 0,
							y = 0,
							b = void 0 !== this._container ? this._container.clientWidth : 0,
							k = void 0 !== this._container ? this._container.clientHeight : 0,
							w = this._videoItem.videoSize;
						if ("Fill" === this._contentMode) h = b / w.width, g = k / w.height;
						else if ("AspectFit" === this._contentMode || "AspectFill" === this._contentMode) {
							var _ = w.width / w.height,
								x = b / k;
							_ >= x && "AspectFit" === this._contentMode || x >= _ && "AspectFill" === this._contentMode ? (h = g = b / w.width, y = (k - w.height * g) / 2) : (x > _ && "AspectFit" === this._contentMode || _ > x && "AspectFill" === this._contentMode) && (h = g = k / w.height, v = (b - w.width * h) / 2)
						}
						this._globalTransform = {
							a: h,
							b: 0,
							c: 0,
							d: g,
							tx: v,
							ty: y
						}
					}
				}
			}, {
				key: "_update",
				value: function() {
					void 0 !== this._videoItem && (this._resize(), this._renderer.drawFrame(this._currentFrame))
				}
			}]), e
		}()
	}, function(e, t, i) {
		"use strict";
		Object.defineProperty(t, "__esModule", {
			value: !0
		}), t.Renderer = void 0;
		var a = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ?
		function(e) {
			return typeof e
		} : function(e) {
			return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
		}, n = function() {
			function e(e, t) {
				for (var i = 0; i < t.length; i++) {
					var a = t[i];
					a.enumerable = a.enumerable || !1, a.configurable = !0, "value" in a && (a.writable = !0), Object.defineProperty(e, a.key, a)
				}
			}
			return function(t, i, a) {
				return i && e(t.prototype, i), a && e(t, a), t
			}
		}(), s = i(3), r = i(12), o = i(54);
		t.Renderer = function() {
			function e(t) {
				!
				function(e, t) {
					if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
				}(this, e), this._owner = void 0, this._prepared = !1, this._undrawFrame = void 0, this._bitmapCache = void 0, this._owner = t
			}
			return n(e, [{
				key: "prepare",
				value: function() {
					var e, t = this;
					return this._prepared = !1, (this._bitmapCache = void 0) === this._owner._videoItem.images || 0 == Object.keys(this._owner._videoItem.images).length ? (this._bitmapCache = {}, void(this._prepared = !0)) : void(void 0 === this._bitmapCache &&
					function() {
						t._bitmapCache = {};
						var i = 0,
							a = 0;
						for (e in t._owner._videoItem.images) {
							var n = t._owner._videoItem.images[e];
							if (0 === n.indexOf("iVBO") || 0 === n.indexOf("/9j/2w")) {
								i++;
								var s = document.createElement("img");
								s.onload = function() {
									++a == i && (this._prepared = !0, "number" == typeof this._undrawFrame && (this.drawFrame(this._undrawFrame), this._undrawFrame = void 0))
								}.bind(t), s.src = "data:image/png;base64," + n, t._bitmapCache[e] = s
							}
						}
					}())
				}
			}, {
				key: "clear",
				value: function() {
					var e = (this._owner._drawingCanvas || this._owner._container).getContext("2d"),
						t = {
							x: 0,
							y: 0,
							width: (this._owner._drawingCanvas || this._owner._container).width,
							height: (this._owner._drawingCanvas || this._owner._container).height
						};
					e.clearRect(t.x, t.y, t.width, t.height)
				}
			}, {
				key: "drawFrame",
				value: function(e) {
					var t = this;
					if (this._prepared) {
						var i = (this._owner._drawingCanvas || this._owner._container).getContext("2d"),
							n = {
								x: 0,
								y: 0,
								width: (this._owner._drawingCanvas || this._owner._container).width,
								height: (this._owner._drawingCanvas || this._owner._container).height
							};
						i.clearRect(n.x, n.y, n.width, n.height), this._owner._videoItem.sprites.forEach(function(e) {
							var n = e.frames[t._owner._currentFrame];
							if (!(n.alpha < .05)) {
								i.save(), t._owner._globalTransform && i.transform(t._owner._globalTransform.a, t._owner._globalTransform.b, t._owner._globalTransform.c, t._owner._globalTransform.d, t._owner._globalTransform.tx, t._owner._globalTransform.ty), i.globalAlpha = n.alpha, i.transform(n.transform.a, n.transform.b, n.transform.c, n.transform.d, n.transform.tx, n.transform.ty);
								var l = t._owner._dynamicImage[e.imageKey] || t._bitmapCache[e.imageKey] || t._owner._videoItem.images[e.imageKey];
								if ("string" == typeof l) {
									var c = t._bitmapCache[e.imageKey] || document.createElement("img"),
										d = void 0,
										u = void 0;
									if (0 === l.indexOf("iVBO") || 0 === l.indexOf("/9j/2w") ? c.src = "data:image/png;base64," + l : (c._svgaSrc !== l && (c._svgaSrc = l, c.src = l), d = n.layout.width, u = n.layout.height), t._bitmapCache[e.imageKey] = c, void 0 !== n.maskPath && null !== n.maskPath && (t.drawBezier(i, n.maskPath), i.clip()), void 0 !== t._owner._dynamicImageTransform[e.imageKey]) {
										i.save();
										var f = t._owner._dynamicImageTransform[e.imageKey];
										i.transform(f[0], f[1], f[2], f[3], f[4], f[5])
									}
									d && u ? i.drawImage(c, 0, 0, d, u) : i.drawImage(c, 0, 0), void 0 !== t._owner._dynamicImageTransform[e.imageKey] && i.restore()
								} else if ("object" === (void 0 === l ? "undefined" : a(l))) {
									if (void 0 !== n.maskPath && null !== n.maskPath && (n.maskPath._styles = void 0, t.drawBezier(i, n.maskPath), i.clip()), void 0 !== t._owner._dynamicImageTransform[e.imageKey]) {
										i.save();
										var p = t._owner._dynamicImageTransform[e.imageKey];
										i.transform(p[0], p[1], p[2], p[3], p[4], p[5])
									}
									i.drawImage(l, 0, 0), void 0 !== t._owner._dynamicImageTransform[e.imageKey] && i.restore()
								}
								n.shapes && n.shapes.forEach(function(e) {
									"shape" === e.type && e.pathArgs && e.pathArgs.d && t.drawBezier(i, new s.BezierPath(e.pathArgs.d, e.transform, e.styles)), "ellipse" === e.type && e.pathArgs && t.drawEllipse(i, new r.EllipsePath(parseFloat(e.pathArgs.x) || 0, parseFloat(e.pathArgs.y) || 0, parseFloat(e.pathArgs.radiusX) || 0, parseFloat(e.pathArgs.radiusY) || 0, e.transform, e.styles)), "rect" === e.type && e.pathArgs && t.drawRect(i, new o.RectPath(parseFloat(e.pathArgs.x) || 0, parseFloat(e.pathArgs.y) || 0, parseFloat(e.pathArgs.width) || 0, parseFloat(e.pathArgs.height) || 0, parseFloat(e.pathArgs.cornerRadius) || 0, e.transform, e.styles))
								});
								var m = t._owner._dynamicText[e.imageKey];
								if (void 0 !== m) {
									i.textBaseline = "middle", i.font = m.style;
									var h = i.measureText(m.text).width;
									i.fillStyle = m.color;
									var g = void 0 !== m.offset && void 0 !== m.offset.x ? isNaN(parseFloat(m.offset.x)) ? 0 : parseFloat(m.offset.x) : 0,
										v = void 0 !== m.offset && void 0 !== m.offset.y ? isNaN(parseFloat(m.offset.y)) ? 0 : parseFloat(m.offset.y) : 0;
									i.fillText(m.text, (n.layout.width - h) / 2 + g, n.layout.height / 2 + v)
								}
								i.restore()
							}
						})
					} else this._undrawFrame = e
				}
			}, {
				key: "resetShapeStyles",
				value: function(e, t) {
					var i = t._styles;
					void 0 !== i && (i && i.stroke ? e.strokeStyle = "rgba(" + parseInt(255 * i.stroke[0]) + ", " + parseInt(255 * i.stroke[1]) + ", " + parseInt(255 * i.stroke[2]) + ", " + i.stroke[3] + ")" : e.strokeStyle = "transparent", i && (e.lineWidth = i.strokeWidth || void 0, e.lineCap = i.lineCap || void 0, e.lineJoin = i.lineJoin || void 0, e.miterLimit = i.miterLimit || void 0), i && i.fill ? e.fillStyle = "rgba(" + parseInt(255 * i.fill[0]) + ", " + parseInt(255 * i.fill[1]) + ", " + parseInt(255 * i.fill[2]) + ", " + i.fill[3] + ")" : e.fillStyle = "transparent", i && i.lineDash && e.setLineDash(i.lineDash))
				}
			}, {
				key: "drawBezier",
				value: function(e, t) {
					var i = this;
					e.save(), this.resetShapeStyles(e, t), void 0 !== t._transform && null !== t._transform && e.transform(t._transform.a, t._transform.b, t._transform.c, t._transform.d, t._transform.tx, t._transform.ty);
					var a = {
						x: 0,
						y: 0,
						x1: 0,
						y1: 0,
						x2: 0,
						y2: 0
					};
					e.beginPath(), t._d.replace(/([a-zA-Z])/g, "|||$1 ").replace(/,/g, " ").split("|||").forEach(function(t) {
						if (0 != t.length) {
							var n = t.substr(0, 1);
							if (0 <= "MLHVCSQRZmlhvcsqrz".indexOf(n)) {
								var s = t.substr(1).trim().split(" ");
								i.drawBezierElement(e, a, n, s)
							}
						}
					}), t._styles && t._styles.fill && e.fill(), t._styles && t._styles.stroke && e.stroke(), e.restore()
				}
			}, {
				key: "drawBezierElement",
				value: function(e, t, i, a) {
					switch (i) {
					case "M":
						t.x = Number(a[0]), t.y = Number(a[1]), e.moveTo(t.x, t.y);
						break;
					case "m":
						t.x += Number(a[0]), t.y += Number(a[1]), e.moveTo(t.x, t.y);
						break;
					case "L":
						t.x = Number(a[0]), t.y = Number(a[1]), e.lineTo(t.x, t.y);
						break;
					case "l":
						t.x += Number(a[0]), t.y += Number(a[1]), e.lineTo(t.x, t.y);
						break;
					case "H":
						t.x = Number(a[0]), e.lineTo(t.x, t.y);
						break;
					case "h":
						t.x += Number(a[0]), e.lineTo(t.x, t.y);
						break;
					case "V":
						t.y = Number(a[0]), e.lineTo(t.x, t.y);
						break;
					case "v":
						t.y += Number(a[0]), e.lineTo(t.x, t.y);
						break;
					case "C":
						t.x1 = Number(a[0]), t.y1 = Number(a[1]), t.x2 = Number(a[2]), t.y2 = Number(a[3]), t.x = Number(a[4]), t.y = Number(a[5]), e.bezierCurveTo(t.x1, t.y1, t.x2, t.y2, t.x, t.y);
						break;
					case "c":
						t.x1 = t.x + Number(a[0]), t.y1 = t.y + Number(a[1]), t.x2 = t.x + Number(a[2]), t.y2 = t.y + Number(a[3]), t.x += Number(a[4]), t.y += Number(a[5]), e.bezierCurveTo(t.x1, t.y1, t.x2, t.y2, t.x, t.y);
						break;
					case "S":
						t.x1 && t.y1 && t.x2 && t.y2 ? (t.x1 = t.x - t.x2 + t.x, t.y1 = t.y - t.y2 + t.y, t.x2 = Number(a[0]), t.y2 = Number(a[1]), t.x = Number(a[2]), t.y = Number(a[3]), e.bezierCurveTo(t.x1, t.y1, t.x2, t.y2, t.x, t.y)) : (t.x1 = Number(a[0]), t.y1 = Number(a[1]), t.x = Number(a[2]), t.y = Number(a[3]), e.quadraticCurveTo(t.x1, t.y1, t.x, t.y));
						break;
					case "s":
						t.x1 && t.y1 && t.x2 && t.y2 ? (t.x1 = t.x - t.x2 + t.x, t.y1 = t.y - t.y2 + t.y, t.x2 = t.x + Number(a[0]), t.y2 = t.y + Number(a[1]), t.x += Number(a[2]), t.y += Number(a[3]), e.bezierCurveTo(t.x1, t.y1, t.x2, t.y2, t.x, t.y)) : (t.x1 = t.x + Number(a[0]), t.y1 = t.y + Number(a[1]), t.x += Number(a[2]), t.y += Number(a[3]), e.quadraticCurveTo(t.x1, t.y1, t.x, t.y));
						break;
					case "Q":
						t.x1 = Number(a[0]), t.y1 = Number(a[1]), t.x = Number(a[2]), t.y = Number(a[3]), e.quadraticCurveTo(t.x1, t.y1, t.x, t.y);
						break;
					case "q":
						t.x1 = t.x + Number(a[0]), t.y1 = t.y + Number(a[1]), t.x += Number(a[2]), t.y += Number(a[3]), e.quadraticCurveTo(t.x1, t.y1, t.x, t.y);
						break;
					case "A":
					case "a":
						break;
					case "Z":
					case "z":
						e.closePath()
					}
				}
			}, {
				key: "drawEllipse",
				value: function(e, t) {
					e.save(), this.resetShapeStyles(e, t), void 0 !== t._transform && null !== t._transform && e.transform(t._transform.a, t._transform.b, t._transform.c, t._transform.d, t._transform.tx, t._transform.ty);
					var i = t._x - t._radiusX,
						a = t._y - t._radiusY,
						n = 2 * t._radiusX,
						s = 2 * t._radiusY,
						r = n / 2 * .5522848,
						o = s / 2 * .5522848,
						l = i + n,
						c = a + s,
						d = i + n / 2,
						u = a + s / 2;
					e.beginPath(), e.moveTo(i, u), e.bezierCurveTo(i, u - o, d - r, a, d, a), e.bezierCurveTo(d + r, a, l, u - o, l, u), e.bezierCurveTo(l, u + o, d + r, c, d, c), e.bezierCurveTo(d - r, c, i, u + o, i, u), t._styles && t._styles.fill && e.fill(), t._styles && t._styles.stroke && e.stroke(), e.restore()
				}
			}, {
				key: "drawRect",
				value: function(e, t) {
					e.save(), this.resetShapeStyles(e, t), void 0 !== t._transform && null !== t._transform && e.transform(t._transform.a, t._transform.b, t._transform.c, t._transform.d, t._transform.tx, t._transform.ty);
					var i = t._x,
						a = t._y,
						n = t._width,
						s = t._height,
						r = t._cornerRadius;
					2 * r > n && (r = n / 2), 2 * r > s && (r = s / 2), e.beginPath(), e.moveTo(i + r, a), e.arcTo(i + n, a, i + n, a + s, r), e.arcTo(i + n, a + s, i, a + s, r), e.arcTo(i, a + s, i, a, r), e.arcTo(i, a, i + n, a, r), e.closePath(), t._styles && t._styles.fill && e.fill(), t._styles && t._styles.stroke && e.stroke(), e.restore()
				}
			}]), e
		}()
	}, function(e, t, i) {
		"use strict";
		Object.defineProperty(t, "__esModule", {
			value: !0
		}), t.RectPath = void 0;
		var a = i(3);
		t.RectPath = function(e) {
			function t(e, i, a, n, s, r, o) {
				!
				function(e, t) {
					if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
				}(this, t);
				var l = function(e, t) {
						if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
						return !t || "object" != typeof t && "function" != typeof t ? e : t
					}(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
				return l._x = e, l._y = i, l._width = a, l._height = n, l._cornerRadius = s, l._transform = r, l._styles = o, l
			}
			return function(e, t) {
				if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
				e.prototype = Object.create(t && t.prototype, {
					constructor: {
						value: e,
						enumerable: !1,
						writable: !0,
						configurable: !0
					}
				}), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
			}(t, a.BezierPath), t
		}()
	}, function(e, t, i) {
		var a;
		"undefined" != typeof self && self, a = function() {
			return function(e) {
				function t(a) {
					if (i[a]) return i[a].exports;
					var n = i[a] = {
						i: a,
						l: !1,
						exports: {}
					};
					return e[a].call(n.exports, n, n.exports, t), n.l = !0, n.exports
				}
				var i = {};
				return t.m = e, t.c = i, t.d = function(e, i, a) {
					t.o(e, i) || Object.defineProperty(e, i, {
						configurable: !1,
						enumerable: !0,
						get: a
					})
				}, t.n = function(e) {
					var i = e && e.__esModule ?
					function() {
						return e["default"]
					} : function() {
						return e
					};
					return t.d(i, "a", i), i
				}, t.o = function(e, t) {
					return Object.prototype.hasOwnProperty.call(e, t);
				}, t.p = "", t(t.s = 0)
			}([function(e, t, i) {
				"use strict";
				Object.defineProperty(t, "__esModule", {
					value: !0
				});
				var a = i(1);
				e.exports = a.ValueAnimator
			}, function(e, t, i) {
				"use strict";
				Object.defineProperty(t, "__esModule", {
					value: !0
				});
				var a = function() {
						function e() {
							this.startValue = 0, this.endValue = 0, this.duration = 0, this.loops = 1, this.fillRule = 0, this.onStart = function() {}, this.onUpdate = function() {}, this.onEnd = function() {}, this.mRunning = !1, this.mStartTime = 0, this.mCurrentFrication = 0, this.mReverse = !1
						}
						return e.prototype.start = function(e) {
							void 0 === e && (e = void 0), this.doStart(!1, e)
						}, e.prototype.reverse = function(e) {
							void 0 === e && (e = void 0), this.doStart(!0, e)
						}, e.prototype.stop = function() {
							this.doStop()
						}, Object.defineProperty(e.prototype, "animatedValue", {
							get: function() {
								return (this.endValue - this.startValue) * this.mCurrentFrication + this.startValue
							},
							enumerable: !0,
							configurable: !0
						}), e.prototype.doStart = function(t, i) {
							void 0 === t && (t = !1), void 0 === i && (i = void 0), this.mReverse = t, this.mRunning = !0, this.mStartTime = e.currentTimeMillsecond(), i && (this.mStartTime -= t ? (1 - i / (this.endValue - this.startValue)) * this.duration : i / (this.endValue - this.startValue) * this.duration), this.mCurrentFrication = 0, this.onStart(), this.doFrame()
						}, e.prototype.doStop = function() {
							this.mRunning = !1
						}, e.prototype.doFrame = function() {
							this.mRunning && (this.doDeltaTime(e.currentTimeMillsecond() - this.mStartTime), this.mRunning && e.requestAnimationFrame(this.doFrame.bind(this)))
						}, e.prototype.doDeltaTime = function(e) {
							e >= this.duration * this.loops ? (this.mCurrentFrication = 1 === this.fillRule ? 0 : 1, this.mRunning = !1) : (this.mCurrentFrication = e % this.duration / this.duration, this.mReverse && (this.mCurrentFrication = 1 - this.mCurrentFrication)), this.onUpdate(this.animatedValue), !1 === this.mRunning && this.onEnd()
						}, e.currentTimeMillsecond = function() {
							return "undefined" == typeof performance ? (new Date).getTime() : performance.now()
						}, e.requestAnimationFrame = function(e) {
							return "undefined" == typeof requestAnimationFrame ? setTimeout(e, 16) : window.requestAnimationFrame(e)
						}, e
					}();
				t.ValueAnimator = a
			}])
		}, e.exports = a()
	}]);
!
function() {
	window.define && define.fmd && define("douyu/com/svga", function() {
		return svgaLib
	})
}(), define("douyu/com/svga-queue", ["jquery", "shark/observer", "douyu/com/svga"], function(e, t, i) {
	var a = {
		chatbox: e("#js-chat-cont"),
		batchDom: e('<div class="batchInfo hide" style="width: 100%;height: 100%;position: absolute;top: 0;left: 0;z-index:210"></div>'),
		array: [],
		isComplete: !0,
		flag: !0,
		init: function() {
			var e = this;
			e.chatbox.append(e.batchDom), e.parentDom = document.querySelector(".batchInfo"), e.svga = new i["default"], e.svga.initDom(e.parentDom);
			var t = n.checkSupportSvga();
			e.flag = t
		}
	},
		n = {
			startQueue: function() {
				var e = a;
				if (0 == e.array.length) return void(e.isComplete = !0);
				if (e.isComplete) {
					var t = e.array[0];
					e.isComplete = !1, n.playSvga(t)
				}
			},
			playSvga: function(e) {
				var t = a;
				t.batchDom.removeClass("hide"), t.svga.addSVGA(e, 1, function(e) {
					if (t.svga.disposeSvga(), t.array.shift(), 0 != t.array.length) {
						var i = t.array[0];
						n.playSvga(i)
					} else t.batchDom.addClass("hide"), t.isComplete = !0, t.svga.disposeSvga()
				}, function() {})
			},
			pushQueue: function(e) {
				var i = a;
				i.flag ? document.hidden || (i.array.push(e), n.startQueue()) : t.trigger("mod.gift.svga.unsupport", "您的浏览器版本过低，无法观看礼物动效")
			},
			checkSupportSvga: function() {
				var e = !1;
				try {
					new ArrayBuffer, e = !0
				} catch (t) {}
				return e
			}
		};
	return a.init(), {
		pushQueue: n.pushQueue
	}
}), define("douyu/page/room/normal/mod/gift/view/super", ["shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "shark/util/storage/1.0", "douyu/context", "douyu/com/preload-file", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/base/view", "douyu/page/room/normal/mod/gift/base/queue", "douyu/com/svga-queue"], function(e, t, i, a, n, s, r, o, l, c, d) {
	var u = function(e) {
			function a(t) {
				var i = e.call(this, t) || this;
				return i.chatbox = $("body"), i.queue = new c, i.queue.run(), i.renderSmall = a.prototype.renderSmallHtml(), i
			}
			return o(a, e), a.prototype.renderSmallHtml = function(e) {
				var a, n;
				return n = t.string.join('<div class="gift-fly-box">', "    {{ if (giftData.gfcnt > 1) }}", '    <div class="gift-fly-num">', '           <span class="gift-fly-num-x"></span>', "       {{ each numArr as item }}", '           <span class="gift-fly-num-{{item}}"></span>', "       {{ /each }}", "    </div>", "    {{ /if }}", "</div>"), a = i.compile(n)
			}, a.prototype.render = function(e, t) {
				var i, a = this,
					n = e.useFullData,
					s = $("#js-stats-and-actions").find('[data-giftid="' + n.giftId + '"]'),
					r = s.offset(),
					o = {
						w: 70,
						h: 50
					},
					l = {
						x: (s.width() - o.w) / 2 + r.left + 2,
						y: r.top - o.h
					},
					c = ("" + (n.gfcnt || 1)).split(""),
					d = a.renderSmall({
						giftData: n,
						numArr: c
					});
				this.raiseUpBlock = $(d), this.chatbox.append(this.raiseUpBlock), n.batchSmallIcon ? this.raiseUpBlock.css({
					left: l.x,
					top: l.y,
					"background-image": "url(" + n.batchSmallIcon + ")"
				}) : this.raiseUpBlock.css({
					left: l.x,
					top: l.y
				}), i = function() {
					var e = $.Deferred();
					return a.raiseUpBlock.animate({
						top: l.y - 100
					}, 1e3, "swing", function() {
						$(this).remove(), e.resolve(), t()
					}), e.name = "ownerSuper", e
				}, this.queue.addJob(i)
			}, a
		}(l),
		f = function(t) {
			function i(e) {
				var i = t.call(this, e) || this;
				return this.useFullData = {}, i.queue = new c, i.queue.run(), this
			}
			return o(i, t), i.prototype.render = function(t, a) {
				var n, s = this;
				s.useFullData = t.useFullData;
				var o = s.useFullData ? s.useFullData.batchTemp : {},
					l = s.useFullData ? s.useFullData.batchNumArray : [],
					c = s.useFullData ? s.useFullData.effectIcon : "";
				this.rocket;
				n = function() {
					var t = new $.Deferred,
						n = s.useFullData.gfcnt;
					if (n) {
						var u = i.prototype.getUrl(n, l, o);
						if (u) d.pushQueue(u);
						else if (c) for (var f = 0; n > f; f++) d.pushQueue(c);
						if (t.resolve(), e.fire(r.CHECK_USER_IS_BAN, s.useFullData.senderId)) return;
						a()
					}
					return t.name = "rocket", t
				}, this.queue.addJob(n)
			}, i.prototype.getUrl = function(e, t, i) {
				for (var a = "", n = 0; n < t.length; n++) parseInt(e, 10) >= parseInt(t[n], 10) && (a = t[n]);
				var s = i[a] ? i[a].barrage_effect : "";
				return s = s.replace(/https?:/, "")
			}, i
		}(l);
	return {
		SuperSmallView: u,
		SuperBigView: f
	}
}), define("douyu/page/room/normal/mod/gift/view/commonfly", ["shark/util/lang/1.0", "shark/util/template/2.0", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/base/view", "douyu/page/room/normal/mod/gift/base/queue"], function(e, t, i, a, n) {
	var s = function(e) {
			function t(t) {
				var i = e.call(this, t) || this;
				return i.queue = new n, i.queue.run(), i
			}
			return i(t, e), t.prototype.render = function(e, t) {
				var i, a = this,
					n = e.useFullData,
					s = $('[data-giftid="' + n.giftId + '"],[data-giftid]'),
					r = s.offset(),
					o = {
						w: 110,
						h: 66
					},
					l = {
						x: (s.width() - o.w) / 2 + r.left + 2,
						y: r.top - o.h
					};
				switch (a.chatbox = $("body"), parseInt(n.effect, 10)) {
				case 3:
					this.commonUpBlock = $('<div class="gift-smallKiss"></div>');
					break;
				case 4:
					this.commonUpBlock = $('<div class="gift-smallCar"></div>');
					break;
				case 5:
					this.commonUpBlock = $('<div class="gift-smallShip"></div>')
				}
				this.chatbox.append(this.commonUpBlock), this.commonUpBlock.css({
					left: l.x,
					top: l.y,
					"background-image": "url(" + n.smallGiftAnimateImg + ")"
				}), i = function() {
					var e = $.Deferred();
					return a.commonUpBlock.animate({
						top: l.y - 300,
						opacity: 0
					}, 1e3, "easeOutCubic", function() {
						$(this).remove(), e.resolve()
					}), t(), e.name = "ownerCommon", e
				}, this.queue.addJob(i)
			}, t
		}(a),
		r = function(e) {
			function t(t) {
				var i = e.call(this, t) || this;
				return i.chatbox = t && t.chatBox || $("#js-chat-cont"), i.queue = new n, i.queue.run(), this
			}
			return i(t, e), t.prototype.render = function(e, t) {}, t
		}(a);
	return {
		CommonSmallView: s,
		CommonBigView: r
	}
}), define("douyu/page/room/normal/mod/gift/view/plane", ["shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/base/view", "douyu/page/room/normal/mod/gift/base/queue", "douyu/com/svga-queue"], function(e, t, i, a, n, s, r, o) {
	var l = function(e) {
			function a(t) {
				var i = e.call(this, t) || this;
				return this.chatbox = $("body"), i.queue = new r, i.queue.run(), i.renderSmall = a.prototype.renderSmallHtml(), i
			}
			return n(a, e), a.prototype.renderSmallHtml = function(e) {
				var a, n;
				return n = t.string.join('<div class="gift-fly-box">', "    {{ if (giftData.gfcnt > 1) }}", '    <div class="gift-fly-num">', '           <span class="gift-fly-num-x"></span>', "       {{ each numArr as item }}", '           <span class="gift-fly-num-{{item}}"></span>', "       {{ /each }}", "    </div>", "    {{ /if }}", "</div>"), a = i.compile(n)
			}, a.prototype.render = function(e, t) {
				var i, a = this,
					n = e.useFullData,
					s = $("#js-stats-and-actions").find('[data-giftid="' + n.giftId + '"]'),
					r = s.offset(),
					o = {
						w: 30,
						h: 50
					},
					l = {
						x: (s.width() - o.w) / 2 + r.left + 2,
						y: r.top - o.h
					},
					c = ("" + (n.gfcnt || 1)).split(""),
					d = a.renderSmall({
						giftData: n,
						numArr: c
					});
				this.raiseUpBlock = $(d), this.chatbox.append(this.raiseUpBlock), n.batchSmallIcon ? this.raiseUpBlock.css({
					left: l.x,
					top: l.y,
					"background-image": "url(" + n.batchSmallIcon + ")"
				}) : this.raiseUpBlock.css({
					left: l.x,
					top: l.y
				}), i = function() {
					var e = $.Deferred();
					return a.raiseUpBlock.animate({
						top: l.y - 100
					}, 1e3, "swing", function() {
						$(this).remove(), e.resolve(), t()
					}), e.name = "ownerPlane", e
				}, this.queue.addJob(i)
			}, a
		}(s),
		c = function(t) {
			function i(e) {
				var i = t.call(this, e) || this;
				return this.useFullData = {}, i.queue = new r, i.queue.run(), this
			}
			return n(i, t), i.prototype.render = function(t, n) {
				var s, r = this;
				r.useFullData = t.useFullData;
				var l = r.useFullData ? r.useFullData.batchTemp : {},
					c = r.useFullData ? r.useFullData.batchNumArray : [],
					d = r.useFullData ? r.useFullData.effectIcon : "";
				this.rocket;
				s = function() {
					var t = new $.Deferred,
						s = r.useFullData.gfcnt;
					if (s) {
						var u = i.prototype.getUrl(s, c, l);
						if (u) o.pushQueue(u);
						else if (d) for (var f = 0; s > f; f++) o.pushQueue(d);
						if (t.resolve(), e.fire(a.CHECK_USER_IS_BAN, r.useFullData.senderId)) return;
						n()
					}
					return t.name = "rocket", t
				}, this.queue.addJob(s)
			}, i.prototype.getUrl = function(e, t, i) {
				for (var a = "", n = 0; n < t.length; n++) parseInt(e, 10) >= parseInt(t[n], 10) && (a = t[n]);
				var s = i[a] ? i[a].barrage_effect : "";
				return s = s.replace(/https?:/, "")
			}, i
		}(s);
	return {
		PlaneSmallView: l,
		PlaneBigView: c
	}
}), define("douyu/page/room/normal/mod/gift/view/batch", ["shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/base/view", "douyu/page/room/normal/mod/gift/base/queue", "douyu/com/svga-queue"], function(e, t, i, a, n, s, r, o) {
	var l = function(e) {
			function a(t) {
				var i = e.call(this, t) || this;
				return i.queue = new r, i.queue.run(), i.renderSmall = a.prototype.renderSmallHtml(), i
			}
			return n(a, e), a.prototype.renderSmallHtml = function(e) {
				var a, n;
				return n = t.string.join('<div class="gift-fly-box">', "    {{ if (giftData.gfcnt > 1) }}", '    <div class="gift-fly-num">', '           <span class="gift-fly-num-x"></span>', "       {{ each numArr as item }}", '           <span class="gift-fly-num-{{item}}"></span>', "       {{ /each }}", "    </div>", "    {{ /if }}", "</div>"), a = i.compile(n)
			}, a.prototype.render = function(e, t) {
				var i, a = this,
					n = e.useFullData,
					s = $("#js-stats-and-actions").find('[data-giftid="' + n.giftId + '"]'),
					r = s.offset(),
					o = {
						w: 30,
						h: 105
					},
					l = {
						x: (s.width() - o.w) / 2 + r.left + 2,
						y: r.top - o.h
					};
				a.chatbox = $("body");
				var c = ("" + (n.gfcnt || 1)).split(""),
					d = a.renderSmall({
						giftData: n,
						numArr: c
					});
				this.raiseUpBlock = $(d), this.chatbox.append(this.raiseUpBlock), n.batchSmallIcon ? this.raiseUpBlock.css({
					left: l.x,
					top: l.y,
					"background-image": "url(" + n.batchSmallIcon + ")"
				}) : this.raiseUpBlock.css({
					left: l.x,
					top: l.y
				}), i = function() {
					var e = $.Deferred();
					return a.raiseUpBlock.animate({
						top: l.y - 100
					}, 1e3, "swing", function() {
						$(this).remove(), e.resolve(), t()
					}), e.name = "batchSimple", e
				}, this.queue.addJob(i)
			}, a
		}(s),
		c = function(t) {
			function i(e) {
				var i = t.call(this, e) || this;
				return this.useFullData = {}, i.queue = new r, i.queue.run(), this
			}
			return n(i, t), i.prototype.render = function(t, n) {
				var s, r = this;
				r.useFullData = t.useFullData;
				var l = r.useFullData ? r.useFullData.batchTemp : {},
					c = r.useFullData ? r.useFullData.batchNumArray : [];
				this.rocket;
				s = function() {
					var t = new $.Deferred,
						s = r.useFullData.gfcnt;
					if (s && s > 1) {
						var d = i.prototype.getUrl(s, c, l);
						if (d && o.pushQueue(d), t.resolve(), e.fire(a.CHECK_USER_IS_BAN, r.useFullData.senderId)) return;
						n()
					}
					return t.name = "batch", t
				}, this.queue.addJob(s)
			}, i.prototype.getUrl = function(e, t, i) {
				for (var a = "", n = 0; n < t.length; n++) parseInt(e, 10) >= parseInt(t[n], 10) && (a = t[n]);
				var s = i[a] ? i[a].barrage_effect : "";
				return s = s.replace(/https?:/, "")
			}, i
		}(s);
	return {
		BatchSmallView: l,
		BatchBigView: c
	}
}), define("douyu/page/room/normal/mod/gift/view/rocket", ["shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/base/view", "douyu/page/room/normal/mod/gift/base/queue", "douyu/com/svga-queue"], function(e, t, i, a, n, s, r, o) {
	var l = function(e) {
			function a(t) {
				var i = e.call(this, t) || this;
				return i.queue = new r, i.queue.run(), i.renderSmall = a.prototype.renderSmallHtml(), i
			}
			return n(a, e), a.prototype.renderSmallHtml = function(e) {
				var a, n;
				return n = t.string.join('<div class="gift-fly-box">', "    {{ if (giftData.gfcnt > 1) }}", '    <div class="gift-fly-num">', '           <span class="gift-fly-num-x"></span>', "       {{ each numArr as item }}", '           <span class="gift-fly-num-{{item}}"></span>', "       {{ /each }}", "    </div>", "    {{ /if }}", "</div>"), a = i.compile(n)
			}, a.prototype.render = function(e, t) {
				var i, a = this,
					n = e.useFullData,
					s = $("#js-stats-and-actions").find('[data-giftid="' + n.giftId + '"]'),
					r = s.offset(),
					o = {
						w: 30,
						h: 50
					},
					l = {
						x: (s.width() - o.w) / 2 + r.left + 2,
						y: r.top - o.h
					};
				a.chatbox = $("body");
				var c = ("" + (n.gfcnt || 1)).split(""),
					d = a.renderSmall({
						giftData: n,
						numArr: c
					});
				this.raiseUpBlock = $(d), this.chatbox.append(this.raiseUpBlock), n.batchSmallIcon ? this.raiseUpBlock.css({
					left: l.x,
					top: l.y,
					"background-image": "url(" + n.batchSmallIcon + ")"
				}) : this.raiseUpBlock.css({
					left: l.x,
					top: l.y
				}), i = function() {
					var e = $.Deferred();
					return a.raiseUpBlock.animate({
						top: l.y - 100
					}, 1e3, "swing", function() {
						$(this).remove(), e.resolve(), t()
					}), e.name = "ownerRocket", e
				}, this.queue.addJob(i)
			}, a
		}(s),
		c = function(t) {
			function i(e) {
				var i = t.call(this, e) || this;
				return this.useFullData = {}, i.queue = new r, i.queue.run(), this
			}
			return n(i, t), i.prototype.render = function(t, n) {
				var s, r = this;
				r.useFullData = t.useFullData;
				var l = r.useFullData ? r.useFullData.batchTemp : {},
					c = r.useFullData ? r.useFullData.batchNumArray : [],
					d = r.useFullData ? r.useFullData.effectIcon : "";
				this.rocket;
				s = function() {
					var t = new $.Deferred,
						s = r.useFullData.gfcnt;
					if (s) {
						var u = i.prototype.getUrl(s, c, l);
						if (u) o.pushQueue(u);
						else if (d) for (var f = 0; s > f; f++) o.pushQueue(d);
						if (t.resolve(), e.fire(a.CHECK_USER_IS_BAN, r.useFullData.senderId)) return;
						n()
					}
					return t.name = "rocket", t
				}, this.queue.addJob(s)
			}, i.prototype.getUrl = function(e, t, i) {
				for (var a = "", n = 0; n < t.length; n++) parseInt(e, 10) >= parseInt(t[n], 10) && (a = t[n]);
				var s = i[a] ? i[a].barrage_effect : "";
				return s = s.replace(/https?:/, "")
			}, i
		}(s);
	return {
		RocketSmallView: l,
		RocketBigView: c
	}
}), define("douyu/page/room/normal/mod/gift/controller/rocket", ["shark/observer", "douyu/page/room/normal/mod/gift/base/view", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/base/queue", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/view/rocket"], function(e, t, i, a, n, s) {
	var r = function(e) {
			function t(t, i) {
				e.call(this, t, i) || this
			}
			return i(t, e), t
		}(t),
		o = new s.RocketSmallView,
		l = new s.RocketBigView({
			chatBox: $("#js-chat-cont")
		});
	return e.on(n.RAISE_UP, function(e, t) {
		l.render(e, t)
	}), e.on(n.RAISE_SMALL_UP, function(e, t) {
		o.render(e, t)
	}), r
}), define("douyu/page/room/normal/mod/gift/controller/batch", ["shark/observer", "douyu/page/room/normal/mod/gift/base/view", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/base/queue", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/view/batch"], function(e, t, i, a, n, s) {
	var r = function(e) {
			function t(t, i) {
				e.call(this, t, i) || this
			}
			return i(t, e), t
		}(t),
		o = new s.BatchSmallView,
		l = new s.BatchBigView({
			chatBox: $("#js-chat-cont")
		});
	return e.on(n.BATCH_UP, function(e, t) {
		l.render(e, t)
	}), e.on(n.BATCH_SMALL_UP, function(e, t) {
		o.render(e, t)
	}), r
}), define("douyu/page/room/normal/mod/gift/view/banner", ["jquery", "shark/observer", "douyu/context", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/base/view", "shark/util/lang/1.0", "shark/util/template/2.0"], function(e, t, i, a, n, s, r, o) {
	var l = ({
		isIE: navigator.appVersion.indexOf("MSIE") > 0 || navigator.appVersion.indexOf("Trident/7.0") > 0,
		isFF: navigator.userAgent.indexOf("Firefox") > 0
	}, function(n) {
		function s(a) {
			var s = n.call(this, a) || this;
			return s.target = a.bannerBox, s.drawBanner = o.compile(r), s.bannerList = [], s.isTimerRunning = !1, s.defaultUsedHeight = 45, s.usedHeight = s.defaultUsedHeight, s.defaultChannelsLen = 4, s.maxChannelsLen = s.defaultChannelsLen, s.currentUid = i.get("sys.uid"), s.defaultBanner = [i.get("sys.web_url") + "/app/douyu/res/page/room-normal/gift/banner/banner1.png?v=20180712", i.get("sys.web_url") + "/app/douyu/res/page/room-normal/gift/banner/banner2.png?v=20180712", i.get("sys.web_url") + "/app/douyu/res/page/room-normal/gift/banner/banner3.png?v=20180712"], s.createDom = function(t, i, a, n) {
				var r = s.drawBanner({
					data: t,
					hitTimesArray: i,
					gfcntArray: a,
					bcntArray: n
				}),
					o = e(r);
				return s.target.append(o), o
			}, this.getBannerId = function(e) {
				return "banner-" + e.senderId + "-" + e.giftId
			}, s.sort = function(e, t) {
				e.sort(function(e, i) {
					var a, n = t ? e.bannerData : e,
						s = t ? i.bannerData : i,
						r = n.contribution * (n.gfcnt || 1),
						o = s.contribution * (s.gfcnt || 1),
						l = n.gfcnt > 1 ? n.bcnt : n.hitTimes,
						c = s.gfcnt > 1 ? s.bcnt : s.hitTimes;
					return r !== o ? a = o - r : l !== c ? a = c - l : n.createTime !== s.createTime && (a = s.createTime - n.createTime), a
				})
			}, this.isSubscribedLayout || (t.on("mod.chat.gift.layout", function() {
				var t = 0,
					i = 0,
					a = s.bannerList,
					n = a.length,
					r = s.defaultChannelsLen;
				if (s.totalHeight = e("#js-chat-cont").height() - s.defaultUsedHeight, !(s.totalHeight <= 0) && (s.maxChannelsLen = Math.floor(s.totalHeight / 100), s.maxChannelsLen = s.maxChannelsLen > r ? r : s.maxChannelsLen, i = n - s.maxChannelsLen, i > 0)) for (; i > t; t++) s.destroyBanner(a.length - 1)
			}), this.isSubscribedLayout = !0), s
		}
		var r = ['{{ if data.effectType === "noble" }}', '<div id="banner-{{ data.senderId }}-{{ data.giftId }}" class="noble-banner-item item-{{ data.styleNumber }}">', '<div class="item-back">', '<img src="{{ data.bannerBgImg }}">', "</div>", '<div class="item-head">', '<img src="{{ data.bannerGiftImg }}">', "</div>", '<div class="item-name">', '<span class="item-name-inner" title="{{ data.senderName }}">{{ data.senderName }}</span>', "</div>", '<div class="item-action-wrap clearfix">', '<span class="item-action fl">开通</span>', '<span class="noble-name fr">{{ data.giftName }}</span>', "</div>", "</div>", "{{ else }}", "{{ if (data.bannerPrice === 0) }}", '<div id="banner-{{ data.senderId }}-{{ data.giftId }}" class="normal-gift-banner">', "{{ else if (data.bannerPrice === 1) }}", '<div id="banner-{{ data.senderId }}-{{ data.giftId }}" class="normal-gift-banner middle-gift-banner">', "{{ else if (data.bannerPrice === 2) }}", '<div id="banner-{{ data.senderId }}-{{ data.giftId }}" class="normal-gift-banner big-gift-banner">', "{{ /if }}", '<img class="gift-banner-bg js-bannerbg" src="{{data.bannerBatchBgImg}}?v=20180614">', '<div class="gift-banner-info">', '<h4 style="color:{{ data.nickNameColor }}">{{ data.senderName }}</h4>', '<p style="color:{{ data.otherColor }}">送出 <span style="color:{{ data.giftNameColor }}">{{ data.giftName }}</span></p>', "</div>", '<div class="gift-banner-img" style="border-color:{{ data.bannerGiftBorderColor }};"><img src="{{ data.bannerGiftImg }}?v=20180614"></div>', '<div class="multiple-num-s js-counts">', "{{ if (data.gfcnt > 1) }}", '<span class="multiple-num-x"></span>', '<div class="multiple-nums">', "{{ each gfcntArray as item }}", '<span class="multiple-num-{{ item }}"></span>', "{{ /each }}", "</div>", "{{ /if }}", "</div>", '<div class="multiple-num-l js-hittimes">', "{{ if (data.gfcnt > 1 && bcntArray.length > 0) }}", '<span class="multiple-num-x"></span>', '<div class="multiple-nums">', "{{ each bcntArray as item }}", '<span class="multiple-num-{{ item }}"></span>', "{{ /each }}", "</div>", "{{ else if (hitTimesArray.length > 0)}}", '<span class="multiple-num-x"></span>', '<div class="multiple-nums">', "{{ each hitTimesArray as item }}", '<span class="multiple-num-{{ item }}"></span>', "{{ /each }}", "</div>", "{{ /if }}", "</div>", "{{ if (data.stage && data.senderFansname && data.richManGiftList[data.giftId]) }}", "{{ if (data.bannerPrice === 0) }}", '<div class="gift-banner-fans js-from-fans">来自【{{ data.senderFansname }}】粉丝团</div>', "{{ else if (data.bannerPrice === 1) }}", '<div class="gift-banner-fans medium js-from-fans">来自【{{ data.senderFansname }}】粉丝团</div>', "{{ else if (data.bannerPrice === 2) }}", '<div class="gift-banner-fans big js-from-fans">来自【{{ data.senderFansname }}】粉丝团</div>', "{{ /if }}", "{{ /if }}", "</div>", "{{ /if }}"].join("");
		return a(s, n), s.prototype.render = function(t, i) {
			var a, n = this,
				r = n.bannerList,
				o = "",
				l = 0,
				c = null,
				d = +new Date,
				u = n.defaultChannelsLen;
			if (n.totalHeight = e("#js-chat-cont").height() - n.defaultUsedHeight, !(n.totalHeight <= 0)) {
				if (n.maxChannelsLen = Math.floor(n.totalHeight / 100), n.maxChannelsLen = n.maxChannelsLen > u ? u : n.maxChannelsLen, t instanceof Array) return n.showBannerList(t), n.isTimerRunning || n.runExpireTimer(), n;
				for (a = t.useFullData, o = n.getBannerId(a); l < r.length; l++) if (o === r[l].bannerId) {
					c = r[l];
					break
				}
				if (c) {
					var f = c.bannerData.gfcnt == a.gfcnt,
						p = a.threshold || [],
						m = a.bannerSrc || [],
						h = a.price * (a.gfcnt || 1),
						g = s.prototype.getPriceIndex(h, p) || 0,
						v = a.batchTemp || {},
						y = a.batchNumArray || {},
						b = s.prototype.getBannerBgUrl(a.gfcnt || 1, y, v),
						k = b.bannerBgUrl,
						w = b.batchPriceIndex;
					k ? (a.bannerBatchBgImg = k, a.bannerPrice = w) : (a.bannerBatchBgImg = m[g] || n.defaultBanner[g], a.bannerPrice = g);
					var _ = c.bannerData.bannerPrice == a.bannerPrice && c.bannerData.bannerBatchBgImg == a.bannerBatchBgImg;
					return c.bannerData.bannerHeight = a.bannerHeight, c.bannerData.bannerPrice = a.bannerPrice, c.bannerData.hitTimes = a.hitTimes, c.bannerData.gfcnt = a.gfcnt, c.bannerData.bcnt = a.bcnt, c.bannerData.bannerBatchBgImg = a.bannerBatchBgImg, c.createTime = d, c.senderFansname = a.senderFansname, a.bst && 0 != a.bst && (a.bannerStayTime = 1e3 * a.bst), c.expireTime = d + (a.bannerStayTime || 0) + 300, n.sort(n.bannerList, 1), n.setHit(c, f, _, a), i(), n
				}
				return n.addBanner(a, 0, i), n.isTimerRunning || n.runExpireTimer(), n
			}
		}, s.prototype.addBanner = function(t, a, n) {
			var r, o, l, c = this,
				d = [],
				u = c.getBannerId(t),
				f = c.maxChannelsLen,
				p = [],
				m = [];
			t.gfcnt > 1 && (p = ("" + (t.gfcnt || 1)).split("") || [], m = ("" + (t.bcnt || 1)).split("") || []);
			var h = t.threshold || [],
				g = t.bannerSrc || [],
				v = t.price * (t.gfcnt || 1),
				r = s.prototype.getPriceIndex(v, h) || 0,
				y = t.batchTemp || {},
				b = t.batchNumArray || {},
				k = s.prototype.getBannerBgUrl(t.gfcnt || 1, b, y),
				w = k.bannerBgUrl,
				_ = k.batchPriceIndex;
			w ? (t.bannerBatchBgImg = w, t.bannerPrice = _) : (t.bannerBatchBgImg = g[r] || c.defaultBanner[r], t.bannerPrice = r);
			var x = ("" + (t.hitTimes || 1)).split(""),
				C = +new Date;
			t.bst && 0 != t.bst && (t.bannerStayTime = 1e3 * t.bst), o = {
				bannerId: u,
				bannerData: t,
				callback: n,
				createTime: C,
				expireTime: C + (t.bannerStayTime || 0) + 300
			}, a ? (l = c.createDom(t, x, p, m), l.css({
				top: c.usedHeight,
				left: 0
			}), c.usedHeight += t.bannerHeight + 13, o.$banner = l, c.bannerList.push(o)) : (d = c.bannerList.slice(0, f), d.unshift(o), c.sort(d, 1), d.length > f ? (d = d.slice(0, f), r = e.inArray(o, d), r > -1 ? (l = c.createDom(t, x, p, m), c.target.append(l), o.$banner = l, c.destroyBanner(f - 1), c.bannerList.unshift(o), c.sort(c.bannerList, 1), c.sortAnimate(o)) : t.senderId === i.get("sys.uid") ? (l = c.createDom(t, x, p, m), c.target.append(l), o.$banner = l, c.destroyBanner(f - 1, o), c.sort(c.bannerList, 1), c.sortAnimate(o)) : n && n()) : (l = c.createDom(t, x, p, m), c.target.append(l), o.$banner = l, c.bannerList.unshift(o), c.sort(c.bannerList, 1), c.sortAnimate(o)))
		}, s.prototype.showBannerList = function(t) {
			var i = this,
				a = i.maxChannelsLen;
			i.sort(t), e.each(t, function(e) {
				return e === a ? !1 : void i.addBanner(this, 1, null)
			})
		}, s.prototype.setHit = function(t, i, a, n) {
			var s = ("" + (t.bannerData.hitTimes || 1)).split(""),
				r = [];
			t.bannerData.gfcnt > 1 && (s = ("" + (t.bannerData.bcnt || 1)).split("") || [], r = ("" + (t.bannerData.gfcnt || 1)).split("") || []);
			var o = "",
				l = "",
				c = t.$banner,
				d = c.find(".js-hittimes").find(".multiple-nums"),
				u = c.find(".js-counts"),
				f = c.find(".js-bannerbg"),
				p = {
					scale: 3
				};
			e.each(s, function() {
				o += '<span class="multiple-num-' + this + '"></span>'
			}), t.bannerData.gfcnt > 1 ? (l += '<span class="multiple-num-x"></span>', e.each(r, function() {
				l += '<span class="multiple-num-' + this + '"></span>'
			}), u.html(l)) : c.find(".js-counts").empty(), i ? d.html(o).stop(!0).animate(p, {
				duration: 160,
				step: function(e, t) {
					d.css("transform", "scale(" + (1 + e / 10) + ")"), e == p.scale && (t.now = 0)
				},
				complete: function() {
					d.animate(p, {
						duration: 100,
						step: function(e, t) {
							d.css("transform", "scale(" + (1 + (p.scale - e) / 10) + ")"), e == p.scale && (t.now = 0)
						},
						complete: function() {
							d.removeAttr("style")
						}
					})
				}
			}) : (d.html(o), a || (0 == n.bannerPrice ? (c.removeClass("middle-gift-banner"), c.removeClass("big-gift-banner")) : 1 == n.bannerPrice ? (c.addClass("middle-gift-banner"), c.removeClass("big-gift-banner")) : 2 == n.bannerPrice && (c.removeClass("middle-gift-banner"), c.addClass("big-gift-banner")), f.attr("src", n.bannerBatchBgImg + "?v=20180614"))), n.senderFansname ? c.find(".js-from-fans").html("来自【" + t.senderFansname + "】粉丝团").removeClass("hide") : c.find(".js-from-fans").html("").addClass("hide"), this.sortAnimate()
		}, s.prototype.sortAnimate = function(t) {
			var i = this.defaultUsedHeight,
				a = t && t.bannerId;
			e.each(this.bannerList, function() {
				var e = this.$banner;
				a === this.bannerId ? e.css("top", i).animate({
					left: 0
				}, 300, function() {
					var e = t.callback;
					e && e(), t.callback = null
				}) : e.stop(!0, !0).animate({
					top: i
				}, 300), i += this.bannerData.bannerHeight + 13
			})
		}, s.prototype.runExpireTimer = function() {
			function t() {
				e.each(i.bannerList, function(e) {
					var t = +new Date;
					t >= this.expireTime && (i.destroyBanner(e), i.sortAnimate())
				}), i.bannerList.length > 0 ? setTimeout(function() {
					t()
				}, 1e3) : i.isTimerRunning = !1
			}
			var i = this;
			i.isTimerRunning = !0, t()
		}, s.prototype.destroyBanner = function(e, t) {
			var i = this,
				a = i.bannerList[e],
				n = a.$banner,
				s = a.callback;
			n && (i.usedHeight -= a.bannerData.bannerHeight + 13, n.finish().remove(), s && (s(), a.callback = null)), t ? i.bannerList.splice(e, 1, t) : i.bannerList.splice(e, 1)
		}, s.prototype.clearBaned = function(e) {
			for (var t, i, a = this, n = a.bannerList, s = 0, r = n.length; r > s; s++) t = n[s] || {}, i = t.bannerData || {}, i && i.senderId && +i.senderId === +e && this.destroyBanner(s)
		}, s.prototype.getPriceIndex = function(e, t) {
			for (var i = 0, a = 0; a < t.length; a++) parseInt(e, 10) >= parseInt(t[a], 10) && (i = a + 1);
			return i
		}, s.prototype.getBannerBgUrl = function(e, t, i) {
			for (var a = "", n = 0, s = 0; s < t.length; s++) parseInt(e, 10) >= parseInt(t[s], 10) && (a = t[s]);
			var r = i[a] ? i[a].bimg_effect : "",
				o = i[a] ? i[a].bimg_lv : 0;
			return 1 == o ? n = 0 : 2 == o ? n = 1 : 3 == o && (n = 2), {
				bannerBgUrl: r,
				batchPriceIndex: n
			}
		}, s
	}(s));
	return l
}), define("douyu/page/room/normal/mod/gift/controller/plane", ["shark/observer", "douyu/page/room/normal/mod/gift/base/view", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/base/queue", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/view/plane"], function(e, t, i, a, n, s) {
	var r = function(e) {
			function t(t, i) {
				e.call(this, t, i) || this
			}
			return i(t, e), t
		}(t),
		o = new s.PlaneSmallView,
		l = new s.PlaneBigView({
			chatBox: $("#js-chat-cont")
		});
	return e.on(n.PLANE_UP, function(e, t) {
		l.render(e, t)
	}), e.on(n.PLANE_SMALL_UP, function(e, t) {
		o.render(e, t)
	}), r
}), define("douyu/page/room/normal/mod/gift/controller/commonfly", ["shark/observer", "douyu/page/room/normal/mod/gift/base/view", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/base/queue", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/view/commonfly"], function(e, t, i, a, n, s) {
	var r = function(e) {
			function t(t, i) {
				e.call(this, t, i) || this
			}
			return i(t, e), t
		}(t),
		o = new s.CommonSmallView,
		l = new s.CommonBigView({
			chatBox: $("#js-chat-cont")
		});
	return e.on(n.COMMON_UP, function(e, t) {
		l.render(e, t)
	}), e.on(n.COMMON_SMALL_UP, function(e, t) {
		o.render(e, t)
	}), r
}), define("douyu/page/room/normal/mod/gift/controller/super", ["shark/observer", "douyu/page/room/normal/mod/gift/base/view", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/base/queue", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/view/super"], function(e, t, i, a, n, s) {
	var r = function(e) {
			function t(t, i) {
				e.call(this, t, i) || this
			}
			return i(t, e), t
		}(t),
		o = new s.SuperSmallView({
			chatBox: $("#js-chat-cont"),
			videoBox: $("#js-room-video")
		}),
		l = new s.SuperBigView({
			chatBox: $("#js-chat-cont"),
			videoBox: $("#js-room-video")
		});
	return e.on(n.SUPER_UP, function(e, t) {
		l.render(e, t)
	}), e.on(n.SUPER_SMALL_UP, function(e, t) {
		o.render(e, t)
	}), r
}), define("douyu/page/room/normal/mod/gift/controller/open-noble", ["shark/observer", "douyu/page/room/normal/mod/gift/base/view", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/base/queue", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/view/open-noble"], function(e, t, i, a, n, s) {
	var r = function(e) {
			function t(t, i) {
				e.call(this, t, i) || this
			}
			return i(t, e), t
		}(t),
		o = new s.OpenNobleView({
			chatBox: $("#js-chat-cont")
		});
	return e.on(n.OPEN_NOBLE, function(e, t) {
		o.render(e, t)
	}), r
}), define("douyu/page/room/normal/mod/gift/controller/banner", ["shark/observer", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/constants"], function(e, t, i) {
	var a = function() {
			function t() {
				this.bannerList = []
			}
			return t.prototype.add = function(t, a) {
				e.trigger(i.BANNER_VIEW, t, a)
			}, t
		}();
	return a
}), define("douyu/page/room/normal/mod/gift/model/banner", ["shark/observer", "douyu/context", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/base/model"], function(e, t, i, a) {
	var n = 0,
		s = {};
	e.on("room.activity.richman.stage", function(e) {
		n = e.stage || 0, s = e.giftList || {}
	});
	var r = {
		timeTransform: function(e) {
			return 1e3 * e
		}
	},
		o = function(e) {
			function a(i, o, l) {
				var c = [54, 76, 88],
					d = {
						7: 78,
						1: 96,
						2: 106,
						3: 106,
						4: 106,
						5: 106,
						6: 106
					},
					u = e.call(this, i, o) || this,
					f = l,
					p = {};
				if (f) {
					var m = f.room || {},
						h = f.tag || {},
						g = f["default"] || {},
						v = t.get("room.room_id"),
						y = t.get("room.cate_id");
					m[v] ? p = m[v] || {} : h[y] ? p = h[y] || {} : g && (p = g || {})
				}
				return u.backendModelMap = $.extend({
					stage: function() {
						return n
					},
					richManGiftList: function() {
						return s
					},
					senderFansname: function(e) {
						var t = "";
						return e.bnn && (t = e.bnn), t
					},
					senderId: "uid",
					senderName: "nn",
					senderAvatar: function(e) {
						var i = e.ic;
						return i ? t.get("sys.avatar_url") + "upload/" + i + "_small.jpg" : t.get("sys.web_url") + "app/douyu/res/com/defaultAvatar.png"
					},
					giftId: "gfid",
					hitTimes: function(e) {
						return e.hits > 0 ? e.hits : 1
					},
					gfcnt: function(e) {
						return e.gfcnt > 0 ? e.gfcnt : 1
					},
					bcnt: function(e) {
						return e.bcnt > 0 ? e.bcnt : 0
					},
					threshold: function(e) {
						if (!f || !f.threshold) return null;
						var t = o.type;
						return 1 == t ? f.threshold.ywsw : 2 == t ? f.threshold.ycsw : void 0
					},
					bannerSrc: function() {
						return p.src || []
					},
					nickNameColor: function() {
						return p.nc ? "#" + p.nc : "#ffffff"
					},
					giftNameColor: function() {
						return p.gnc ? "#" + p.gnc : "#ffffff"
					},
					otherColor: function() {
						return p.oc ? "#" + p.oc : "#ffffff"
					},
					bst: function(e) {
						return e.bst > 0 ? e.bst : 0
					},
					styleNumber: "gs",
					bannerHeight: function(e) {
						if ("noble" === e.effectType) return d[e.gs];
						var t = 0;
						if (f && f.threshold) {
							var i = o.type;
							1 == i ? t = f.threshold.ywsw : 2 == i && (t = f.threshold.ycsw)
						}
						var n = e.gfcnt > 0 ? e.gfcnt : 1,
							s = o.pc * (n || 1),
							r = a.prototype.getPriceIndex(s, t) || 0;
						return c[r]
					},
					className: function(e) {
						return "banner-style-" + e.gs
					},
					anchorWeight: "dw",
					senderIcon: "ic",
					senderLv: "level",
					giftBoxId: function(e) {
						return e.rpid || e.rpidn
					},
					pecktype: function(e) {
						return void 0 !== e.rpt ? parseInt(e.rpt, 10) : 0
					},
					danmucontent: function(e) {
						return e.dct || ""
					},
					surplusTime: function(e) {
						return r.timeTransform(e.slt ? parseInt(e.slt, 10) : 0)
					},
					endTime: function(e) {
						return r.timeTransform(e.elt ? parseInt(e.elt, 10) : 0)
					},
					delayTime: function() {
						return 1e3 * (Math.floor(5 * Math.random()) + 1)
					},
					treasureImg: function(e) {
						var i = o,
							a = t.get("sys.web_url") + "app/douyu/res/page/room-normal/gift/peck-close.png?v=20170922";
						return e.gfid && i && i.gift_icon ? i.gift_icon : a
					},
					treasureOpenedImg: function(e) {
						var i = o,
							a = t.get("sys.web_url") + "app/douyu/res/page/room-normal/gift/peck-open.png?v=20170922";
						return e.gfid && i && i.gift_open_icon ? i.gift_open_icon : a
					},
					openNobleAvatar: "openNobleAvatar"
				}, o), u.fromBackendModel(i), u
			}
			return i(a, e), a.prototype.getPriceIndex = function(e, t) {
				for (var i = 0, a = 0; a < t.length; a++) parseInt(e, 10) >= parseInt(t[a], 10) && (i = a + 1);
				return i
			}, a
		}(a);
	return o
}), define("douyu/page/room/normal/mod/gift/chainManager", ["douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/controller/banner"], function(e, t) {
	var i = function() {
			function e(e) {
				this.gift = null, this.nextManager = null, this.stepPool = e
			}
			return e.prototype.goNext = function(e) {
				if (!e) throw new Error("没有礼物被处理");
				this.nextManager.applyGift(e)
			}, e.prototype.applyGift = function(e) {
				this.validGift(e), this.handleGift(e)
			}, e.prototype.validGift = function(e) {}, e.prototype.handleGift = function() {
				throw new Error("子类必须实现该方法");
			}, e.prototype.setNextManager = function(e) {
				return this.nextManager = e, this.nextManager
			}, e
		}(),
		a = function(i) {
			function a(e) {
				return i.call(this, e) || this
			}
			return e(a, i), a.prototype.handleGift = function(e) {
				this.goNext(e)
			}, a.prototype.toString = function() {
				return t.GIFT_BEGIN
			}, a
		}(i),
		n = function(t) {
			function i(e) {
				return t.call(this, e) || this
			}
			return e(i, t), i.prototype.handleGift = function(e) {
				var t = this;
				this.stepPool.add(e, function() {
					t.goNext(e)
				})
			}, i
		}(i);
	n.toString = function() {
		return t.RAISE_SMALL_UP
	};
	var s = function(t) {
			function i(e) {
				return t.call(this, e) || this
			}
			return e(i, t), i.prototype.handleGift = function(e) {
				var t = this;
				this.stepPool.add(e, function() {
					t.goNext(e)
				})
			}, i
		}(i);
	s.toString = function() {
		return t.RAISE_UP
	};
	var r = function(t) {
			function i(e) {
				return t.call(this, e) || this
			}
			return e(i, t), i.prototype.handleGift = function(e) {
				var t = this;
				this.stepPool.add(e, function() {
					t.goNext(e)
				})
			}, i
		}(i);
	r.toString = function() {
		return t.BATCH_SMALL_UP
	};
	var o = function(t) {
			function i(e) {
				return t.call(this, e) || this
			}
			return e(i, t), i.prototype.handleGift = function(e) {
				var t = this;
				this.stepPool.add(e, function() {
					t.goNext(e)
				})
			}, i
		}(i);
	o.toString = function() {
		return t.BATCH_UP
	};
	var l = function(t) {
			function i(e) {
				return t.call(this, e) || this
			}
			return e(i, t), i.prototype.handleGift = function(e) {
				var t = this;
				this.stepPool.add(e, function() {
					t.goNext(e)
				})
			}, i
		}(i);
	l.toString = function() {
		return t.PLANE_SMALL_UP
	};
	var c = function(t) {
			function i(e) {
				return t.call(this, e) || this
			}
			return e(i, t), i.prototype.handleGift = function(e) {
				var t = this;
				this.stepPool.add(e, function() {
					t.goNext(e)
				})
			}, i
		}(i);
	c.toString = function() {
		return t.PLANE_UP
	};
	var d = function(t) {
			function i(e) {
				return t.call(this, e) || this
			}
			return e(i, t), i.prototype.handleGift = function(e) {
				var t = this;
				this.stepPool.add(e, function() {
					t.goNext(e)
				})
			}, i
		}(i);
	d.toString = function() {
		return t.COMMON_SMALL_UP
	};
	var u = function(t) {
			function i(e) {
				return t.call(this, e) || this
			}
			return e(i, t), i.prototype.handleGift = function(e) {
				var t = this;
				this.stepPool.add(e, function() {
					t.goNext(e)
				})
			}, i
		}(i);
	u.toString = function() {
		return t.COMMON_UP
	};
	var f = function(t) {
			function i(e) {
				return t.call(this, e) || this
			}
			return e(i, t), i.prototype.handleGift = function(e) {
				var t = this;
				this.stepPool.add(e, function() {
					t.goNext(e)
				})
			}, i
		}(i);
	f.toString = function() {
		return t.SUPER_SMALL_UP
	};
	var p = function(t) {
			function i(e) {
				return t.call(this, e) || this
			}
			return e(i, t), i.prototype.handleGift = function(e) {
				var t = this;
				this.stepPool.add(e, function() {
					t.goNext(e)
				})
			}, i
		}(i);
	p.toString = function() {
		return t.SUPER_UP
	};
	var m = function(t) {
			function i(e) {
				return t.call(this, e) || this
			}
			return e(i, t), i.prototype.handleGift = function(e) {
				var t = this;
				this.stepPool.add(e, function() {
					t.goNext(e)
				})
			}, i
		}(i);
	m.toString = function() {
		return t.BANNER
	};
	var h = function(t) {
			function i(e) {
				return t.call(this, e) || this
			}
			return e(i, t), i.prototype.handleGift = function(e) {
				var t = this;
				this.stepPool.add(e, function() {
					t.goNext(e)
				})
			}, i
		}(i);
	h.toString = function() {
		return t.DROP_DOWN
	};
	var g = function(t) {
			function i(e) {
				return t.call(this, e) || this
			}
			return e(i, t), i.prototype.handleGift = function(e) {
				var t = this;
				this.stepPool.add(e, function() {
					t.goNext(e)
				})
			}, i
		}(i);
	g.toString = function() {
		return t.TREASURE_BOX
	};
	var v = function(t) {
			function i(e) {
				return t.call(this, e) || this
			}
			return e(i, t), i.prototype.handleGift = function(e) {
				var t = this;
				this.stepPool.add(e, function() {
					t.goNext(e)
				})
			}, i
		}(i);
	v.toString = function() {
		return t.OPEN_NOBLE
	};
	var y = function(t) {
			function i(e) {
				return t.call(this, e) || this
			}
			return e(i, t), i.prototype.handleGift = function(e) {}, i
		}(i);
	return {
		StartManager: a,
		RaiseSmallUpManager: n,
		RaiseUpManager: s,
		BatchSmallUpManager: r,
		BatchUpManager: o,
		PlaneSmallUpManager: l,
		PlaneUpManager: c,
		CommonSmallUpManager: d,
		CommonUpManager: u,
		SuperSmallUpManager: f,
		SuperUpManager: p,
		BannerManager: m,
		DropDownManager: h,
		TreasureBoxManager: g,
		OpenNobleManager: v,
		EndManager: y
	}
}), define("douyu/page/room/normal/mod/gift/model/models", ["douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/model/banner", "douyu/page/room/normal/mod/gift/model/commonmodel", "douyu/page/room/normal/mod/gift/model/treasure"], function(e, t, i, a) {
	return {
		Banner: t,
		Commonmodel: i,
		TreasureModel: a
	}
}), define("douyu/page/room/normal/mod/gift/stepPool", ["shark/observer", "douyu/page/room/normal/mod/gift/base/extends", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/base/queue", "douyu/page/room/normal/mod/gift/controller/banner"], function(e, t, i, a, n) {
	var s = new n($(".chat-cont-wrap")),
		r = function() {
			function e() {
				this.pool = [], this.isComsuming = !1
			}
			return e.prototype.handle = function() {
				throw new Error("子类必须实现该方法")
			}, e.prototype.add = function(e, t) {
				this.pool.push({
					gift: e,
					callback: t
				}), this.isComsuming || this.consume(e, t)
			}, e.prototype.consume = function() {
				this.isComsuming = !0;
				for (var e; e = this.pool.shift();) this.handle(e.gift, e.callback);
				this.isComsuming = !1
			}, e
		}(),
		o = function(n) {
			function s() {
				var e = n.call(this) || this;
				return e.raiseSmallUpBlock = null, e.chatbox = null, e.queue = new a, e.queue.run(), e.num = 0, e
			}
			return t(s, n), s.prototype.handle = function(t, a) {
				e.trigger(i.RAISE_SMALL_UP, t, function() {
					a()
				})
			}, s
		}(r);
	o.getInstance = function() {
		return o.pool || (o.pool = new o), o.pool
	}, o.toString = function() {
		return i.RAISE_SMALL_UP
	};
	var l = function(n) {
			function s() {
				var e = n.call(this) || this;
				return e.raiseUpBlock = null, e.chatbox = null, e.queue = new a, e.queue.run(), e
			}
			return t(s, n), s.prototype.handle = function(t, a) {
				e.trigger(i.RAISE_UP, t, function() {
					a()
				})
			}, s
		}(r);
	l.getInstance = function() {
		return l.pool || (l.pool = new l), l.pool
	}, l.toString = function() {
		return i.RAISE_UP
	};
	var c = function(n) {
			function s() {
				var e = n.call(this) || this;
				return e.BatchSmallUpBlock = null, e.chatbox = null, e.queue = new a, e.queue.run(), e.num = 0, e
			}
			return t(s, n), s.prototype.handle = function(t, a) {
				e.trigger(i.BATCH_SMALL_UP, t, function() {
					a()
				})
			}, s
		}(r);
	c.getInstance = function() {
		return c.pool || (c.pool = new c), c.pool
	}, c.toString = function() {
		return i.BATCH_SMALL_UP
	};
	var d = function(n) {
			function s() {
				var e = n.call(this) || this;
				return e.BatchUpBlock = null, e.chatbox = null, e.queue = new a, e.queue.run(), e
			}
			return t(s, n), s.prototype.handle = function(t, a) {
				e.trigger(i.BATCH_UP, t, function() {
					a()
				})
			}, s
		}(r);
	d.getInstance = function() {
		return d.pool || (d.pool = new d), d.pool
	}, d.toString = function() {
		return i.BATCH_UP
	};
	var u = function(n) {
			function s() {
				var e = n.call(this) || this;
				return e.planeSmallUpBlock = null, e.chatbox = null, e.queue = new a, e.queue.run(), e
			}
			return t(s, n), s.prototype.handle = function(t, a) {
				e.trigger(i.PLANE_SMALL_UP, t, function() {
					a()
				})
			}, s
		}(r);
	u.getInstance = function() {
		return u.pool || (u.pool = new u), u.pool
	}, u.toString = function() {
		return i.PLANE_SMALL_UP
	};
	var f = function(n) {
			function s() {
				var e = n.call(this) || this;
				return e.planeUpBlock = null, e.chatbox = null, e.queue = new a, e.queue.run(), e
			}
			return t(s, n), s.prototype.handle = function(t, a) {
				e.trigger(i.PLANE_UP, t, function() {
					a()
				})
			}, s
		}(r);
	f.getInstance = function() {
		return f.pool || (f.pool = new f), f.pool
	}, f.toString = function() {
		return i.PLANE_UP
	};
	var p = function(n) {
			function s() {
				var e = n.call(this) || this;
				return e.commonSmallUpBlock = null, e.chatbox = null, e.queue = new a, e.queue.run(), e
			}
			return t(s, n), s.prototype.handle = function(t, a) {
				e.trigger(i.COMMON_SMALL_UP, t, function() {
					a()
				})
			}, s
		}(r);
	p.getInstance = function() {
		return p.pool || (p.pool = new p), p.pool
	}, p.toString = function() {
		return i.COMMON_SMALL_UP
	};
	var m = function(n) {
			function s() {
				var e = n.call(this) || this;
				return e.commonUpBlock = null, e.chatbox = null, e.queue = new a, e.queue.run(), e
			}
			return t(s, n), s.prototype.handle = function(t, a) {
				e.trigger(i.COMMON_UP, t, function() {
					a()
				})
			}, s
		}(r);
	m.getInstance = function() {
		return m.pool || (m.pool = new f), m.pool
	}, m.toString = function() {
		return i.COMMON_UP
	};
	var h = function(n) {
			function s() {
				var e = n.call(this) || this;
				return e.commonSmallUpBlock = null, e.chatbox = null, e.queue = new a, e.queue.run(), e
			}
			return t(s, n), s.prototype.handle = function(t, a) {
				e.trigger(i.SUPER_SMALL_UP, t, function() {
					a()
				})
			}, s
		}(r);
	h.getInstance = function() {
		return h.pool || (h.pool = new h), h.pool
	}, h.toString = function() {
		return i.SUPER_SMALL_UP
	};
	var g = function(n) {
			function s() {
				var e = n.call(this) || this;
				return e.commonUpBlock = null, e.chatbox = null, e.queue = new a, e.queue.run(), e
			}
			return t(s, n), s.prototype.handle = function(t, a) {
				e.trigger(i.SUPER_UP, t, function() {
					a()
				})
			}, s
		}(r);
	g.getInstance = function() {
		return g.pool || (g.pool = new g), g.pool
	}, g.toString = function() {
		return i.SUPER_UP
	};
	var v = function(e) {
			function i() {
				return e.call(this) || this
			}
			return t(i, e), i.prototype.handle = function(e, t) {
				var i = this;
				s.add(e, function() {
					t.apply(i)
				})
			}, i
		}(r);
	v.getInstance = function() {
		return v.pool || (v.pool = new v), v.pool
	}, v.toString = function() {
		return i.BANNER
	};
	var y = function(a) {
			function n() {
				return a.call(this) || this
			}
			return t(n, a), n.prototype.handle = function(t, a) {
				e.trigger(i.DROP_DOWN_VIEW, t, function() {
					a()
				})
			}, n
		}(r);
	y.getInstance = function() {
		return y.pool || (y.pool = new y), y.pool
	}, y.toString = function() {
		return i.DROP_DOWN
	};
	var b = function(a) {
			function n() {
				return a.call(this) || this
			}
			return t(n, a), n.prototype.consume = function(t, a) {
				e.trigger(i.TREASURE_BOX_VIEW, t, function() {
					a()
				})
			}, n
		}(r);
	b.getInstance = function() {
		return b.pool || (b.pool = new b), b.pool
	}, b.toString = function() {
		return i.TREASURE_BOX
	};
	var k = function(a) {
			function n() {
				return a.call(this) || this
			}
			return t(n, a), n.prototype.consume = function(t, a) {
				e.trigger(i.OPEN_NOBLE, t, function() {
					a()
				})
			}, n
		}(r);
	return k.getInstance = function() {
		return k.pool || (k.pool = new k), k.pool
	}, k.toString = function() {
		return i.OPEN_NOBLE
	}, {
		RaiseSmallUpPool: o,
		RaiseUpPool: l,
		BatchSmallUpPool: c,
		BatchUpPool: d,
		PlaneSmallUpPool: u,
		PlaneUpPool: f,
		CommonSmallUpPool: p,
		CommonUpPool: m,
		SuperSmallUpPool: h,
		SuperUpPool: g,
		BannerPool: v,
		DropDownPool: y,
		TreasureBoxPool: b,
		OpenNoblePool: k
	}
}), define("douyu/page/room/normal/mod/gift/view/views", ["shark/observer", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/controller/rocket", "douyu/page/room/normal/mod/gift/controller/batch", "douyu/page/room/normal/mod/gift/view/banner", "douyu/page/room/normal/mod/gift/controller/plane", "douyu/page/room/normal/mod/gift/controller/commonfly", "douyu/page/room/normal/mod/gift/controller/super", "douyu/page/room/normal/mod/gift/controller/open-noble"], function(e, t, i, a, n, s, r, o) {
	var l = $('<div class="giftbatter-box giftbatter-box2" style="overflow:visible"></div>');
	$("#js-chat-cont").append(l);
	var c = new n({
		bannerBox: l
	});
	e.on(t.GiFT_BANNER_LIST, function(e) {
		c.render(e)
	}), e.on(t.BANNER_VIEW, function(e, t) {
		c.render(e, t)
	}), e.on(t.GIFT_SENDER_IS_BAN, function(e) {
		c.clearBaned(e)
	})
}), define("douyu/page/room/normal/mod/gift/controller/treasure", ["jquery", "shark/observer", "shark/util/storage/1.0", "douyu/context", "douyu/com/user", "douyu/com/exjsonp", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/timer", "douyu/page/room/normal/mod/gift/controller/geetest", "douyu/page/room/normal/mod/gift/model/treasure", "douyu/page/room/normal/mod/gift/view/treasure"], function(e, t, i, a, n, s, r, o, l, c, d) {
	function u() {
		return s.load(a.get("sys.webconfUrl") + "resource/common/treasure/web.json", "treasureConfig", function(e) {
			m.resolve(e)
		}), m
	}
	var f, p, m = e.Deferred(),
		h = {},
		g = [],
		v = {},
		y = {},
		b = new o,
		k = d.init,
		w = d.drop,
		_ = d.load,
		x = d.conut,
		C = d.luckUser,
		T = d.bind;
	return k(), f = function() {
		this.timer = null, this.monitorQueue = [], this.isDispatcherRun = !1
	}, f.prototype.init = function(e) {
		var i = this,
			a = {};
		t.on("room.gift.treasure.data.entry", function(t) {
			u().done(function(n) {
				switch (i.treasureConfig = n, t.type) {
				case "tslist":
					i.entranceMsg(t.list, t.startTime, e);
					break;
				case "tsboxb":
					a = c.mapItem(t, n), a.isValid && i.monitorQueue.push(a), i.isDispatcherRun || (i.isDispatcherRun = !0, i.pollingMsgQueue(e))
				}
			})
		})
	}, f.prototype.entranceMsg = function(e, t, a) {
		var n = i.get("treasureHistory"),
			s = c.mapList(e, t, n, this.treasureConfig);
		this.monitorQueue = s, "function" == typeof a && (a(s, "Entrance"), this.monitorQueue = [])
	}, f.prototype.pollingMsgQueue = function(e) {
		var t = this,
			i = t.monitorQueue.length || 0,
			a = 0;
		i > 0 ? (a = parseInt(t.monitorQueue[0].effectTime, 10) || 0, clearTimeout(t.timer), t.timer = setTimeout(function() {
			"function" == typeof e && e(t.monitorQueue[0], "Polling"), t.monitorQueue.shift(), t.pollingMsgQueue(e)
		}, a)) : (t.isDispatcherRun = !1, clearTimeout(t.timer))
	}, p = new f, h = {
		formate: function(e) {
			var t, i;
			return e > 60 ? (t = parseInt(e / 60, 10).toString(), i = parseInt(e % 60, 10).toString()) : (t = "00", i = e.toString()), t = t.length > 1 ? t : "0" + t, i = i.length > 1 ? i : "0" + i, t + ":" + i
		}
	}, v = {
		init: function() {
			this.config = {
				initTime: (new Date).getTime(),
				banUserList: [],
				geeFn: null,
				isBindTipsShow: !1,
				isGeeBoxShow: !1,
				isSendRequest: !1,
				isPassGee: !0,
				isTreasureHover: !0,
				isPollingerRun: !1,
				isTrueasureDraw: !1
			}, this.doms = {
				$treasure: e("#treasure"),
				$geeContent: e("#geetest-box"),
				$chatContent: e("#js-chat-cont"),
				$page: e("#container")
			}, this.bindEvents(), this.regBindStatus(), this.regBanUser(), p.init(this.receiver.bind(this))
		},
		regBanUser: function() {
			var e = this,
				i = e.config;
			t.on(r.GIFT_SENDER_IS_BAN, function(t) {
				var a = 0,
					n = parseInt(t, 10);
				if (i.banUserList.push(n), i.banUserList.length && g.length) for (a; a < i.banUserList.length; a++) i.banUserList[a] === +g[0].senderUid && (e.rejectTreasureQueue(), e.showDrawTips(1, "Prohibition"))
			})
		},
		regBindStatus: function() {
			var e = this;
			t.on(r.IS_LOGIN_CONTROLLER, function(t) {
				e.config.bindStatus = t, e.handleBindTips(t), e.showBindTips()
			})
		},
		handleBindTips: function(e) {
			var t = this.doms;
			e > 0 && (t.$treasure.append(T({
				status: e
			})), t.$treasure.addClass("noBind"), t.$treasure.find(".peck-cdn").addClass("noBind"))
		},
		receiver: function(e, t) {
			var i = this.config;
			switch (t) {
			case "Polling":
				if (i.banUserList.indexOf(e.senderUid) >= 0) return;
				g.push(e), i.isPollingerRun || (i.isPollingerRun = !0, this.pollingFactory("Polling"));
				break;
			case "Entrance":
				g = e, i.isPollingerRun || (i.isPollingerRun = !0, this.pollingFactory("Entrance"))
			}
		},
		pollingFactory: function(e) {
			var t = this,
				i = g && g[0] || {},
				a = (new Date).getTime();
			return a >= i.destroyTime || !i.destroyTime ? void t.rejectTreasureQueue() : (t.config.isTrueasureDraw = !1, void w({
				item: i,
				type: e
			}, function() {
				t.loadNext()
			}))
		},
		loadNext: function() {
			var e = this,
				t = g.length,
				i = g[0];
			return i ? (e.config.isTrueasureDraw = !1, b.stop(), void _({
				item: i,
				queueLen: t
			}, function() {
				e.countDowner(i)
			})) : void e.rejectTreasureQueue()
		},
		countDowner: function(e) {
			var t = this,
				i = t.config,
				a = (new Date).getTime(),
				n = parseInt((e.destroyTime - a) / 1e3, 10),
				s = 0,
				r = 0,
				o = {};
			return 0 >= n ? void t.rejectTreasureQueue() : (i.isTrueasureDraw = !1, b.stop(), b.set(n), void b.decrease(0, 500, function() {
				s = (new Date).getTime(), r = parseInt((e.surplusTime - s) / 1e3, 10), r > 0 ? (o = {
					timeText: h.formate(r),
					queueLen: g.length,
					isDrawStatus: !1,
					treasureBg: e.treasureCloseBg,
					bindStatus: i.bindStatus
				}, x(o), i.isTrueasureDraw = !1) : (i.isTrueasureDraw = !0, o = {
					timeText: "领取",
					queueLen: g.length,
					isDrawStatus: !0,
					treasureBg: e.treasureOpenBg,
					finishDesc: e.finishDesc,
					bindStatus: i.bindStatus
				}, x(o))
			}, function() {
				i.isTrueasureDraw = !1, t.rejectTreasureQueue()
			}))
		},
		rejectTreasureQueue: function() {
			var t = (new Date).getTime(),
				i = this.config,
				a = {},
				n = 0;
			for (g.shift(), n; n < g.length; n++) a = g[n], i.banUserList.indexOf(a.senderUid) >= 0 ? (g.splice(n, 1), n--) : a && (t > a.destroyTime || !a.destroyTime) && (g.splice(n, 1), n--);
			g.length > 0 ? this.pollingFactory() : (b.stop(), this.doms.$treasure.hide(), this.doms.$treasure.find(".peck-num").hide(), this.toggleGeeView(0), i.isPassGee || this.showDrawTips(1, "Normal"), e.extend(!0, i, {
				isBindTipsShow: !1,
				isGeeBoxShow: !1,
				isSendRequest: !1,
				isPassGee: !0,
				isTreasureHover: !0,
				isPollingerRun: !1,
				isTrueasureDraw: !1
			}))
		},
		bindEvents: function() {
			this.preventScript(), this.drawTreasure(), this.toggleGeeEvent(), this.showSenderTips()
		},
		showBindTips: function() {
			var e = this.doms,
				t = e.$treasure.find(".peck-tips"),
				i = this.config;
			e.$treasure.on("click", ".peck-tips", function(e) {
				e.stopPropagation()
			}).on("click", function(e) {
				e.stopPropagation(), i.isBindTipsShow ? (t.fadeIn(400), i.isBindTipsShow = !1) : (t.fadeOut(400), i.isBindTipsShow = !0)
			}), e.$page.on("clcik", function() {
				t.stop(!0, !0).fadeOut(400)
			}), t.on("click", '[data-type="close"]', function(e) {
				e.preventDefault(), e.stopPropagation(), t.stop(!0, !0).fadeOut(400)
			})
		},
		showSenderTips: function() {
			var e = this,
				t = e.doms,
				i = t.$treasure.find(".peck-tip"),
				a = e.config;
			t.$treasure.on("mouseenter", function() {
				a.isGeeBoxShow || a.bindStatus > 0 || i.stop(!0, !0).fadeIn(400)
			}).on("mouseleave", function() {
				i.stop(!0, !0).fadeOut(400)
			})
		},
		preventScript: function() {
			var e = this,
				t = e.doms;
			t.$treasure.on({
				mouseenter: function() {
					e.config.isTreasureHover = !0
				},
				mouseleave: function() {
					e.config.isTreasureHover = !0
				}
			})
		},
		drawTreasure: function() {
			var e = this,
				t = e.doms,
				i = e.config,
				a = document.referrer.indexOf(location.host) > 0 ? 1 : 0,
				s = !1;
			t.$treasure.on("click", function() {
				var t = (new Date).getTime();
				if (!n.check()) return void n.show("login", {
					source: "click_ywbox_get"
				});
				if (i.isTrueasureDraw && !(i.bindStatus > 0)) return !a && t - i.initTime < 1e4 && !s ? (e.storeGetTreausre(), e.showDrawTips(1, "Normal"), e.rejectTreasureQueue(), void(s = !0)) : void(i.isPassGee ? i.isSendRequest || e.sendRequest() : e.toggleGeeView(1))
			})
		},
		sendRequest: function(t) {
			var i = this,
				n = i.config,
				s = g.length ? g[0] : {},
				r = e.extend(!0, {
					room_id: a.get("room.room_id"),
					device_id: a.get("room.device_id"),
					packerid: s.treasureId || 0,
					version: 1
				}, t);
			n.isSendRequest || (n.isSendRequest = !0, e.ajax({
				url: "/member/task/redPacketReceive",
				type: "POST",
				dataType: "json",
				data: r
			}).done(function(e) {
				n.isSendRequest = !1, i.handleDrawResult(e)
			}).fail(function() {
				n.isSendRequest = !1
			}))
		},
		handleDrawResult: function(e) {
			var t = this,
				i = e.geetest || {},
				a = t.config;
			1 === e.validate || -2 === parseInt(e.code, 10) ? 0 === parseInt(i.code, 10) ? (a.geeFn ? a.geeFn.refresh() : a.geeFn = l.init("#geetest-box", JSON.parse(i.validate_str), function(e) {
				t.sendRequest(e)
			}, function() {
				t.showDrawTips(1, "Normal")
			}), a.isPassGee = !1, t.toggleGeeView(1), t.doms.$treasure.find(".peck-tip").hide()) : (a.isPassGee = !0, t.storeGetTreausre(), t.showDrawTips(e, "Normal"), t.rejectTreasureQueue(), t.toggleGeeView(0)) : (a.isPassGee = !0, t.showDrawTips(e, "Normal"), t.storeGetTreausre(), t.rejectTreasureQueue(), t.toggleGeeView(0))
		},
		showDrawTips: function(i, a) {
			var n = "",
				s = this.doms,
				r = 0,
				o = "",
				l = [];
			switch (this.config.isPassGee = !0, e(".peck-back-tip") && e(".peck-back-tip").length ? e(".peck-back-tip").remove() : "", a) {
			case "Prohibition":
				n = e('<div class="peck-back-tip peck-back-error"><p><span>违禁行为宝箱已销毁</span></p></div>'), this.appendTips(n);
				break;
			case "Normal":
				if (0 !== parseInt(i.code, 10) || 0 === parseInt(i.silver, 10) && 0 === parseInt(i.prop_count, 10)) n = e('<div class="peck-back-tip peck-back-error"><p><span>运气不佳，宝箱已被洗劫一空T_T</span></p></div>'), this.appendTips(n);
				else if (2 === parseInt(i.award_type, 10)) n = e('<div class="peck-back-tip peck-back-success"><p><span>恭喜您，领取了</span><strong title="' + i.src_nick + '">' + i.src_nick + "</strong></p><p><span>派送的</span><strong>" + i.prop_count + "个" + i.prop_name + "</strong><span>~</span></p></div>"), this.appendTips(n),insertData(i);
				else if (parseInt(i.lk, 10)) e(".treasure-luckuser-tips") && e(".treasure-luckuser-tips").length ? e(".treasure-luckuser-tips").remove() : "", n = e('<div class="treasure-luckuser-tips"><span class="best"></span></div>'), s.$chatContent.append(n), n.delay(1500).fadeOut(400, function() {
					n.remove()
				});
				else if (parseInt(i.lt, 10) > 0) {
					for (e(".treasure-luckuser-tips") && e(".treasure-luckuser-tips").length ? e(".treasure-luckuser-tips").remove() : "", l = i.lt.toString().split(""), r; r < l.length; r++) o += '<span class="rate' + l[r] + '"></span>';
					n = e('<div class="treasure-luckuser-tips"><span class="bouns"></span><span class="multiply"></span>' + o + "</div>"), s.$chatContent.append(n), n.delay(1500).fadeOut(400, function() {
						n.remove()
					})
				} else n = e('<div class="peck-back-tip peck-back-success"><p><span>恭喜您，领取了</span><strong title="' + i.src_nick + '">' + i.src_nick + "</strong></p><p><span>派送的</span><strong>" + i.silver + "个鱼丸</strong><span>~</span></p></div></div>"), this.appendTips(n),insertData(i);
			}
			i.silver_balance && t.trigger("mod.userinfo.change", {
				current: {
					silver: i.silver_balance
				}
			})
		},
		appendTips: function(e) {
			var t = this.doms;
			t.$chatContent.append(e), e.fadeIn(400).delay(3e3).fadeOut(400, function() {
				e.remove()
			})
		},
		storeGetTreausre: function() {
			var e = i.get("treasureHistory") || [],
				t = g[0] ? g[0].treasureId : 0;
			t && (e.push(t), i.set("treasureHistory", e, 600))
		},
		toggleGeeEvent: function() {
			var e = this,
				t = e.doms;
			t.$treasure.on("click", '[data-geebox="off"]', function(t) {
				t.preventDefault(), t.stopPropagation(), e.toggleGeeView(0)
			})
		},
		toggleGeeView: function(e) {
			var t = this.config,
				i = this.doms;
			e ? (i.$geeContent.show(), t.isGeeBoxShow = !0) : (i.$geeContent.hide(), t.isGeeBoxShow = !1)
		}
	}, y = {
		init: function() {
			this.doms = {
				$chatContent: e("#js-chat-cont")
			}, this.timer = null, this.dataEntry()
		},
		dataEntry: function() {
			var e = this;
			t.on("room.gift.treasure.data.draw", function(t) {
				e.renderTips(t)
			})
		},
		renderTips: function(e) {
			var t = "",
				i = this.doms.$chatContent,
				a = i.find('[data-gift="king"]');
			(parseInt(e.lk, 10) || parseInt(e.lt, 10)) && (a.length && a.remove(), t = C({
				isBestLuck: parseInt(e.lk, 10),
				rate: e.lt,
				getName: e.dnk || "",
				sendName: e.snk || "",
				ywNum: e.silver
			}), i.append(t), i.find('[data-gift="king"]').animate({
				bottom: 0
			}, 300), clearTimeout(this.timer), this.timer = setTimeout(function() {
				i.find('[data-gift="king"]').remove()
			}, 5e3))
		}
	}, {
		init: function() {
			v.init(), y.init()
		}
	}
}), define("douyu/page/room/normal/mod/gift/app", ["douyu/context", "shark/observer", "douyu/com/get-gift-configs", "douyu/page/room/normal/mod/gift/base/view", "douyu/page/room/normal/mod/gift/chainManager", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/controller/banner", "douyu/page/room/normal/mod/gift/model/models", "douyu/page/room/normal/mod/gift/stepPool", "douyu/page/room/normal/mod/gift/view/views", "douyu/page/room/normal/mod/gift/controller/treasure"], function(e, t, i, a, n, s, r, o, l, c, d) {
	var u = [],
		f = function() {
			function i() {
				this.version = "DY20170612"
			}
			return i.prototype.getgiftChainConfig = function() {
				return this.giftChainConfig = {
					rocketChain: [n.RaiseUpManager, n.BannerManager],
					rocketSimpleChain: [n.RaiseUpManager, n.BannerManager],
					ownerRocketChain: [n.RaiseSmallUpManager, n.RaiseUpManager, n.BannerManager],
					ownerRocketSimpleChain: [n.RaiseSmallUpManager, n.RaiseUpManager, n.BannerManager],
					batchSimpleChain: [n.BatchUpManager, n.BannerManager],
					ownerBatchSimpleChain: [n.BatchSmallUpManager, n.BatchUpManager, n.BannerManager],
					planeChain: [n.PlaneUpManager, n.BannerManager],
					planeSimpleChain: [n.PlaneUpManager, n.BannerManager],
					ownerPlaneChain: [n.PlaneSmallUpManager, n.PlaneUpManager, n.BannerManager],
					ownerPlaneSimpleChain: [n.PlaneSmallUpManager, n.PlaneUpManager, n.BannerManager],
					commonChain: [n.BannerManager],
					commonSimpleChain: [n.BannerManager],
					ownerCommonChain: [n.CommonSmallUpManager, n.BannerManager],
					ownerCommonSimpleChain: [n.CommonSmallUpManager, n.BannerManager],
					superChain: [n.SuperUpManager, n.BannerManager],
					superSimpleChain: [n.SuperUpManager, n.BannerManager],
					ownerSuperChain: [n.SuperSmallUpManager, n.SuperUpManager, n.BannerManager],
					ownerSuperSimpleChain: [n.SuperSmallUpManager, n.SuperUpManager, n.BannerManager],
					highChain: [n.BannerManager],
					highSimpleChain: [n.BannerManager],
					normalChain: [n.BannerManager],
					normalSimpleChain: [n.BannerManager],
					openNobleChain: [n.OpenNobleManager, n.BannerManager],
					openNobleSimpleChain: [n.BannerManager]
				}, this.giftChainConfig
			}, i.prototype.initGiftChain = function(e) {
				var t, a = [],
					n = this.giftChainConfig || i.prototype.getgiftChainConfig();
				if (t = n[e], !t) throw new Error("没有对应礼物动画队列");
				for (var s = 0; s < t.length; s++) a.push(t[s]);
				this[e] = i.setUpChain(a)
			}, i.setUpChain = function() {
				var e = new n.StartManager,
					t = e;
				for (var i in arguments[0]) {
					var a, s = arguments[0][i],
						r = !1;
					if (s) {
						for (var o in l) if (l[o].toString() === s.toString()) {
							a = l[o], r = !0;
							break
						}
						if (!r) throw new Error("没有对应初始化对象池");
						var c = new s(a.getInstance());
						e.setNextManager(c), e = c
					}
				}
				return e.setNextManager(new n.EndManager), t
			}, i.prototype.addGift = function(e, t) {
				var a = e.split(s.VERSION)[1];
				this[a + "Chain"] || i.prototype.initGiftChain(a + "Chain"), this[a + "Chain"].applyGift(t)
			}, i.prototype.checkSenderOwner = function(t) {
				return e.get("sys.uid") == t
			}, i.prototype.giftShieldStatus = function(i) {
				var a = t.fire("mod.chat.msg.shield");
				return a.allGift ? e.get("sys.uid") != i : !1
			}, i
		}(),
		p = new f,
		m = function(e) {
			var t, i, a, n = 0;
			if (i = new o.Commonmodel(e.giftConfig), a = new o.Banner(e.giftData, e.giftConfig, e.bimg), i.mergeData(a), !p.giftShieldStatus(i.useFullData.senderId)) {
				switch (n = i.useFullData.giftBoxId ? 1 : 0, parseInt(i.useFullData.effect, 10)) {
				case 0:
					t = n ? s.GIFT_NORMAL : s.GIFT_NORMAL_SIMPLE, 1 == e.giftConfig.isBatchGift && e.giftData.gfcnt > 1 && (t = p.checkSenderOwner(i.useFullData.senderId) ? s.GIFT_OWNER_BATCH_SIMPLE : s.GIFT_BATCH_SIMPLE);
					break;
				case 1:
					t = p.checkSenderOwner(i.useFullData.senderId) ? n ? s.GIFT_OWNER_ROCKET : s.GIFT_OWNER_ROCKET_SIMPLE : n ? s.GIFT_ROCKET : s.GIFT_ROCKET_SIMPLE;
					break;
				case 2:
					t = p.checkSenderOwner(i.useFullData.senderId) ? n ? s.GIFT_OWNER_PLANE : s.GIFT_OWNER_PLANE_SIMPLE : n ? s.GIFT_PLANE : s.GIFT_PLANE_SIMPLE;
					break;
				case 3:
				case 4:
				case 5:
					t = p.checkSenderOwner(i.useFullData.senderId) ? n ? s.GIFT_OWNER_COMMON : s.GIFT_OWNER_COMMON_SIMPLE : n ? s.GIFT_COMMON : s.GIFT_COMMON_SIMPLE;
					break;
				case 101:
					t = p.checkSenderOwner(i.useFullData.senderId) ? n ? s.GIFT_OWNER_SUPER : s.GIFT_OWNER_SUPER_SIMPLE : n ? s.GIFT_SUPER : s.GIFT_SUPER_SIMPLE;
					break;
				case 111111:
					t = parseInt(i.useFullData.isNobleEffectShow, 10) ? s.OPEN_NOBLE : s.OPEN_NOBLE_SIMPLE
				}
				p.addGift(t, i)
			}
		};
	t.on(s.OPEN_NOBLE_PUSH, function(e) {
		m(e)
	}), t.on(s.GET_GIFT_DATA, function(e) {
		"giftCQ" == e.giftType ? m(e) : i.get(e.giftData.gfid).done(function(t) {
			e.giftConfig = t, m(e)
		})
	}), t.on(s.GIFT_SENDER_IS_BAN, function(e) {
		u.push(e)
	}), t.on(s.CHECK_USER_IS_BAN, function(e) {
		for (var t = 0; t < u.length; t++) if (u[t] == e) return 1;
		return 0
	}), d.init()
}), define("douyu/com/avatar", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/cookie/1.0", "douyu/context"], function(e, t, i, a, n) {
	var s = {
		cacheKey: "avatar",
		avatarDomain: n.get("sys.avatar_url"),
		defaultAvatarUrl: n.get("sys.res_url") + "douyu/images/defaultAvatar.png?20160303",
		avatarCache: {}
	},
		r = {
			cache: function(t, i, a) {
				var n = s.avatarCache[t];
				return a ? (e.isPlainObject(n) || (s.avatarCache[t] = {}), void(s.avatarCache[t][i] = a)) : e.isPlainObject(n) ? n[i] : ""
			},
			getSelfAvatar: function(t, n, o) {
				var l = a.get(s.cacheKey);
				if (l) {
					switch (l.charAt(l.length - 1)) {
					case "_":
						l += n + ".jpg";
						break;
					case "=":
						l += n
					}
					return o(l)
				}
				e.ajax({
					url: i.string.format("/lapi/member/userInfo/getInfo/{0}?size={1}&icon={2}", t, n, 1),
					type: "GET",
					dataType: "json",
					error: function() {
						o(s.defaultAvatarUrl)
					},
					success: function(e) {
						var l = s.defaultAvatarUrl;
						if (0 === parseInt(e.error, 10) && e.data.icon && 0 === parseInt(e.data.icon.code, 10)) {
							l = i.string.format("{0}upload/{1}", s.avatarDomain, e.data.icon.msg);
							var c = l.indexOf("_small.jpg") || l.indexOf("_middle.jpg") || l.indexOf("_big.jpg") || l.indexOf("size=") + 4;
							c && a.set(s.cacheKey, l.substring(0, c + 1), 0), r.cache(t, n, l)
						}
						o(l)
					}
				})
			},
			getOthersAvatar: function(t, a, n) {
				e.ajax({
					url: i.string.format("{0}lapi/member/avatar/getAvatar?uid={1}&size={2}", "/", t, a),
					type: "GET",
					error: function() {
						n(s.defaultAvatarUrl)
					},
					success: function(e) {
						var o = s.defaultAvatarUrl;
						e && (o = i.string.format("{0}upload/{1}", s.avatarDomain, e), r.cache(t, a, o)), n(o)
					}
				})
			}
		};
	t.on("douyu.avatar.get", function(t, i, a) {
		var o = s.defaultAvatarUrl;
		t = String(t), i = i || "small", a = e.isFunction(a) ? a : function() {}, s.avatarDomain && t && !(o = r.cache(t, i)) || a(o), n.get("sys.uid") === t ? r.getSelfAvatar(t, i, a) : r.getOthersAvatar(t, i, a)
	}), t.on("douyu.avatar.url", function(t, a, n) {
		t = t ? String(t) : "", a = a || "small", (n = e.isFunction(n) ? n : function() {})(s.avatarDomain && t ? i.string.format("{0}upload/{1}_{2}.jpg", s.avatarDomain, t, a) : s.defaultAvatarUrl)
	})
}), define("douyu/page/room/normal/mod/chat-user-manager", ["jquery", "shark/observer", "shark/util/flash/data/1.0", "douyu/context", "douyu/com/user", "douyu/page/room/base/api", "shark/util/lang/1.0", "shark/util/template/2.0"], function(e, t, i, a, n, s, r, o) {
	var l = [9, 10, 11, 12, 15, 16, 17, 18, 26],
		c = {},
		d = {},
		u = {},
		f = {},
		p = {};
	return c.isListen = !1, c.isLocked = !1, f.stopEvt = function(e) {
		e.preventDefault(), e.stopPropagation()
	}, d.init = function() {
		d.$container = e(document), d.$chatCont = e("#js-chat-cont"), d.$menugrp = e(".user-card-action"), d.$userManager = e('[data-type="user-manager-group"]'), d.$mute = d.$menugrp.find('[data-type="mute"]'), d.$reportgrp = d.$menugrp.find('[data-type="toreport"]'), d.$report = d.$userManager.find('[data-type="report"]'), d.$shield = d.$menugrp.find('[data-type="shield"]'), d.$appoint = d.$menugrp.find('[data-type="appoint"]'), d.$closure = d.$menugrp.find('[data-type="onekeyblack"]'), d.$opnenoble = d.$menugrp.find('[data-type="opnenoble"]'), d.$barrageCheck = d.$menugrp.find('[data-type="barrageRecord"]'), d.$follow = d.$menugrp.find(".js-card-follow"), c.uid = a.get("sys.uid"), c.ugd = a.get("sys.groupid"), 5 != a.get("sys.groupid") ? (d.$closure.remove(), d.$barrageCheck.remove()) : d.$shield.remove();
		var i = t.fire("mod.center.userrole.get");
		c.role = i.join(",")
	}, d.showManager = function() {
		c.rgp.rg < 4 && (c.ugp.rg >= 4 || 5 == c.ugd || 2 == c.ugd) ? d.$mute.show() : d.$mute.hide(), 5 == c.rgp.pg && d.$mute.hide(), d.$report[void 0 === c.cid || c.gid >= 5 ? "hide" : "show"]();
		var i = t.fire("mod.chat.blackList.get", c.rel),
			a = d.$shield.text(),
			n = 0;
		if (i.index > -1 ? (a = "取消屏蔽", n = 1) : i.length >= 10 ? (a = "屏蔽人数已满", n = 3) : (a = "屏蔽用户", n = 0), d.$shield.show().html('<i class="icon pb-icon"></i>' + a).attr("rel", n), c.cid || e("[data-type='report'][data-rept='0']").hide(), 5 == c.ugp.rg || 5 == c.ugd && c.rgp.rg < 5) {
			var s = 4 == c.rgp.rg ? 1 : 4,
				r = 4 == c.rgp.rg ? "解除房管" : "任命房管";
			d.$appoint.show().html('<i class="icon rm-icon"></i>' + r).attr("rel", s)
		} else d.$appoint.hide()
	}, u.init = function() {
		u.chatCont(), u.userManager(), d.$container.off("click.manager").on("click.manager", function() {
			d.$userManager.hide()
		})
	}, u.chatCont = function() {
		var i = d.$userManager;
		return c.clt = parseInt(i.attr("clt"), 10) || 0, c.rel = i.attr("rel"), c.gid = parseInt(i.attr("gid"), 10), c.cid = i.attr("chatid"), c.rgp = t.fire("mod.center.usergroup.get", c.rel), c.una = i.attr("nickname"), t.trigger("douyu.avatar.url", i.attr("avatar"), "big", function(e) {
			c.avatar = e
		}), c.uid && 2 != c.gid && c.uid != c.rel && 5 != c.gid ? (c.ugp || (c.ugp = t.fire("mod.center.usergroup.get", c.uid)), d.showManager(), e.inArray(c.clt, l) >= 0 && (d.$reportgrp.hide(), d.$shield.hide(), d.$appoint.hide(), d.$closure.hide(), d.$barrageCheck.hide(), d.$follow.hide(), "none" === d.$mute.css("display")) ? void d.$menugrp.hide() : void 0) : (i.hide(), !1)
	}, u.userManager = function() {
		d.$mute.on("click", function(e) {
			f.stopEvt(e), p.mute()
		}), d.$report.on("click", function(i) {
			f.stopEvt(i), c.rept = e(this).data("rept"), p.report();
			var a = e(this).closest("[data-noblelvl]").data("noblelvl") || 0;
			t.trigger("dys", {
				key: "dys.room.username.click",
				type: 1,
				r_type: 1,
				level: a
			})
		}), d.$shield.on("click", function(i) {
			f.stopEvt(i), p.shield();
			var a = e(this).closest("[data-noblelvl]").data("noblelvl") || 0;
			t.trigger("dys", {
				key: "dys.room.username.click",
				type: 2,
				r_type: 2,
				level: a
			})
		}), d.$appoint.on("click", function(e) {
			f.stopEvt(e), p.appoint()
		}), d.$closure.on("click", function(e) {
			f.stopEvt(e), p.closure()
		}), d.$opnenoble.on("click", function(e) {
			f.stopEvt(e), p.opnenoble()
		}), d.$barrageCheck.on("click", function(e) {
			f.stopEvt(e), p.barrageCheck()
		}), c.isListen || (t.on("mod.mute.anchorwhitelist.confirm", function(e) {
			p.muteConfirm(e.config.otype)
		}), t.on("mod.closure.anchorwhitelist.confirm", function(e) {
			p.closureConfirm()
		}), c.isListen = !0)
	}, p.mute = function() {
		if (c.isLocked = !1, 2 == c.ugd || !(c.ugp.rg < 4 && 5 != c.ugd || c.uid == c.rel)) {
			var n = "",
				r = 0;
			if (e.inArray(c.clt, l) >= 0) return c.role.indexOf(4) >= 0 ? n = ['<ul class="room-super-menu room-super-menu-super-admin">', '<li><em>用户：</em><strong class="unser-name">' + c.una + "</strong></li>", '<li><em>是否全站：</em><span class="room-super-menu-radio"><input type="radio" name="full" value="1" id="room-super-menu-full1"><label for="room-super-menu-full1">当前房间</label></span><span class="room-super-menu-radio"><input type="radio" name="full" value="2" data-roomid="-1" checked="checked" id="room-super-menu-full2"><label for="room-super-menu-full2">全站</label></span></li>', "<li><em>时长：</em><strong>永久</strong></li>", "</ul>"].join("") : (-1 != c.role.indexOf(3) || 4 == c.ugp.rg || c.role.indexOf(2) >= 0) && (n = ['<ul class="room-super-menu room-super-menu-super-admin">', '<li><em>用户：</em><strong class="unser-name">' + c.una + "</strong></li>", "<li><em>范围：</em><strong>当前房间</strong></li>", "<li><em>时长：</em><strong>永久</strong></li>", "</ul>"].join("")), void e.dialog({
				title: "禁止发言",
				content: n,
				id: "black900l",
				ok: function() {
					var e = a.get("room.room_id");
					this.DOM.content.find('[data-roomid="-1"]').prop("checked") && (e = -1), s.exe("js_blackuser", i.encode([{
						name: "type",
						value: "thirdblackreq"
					}, {
						name: "userid",
						value: c.rel
					}, {
						name: "dnick",
						value: c.una
					}, {
						name: "rid",
						value: e
					}, {
						name: "ct",
						value: c.clt
					}]))
				},
				cancelVal: "取消",
				cancel: !0
			}); - 1 != c.role.indexOf(4) ? (n = ['<ul class="room-super-menu room-super-menu-super-admin" id="room-super-menu-mute">', '<li class="user-avatar"><em>头像：</em><img src="' + c.avatar + '"></li>', '<li><em>用户：</em><strong class="unser-name">' + c.una + "</strong></li>", "<li><em>UID：</em><strong>" + c.rel + "</strong></li>", '<li><em>是否全站：</em><span class="room-super-menu-radio"><input type="radio" name="full" value="1" id="room-super-menu-full1" /><label for="room-super-menu-full1">当前房间</label></span><span class="room-super-menu-radio"><input type="radio" name="full" value="2" checked="" id="room-super-menu-full2" /><label for="room-super-menu-full2">全站</label></span></li>', '<li><em>范围：</em><span class="room-super-menu-radio"><input type="radio" name="range" value="1" checked="" id="room-super-menu-range1" /><label for="room-super-menu-range1">该用户</label></span><span class="room-super-menu-radio"><input type="radio" name="range" value="2" id="room-super-menu-range2" /><label for="room-super-menu-range2">该IP段</label></span></li>', '<li><em>时长：</em><input type="text" name="blacktime" value="24" class="inn-text" /><span class="info">小时</span></li>', '<li><em>原因：</em><input type="radio" name="reason_choice" checked="" class="inn-radio" /><select name="ban_reason">', "<option>恶意带节奏</option>", "<option>一般地域黑</option>", "<option>严重地域黑</option>", "<option>黑平台</option>", "<option>直播间被封禁</option>", "<option>恶意刷屏</option>", "</select></li>", '<li class="other-reason"><em></em><input type="radio" name="reason_choice" class="inn-radio" /><textarea name="oreason" placeholder="其他原因" maxlength="30"></textarea></li>', "</ul>"].join(""), r = 3) : -1 != c.role.indexOf(2) ? (n = ['<ul class="room-super-menu" id="room-super-menu-mute">', '<li><em>用户：</em><strong class="unser-name">' + c.una + "</strong></li>", '<li><em>范围：</em><span class="room-super-menu-radio"><input type="radio" name="range" value="1" checked="" id="room-super-menu-range1" /><label for="room-super-menu-range1">该用户</label></span><span class="room-super-menu-radio"><input type="radio" name="range" value="2" id="room-super-menu-range2" /><label for="room-super-menu-range2">该IP段</label></span></li>', '<li><em>时长：</em><select name="blacktime">', '<option value="60">1分钟</option>', '<option value="600">10分钟</option>', '<option value="1800">30分钟</option>', '<option value="3600">1小时</option>', '<option value="28800">8小时</option>', '<option value="86400" selected="">1天</option>', '<option value="259200">3天</option>', '<option value="604800">7天</option>', '<option value="2592000">30天</option>', "</select></li>", "</ul>"].join(""), r = 2) : -1 == c.role.indexOf(3) && 4 != c.ugp.rg || (n = ['<ul class="room-super-menu" id="room-super-menu-mute">', '<li><em>用户：</em><strong class="unser-name">' + c.una + "</strong></li>", '<li><em>时长：</em><select name="blacktime">', '<option value="60">1分钟</option>', '<option value="600">10分钟</option>', '<option value="1800">30分钟</option>', '<option value="3600">1小时</option>', '<option value="28800">8小时</option>', '<option value="86400" selected="">1天</option>', '<option value="259200">3天</option>', '<option value="604800">7天</option>', '<option value="2592000">30天</option>', "</select></li>", "</ul>"].join(""), r = 1), e.dialog({
				title: "禁止发言",
				content: n,
				id: "black900l",
				init: function() {
					if (-1 != c.role.indexOf(4)) {
						var t = e("#room-super-menu-mute");
						t.find('[name="blacktime"]').focus()
					}
				},
				ok: function() {
					return p.muteDialog = this, c.isLocked || (t.trigger("mod.anchorwhitelist.dialogshow", {
						anchorwhitelistData: {
							isShowDialog: !(!c.rel || c.rel !== a.get("room.owner_uid")),
							userid: c.rel,
							config: c,
							flag: "mod.mute.anchorwhitelist.confirm"
						},
						config: {
							otype: r
						}
					}), c.isLocked = !0), !1
				},
				cancelVal: "取消",
				cancel: function() {
					c.isLocked = !1
				},
				skin: "room-super-menu-skin"
			})
		}
	}, p.muteConfirm = function(t) {
		var n = e("#room-super-menu-mute"),
			r = e.trim(n.find('[name="full"]:checked').val()),
			o = e.trim(n.find('[name="range"]:checked').val()) || 1,
			l = e.trim(n.find('[name="blacktime"]').val()),
			d = e.trim(n.find('[name="reason_choice"]:checked').next().val()) || "";
		if (-1 != c.role.indexOf(4)) {
			if (isNaN(l) || 0 >= l) return e.dialog.tips_black("请重新输入禁言时长!"), !1;
			if (2 == r || 2 == o) {
				if (l > 99) return e.dialog.tips_black("禁言时长不能超过99小时!"), !1
			} else if (l > 720) return e.dialog.tips_black("禁言时长不能超过720小时!"), !1;
			if ("" === d) return e.dialog.tips_black("禁言原因未填写!"), !1;
			if (d.length > 30) return e.dialog.tips_black("禁言原因长度不能大于30个字！"), !1;
			l = 3600 * l
		}
		s.exe("js_blackuser", i.encode([{
			name: "type",
			value: "newblackreq"
		}, {
			name: "uid",
			value: c.rel
		}, {
			name: "oid",
			value: c.uid
		}, {
			name: "otype",
			value: t
		}, {
			name: "rid",
			value: 2 == r ? -1 : a.get("room.room_id")
		}, {
			name: "blacktype",
			value: o
		}, {
			name: "limittime",
			value: l
		}, {
			name: "reason",
			value: d
		}])), p.muteDialog.close()
	}, p.report = function() {
		return c.uid == c.rel ? void e.dialog.alert("不能举报自已!") : (d.$userManager.hide(), void(-1 !== c.cid && s.exe("js_reportBarrage", i.encode([{
			name: "suid",
			value: c.rel
		}, {
			name: "rept",
			value: c.rept
		}, {
			name: "rid",
			value: a.get("room.room_id")
		}, {
			name: "chatmsgid",
			value: c.cid
		}]))))
	}, p.shield = function() {
		var e = parseInt(d.$shield.attr("rel"), 10),
			i = t.fire("mod.chat.blackList.get", c.rel),
			a = 0,
			n = "";
		if (0 === e) {
			if (i.index > -1 || i.length >= 10) return;
			a = 1, n = "取消屏蔽", t.trigger("mod.chat.blackList.set", c.rel)
		} else {
			if (-1 == i.index) return;
			a = 0, n = "屏蔽用户", t.trigger("mod.chat.blackList.del", c.rel)
		}
		d.$shield.html('<i class="icon pb-icon"></i>' + n).attr("rel", a), s.exe("js_myblacklist", i.list.join("|"))
	}, p.appoint = function() {
		s.exe("js_setadmin", i.encode([{
			name: "type",
			value: "setadminreq"
		}, {
			name: "userid",
			value: c.rel
		}, {
			name: "group",
			value: d.$appoint.attr("rel")
		}])), d.$userManager.hide()
	}, p.closure = function() {
		if (c.isLocked = !1, a.get("sys.uid") == c.rel || 5 != a.get("sys.groupid")) return void e.dialog.alert("没有相应权限!");
		var t = ['<ul class="room-super-menu" id="room-super-menu">', '<li class="user-avatar"><em>头像：</em><img src="' + c.avatar + '"></li>', '<li><em>用户：</em><strong class="unser-name">' + c.una + "</strong></li>", "<li><em>UID：</em><strong>" + c.rel + "</strong></li>", "<li><em>时长：</em><span>永久</span></li>", '<li><em>原因：</em><input type="radio" name="reason_choice" checked="" class="inn-radio" /><select name="ban_reason">', "<option>广告</option>", "<option>地域黑</option>", "<option>色情</option>", "<option>违规ID</option>", "<option>恶意刷屏</option>", "<option>涉政</option>", "<option>违法擦边内容</option>", "<option>违规IP下账号</option>", "<option>弹幕机器人</option>", "<option>其它(跳槽、冒充官方等)</option>", "</select></li>", '<li class="other-reason"><em></em><input type="radio" name="reason_choice" class="inn-radio" /><textarea name="oreason" placeholder="其他原因" maxlength="30"></textarea></li>', "</ul>"].join("");
		e.dialog({
			title: "一键封号",
			content: t,
			id: "oneKeyBlack00l",
			init: function() {},
			ok: function() {
				var e = {
					anchorwhitelistData: {
						isShowDialog: !1,
						flag: "mod.closure.anchorwhitelist.confirm",
						config: c,
						userid: c.rel
					}
				};
				return p.closureDialog = this, p.isAnchorAccount(e, p.triggerAnchorwhitelistDiaShow), !1
			},
			cancelVal: "取消",
			cancel: function() {
				c.isLocked = !1
			},
			skin: "room-super-menu-skin room-super-menu-skin-closure"
		})
	}, p.opnenoble = function() {
		t.trigger("mod.normal.noble.buy")
	}, p.barrageCheck = function() {
		if (a.get("sys.uid") == c.rel || 5 != a.get("sys.groupid")) return void e.dialog.alert("没有相应权限!");
		var t = function(e) {
				var t = r.string.join('<div class="barrage-record-avatar">', '<img src="{{avatar}}" />', "<p>", "<span>昵称：{{una}}</span>", "<span>UID：{{rel}}</span>", "</p>", "</div>");
				return o.compile(t)(e)
			},
			i = function(e) {
				var t = r.string.join('<div class="barrage-record-list">', "<ul>", "{{if list.length}}", "{{each list}}", "<li>", "<span>{{$value.dateline}}</span>", "<p>{{$value.content}}</p>", "</li>", "{{/each}}", "{{else}}", "暂无数据", "{{/if}}", "</ul>", "</div>");
				return o.compile(t)({
					list: e
				})
			};
		e.ajax("/room/barrageRecord/getLastList100", {
			type: "get",
			dataType: "json",
			data: {
				uid: c.rel
			},
			success: function(a) {
				if (0 === a.error) {
					var n = t({
						avatar: c.avatar,
						una: c.una,
						rel: c.rel
					}),
						s = i(a.data.list || []);
					e.dialog({
						title: "弹幕记录",
						content: n + s,
						id: "barrageRecord00l"
					})
				}
			},
			error: function() {}
		})
	}, p.triggerAnchorwhitelistDiaShow = function(i, a) {
		i = "string" == typeof i ? JSON.parse(i) : i, e.isPlainObject(a) || (a = {
			anchorwhitelistData: {
				isShowDialog: !1,
				config: c,
				flag: "mod.closure.anchorwhitelist.confirm",
				userid: ""
			}
		}), a.anchorwhitelistData.isShowDialog = !(!i || 0 !== parseInt(i.error) || !i.room_id), c.isLocked || (t.trigger("mod.anchorwhitelist.dialogshow", a), c.isLocked = !0)
	}, p.isAnchorAccount = function(t, i) {
		var a = {},
			n = "";
		e.isPlainObject(t) || (t = {
			anchorwhitelistData: {
				isShowDialog: !1,
				config: c,
				flag: "mod.closure.anchorwhitelist.confirm",
				userid: ""
			}
		}), i = e.isFunction(i) ? i : function() {}, a = t.anchorwhitelistData, n = a.userid ? a.userid : "", e.ajax({
			url: "/room/anchor_whitelist/getroomid",
			type: "GET",
			data: {
				uid: n
			},
			error: function(e) {
				i(e, t)
			},
			success: function(e) {
				i(e, t)
			}
		})
	}, p.closureConfirm = function() {
		var t = e.trim(e('#room-super-menu input[name="reason_choice"]:checked').next().val());
		return "" === t ? (e.dialog.tips_black("封禁原因未填写！"), !1) : t.length > 30 ? (e.dialog.tips_black("封禁原因长度不能大于30个字！"), !1) : (s.exe("js_keyTitles", i.encode([{
			name: "type",
			value: "gbm"
		}, {
			name: "roomid",
			value: a.get("room.room_id")
		}, {
			name: "userid",
			value: c.rel
		}, {
			name: "username",
			value: c.una
		}, {
			name: "limittime",
			value: 0
		}, {
			name: "reason",
			value: t
		}])), void p.closureDialog.close())
	}, {
		init: function() {
			d.init(), u.init()
		}
	}
}), define("douyu/page/room/normal/mod/get-medal-config", ["jquery", "shark/observer"], function(e, t) {
	var i = {
		config: {
			fansMedalConfig: {}
		},
		getMedalConfig: function(e, t, a) {
			var n = i,
				s = n.config.fansMedalConfig,
				r = "",
				o = "",
				l = "",
				c = "",
				d = 0,
				u = 0,
				f = {
					medalBg: "",
					bestBg: "",
					isMade: 0
				};
			return e ? (r = e.roomId, o = e.medalLev, t > 0 && s.fans ? (d = 1, u = 1, 2 == a && s.fans.bag[o] && (c = s.fans.bag[o]), l = s.fans.bg[o]) : s[r] ? (d = 1, u = 2, l = s[r].bg[o]) : s.all && (d = 1, u = 4, l = s.all.bg[o]), d && (f = {
				medalBg: l ? "style=background-image:url(" + l + ")" : "",
				bestBg: c ? "style=background-image:url(" + c + ")" : "",
				isMade: u
			}), f) : f
		},
		returnMedalComponent: function(e, t, a) {
			var n = i.getMedalConfig(e, t, a),
				s = 0,
				r = "",
				o = "",
				l = "",
				c = [];
			switch (t > 0 && 2 == a && n.bestBg ? (s = 1, r = n.bestBg, o = e.medalNick) : (s = t > 0 ? 1 : 0, 2 == a && (s = 0), r = n.medalBg, o = e.medalNick), l = n.isMade > 0 ? 1 : 0, +a) {
			case 3:
				c = ['<span class="fans-badge-icon" data-flag="fans-medal-components-2" data-ui-level="' + e.medalLev + '">', '<span class="fans-icon-name">', "<i>" + o + "</i>", "</span>", "</span>"].join("");
				break;
			case 1:
			case 2:
			default:
				c = ['<span class="fans-badge-icon" data-flag="fans-medal-components-2" data-best-fans="' + s + '" data-ui-level="' + e.medalLev + '" data-is-made="' + l + '">', '<span class="fans-icon-name" ' + r + ">", "<i>" + o + "</i>", "</span>", "</span>"].join("")
			}
			return c
		}
	};
	return t.on("crazy.fans.config.data", function(e) {
		i.config.fansMedalConfig = e
	}), {
		getMedalConfig: i.getMedalConfig,
		returnMedalComponent: i.returnMedalComponent
	}
}), define("douyu/page/room/normal/mod/get-motorcade-config", ["jquery", "douyu/com/exjsonp", "douyu/context", "shark/observer", "shark/util/template/2.0", "shark/util/lang/1.0"], function(e, t, i, a, n, s) {
	var r = {
		config: {},
		flagBgList: {},
		defaultBg: i.get("sys.web_url") + "/app/douyu/res/page/room-normal/motor-bg.png?20180705",
		initMotorcadeConfig: function() {
			t.load(i.get("sys.webconfUrl") + "resource/common/fleet/fleet_config.json", "motorcadeConfig", function(t) {
				t && t.list && (r.config = t.list), e.isEmptyObject(t) || (e.isEmptyObject(t.list) || (r.config = t.list), e.isEmptyObject(t.flagBgList) || (r.flagBgList = t.flagBgList))
			})
		},
		getMotorcadeConfig: function(e) {
			var t = "",
				i = e.cbid;
			if (i && r && r.config) {
				var a = r.config[i];
				a && (t = a.flag)
			}
			return t
		},
		getMotorcadeBg: function(e) {
			var t = r.defaultBg,
				i = e.cbid;
			return i && r && r.flagBgList && r.flagBgList[i] && (t = r.flagBgList[i].web || r.defaultBg), t
		}
	};
	return r.initMotorcadeConfig(), {
		getMotorcadeConfig: r.getMotorcadeConfig,
		getMotorcadeBg: r.getMotorcadeBg
	}
}), define("douyu/page/room/normal/mod/chat-msg-tmp", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/flash/data/1.0", "shark/util/template/1.0", "douyu/context", "douyu/page/room/normal/mod/get-medal-config", "douyu/page/room/normal/mod/get-motorcade-config", "douyu/com/exjsonp"], function(e, t, i, a, n, s, r, o, l) {
	var c = $COLLIGATE.userLevelSwitch > 0 ? 1 : 0,
		d = {};
	t.on("crazy.fans.config.data", function(e) {
		d = e
	});
	var u = {};
	t.on("room.act.data.chatmsg", function(e) {
		u = e
	});
	var f = [];
	f.length <= 0 && l.load(s.get("sys.webconfUrl") + "resource/common/annual2017/nickname_color_map_web.json", "annual2017ColorMap", function(e) {
		f = e
	});
	var p = {};
	l.load(s.get("sys.webconfUrl") + "resource/common/annual2017/web_barrage_tail.json", "annual2017BarrageTail", function(e) {
		p = e
	});
	var m = function(e) {
			var t = f,
				i = 0,
				a = "";
			if (!e) return !1;
			for (i; i < t.length; i++) {
				var n = 0;
				for (n; n < e.length; n++) if (parseInt(t[i].effect_id, 10) === parseInt(e[n].eid, 10)) return a = t[i].color
			}
			return a
		},
		h = 10,
		g = {},
		v = {},
		y = {
			1: {
				id: "1500000003",
				title: "银质勋章：单次充值超过600鱼翅可获得。"
			},
			2: {
				id: "1500000005",
				title: "铜质勋章：累计充值超过200鱼翅可获得。"
			},
			3: {
				id: "1500000004",
				title: "红色昵称：累计充值超过1000鱼翅可获得。"
			},
			4: {
				id: "1500000002",
				title: "金质勋章：累计充值超过6666鱼翅可获得。"
			},
			5: {
				id: "1500000006",
				title: ""
			}
		},
		b = [],
		k = [{
			id: "101",
			type: "png",
			title: "666"
		}, {
			id: "102",
			type: "png",
			title: "发呆"
		}, {
			id: "103",
			type: "png",
			title: "拜拜"
		}, {
			id: "104",
			type: "png",
			title: "晕"
		}, {
			id: "105",
			type: "png",
			title: "弱"
		}, {
			id: "106",
			type: "png",
			title: "傲慢"
		}, {
			id: "107",
			type: "png",
			title: "开心"
		}, {
			id: "108",
			type: "png",
			title: "奋斗"
		}, {
			id: "109",
			type: "png",
			title: "很酷"
		}, {
			id: "110",
			type: "png",
			title: "流泪"
		}, {
			id: "111",
			type: "png",
			title: "鄙视"
		}, {
			id: "112",
			type: "png",
			title: "得意"
		}, {
			id: "113",
			type: "png",
			title: "抠鼻"
		}, {
			id: "114",
			type: "png",
			title: "亲亲"
		}, {
			id: "115",
			type: "png",
			title: "偷笑"
		}, {
			id: "116",
			type: "png",
			title: "口罩"
		}, {
			id: "117",
			type: "png",
			title: "委屈"
		}, {
			id: "118",
			type: "png",
			title: "难过"
		}, {
			id: "119",
			type: "png",
			title: "吐血"
		}, {
			id: "120",
			type: "png",
			title: "大怒"
		}, {
			id: "121",
			type: "png",
			title: "赞"
		}, {
			id: "122",
			type: "png",
			title: "睡觉"
		}, {
			id: "123",
			type: "png",
			title: "骷髅"
		}, {
			id: "124",
			type: "png",
			title: "调皮"
		}, {
			id: "125",
			type: "png",
			title: "惊讶"
		}, {
			id: "126",
			type: "png",
			title: "撇嘴"
		}, {
			id: "127",
			type: "png",
			title: "拥抱"
		}, {
			id: "128",
			type: "png",
			title: "背锅"
		}, {
			id: "129",
			type: "png",
			title: "闭嘴"
		}, {
			id: "130",
			type: "png",
			title: "吃药"
		}, {
			id: "131",
			type: "png",
			title: "可怜"
		}, {
			id: "132",
			type: "png",
			title: "呕吐"
		}, {
			id: "133",
			type: "png",
			title: "敲打"
		}, {
			id: "134",
			type: "png",
			title: "心碎"
		}, {
			id: "135",
			type: "png",
			title: "嘘"
		}, {
			id: "136",
			type: "png",
			title: "中箭"
		}, {
			id: "137",
			type: "png",
			title: "抓狂"
		}, {
			id: "001",
			type: "png",
			title: "流汗"
		}, {
			id: "002",
			type: "png",
			title: "丢药"
		}, {
			id: "003",
			type: "png",
			title: "白眼"
		}, {
			id: "004",
			type: "png",
			title: "火箭"
		}, {
			id: "005",
			type: "png",
			title: "色"
		}, {
			id: "006",
			type: "png",
			title: "点蜡"
		}, {
			id: "007",
			type: "png",
			title: "抽烟"
		}, {
			id: "008",
			type: "png",
			title: "可爱"
		}, {
			id: "009",
			type: "png",
			title: "炸弹"
		}, {
			id: "010",
			type: "png",
			title: "吃丸子"
		}, {
			id: "011",
			type: "png",
			title: "害怕"
		}, {
			id: "012",
			type: "png",
			title: "疑问"
		}, {
			id: "013",
			type: "png",
			title: "阴险"
		}, {
			id: "014",
			type: "png",
			title: "害羞"
		}, {
			id: "015",
			type: "png",
			title: "笑哭"
		}, {
			id: "016",
			type: "png",
			title: "猪头"
		}, {
			id: "017",
			type: "png",
			title: "困"
		}],
		w = s.get("sys.resource_url"),
		_ = s.get("colligate.madelConfig"),
		x = s.get("room.nobleConfig") || {},
		C = function() {
			var t = [];
			return _ && e.each(_, function(e, i) {
				i.act_ext && 1 === +i.act_ext && t.push(+i.id)
			}), t
		};
	v.createArr = function(t, i, a) {
		if (e.isArray(t)) {
			for (var n = 0; a - i >= n; n++) t.push(+i + n + "");
			return t
		}
	}, b = v.createArr([], 1500000041, 1500000064), b.push("1500000143", "1500000144", "1500000145"), b.push("1500000047", "1500000048", "1500000049"), b.push("1500000154", "1500000153", "1500000152"), v.processArrData = function(t) {
		var i, n, s = [];
		if (!t) return s;
		i = t.split("/");
		for (var r = 0, o = i.length; o > r; r++) n = a.decode(i[r]).too(), e.isPlainObject(n) && !e.isEmptyObject(n) && s.push(n);
		return s
	}, v.handleUserEnter = function(e) {
		var i = {},
			a = ["christmas", "newYear2017"],
			n = [1500000239, 1500000240, 1500000241, 1500000242, 1500000243, 1500000244, 1500000245, 1500000246],
			s = [1500000263, 1500000264, 1500000265];
		if (e.el) for (var r = 0, o = e.el.length; o > r; r++) {
			if (1500000229 === parseInt(e.el[r].eid, 10)) return t.fire("mod.userenter.activity.starmagic", e);
			if (1500000247 === parseInt(e.el[r].eid, 10)) return t.fire("mod.activity.loveheadline6", e);
			if (1500000248 === parseInt(e.el[r].eid, 10)) return t.fire("mod.activity.summerParty201806", e);
			for (var l = 0; l < n.length; l++) if (parseInt(e.el[r].eid, 10) === n[l]) return t.fire("mod.userenter.activity.fansDay", {
				node: e,
				enterId: n[l]
			})
		}
		if (e.ceid) return t.fire("mod.chat.level120.enter", e);
		if (e.el) for (var c = 0, d = e.el.length; d > c; c++) for (var u = 0, f = s.length; f > u; u++) if (parseInt(e.el[c].eid, 10) === s[u]) return t.fire("mod.userenter.activity.worldfans", e);
		if (e.nl) return t.fire("mod.chat.noble.enter", e);
		if (e.girlPrivilege) return t.fire("mod.userenter.get.girl", e);
		if (e.el) for (var p = 0, o = e.el.length; o > p; p++) if (1500000123 === parseInt(e.el[p].eid, 10)) return t.fire("mod.userenter.get.sharkKing", e);
		for (var m = 0; m < a.length; m++) {
			var h = v.handleEL(a[m], e.el);
			if (h) {
				i = t.fire("mod.userenter.get." + h, e) || {};
				break
			}
		}
		return i
	}, v.handleEid = function(t) {
		return t ? -1 !== e.inArray(t, b) ? "cataRankList" : void 0 : !1
	}, v.handleEL = function(e, t) {
		if (t.length) for (var i = 0; len = t.length, i < len; i++) {
			if ("namered" === e && t[i].eid && y[3] && t[i].eid === y[3].id) return e;
			if ("taskwel" === e && t[i].eid && y[5] && t[i].eid === y[5].id) return e;
			if ("namegold" === e && t[i].eid && "1500000082" === t[i].eid) return e;
			if ("christmas" === e && t[i].eid && ("1500000092" === t[i].eid || "1500000094" === t[i].eid)) return e;
			if ("newYear2017" === e && t[i].eid && "1500000105" === t[i].eid) return e
		}
		return !1
	}, v.handleJumpUrl = function(e, t) {
		return "" === e || null === e || void 0 === e ? "href" === t ? "javascript:;" : "cursor:default;" : "href" === t ? e : ""
	}, v.roomLinkCheck = function(t) {
		if (!t) return 0;
		var i = /\[room\=([^\]]+)\]/gi,
			a = /\[room\=([a-z\d]+)\]/gi,
			n = t.match(i),
			s = 1;
		return n && e.each(n, function(e, t) {
			return a.test(t) ? void 0 : (s = 0, !1)
		}), s
	}, v.htmlEncode = function(e) {
		var t = "";
		return 0 === e.length ? t : t = e.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/ /g, "&nbsp;").replace(/\'/g, "&#39;").replace(/\"/g, "&quot;").replace(/\s/g, " ")
	}, v.replaceFace = function(t) {
		var a = window.faceListConfig ? window.faceListConfig : k,
			n = "",
			r = "";
		return e.each(a, function(e, a) {
			n = i.string.format("{0}app/douyu/res/page/room-normal/face/dy{1}.{2}?v={3}", s.get("sys.web_url"), a.id, a.type, 20170626), r = "dy" + a.id, t = t.replace(new RegExp("\\[emot:" + r + "\\]", "g"), '<img class="chat-emotion" rel="' + r + '" src="' + n + '" />')
		}), t
	}, v.getColor = function(e) {
		return ["#ff0000", "#1e87f0", "#7ac84b", "#ff7f00", "#9b39f4", "#ff69b4"][e]
	};
	var T = [];
	return t.on("mod.chat.msg.color.vote", function(e) {
		T = e
	}), v.getKplVoteColor = function(t) {
		var i = "";
		return e.map(T, function(e, a) {
			return e.type && +t === +e.type ? (i = e.value, !1) : void 0
		}), i
	}, v.returnUlevelClass = function(e) {
		var t = 120,
			a = "";
		return a = e ? i.string.format("{0}{1}", "level-", t + 1 > e ? e : t) : "level-next-1", a + " " + v.imgType(e) + " " + v.imgSize(e) || ""
	}, v.imgType = function(e, t) {
		var i = "";
		return i = e >= 70 ? "" : "level-bgpng", t && (i = "level-bgpng"), i
	}, v.imgSize = function(e) {
		var t = "";
		return t = e >= 100 ? "level-size2" : " level-size1"
	}, v.getCqName = function(e) {
		return 1 == e ? "初级酬勤" : 2 == e ? "中级酬勤" : 3 == e ? "高级酬勤" : 4 == e ? "超级酬勤" : void 0
	}, v.getUserCqName = function(e) {
		return e = e ? e : 10, 0 == e ? "酬勤用户" : 1 == e ? "初级酬勤用户" : 2 == e ? "中级酬勤用户" : 3 == e ? "高级酬勤用户" : ""
	}, v.getCqLevIcon = function(e) {
		return i.string.format("{0}app/douyu/res/page/room-normal/cq/level/cq_0{1}.gif?v=20170627", s.get("sys.web_url"), e)
	}, v.getCqTitIcon = function(e) {
		return i.string.format("{0}app/douyu/res/page/room-normal/cq/level/cq_no0{1}.png?v=20170627", s.get("sys.web_url"), e)
	}, v.getRankTypeName = function(e) {
		return 1 == e ? "贡献周榜" : 2 == e ? "贡献总榜" : "贡献周榜"
	}, v.handleLinkBarrage = function(e) {
		var t, i, a = e.toString(),
			n = s.get("colligate.barrage_link.link_pre"),
			r = {
				open: 0,
				type: "",
				link: ""
			};
		return !a || a.indexOf("_") <= 0 ? r : (i = a.split("_"), t = n[i[0]], i.length >= 2 && n[i[0]] && i[1] && (r.open = 1, r.type = i[0], 2 == i.length ? r.link = 1 == r.type ? t + "special/jump/" + i[1] : t + i[1] : (i.shift(), r.link = 1 == r.type ? t + "special/jump/" + i.join("_") : t + i.join("_"))), r)
	}, g.superBarrage = function(e) {
		e = a.decode(e).too();
		var t, r, o;
		return g.superBarrage.RENDER ? r = g.superBarrage.RENDER : (t = i.string.join('<li class="jschartli high-notice-new" data-type="list">', '<i class="sys-icon"></i>', '<p class="text-cont">', '<span class="super-barrage js-normal-barrage" data-sdid="<%=sdid%>" data-trid="<%=trid%>" data-type="<%=jmptp%>" data-url="<%=url%>" ><%=text%></span>', "</p>", "</li>"), r = g.superBarrage.RENDER = n.compile(t)), o = r({
			sdid: e.sdid,
			trid: e.trid,
			text: e.content,
			jmptp: e.jmptp,
			url: e.url,
			attr: {
				web_url: s.get("sys.web_url")
			}
		})
	}, g.superBarrage.RENDER = null, g.athenaSuperBarrage = function(e) {
		var t, a, r, o = JSON.parse(e),
			l = o.isReverse;
		g.athenaSuperBarrage.RENDER ? a = g.athenaSuperBarrage.RENDER : (t = i.string.join('<li class="jschartli high-notice-new" data-type="list">', '<i class="sys-icon"></i>', '<p class="text-cont">', '<span class="super-barrage js-distribute-barrage"', 'data-bid="<%=bid%>" ', 'data-booth_id="<%=booth_id%>" ', 'data-ruleset_id="<%=ruleset_id%>" ', 'data-con_id="<%=con_id%>" ', 'data-rid="<%=rid%>" ', 'data-vid="<%=vid%>" ', 'data-jurl="<%=jurl%>" ', 'data-reverse="<%=isReverse%>" ', 'data-jump_type="<%=jump_type%>" ', "><%=title%></span>", "</p>", "</li>"), a = g.athenaSuperBarrage.RENDER = n.compile(t)), o.jump_type = parseInt(o.jump_type, 10), 1 === o.jump_type ? (o.vid = "", o.rid = "", o.jurl = o.jump_to) : 2 === o.jump_type ? (o.vid = "", o.rid = o.jump_to, o.jurl = "/" + (+o.vipId ? o.vipId : o.jump_to)) : (o.rid = "", o.vid = o.jump_to, o.jurl = $SYS.vsite_url + "/show/" + o.jump_to);
		var c = {
			bid: o.bid,
			booth_id: l ? 10 : 1,
			ruleset_id: o.ruleset_id,
			con_id: o.con_id,
			rid: o.rid,
			vid: o.vid,
			jurl: o.jurl,
			ctid: s.get("room.cate_id"),
			title: o.title,
			isReverse: l,
			jump_type: o.jump_type
		};
		return c.attr = {
			web_url: s.get("sys.web_url")
		}, r = a(c)
	}, g.athenaSuperBarrage.RENDER = null, g.barrage = function(l, f) {
		var h, b, k, w = l,
			T = t.fire("mod.chat.blackList.get", parseInt(w.uid, 10));
		if (-1 === T.index && v.roomLinkCheck(w.txt)) {
			w.txt = v.htmlEncode(w.txt), w.txt = v.replaceFace(w.txt), w.txt = w.txt.replace(/\[room\=([a-zA-Z\d]+)\]/gi, '<a href="/$1" target="_blank" class="cont-room"><img src="' + s.get("sys.web_url") + 'app/douyu/res/page/room-normal/link.png?v=20160310" />$1</a>'), l.cqt = v.getUserCqName(l.dlv) || "", l.bgt = Math.pow(10, l.gt), +l.col >= 1e3 && +l.col <= 1100 ? l.color = v.getKplVoteColor(+l.col) || "" : l.color = v.getColor(l.col - 1) || "", l.ut = l.ut || "", w.ut = a.isArray(l.ut) ? a.decode(l.ut) : [{
				value: l.ut
			}], w.userIcon = v.returnUlevelClass(w.level), w.el = v.processArrData(w.el), w.highLevel = 120, w.nl = l.nl, w.medalNickname = l.bnn, w.medalLv = l.bl, w.hc = l.hc, w.ownItRoomId = parseInt(l.brid, 10), w.curRoomId = parseInt(s.get("room.room_id"), 10), w.fansMedal = d || {}, w.ol = parseInt(l.ol, 10) || 0, w.girlPrivilege = g.checkGirlPri(w.el, 1500000173, w), w.girlPriCls = w.girlPrivilege ? "girl-chart" : "", w.isOwnMedal = 1 === +w.jsk || 3 === +w.jsk ? 1 : 0, w.isKingMedal = +w.jskc;
			var S = g.checkGuessRank(w.el);
			g.barrage.RENDER ? b = g.barrage.RENDER : (h = i.string.join("<% if ( node.isSender ) { %>", '<li class="jschartli chartli hy-chat <%= node.girlPriCls %> <%= nobleClass %>" data-level="<%=node.level%>" data-type="list" ', "<% if ( node.ol > 0 ) { %>", 'data-anchor-level="<%=node.ol%>"', "<% } %>", ">", "<% if ( node.dlv > 0 && node.dc > 0 ) { %>", '<p class="my-cont cqback">', "<% } else { %>", '<p class="my-cont">', "<% } %>", "<% } else { %>", '<li class="jschartli hy-chat <%= node.girlPriCls %> <%= nobleClass %>" data-level="<%=node.level%>" data-type="list" ', "<% if ( node.ol > 0 ) { %>", 'data-anchor-level="<%=node.ol%>"', "<% } %>", ">", "<% if ( node.dlv > 0 && node.dc > 0 ) { %>", '<p class="text-cont cqback">', "<% } else { %>", '<p class="text-cont">', "<% } %>", "<% } %>", "<% if ( node.ct === 1 || node.ct === 2 ) { %>", "<% } %>", "<% if ( (node.pg === 5 || node.pg === 2) && node.sahf ) { %>", '<span class="chat-icon-pad"><img class="icon-role super-admin" src="<%= attr.web_url %>app/douyu/res/page/room-normal/super_admin.png?v=<%= attr.web_ver %>" /></span>', "<% } else if ( node.rg === 4 ) { %>", '<span class="chat-icon-pad"><img class="icon-role" src="<%= attr.web_url %>app/douyu/res/page/room-normal/roomadmin.png?v=<%= attr.web_ver %>" /></span>', "<% } %>", "<% if ( nobleInfo ) { %>", '<span class="chat-icon-pad user-noble">', '<img src="<%= attr.resource_url %><%= nobleInfo.symbol.web_symbol_pic1 %>" title="<%= nobleInfo.symbol.name %>" />', "</span>", "<% } %>", "<% if (node.el.length) { %>", "<% kplOuterLayer : for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% for (var j = 0; j < kplVoteMedal.length; j++) { %>", "<% if ( el[i].eid == kplVoteMedal[j] && madelConfig[el[i].eid].web_img && madelConfig[el[i].eid].name) { %>", '<a href="javascript:;" class="cursor-default" data-id="<%= el[i].eid %>"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[el[i].eid].web_img %>" title="<%= madelConfig[el[i].eid].name %>"></a>', "<% break kplOuterLayer %>", "<% } %>", "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% for (var j = 0; j < fansDay03Medal.length; j++) { %>", "<% if ( el[i].eid == fansDay03Medal[j]) { %>", '<a href="javascript:;" class="cursor-default" data-id="<%= el[i].eid %>"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[el[i].eid].web_img %>" title="<%= madelConfig[el[i].eid].name %>"></a>', "<% } %>", "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if (effectInfo) { %>", "<% if ( el[i].etp && el[i].etp == 1 &&el[i].ef&&el[i].ef==1) { %>", "<% if(effectInfo[el[i].eid]){ %>", '<span class="chat-icon-pad madel-list ticket-list">', '<img src="<%= attr.resource_url %><%= effectInfo[el[i].eid].icon  %>" title="<%= effectInfo[el[i].eid].txt %>" />', "</span>", "<% } %>", "<% } %>", "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if (madelConfig && isShowRankList) { %>", '<% if(handleEid(el[i].eid) === "cataRankList" && madelConfig[el[i].eid]){ %>', '<span class="chat-icon-pad madel-list">', '<a href="<%= handleJumpUrl(madelConfig[el[i].eid].link,"href") %>" style="<%= handleJumpUrl(madelConfig[el[i].eid].link,"style") %>" target="_blank">', '<img class="madel-no-count" src="/resource/<%= madelConfig[el[i].eid].web_img %>" title="<%= madelConfig[el[i].eid].desc %>" />', "</a>", "</span>", "<% } %>", "<% } %>", "<% } %>", "<% } %>", "<% if (madelConfig) { %>", "<% if ( guessRank ) { %>", '<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[guessRank].web_img %>" title="<%= madelConfig[guessRank].name %>"></a>', "<% } %>", "<% } %>", "<% if ( node.dlv > 0 && node.dc > 0) { %>", '<span class="chat-icon-pad cq-level c-lv<%= node.dlv %>" title="<%= node.cqt %>"><img src="<%= attr.web_url %>app/douyu/res/page/room-normal/cq_no0<%= node.dlv %>.png?v=<%= attr.web_ver %>" /><em>×<%= node.dc %></em></span>', "<% } else if ( node.bdlv > 0 ) { %>", '<img src="<%= attr.web_url %>app/douyu/res/page/room-normal/cq_other.png?v=<%= attr.web_ver %>" class="chat-icon-pad cq-other" title="酬勤用户"/>', "<% } %>", "<% if ( node.el.length && comboConfig ) { %>", "<% for(var i = 0, el = node.el, len = el.length; i < len; i++){ %>", "<% if ( el[i].etp && el[i].etp == 1) { %>", "<% if(comboConfig[el[i].eid]){ %>", '<span class="chat-icon-pad madel-list">', '<a href="<%= handleJumpUrl(comboConfig[el[i].eid].link,"href") %>" style="<%= handleJumpUrl(comboConfig[el[i].eid].link,"style") %>" target="_blank">', "<% if ( el[i].sc != 0 && comboConfig[el[i].eid].show_hits != 0 ) { %>", '<img src="<%= comboConfig[el[i].eid].web_icon %>" title="<%= comboConfig[el[i].eid].desc %>" />', '<em style="background-color:<%= comboConfig[el[i].eid].medal_bg_color %>;color:<%= comboConfig[el[i].eid].medal_font_color %>;">x<%= el[i].sc %></em>', "<% } else { %>", '<img class="madel-no-count" src="<%= comboConfig[el[i].eid].web_icon %>" title="<%= comboConfig[el[i].eid].desc %>" />', "<% } %>", "</a>", "</span>", "<% } %>", "<% } %>", "<% } %>", "<% } %>", "<% if ( node.egtt > 0 && node.egtt<=4&&node.egtt!=3) { %>", '<a class="chat-3six-title" title="<%=node.txtitle%>" >', '<img class="three6tx" src="<%= attr.web_url %>app/douyu/activity/res/3six/pc/dmtx_d_<%=node.egtt%>.gif" />', "</a>", "<% } %>", "<% if (node.el.length) { %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == yearFestival1) { %>", '<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[yearFestival1].web_img %>" title="<%= madelConfig[yearFestival1].name %>"></a>', "<% } %>", "<% if ( el[i].eid == yearFestival2) { %>", '<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[yearFestival2].web_img %>" title="<%= madelConfig[yearFestival2].name %>"></a>', "<% } %>", "<% if ( el[i].eid == yearFestival3) { %>", '<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[yearFestival3].web_img %>" title="<%= madelConfig[yearFestival3].name %>"></a>', "<% } %>", "<% if ( el[i].eid == yearFestival4) { %>", '<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[yearFestival4].web_img %>" title="<%= madelConfig[yearFestival4].name %>"></a>', "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == annualMedal1) { %>", '<a class="annualfestival-medal medal-1" href="/actives/YuleShengDian2017/competition" target="_blank" title="为斗鱼打call，很灵性"></a>', "<% } %>", "<% if ( el[i].eid == annualMedal2) { %>", '<a class="annualfestival-medal medal-2" href="/actives/YuleShengDian2017/competition" target="_blank" title="牌面这块给你整得明明白白的"></a>', "<% } %>", "<% if ( el[i].eid == annualMedal3) { %>", '<a class="annualfestival-medal medal-3" href="/actives/YuleShengDian2017/competition" target="_blank" title="这个鱼塘，我承包了"></a>', "<% } %>", "<% if ( el[i].eid == annualMedal4) { %>", '<a class="annualfestival-medal medal-4" href="/actives/YuleShengDian2017/competition" target="_blank" title="带就完事了"></a>', "<% } %>", "<% if ( el[i].eid == annualMedal5) { %>", '<a class="annualfestival-medal medal-5" href="/actives/YuleShengDian2017/competition" target="_blank" title="没时间解释了，快上车"></a>', "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == fansJuly1 && madelConfig[fansJuly1].desc && madelConfig[fansJuly1].web_img) { %>", '<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[fansJuly1].web_img %>" title="<%= madelConfig[fansJuly1].desc %>"></a>', "<% } %>", "<% if ( el[i].eid == fansJuly2 && madelConfig[fansJuly2].desc && madelConfig[fansJuly2].web_img) { %>", '<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[fansJuly2].web_img %>" title="<%= madelConfig[fansJuly2].desc %>"></a>', "<% } %>", "<% if ( el[i].eid == fansJuly3 && madelConfig[fansJuly3].desc && madelConfig[fansJuly3].web_img) { %>", '<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[fansJuly3].web_img %>" title="<%= madelConfig[fansJuly3].desc %>"></a>', "<% } %>", "<% if ( el[i].eid == fansJuly4 && madelConfig[fansJuly4].desc && madelConfig[fansJuly4].web_img) { %>", '<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[fansJuly4].web_img %>" title="<%= madelConfig[fansJuly4].desc %>"></a>', "<% } %>", "<% if ( el[i].eid == fansJuly5 && madelConfig[fansJuly5].desc && madelConfig[fansJuly5].web_img) { %>", '<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[fansJuly5].web_img %>" title="<%= madelConfig[fansJuly5].desc %>"></a>', "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", '<% if ( payTaskObj["1"] && el[i].eid === payTaskObj["1"].id ) { %>', '<a href="/web_game/welcome/18" target="_blank" class="chat-task-madel">', '<img src="<%= attr.web_url %>app/douyu/res/page/room-normal/task/madel-s2.png?v=<%= attr.web_ver %>"', ' title="<%=payTaskObj["1"].title%>" />', "</a>", "<% } %>", '<% if ( payTaskObj["2"] && el[i].eid === payTaskObj["2"].id ) { %>', '<a href="/web_game/welcome/18" target="_blank" class="chat-task-madel">', '<img src="<%= attr.web_url %>app/douyu/res/page/room-normal/task/madel-s1.png?v=<%= attr.web_ver %>"', ' title="<%=payTaskObj["2"].title%>" />', "</a>", "<% } %>", '<% if ( payTaskObj["4"] && el[i].eid === payTaskObj["4"].id ) { %>', '<a href="/web_game/welcome/18" target="_blank" class="chat-task-madel">', '<img src="<%= attr.web_url %>app/douyu/res/page/room-normal/task/madel-s3.png?v=<%= attr.web_ver %>"', ' title="<%=payTaskObj["4"].title%>" />', "</a>", "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == cdkeyNewIcon1 && madelConfig) { %>", '<img class="chat-icon-pad" src="/resource/<%= madelConfig[cdkeyNewIcon1].web_img %>" title="<%= madelConfig[cdkeyNewIcon1].desc %>">', "<% } %>", "<% if ( el[i].eid == cdkeyNewIcon2 ) { %>", '<img class="chat-icon-pad" src="/resource/<%= madelConfig[cdkeyNewIcon2].web_img %>" title="<%= madelConfig[cdkeyNewIcon2].desc %>">', "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == act5202017 && madelConfig) { %>", "<% if (act5202017Switch) {%>", '<a href="<%= madelConfig[act5202017].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[act5202017].web_img %>?20170424" title="<%= madelConfig[act5202017].desc %>" data-value="act5202017"></a>', "<% }else{ %>", '<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[act5202017].web_img %>?20170424" title="<%= madelConfig[act5202017].desc %>" data-value="act5202017"></a>', "<% } %>", "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == mayday2017 && madelConfig) { %>", "<% if (mayday2017Switch) {%>", '<a href="<%= madelConfig[mayday2017].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[mayday2017].web_img %>?20170424" title="<%= madelConfig[mayday2017].desc %>" data-value="mayday2017"></a>', "<% }else{ %>", '<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[mayday2017].web_img %>?20170424" title="<%= madelConfig[mayday2017].desc %>" data-value="mayday2017"></a>', "<% } %>", "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if (peopleBehalfSwitch == 1) { %>", "<% if ( el[i].eid == peopleBehalf1 && madelConfig[peopleBehalf1].desc && madelConfig[peopleBehalf1].web_img && madelConfig[peopleBehalf1].link) { %>", '<a href="<%= madelConfig[peopleBehalf1].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf1].web_img %>" title="<%= madelConfig[peopleBehalf1].desc %>"></a>', "<% } %>", "<% if ( el[i].eid == peopleBehalf2 && madelConfig[peopleBehalf2].desc && madelConfig[peopleBehalf2].web_img && madelConfig[peopleBehalf2].link) { %>", '<a href="<%=madelConfig[peopleBehalf2].link%>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf2].web_img %>" title="<%= madelConfig[peopleBehalf2].desc %>"></a>', "<% } %>", "<% if ( el[i].eid == peopleBehalf3 && madelConfig[peopleBehalf3].desc && madelConfig[peopleBehalf3].web_img && madelConfig[peopleBehalf3].link) { %>", '<a href="<%=madelConfig[peopleBehalf3].link%>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf3].web_img %>" title="<%= madelConfig[peopleBehalf3].desc %>"></a>', "<% } %>", "<% if ( el[i].eid == peopleBehalf4 && madelConfig[peopleBehalf4].desc && madelConfig[peopleBehalf4].web_img && madelConfig[peopleBehalf4].link) { %>", '<a href="<%=madelConfig[peopleBehalf4].link%>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf4].web_img %>" title="<%= madelConfig[peopleBehalf4].desc %>"></a>', "<% } %>", "<% if ( el[i].eid == peopleBehalf5 && madelConfig[peopleBehalf5].desc && madelConfig[peopleBehalf5].web_img && madelConfig[peopleBehalf5].link) { %>", '<a href="<%=madelConfig[peopleBehalf5].link%>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf5].web_img %>" title="<%= madelConfig[peopleBehalf5].desc %>"></a>', "<% } %>", "<% } else { %>", "<% if ( el[i].eid == peopleBehalf1 && madelConfig[peopleBehalf1].desc && madelConfig[peopleBehalf1].web_img && madelConfig[peopleBehalf1].link) { %>", '<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf1].web_img %>" title="<%= madelConfig[peopleBehalf1].desc %>"></a>', "<% } %>", "<% if ( el[i].eid == peopleBehalf2 && madelConfig[peopleBehalf2].desc && madelConfig[peopleBehalf2].web_img && madelConfig[peopleBehalf2].link) { %>", '<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf2].web_img %>" title="<%= madelConfig[peopleBehalf2].desc %>"></a>', "<% } %>", "<% if ( el[i].eid == peopleBehalf3 && madelConfig[peopleBehalf3].desc && madelConfig[peopleBehalf3].web_img && madelConfig[peopleBehalf3].link) { %>", '<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf3].web_img %>" title="<%= madelConfig[peopleBehalf3].desc %>"></a>', "<% } %>", "<% if ( el[i].eid == peopleBehalf4 && madelConfig[peopleBehalf4].desc && madelConfig[peopleBehalf4].web_img && madelConfig[peopleBehalf4].link) { %>", '<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf4].web_img %>" title="<%= madelConfig[peopleBehalf4].desc %>"></a>', "<% } %>", "<% if ( el[i].eid == peopleBehalf5 && madelConfig[peopleBehalf5].desc && madelConfig[peopleBehalf5].web_img && madelConfig[peopleBehalf5].link) { %>", '<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[peopleBehalf5].web_img %>" title="<%= madelConfig[peopleBehalf5].desc %>"></a>', "<% } %>", "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == girlDay2017 && madelConfig) { %>", "<% if (girlDay2017Switch) {%>", '<a href="<%= madelConfig[girlDay2017].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[girlDay2017].web_img %>" title="<%= madelConfig[girlDay2017].desc %>"></a>', "<% }else{ %>", '<a href="javascript:;" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[girlDay2017].web_img %>" title="<%= madelConfig[girlDay2017].desc %>"></a>', "<% } %>", "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == weekStarRank1 && madelConfig[weekStarRank1].desc && madelConfig[weekStarRank1].web_img && madelConfig[weekStarRank1].link) { %>", '<a href="<%= madelConfig[weekStarRank1].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[weekStarRank1].web_img %>" title="<%= madelConfig[weekStarRank1].desc %>"></a>', "<% } %>", "<% if ( el[i].eid == weekStarRank2 && madelConfig[weekStarRank2].desc && madelConfig[weekStarRank2].web_img && madelConfig[weekStarRank2].link) { %>", '<a href="<%=madelConfig[weekStarRank2].link%>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[weekStarRank2].web_img %>" title="<%= madelConfig[weekStarRank2].desc %>"></a>', "<% } %>", "<% if ( el[i].eid == weekStarRank3 && madelConfig[weekStarRank3].desc && madelConfig[weekStarRank3].web_img && madelConfig[weekStarRank3].link) { %>", '<a href="<%=madelConfig[weekStarRank3].link%>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[weekStarRank3].web_img %>" title="<%= madelConfig[weekStarRank3].desc %>"></a>', "<% } %>", "<% if ( el[i].eid == weekStarRank4 && madelConfig[weekStarRank4].desc && madelConfig[weekStarRank4].web_img && madelConfig[weekStarRank4].link) { %>", '<a href="<%=madelConfig[weekStarRank4].link%>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[weekStarRank4].web_img %>" title="<%= madelConfig[weekStarRank4].desc %>"></a>', "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", '<% if ( node.el.length && madelConfig && isDota2Page == "DOTA2") { %>', "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == dotaMatch ) { %>", "<% if (dotaMatchSwitch == 1) { %>", '<a href="<%= madelConfig[dotaMatch].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[dotaMatch].web_img %>" title="<%= madelConfig[dotaMatch].desc %>"></a>', "<% } else { %>", '<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[dotaMatch].web_img %>" title="<%= madelConfig[dotaMatch].desc %>"></a>', "<% } %>", "<% } %>", "<% } %>", "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == jifen && madelConfig) { %>", '<img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[jifen].web_img %>" title="<%= madelConfig[jifen].desc %>">', "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == dotaTIBadge && madelConfig) { %>", '<img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[dotaTIBadge].web_img %>" title="<%= madelConfig[dotaTIBadge].desc %>">', "<% } %>", "<% } %>", "<% } %>", "<% if ( node.el.length && madelConfig) { %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == aprilFool2017Icon4 ) { %>", "<% if (aprilFoolSwitch) {%>", '<a style="vertical-align: middle;" href="<%= madelConfig[aprilFool2017Icon4].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon4].web_img %>" title="完成愚人节登榜成就&#10;每天截止零点登上【无畏霸主榜】获得！"></a>', "<% }else{ %>", '<a style="vertical-align: middle;"><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon4].web_img %>" title="完成愚人节登榜成就&#10;每天截止零点登上【无畏霸主榜】获得！"></a>', "<% } %>", "<% } %>", "<% } %>", "<% } %>", "<% if ( node.el.length && madelConfig) { %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == aprilFool2017Icon1 ) { %>", "<% if (aprilFoolSwitch) {%>", '<a href="<%= madelConfig[aprilFool2017Icon1].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon1].web_img %>" title="<%= madelConfig[aprilFool2017Icon1].desc %>"></a>', "<% }else{ %>", '<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon1].web_img %>" title="<%= madelConfig[aprilFool2017Icon1].desc %>"></a>', "<% } %>", "<% break; } %>", "<% if ( el[i].eid == aprilFool2017Icon2 ) { %>", "<% if (aprilFoolSwitch) {%>", '<a href="<%= madelConfig[aprilFool2017Icon2].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon2].web_img %>" title="<%= madelConfig[aprilFool2017Icon2].desc %>"></a>', "<% }else{ %>", '<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon2].web_img %>" title="<%= madelConfig[aprilFool2017Icon2].desc %>"></a>', "<% } %>", "<% break; } %>", "<% if ( el[i].eid == aprilFool2017Icon3 ) { %>", "<% if (aprilFoolSwitch) {%>", '<a href="<%= madelConfig[aprilFool2017Icon3].link %>" target="_blank"><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon3].web_img %>" title="<%= madelConfig[aprilFool2017Icon3].desc %>"></a>', "<% }else{ %>", '<a><img class="chat-icon-pad" src="/resource/<%= madelConfig[aprilFool2017Icon3].web_img %>" title="<%= madelConfig[aprilFool2017Icon3].desc %>"></a>', "<% } %>", "<% break; } %>", "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == fansRecharge) { %>", '<span title="首充6元专属徽章" class="firstpay-award-icon"></span>', "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == valentMedal && madelConfig) { %>", '<img class="chat-icon-pad" src="<%= attr.resource_url %><%= madelConfig[valentMedal].web_img %>" title="<%= madelConfig[valentMedal].desc %>" />', "<% } %>", "<% } %>", "<% if (node.isOwnMedal && richManMedalConfig.conquerIcon) { %>", '<span class="richman-ownmedal" style="background-image: url(<%= richManMedalConfig.conquerIcon %>)"></span>', "<% } else if (node.isOwnMedal) { %>", '<span class="richman-ownmedal"></span>', "<% } %>", "<% if (node.isKingMedal && richManMedalConfig.sharkIcon) { %>", '<span class="richman-sharkmedal" style="background-image: url(<%= richManMedalConfig.sharkIcon %>)"></span>', "<% } else if (node.isKingMedal) { %>", '<span class="richman-sharkmedal"></span>', "<% } %>", "<% if (node.medalNickname && node.medalLv) { %>", "<% if (node.curRoomId != node.ownItRoomId) { %>", '<a class="chat-icon-pad" data-msg="fans" href="/<%= node.ownItRoomId %>" target="_blank" data-fans="<%= node.ownItRoomId%>" data-hc="<%= node.hc %>">', "<%=# returnMedalComponent({roomId: node.ownItRoomId, medalLev: node.medalLv, medalNick: node.medalNickname}, node.vipfan, 2) %>", "</a>", "<% } else { %>", '<span class="chat-icon-pad" data-msg="fans" data-fans="<%= node.ownItRoomId %>" data-hc="<%= node.hc%>">', "<%=# returnMedalComponent({roomId: node.ownItRoomId, medalLev: node.medalLv, medalNick: node.medalNickname}, node.vipfan, 2) %>", "</span>", "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == summerHighBadge) { %>", '<a href="https://www.douyu.com/actives/summer?#rank" target="_blank" class="chat-icon-pad anchor-level-icon summer_high_level" title="精神股东：高阶徽章"></a>', "<% isBreakSummerBadge = true; %>", "<% break; %>", "<% } %>", "<% } %>", "<% if (!isBreakSummerBadge) { %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == summerMiddleBadge) { %>", '<a href="https://www.douyu.com/actives/summer?#rank" target="_blank" class="chat-icon-pad anchor-level-icon summer_middle_level" title="精神股东：中阶徽章"></a>', "<% isBreakSummerBadge = true; %>", "<% break; %>", "<% } %>", "<% } %>", "<% } %>", "<% if (!isBreakSummerBadge) { %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == summerLowBadge) { %>", '<a href="https://www.douyu.com/actives/summer?#rank" target="_blank" class="chat-icon-pad anchor-level-icon summer_low_level" title="精神股东：低阶徽章"></a>', "<% isBreakSummerBadge = true; %>", "<% break; %>", "<% } %>", "<% } %>", "<% } %>", "<% if ( node.ol > 0 ) { %>", '<a class="chat-icon-pad anchor-level-icon" title="主播等级：<%= node.ol %>" data-anchor-levelimg="<%=node.ol%>">', "</a>", "<%} else if ( node.level > 0 && isShowUserLevel) { %>", '<a class="chat-icon-pad user-level<% if ( node.level < 10 ) { %> lve-icon-1to9 <% } %> <%= node.userIcon %> " title="用户等级：<%= node.level %>">', "</a>", "<% } %>", '<% if ( node.cbid && getMotorcadeConfig({cbid: node.cbid}) != "") { %>', '<span class="motorcade-icon" title="<%= getMotorcadeConfig({cbid: node.cbid}) %>" data-motorcade="<%= getMotorcadeConfig({cbid: node.cbid}) %>" style="background-image:url(<%= getMotorcadeBg({cbid: node.cbid}) %>)">', '<span class="motorcade-flag"><%= getMotorcadeConfig({cbid: node.cbid}) %></span>', "</span>", "<% } %>", '<% if ( handleEL("namegold",node.el) === "namegold" ) { %>', '<span class="name namegold" title="金色昵称">', '<% } else if(handleEL("namered",node.el) === "namered") { %>', '<span class="name namered" title="<%= payTaskObj["3"].title %>">', "<% } else { %>", '<span class="name">', "<% } %>", "<% if (nameColor) { %>", '<a href="javascript:;" style="color:#<%= nameColor %>" class="nick-new js-nick" clt="<%= node.ct %>" rel="<%= node.uid %>" avatar="<%= node.ic %>"  gid="<%= node.pg %>" is-show-super-icon="<%= node.sahf %>" data-noble="<%= node.nl %>"><%= node.nn %>：</a></span>', "<% } else { %>", '<a href="javascript:;" class="nick-new js-nick" clt="<%= node.ct %>" rel="<%= node.uid %>" avatar="<%= node.ic %>"  gid="<%= node.pg %>" is-show-super-icon="<%= node.sahf %>" data-noble="<%= node.nl %>"><%= node.nn %>：</a></span>', "<% } %>", "<% if (linkBarrage && linkBarrage.open) { %>", '<a class="hyperlink-chat-msg" data-msg-type="<%= linkBarrage.type %>" href="<%= linkBarrage.link %>" target="_blank">', '<span class="hyperlink-brace">【</span>', "<% } %>", '<span class="chat-msg-item <% if ( node.isSender ) { %>', "m", "<% } else { %>", "text-cont", '<% } %>" chatid="<% if ( node.pg < 5 ) { %>', "<%= node.cid %>", '<% } %>" <% if ( node.col >= 1 && node.col <= 6) { %>', 'style="color:<%= node.color %>"', "<% }else if ( +node.col >= 1000 && +node.col <= 1100 ){ %>", 'style="color:<%= node.color %>"', "<% } %>>", "<%=# node.txt %>", "</span>", "<% if (linkBarrage && linkBarrage.open) { %>", '<span class="hyperlink-brace">】</span>', "</a>", "<% } %>", '<% if (node.shark === "hjs") { %>', '<a href="/cms/zt/mayday.html" target="_blank">', '<img src="<%= attr.web_url %>app/douyu/activity/res/mayday/pc/shark-hjs.gif?v=<%= attr.web_ver %>"', ' title="狠角色宝宝专享特权：直播间进入提示，免费\n专享彩色弹幕，限量狠角色宝宝30天出入跟随" />', "</a>", "<% } %>", "<% if (node.el.length && madelConfig) { %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% if ( el[i].eid == sharkKingIcon) { %>", "<% if (sharkKingSwitch) {%>", '<a class="sharkbaby-animation" target="_blank" href="/t/DouyuKing"', 'title="完成充值或收集成就！尊享珍藏鲨鱼王萌宠" data-value="<%= sharkKingIcon %>"><img src="<%= attr.web_url %>app/douyu/res/page/room-normal/sharkbaby/sharkbaby.gif?v=<%= attr.web_ver %>" alt=""></a>', "<% }else{ %>", '<a class="sharkbaby-animation" href="javascript:;"', 'title="完成充值或收集成就！尊享珍藏鲨鱼王萌宠" data-value="<%= sharkKingIcon %>"><img src="<%= attr.web_url %>app/douyu/res/page/room-normal/sharkbaby/sharkbaby.gif?v=<%= attr.web_ver %>" alt=""></a>', "<% } %>", "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<% for (var key in annualfestival) { %>", "<% if ( el[i].eid == key ) { %>", '<a class="worldfans-animation" href="javascript:;"', 'title="<%= annualfestival[key].name || "" %>" data-value="<%= key %>"><img src="<%= annualfestival[key].pic %>?v=<%= attr.web_ver %>" alt=""></a>', "<% } %>", "<% } %>", "<% } %>", "<% for (var i = 0, el = node.el, len = el.length; i < len; i++) { %>", "<%if ( node.el[i].eid == aprilFool2017Baby1 ) { %>", "<% if(aprilFoolSwitch){ %>", '<a data-uid="<%=node.uid%>" href="<%=aprilFoolUrl%>" target="_blank"><img src="<%= attr.web_url %>/app/douyu/activity/res/foolsday/foolsday-pet.gif?v=<%= attr.web_ver %>" title="老铁获得愚人节成就，没毛病！"></a>', "<% }else{ %>", '<a><img src="<%= attr.web_url %>/app/douyu/activity/res/foolsday/foolsday-pet.gif?v=<%= attr.web_ver %>" title="老铁获得愚人节成就，没毛病！"></a>', "<% } %>", "<% } %>", "<% } %>", "<% } %>", "</p>", "</li>"), b = g.barrage.RENDER = n.compile(h));
			var I = w.nl ? x[w.nl] : null,
				j = "";
			return 1 === w.nc ? j = "js-noble-barrage-tag noble-chart" : w.hl && parseInt(w.hl, 10) && (j = "js-noble-barrage-tag js-fans-chart"), k = b({
				node: w,
				comboConfig: e.isEmptyObject(f) ? null : f,
				madelConfig: e.isEmptyObject(_) ? null : _,
				handleJumpUrl: v.handleJumpUrl,
				handleEid: v.handleEid,
				isShowRankList: 1 === parseInt(s.get("room.is_show_rank_list"), 10),
				payTaskObj: y,
				handleEL: v.handleEL,
				returnMedalComponent: r.returnMedalComponent,
				getMotorcadeConfig: o.getMotorcadeConfig,
				getMotorcadeBg: o.getMotorcadeBg,
				linkBarrage: v.handleLinkBarrage(w.lk),
				aprilFoolUrl: "/t/DouyuFoolsDay",
				aprilFoolSwitch: s.get("colligate.activitySwitch.aprilfool"),
				aprilFool2017Icon1: 1500000134,
				aprilFool2017Icon2: 1500000133,
				aprilFool2017Icon3: 1500000132,
				aprilFool2017Icon4: 1500000131,
				aprilFool2017Baby1: 1500000135,
				cdkeyNewIcon1: 1500000114,
				cdkeyNewIcon2: 1500000115,
				effectInfo: $ROOM.effectInfo,
				attr: {
					web_url: s.get("sys.web_url"),
					resource_url: s.get("sys.resource_url"),
					web_ver: "20180608"
				},
				nobleInfo: I,
				nobleClass: j,
				girlDay2017: 1500000120,
				girlDay2017Switch: s.get("room.rankActivity.nsj2017.activeTimeOnline"),
				dotaMatch: 1500000122,
				isDota2Page: s.get("room.second_lvl_name"),
				dotaMatchSwitch: s.get("colligate.activitySwitch.dota2kiev"),
				annualfestival: p,
				sharkKingIcon: 1500000124,
				sharkKingSwitch: s.get("colligate.activitySwitch.shark_kings"),
				weekStarRank1: 1500000142,
				weekStarRank2: 1500000141,
				weekStarRank3: 1500000140,
				weekStarRank4: 1500000139,
				peopleBehalf1: 1500000146,
				peopleBehalf2: 1500000147,
				peopleBehalf3: 1500000148,
				peopleBehalf4: 1500000149,
				peopleBehalf5: 1500000150,
				peopleBehalfSwitch: s.get("colligate.activitySwitch.ren_min"),
				mayday2017: 1500000151,
				mayday2017Switch: s.get("colligate.activitySwitch.mayday2017"),
				act5202017: 1500000157,
				act5202017Switch: s.get("colligate.activitySwitch.activity520_rank"),
				fansRecharge: 1500000160,
				fansJuly1: 1500000163,
				fansJuly2: 1500000164,
				fansJuly3: 1500000165,
				fansJuly4: 1500000166,
				fansJuly5: 1500000167,
				annualMedal1: 1500000208,
				annualMedal2: 1500000209,
				annualMedal3: 1500000210,
				annualMedal4: 1500000211,
				annualMedal5: 1500000212,
				jifen: 1500000219,
				nameColor: m(w.el),
				yearFestival1: 1500000225,
				yearFestival2: 1500000226,
				yearFestival3: 1500000227,
				yearFestival4: 1500000228,
				fansDay03Medal: [1500000231, 1500000232, 1500000233, 1500000234, 1500000235, 1500000236, 1500000237, 1500000238],
				guessRank: S,
				isShowUserLevel: c,
				richManMedalConfig: u,
				kplVoteMedal: C(),
				summerHighBadge: 1500000272,
				summerMiddleBadge: 1500000271,
				summerLowBadge: 1500000270,
				isBreakSummerBadge: !1,
				dotaTIBadge: 1500000273,
				valentMedal: 1500000275
			})
		}
	}, g.barrage.RENDER = null, g.checkGirlPri = function(e, t, i) {
		for (var a = 0, n = e.length; n > a; a++) if (e[a].eid == t) return 1;
		return 0
	}, g.checkGuessRank = function(e) {
		for (var t = ["1500010941", "1600030486", "1500000230"], i = 0, a = e.length; a > i; i++) for (var n = 0, s = t.length; s > n; n++) if (e[i].eid == t[n]) return e[i].eid;
		return 0
	}, g.userEnter = function(r, l) {
		var d, u, f, p = {},
			m = r;
		m.cqt = v.getUserCqName(r.dlv) || "", m.uli = v.returnUlevelClass(r.level), m.bgt = Math.pow(10, r.gt), r.ut = r.ut || "", m.ut = a.isArray(r.ut) ? a.decode(r.ut) : [{
			value: r.ut
		}], m.el = v.processArrData(m.el), m.highLevel = 120, m.levelWel = parseInt(m.lev / 2, 10) + 1, m.ol = parseInt(r.ol, 10) || 0, m.girlPrivilege = g.checkGirlPri(m.el, 1500000173, m);
		var h = g.checkGuessRank(m.el);
		if (p = v.handleUserEnter(m), p.mark) return "";
		if (p.html) {
			if (m.el) for (var b = 0, k = m.el.length; k > b; b++) 1500000123 === parseInt(m.el[b].eid, 10) && t.fire("mod.userenter.get.sharkKing", m);
			return p.html
		}
		return m.crw = m.crw ? parseInt(m.crw) : 0, m.crw ? f = t.fire("mod.userenter.get.rankwel", m) || "" : (g.userEnter.RENDER ? u = g.userEnter.RENDER : (d = i.string.join('<li class="jschartli" data-type="list" data-level="<%=node.level%>" ', "<% if ( node.ol > 0 ) { %>", 'data-anchor-level="<%=node.ol%>"', "<% } %>", ">", '<% var taskwel = (handleEL("taskwel",node.el) === "taskwel") %>', "<% var taskbx = (handleBX(node.el, blizzardtvId, blizzardtvCates) === true) %>", "<% if ( taskwel ) { %>", '<p class="text-cont task-wel">', "<% } else { %>", '<p class="text-cont">', "<% if (guessRank) { %>", '<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resourceUrl %><%= madelConfig[guessRank].web_img %>" title="<%= madelConfig[guessRank].name %>"></a>', "<% } %>", "<% if ( node.el.length && comboConfig ) { %>", "<% for(var i = 0, el = node.el, len = el.length; i < len; i++){ %>", "<% if ( el[i].etp && el[i].etp == 1 && el[i].eid != dmxyId && el[i].eid != rioId && el[i].eid != rioFlagId) { %>", "<% if(comboConfig[el[i].eid]){ %>", '<span class="chat-icon-pad madel-list">', '<a href="<%= handleJumpUrl(comboConfig[el[i].eid].link,"href") %>" style="<%= handleJumpUrl(comboConfig[el[i].eid].link,"style") %>" target="_blank">', "<% if ( el[i].sc != 0 && comboConfig[el[i].eid].show_hits != 0 ) { %>", '<img src="<%= comboConfig[el[i].eid].web_icon %>" title="<%= comboConfig[el[i].eid].desc %>" />', '<em style="background-color:<%= comboConfig[el[i].eid].medal_bg_color %>;color:<%= comboConfig[el[i].eid].medal_font_color %>;">x<%= el[i].sc %></em>', "<% } else { %>", '<img class="madel-no-count" src="<%= comboConfig[el[i].eid].web_icon %>" title="<%= comboConfig[el[i].eid].desc %>" />', "<% } %>", "</a>", "</span>", "<% } %>", "<% } %>", "<% } %>", "<% } %>", "<% if ( node.egtt > 0 && node.egtt<=4&&node.egtt!=3) { %>", '<a class="chat-3six-title" title="<%=node.txtitle%>" >', '<img class="three6tx-un" src="<%= attr.web_url %>app/douyu/activity/res/3six/pc/dmtx_h_<%=node.egtt%>.gif" />', "</a>", "<% } %>", "<% } %>", "<% if ( node.ol > 0 ) { %>", '<a class="chat-icon-pad anchor-level-icon" title="主播等级：<%= node.ol %>" data-anchor-levelimg="<%=node.ol%>">', "</a>", "<%} else if ( node.level > 0 &&　isShowUserLevel) { %>", '<a class="chat-icon-pad user-level<% if ( node.level < 10 ) { %> lve-icon-1to9 <% } %> <%= node.uli %> " title="用户等级：<%= node.level %>">', "</a>", "<% } %>", '<% if ( node.cbid && getMotorcadeConfig({cbid: node.cbid}) != "") { %>', '<span class="motorcade-icon" title="<%= getMotorcadeConfig({cbid: node.cbid}) %>" data-motorcade="<%= getMotorcadeConfig({cbid: node.cbid}) %>" style="background-image:url(<%= getMotorcadeBg({cbid: node.cbid}) %>)">', '<span class="motorcade-flag"><%= getMotorcadeConfig({cbid: node.cbid}) %></span>', "</span>", "<% } %>", "<% if ( taskwel ) { %>", '<a href="javascript:;" class="nick-new js-nick" rel="<%= node.uid %>" is-show-super-icon="<%=node.sahf %>" avatar="<%= node.ic %>" gid="<%= node.pg %>" title="<%= node.nn %>" data-noble="<%= node.nl %>"><%= node.nn %></a>', "<span>欢迎您来到本直播间</span>", "<% } else { %>", "<% if ( taskbx ) { %>", "<span>风暴英雄 </span>", "<% } %>", '<a href="javascript:;" class="nick-new js-nick" rel="<%= node.uid %>" is-show-super-icon="<%=node.sahf %>"  avatar="<%= node.ic %>" gid="<%= node.pg %>" data-noble="<%= node.nl %>"><%= node.nn %></a>', "<span>欢迎来到本直播间</span>", "<% } %>", "</p>", "</li>"), u = g.userEnter.RENDER = n.compile(d)), f = u({
			node: m,
			comboConfig: e.isEmptyObject(l) ? null : l,
			getMotorcadeConfig: o.getMotorcadeConfig,
			getMotorcadeBg: o.getMotorcadeBg,
			handleJumpUrl: v.handleJumpUrl,
			dmxyId: 1500000001,
			rioId: 1500000007,
			rioFlagId: 1500000020,
			payTaskObj: y,
			handleEL: v.handleEL,
			blizzardtvId: 1500000078,
			blizzardtvCates: [148, 4, 32, 2, 35, 5, 55],
			handleBX: function(e, t, i) {
				var a = 0;
				for (a = 0; a < e.length && e[a].eid != t; ++a);
				if (a === e.length) return !1;
				for (a = 0; a < i.length && i[a] != $ROOM.cate_id; ++a);
				return a !== i.length
			},
			attr: {
				web_url: s.get("sys.web_url"),
				web_ver: "20170627",
				resourceUrl: w
			},
			madelConfig: _,
			guessRank: h,
			isShowUserLevel: c
		}))
	}, g.userEnter.RENDER = null, g.lottery = function(e) {
		e = a.decode(e).too();
		var t, r, o, l, c = e.sl || 0,
			d = e.gl / 100 || 0;
		return l = c > 0 ? d > 0 ? "赠送过" + c + "鱼丸以上或" + d + "鱼翅以上" : "赠送过" + c + "鱼丸以上" : d > 0 ? "赠送过" + d + "鱼翅以上" : "", g.lottery.RENDER ? r = g.lottery.RENDER : (t = i.string.join('<li class="jschartli normal-notice-new" data-type="list">', '<i class="sys-icon"></i>', '<div class="my_cont clearfix">', '<div class="mycont-r">', "主播将会在", "<span><%= secstr %></span>", "开始从", "<span><%= condition %></span>", "的用户中抽取幸运观众，快来参与吧~", "</div>", "</div>", "</li>"), r = g.lottery.RENDER = n.compile(t)), o = r({
			secstr: e.sec < 60 ? e.sec + "秒后" : parseInt(e.sec / 60, 10) + "分钟后",
			condition: l,
			attr: {
				web_url: s.get("sys.web_url")
			}
		})
	}, g.lottery.RENDER = null, g.setAdmin = function(e) {
		var t, a, s;
		return g.setAdmin.RENDER ? a = g.setAdmin.RENDER : (t = i.string.join("<% if ( node.rescode == 0 && node.group > 1 ) { %>", '<li class="jschartli sys-msg sys-msg-success" data-level="<%=node.level%>">', "<% } else { %>", '<li class="jschartli sys-msg" data-level="<%=node.level%>">', "<% } %>", '<p class="text-cont">', '<i class="sys-icon"></i>', '<span class="sys-title">系统提示：</span>', "<% if ( node.rescode == 0 ) { %>", '<a href="javascript:;" class="nick-new js0nick" rel="<%= node.userid %>"><%= node.adnick %></a>', "<% if ( node.group > 1 ) { %>", "<span>被任命为房管</span>", "<% } else { %>", "<span>被解除房管身份</span>", "<% } %>", "<% } else if ( node.rescode == 214 ) { %>", "<span>房管数量已达上限</span>", "<% } else if ( node.rescode == 206 ) { %>", "<span>非法操作</span>", "<% } else if ( node.rescode == 208 ) { %>", "<span>用户不在房间</span>", "<% } %>", "</p>", "</li>"), a = g.setAdmin.RENDER = n.compile(t)), s = a({
			node: e
		})
	}, g.setAdmin.RENDER = null, g.oneKey = function(e) {
		var t, a, s;
		return g.oneKey.RENDER ? a = g.oneKey.RENDER : (t = i.string.join('<li class="jschartli sys-msg" data-level="<%=node.level%>">', '<p class="text-cont">', '<i class="sys-icon"></i>', "<% if ( node.ret == 0 ) { %>", '<span class="sys-title">系统提示：</span>', '<span class="nick-new"><%= node.uname %></span>被封号', "<% } else if (node.ret == 208) { %>", '<span class="sys-title">系统提示：</span>', '<span class="nick-new"><%= node.uname %></span>已被封禁或已被一键封号', "<% } else { %>", '<span class="sys-title">消息提醒：</span>', '对<span class="nick-new"><%= node.uname %></span>进行一键封号失败，错误码：<%= node.ret %>', "<% } %>", "</p>", "</li>"), a = g.oneKey.RENDER = n.compile(t)), s = a({
			node: e
		})
	}, g.oneKey.RENDER = null, g.sysMsgTips = function(t) {
		var a, s, r;
		if (e.trim(t.msg)) {
			g.sysMsgTips.RENDER ? s = g.sysMsgTips.RENDER : (a = i.string.join('<div class="sys-tips">', '<span class="sys-tips-txt"><span class="sys-tips-icon"></span><%=node.msg%></span>', "</div>"), s = g.sysMsgTips.RENDER = n.compile(a)), r = s({
				node: t
			});
			var o = e(r);
			e("#js-chat-cont").append(o), o.fadeIn(400).delay(3e3).fadeOut(400, function() {
				o.remove()
			})
		}
	}, g.sysMsgTips.RENDER = null, g.sysMsg = function(t) {
		var a, s, r;
		if (e.trim(t.msg)) return g.sysMsg.RENDER ? s = g.sysMsg.RENDER : (a = i.string.join("<% if ( node.success && node.success == 1 ) { %>", '<li class="jschartli sys-msg sys-msg-success" data-level="<%=node.level%>" ', "<% if ( node.ol > 0 ) { %>", 'data-anchor-levelimg="<%=node.ol%>"', "<% } %>", ">", "<% } else { %>", '<li class="jschartli sys-msg" data-level="<%=node.level%>" ', "<% if ( node.ol > 0 ) { %>", 'data-anchor-levelimg="<%=node.ol%>"', "<% } %>", ">", "<% } %>", '<p class="text-cont">', '<i class="sys-icon"></i>', '<span class="sys-title">系统提示：</span>', "<%= node.msg %>", "</p>", "</li>"), s = g.sysMsg.RENDER = n.compile(a)), r = s({
			node: t
		})
	}, g.sysMsg.RENDER = null, g.sysHtmlMsg = function(t) {
		var a, s, r;
		if (e.trim(t.msg)) return g.sysHtmlMsg.RENDER ? s = g.sysHtmlMsg.RENDER : (a = i.string.join("<% if ( node.success && node.success == 1 ) { %>", '<li class="jschartli sys-msg sys-msg-success" data-level="<%=node.level%>" ', "<% if ( node.ol > 0 ) { %>", 'data-anchor-level="<%=node.ol%>"', "<% } %>", ">", "<% } else { %>", '<li class="jschartli sys-msg" data-level="<%=node.level%>" ', "<% if ( node.ol > 0 ) { %>", 'data-anchor-level="<%=node.ol%>"', "<% } %>", ">", "<% } %>", '<p class="text-cont">', '<i class="sys-icon"></i>', '<span class="sys-title">系统提示：</span>', "<%=# node.msg %>", "</p>", "</li>"), s = g.sysHtmlMsg.RENDER = n.compile(a)), r = s({
			node: t
		})
	}, g.sysHtmlMsg.RENDER = null, g.chouqin = function(e) {
		e = a.decode(e).too();
		var t, o, l, u = a.decode(e.sui).too(),
			f = u.level,
			p = e.lev;
		return g.chouqin.RENDER ? o = g.chouqin.RENDER : (t = i.string.join('<li class="jschartli" data-type="list" data-level="<%=userLev%>">', "<% if ( nl && nobleConfig[nl] ) { %>", '<span class="chat-icon-pad user-noble">', '<img src="<%= resourceUrl %><%= nobleConfig[nl].symbol.web_symbol_pic1 %>" title="<%= nobleConfig[nl].symbol.name %>" />', "</span>", "<% } %>", "<% if (bnn && bl && brid) {%>", "<% if (brid != curRoomId) { %>", '<a class="chat-icon-pad" href="/<%= brid%>" target="_blank" data-fans="<%= brid %>" data-hc="<%= hc %>" data-msg="fans">', "<%=# returnMedalComponent({roomId: brid, medalLev: bl, medalNick: bnn}) %>", "</a>", "<% } else { %>", '<span class="chat-icon-pad" data-fans="<%= brid %>" data-hc="<%= hc %>" data-msg="fans">', "<%=# returnMedalComponent({roomId: brid, medalLev: bl, medalNick: bnn}) %>", "</span>", "<% } %>", "<% } %>", "<% if ( userLev > 0 && isShowUserLevel) { %>", '<a class="chat-icon-pad user-level<%=ulevIn1t9 ? " lve-icon-1to9" : ""%> <%=userIcon%> " title="用户等级：<%=userLev%>">', "</a>", "<% } %>", '<a href="javascript:;" class="nick js-nick" rel="<%=userId%>" is-show-super-icon="<%=sahf%>" avatar="<%=ic%>" clt="<%=clt%>" gid="<%=spg%>" data-noble=<%= nl %>><%=userNick%></a>', "赠送了<%=cqName%>", '<img src="<%=cqLevIcon%>">', "<span>获得了本房间</span>", '<span class="s-cq">', '<img src="<%=cqTitIcon%>">', "</span>", "<span>头衔30天</span>", "</li>"), o = g.chouqin.RENDER = n.compile(t)), l = o({
			ulevIn1t9: f >= 1 && 9 >= f,
			userId: u.id,
			userNick: u.nick,
			spg: u.pg || 1,
			clt: u.ct || 0,
			userLev: f,
			userIcon: v.returnUlevelClass(f),
			cqName: v.getCqName(p),
			cqLevIcon: v.getCqLevIcon(p),
			cqTitIcon: v.getCqTitIcon(p),
			ic: u.icon || "",
			resourceUrl: w,
			nl: u.nl || 0,
			nobleConfig: x,
			bnn: e.bnn || "",
			brid: parseInt(e.brid, 10) || "",
			bl: e.bl || 1,
			hc: e.hc || "",
			curRoomId: parseInt(s.get("room.room_id"), 10),
			fansMedal: d || {},
			sahf: isNaN(e.sahf) ? 1 : e.sahf,
			returnMedalComponent: r.returnMedalComponent,
			isShowUserLevel: c
		})
	}, g.chouqin.RENDER = null, g.gift = function(e, t) {
		e = a.decode(e).too();
		var l, u, f, p = {
			1: 25,
			2: 35,
			3: 45,
			4: 50,
			5: 55,
			6: 60
		},
			m = t[e.gfid],
			h = v.processArrData(e.el),
			y = g.checkGirlPri(h, 1500000173, e),
			b = y ? "chat-girl" : "",
			k = g.checkGuessRank(h);
		return g.gift.RENDER ? u = g.gift.RENDER : (l = i.string.join('<li class="jschartli" data-type="list" data-level="<%=userLev%>">', '<p class="text-cont">', "<% if ( nl && nobleConfig[nl] ) { %>", '<span class="chat-icon-pad user-noble">', '<img src="<%= attr.resourceUrl %><%= nobleConfig[nl].symbol.web_symbol_pic1 %>" title="<%= nobleConfig[nl].symbol.name %>" />', "</span>", "<% } %>", "<% if (guessRank) { %>", '<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resourceUrl %><%= madelConfig[guessRank].web_img %>" title="<%= madelConfig[guessRank].name %>"></a>', "<% } %>", "<% if (bnn && bl && brid) {%>", "<% if (brid != curRoomId) { %>", '<a class="chat-icon-pad" href="/<%= brid%>" target="_blank" data-fans="<%= brid %>" data-hc="<%= hc %>" data-msg="fans">', "<%=# returnMedalComponent({roomId: brid, medalLev: bl, medalNick: bnn}, vipfan, 2) %>", "</a>", "<% } else { %>", '<span class="chat-icon-pad" data-fans="<%= brid %>" data-hc="<%= hc %>" data-msg="fans">', "<%=# returnMedalComponent({roomId: brid, medalLev: bl, medalNick: bnn}, vipfan, 2) %>", "</span>", "<% } %>", "<% } %>", "<% if ( userLev > 0 && isShowUserLevel) { %>", '<a class="chat-icon-pad user-level<%=ulevIn1t9 ? " lve-icon-1to9" : ""%> <%=userIcon%> " title="用户等级：<%=userLev%>">', "</a>", "<% } %>", '<% if ( cbid && getMotorcadeConfig({cbid: cbid}) != "") { %>', '<span class="motorcade-icon" title="<%= getMotorcadeConfig({cbid: cbid}) %>" data-motorcade="<%= getMotorcadeConfig({cbid: cbid}) %>" style="background-image:url(<%= getMotorcadeBg({cbid: cbid}) %>)">', '<span class="motorcade-flag"><%= getMotorcadeConfig({cbid: cbid}) %></span>', "</span>", "<% } %>", '<a href="javascript:;" class="nick-new <%= girlCls %> js-nick" clt="<%=clt%>" rel="<%=uid%>" is-show-super-icon="<%=sahf%>" avatar="<%=ic%>" gid="<%=pg%>" data-noble="<%= nl %>"><%=nn%></a>', "<span>赠送给主播</span>", '<img class="lw-imgs" src="<%=giftCImg%>" width="22" height="22">', "<% if (gfcnt > 1) { %>", '<span class="gfcnt" style="display:inline-block;">x<%=gfcnt%> </span>', "<% if (bcnt > 1) { %>", '<span class="hy-org" style="display:inline-block;"> <%=bcnt%>连击</span>', "<% } %>", "<% } else  {%>", "<% if (hits > 1) { %>", '<span class="hy-org" style="display:inline-block;"><%=hits%>连击</span>', "<% } %>", "<% } %>", "</p>", "</li>"), u = g.gift.RENDER = n.compile(l)), f = u({
			clt: e.ct || 0,
			uid: e.uid,
			nn: e.nn,
			dlv: e.dlv || 0,
			dc: e.dc || 0,
			bdl: e.bdl || 0,
			pg: e.pg || 1,
			rg: e.rg || 1,
			bnn: e.bnn || "",
			bl: parseInt(e.bl, 10) || 1,
			brid: parseInt(e.brid, 10) || "",
			hc: e.hc,
			girlPrivilege: y,
			girlCls: b,
			curRoomId: parseInt(s.get("room.room_id"), 10),
			hits: e.hits || 1,
			gfcnt: e.gfcnt || 1,
			bcnt: e.bcnt || 0,
			userLev: e.level,
			userIcon: v.returnUlevelClass(e.level),
			ulevIn1t9: e.level >= 1 && e.level <= 9,
			cqName: v.getUserCqName(e.dlv),
			cqTitIcon: v.getCqTitIcon(e.dlv),
			giftType: m.type,
			giftCount: m.pc,
			giftCImg: m.cimg,
			giftName: m.name,
			giftWidth: p[m.style],
			giftHeight: p[m.style],
			attr: {
				web_url: s.get("sys.web_url"),
				resourceUrl: w
			},
			ic: e.ic || "",
			nl: e.nl || 0,
			nobleConfig: x,
			fansMedal: d || {},
			sahf: isNaN(e.sahf) ? 1 : e.sahf,
			returnMedalComponent: r.returnMedalComponent,
			vipfan: e.vipfan || 0,
			getMotorcadeConfig: o.getMotorcadeConfig,
			getMotorcadeBg: o.getMotorcadeBg,
			cbid: e.cbid || "",
			madelConfig: _,
			guessRank: k,
			isShowUserLevel: c
		})
	}, g.gift.RENDER = null, g.balls = function(e, t) {
		e = a.decode(e).too();
		var r, o, l, d = a.decode(e.sui).too(),
			u = v.processArrData(e.el),
			f = g.checkGirlPri(u, 1500000173, e),
			p = f ? "chat-girl" : "",
			m = g.checkGuessRank(u);
		return g.balls.RENDER ? o = g.balls.RENDER : (r = i.string.join('<li class="jschartli older-balls" data-type="list" data-level="<%=userLev%>">', '<p class="text-cont">', "<% if ( nl && nobleConfig[nl] ) { %>", '<span class="chat-icon-pad user-noble">', '<img src="<%= attr.resourceUrl %><%= nobleConfig[nl].symbol.web_symbol_pic1 %>" title="<%= nobleConfig[nl].symbol.name %>" />', "</span>", "<% } %>", "<% if (guessRank) { %>", '<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resourceUrl %><%= madelConfig[guessRank].web_img %>" title="<%= madelConfig[guessRank].name %>"></a>', "<% } %>", "<% if ( userLev > 0 && isShowUserLevel) { %>", '<a class="chat-icon-pad user-level<%=ulevIn1t9 ? " lve-icon-1to9" : ""%> <%=userIcon%> " title="用户等级：<%=userLev%>">', "</a>", "<% } %>", '<a href="javascript:;" class="nick <%= girlCls %> js-nick" rel="<%=uid%>" avatar="<%=ic%>" gid="<%=pg%>" data-noble="<%= nl %>"><%=nn%></a>', "<span>赠送给主播</span>", '<span style="display:inline-block;"><%=giftCount%>个鱼丸</span>', '<img class="lw-imgs" src="<%=attr.web_url%>app/douyu/res/page/room-normal/gift/mobile-yw-100.png?v=20160331" />', "</p>", "</li>"), o = g.balls.RENDER = n.compile(r)), l = o({
			uid: d.id,
			nn: d.nick,
			dlv: d.cur_lev || 0,
			dc: d.cq_cnt || 0,
			bdl: d.best_dlev || 0,
			pg: d.pg || 1,
			rg: d.rg || 1,
			hits: e.hc || 1,
			girlPrivilege: f,
			girlCls: p,
			userLev: d.level,
			userIcon: v.returnUlevelClass(d.level),
			ulevIn1t9: d.level >= 1 && d.level <= 9,
			cqName: v.getUserCqName(d.cur_lev),
			cqTitIcon: v.getCqTitIcon(d.cur_lev),
			giftCount: e.ms,
			attr: {
				web_url: s.get("sys.web_url"),
				resourceUrl: w
			},
			ic: d.ic || "",
			nl: d.nl,
			nobleConfig: x,
			madelConfig: _,
			guessRank: m,
			isShowUserLevel: c
		})
	}, g.balls.RENDER = null, g.rankupdate = function(e) {
		e = a.decode(e).too();
		var r, o, l, c = parseInt(e.rn, 10),
			d = t.fire("mod.center.userrole.get"),
			u = parseInt(e.ih),
			f = e.nk;
		return u && (d.isAnchor() || d.isSuperAdmin() || s.get("sys.uid") == e.uid) && (f = e.nk + "(已隐身)"), c > h ? "" : (g.rankupdate.RENDER ? o = g.rankupdate.RENDER : (r = i.string.join('<li class="jschartli normal-notice-new" data-level="<%=level%>" data-type="list">', '<i class="sys-icon"></i>', '<div class="clearfix">', '<div class="mycont-r">', "<% if (broadcastType == 2 || broadcastType == 4) { %>", "<span>恭喜</span>", '<a class="nick-new js-nick <%= isVisible ? "status--invisible":"" %>" href="javascript:;" target="_blank"><%=userNick%></a>', "<% } else { %>", "<span>恭喜</span>", '<a class="nick-new js0nick <%= isVisible ? "status--invisible":"" %>"><%=userNick%></a>', "<% } %>", "<span>的<%=rankTypeName%>排名上升到了</span>", '<span class="highLight">第<%=rankNum%>名</span>！', "</div>", "</div>", "</li>"), o = g.rankupdate.RENDER = n.compile(r)), l = o({
			dstRoomId: "",
			userNick: f,
			level: e.level,
			rankNum: e.rn,
			isVisible: u,
			rankTypeName: v.getRankTypeName(e.rkt),
			broadcastType: e.bt,
			attr: {
				web_url: s.get("sys.web_url")
			}
		}))
	}, g.rankupdate.RENDER = null, g.rankgap = function(e) {
		e = a.decode(e).too();
		var t = parseInt(e.nz, 10);
		if (1 !== t && 3 !== t) return "";
		var r, o, l, c = parseInt(e.urn, 10);
		return c > h ? "" : (g.rankgap.RENDER ? o = g.rankgap.RENDER : (r = i.string.join('<li class="jschartli normal-notice-new" data-level="<%=level%>">', '<i class="sys-icon"></i>', '<div class="my-cont clearfix">', '<div class="mycont-r">', '<span class="highLight">消息提醒：</span>', "<span>继续赠送</span>", '<span class="highLight"><%=contributionGap%></span>', "点贡献值，", "<span>您就可以升到<%=rankTypeName%></span>", '<span class="highLight highLight2">第<%=urln%>名</span>', "</div>", "</div>", "</li>"), o = g.rankgap.RENDER = n.compile(r)), l = o({
			contributionGap: e.cg,
			rankTypeName: v.getRankTypeName(e.rt),
			urln: e.urn - 1,
			attr: {
				web_url: s.get("sys.web_url")
			}
		}))
	}, g.rankgap.RENDER = null, g.luckburst = function(e) {
		if (e = a.decode(e).too(), !e.ur) return "";
		var t, r, o, l, d = parseInt(e.sil, 10),
			u = parseInt(e.ur, 10),
			l = d / u,
			f = parseInt(e.ct, 10);
		parseInt(e["if"], 10);
		return 1 == f && l >= 1e3 ? (g.luckburst.RENDER1 ? r = g.luckburst.RENDER1 : (t = i.string.join('<li class="jschartli normal-notice" data-type="list">', '<i class="icon-heart"></i>', '<div class="text-cont">', '<a href="/client" target="_blank" class="text-app text-app-phone">', '<span class="text-app-des">', '<i>恭喜 <em class="hy-name"><%=nick%></em> </i>', "<i>使用斗鱼手机APP领取了 ", '<b><img src="<%=attr.web_url%>app/douyu/res/page/room-show/olyw/olyw-1000.png?v=20160322"></b> 鱼丸', "</i>", "</span>", "</a>", "</div>", "</li>"), r = g.luckburst.RENDER1 = n.compile(t)), o = r({
			nick: e.nn,
			attr: {
				web_url: s.get("sys.web_url")
			}
		})) : 0 == f && l > 0 && u > 1 ? (g.luckburst.RENDER2 ? r = g.luckburst.RENDER2 : (t = i.string.join('<li class="jschartli normal-notice" data-type="list" data-level="<%=userLev%>">', '<i class="icon-heart"></i>', '<div class="text-cont">', "<% if (level >= 10) { %>", "<% if ( userLev > 0 && isShowUserLevel) { %>", '<a class="chat-icon-pad user-level<%=ulevIn1t9 ? " lve-icon-1to9" : ""%> <%=userIcon%> " title="用户等级：<%=userLev%>">', "</a>", "<% } %>", '<span class="nick js-nick"><%=nick%></span>在第<%=lev%>次在线领鱼丸时触发', "<span><%=userRate%>倍暴击</span>，获得了", '<span class="hy-org"><%=gold%></span>个鱼丸', '<img src="<%=attr.web_url%>app/douyu/res/page/room-normal/olyw/yw.png?20170627">', "<% } else { %>", '<span class="nick js-nick"><%=nick%></span>', '在第<%=lev%>次在线领鱼丸时获得了<span class="hy-org"><%=gold%></span>个鱼丸', '<img src="<%=attr.web_url%>app/douyu/res/page/room-normal/olyw/yw.png?v=20170627">', "<% } %>", "</div>", "</li>"), r = g.luckburst.RENDER2 = n.compile(t)), o = r({
			gold: d,
			lev: e["if"],
			level: e.level,
			nick: e.nn,
			userIcon: v.returnUlevelClass(e.level),
			userLev: e.level,
			userRate: u,
			ulevIn1t9: e.level >= 1 && e.level <= 9,
			attr: {
				web_url: s.get("sys.web_url")
			},
			sahf: isNaN(e.sahf) ? 1 : e.sahf,
			isShowUserLevel: c
		})) : void 0
	}, g.luckburst.RENDER1 = null, g.luckburst.RENDER2 = null, g.peck = function(e) {
		var t, a, r;
		return g.peck.RENDER ? a = g.peck.RENDER : (t = i.string.join("<% if (isLucker) { %>", '<li class="jschartli chartli bonus-chat normal-notice-new">', '<i class="sys-icon"></i>', '<p class="text-cont">', '恭喜<span class="nick-new" rel="<%= did %>"><%= dnk %></span>', '领取了<span class="nick-new"><%= snk %></span>', "派送的宝箱！", '获得<span class="hy-org"><%= silver %>鱼丸</span>', '，成为本场<span class="hy-org">手气王</span>！', "<% if(dct.length) {%>", '<span>。并成功发送节奏弹幕"<%=dct%>"</span>', "<% } %>", "</p>", "</li>", "<% } else if (giftType > 0) { %>", '<li class="jschartli chartli bonus-chat normal-notice-new">', '<i class="sys-icon"></i>', '<p class="text-cont">', '恭喜<span class="nick-new" rel="<%= did %>"><%= dnk %></span>', '领取了<span class="nick-new"><%= snk %></span>', "派送的宝箱！触发暴击", "<% if (giftType > 1) { %>", "X<%= giftType %>", "<% } %>", '获得<span class="hy-org"><%= silver %>鱼丸</span>', "<% if(dct.length) {%>", '<span>。并成功发送节奏弹幕"<%=dct%>"</span>', "<% } %>", "</p>", "</li>", "<% } else { %>", '<li class="jschartli normal-notice-new" data-type="list">', '<i class="sys-icon"></i>', '<p class="text-cont">', '<% if (rpt ==  "3") { %>', '<a href="javascript:;" class="nick-new" style="cursor:text;" rel="<%=did%>"><%=dnk%></a>', "<span> 红包拆出了 </span>", '<span class="hy-org"><%=silver%></span>', '<span class="hy-org">个鱼丸</span>', "<% } else { %>", '<a href="javascript:;" class="nick-new" style="cursor:text;" rel="<%=did%>"><%=dnk%></a>', "<span> 领取了 </span>", '<span class="hy-name nick-new"><%=snk%></span>', "<span> 派送的 </span>", '<span class="hy-org"><%=silver%></span>', '<span class="hy-org">个鱼丸</span>', "<% } %>", "<% if(dct.length) {%>", '<span>。并成功发送节奏弹幕"<%=dct%>"</span>', "<% } %>", "</p>", "</li>", "<% } %>"), a = g.peck.RENDER = n.compile(t)), r = a({
			did: e.did,
			dnk: e.dnk,
			snk: e.snk,
			silver: e.silver,
			rpt: e.rpt,
			dct: e.dct || "",
			giftType: parseInt(e.lt, 10) || 0,
			isLucker: parseInt(e.lk, 10) ? 1 : 0,
			attr: {
				web_url: s.get("sys.web_url")
			}
		})
	}, g.peck.RENDER = null, g.uplevel = function(e) {
		e = a.decode(e).too();
		var r, o, l, d = e.level ? e.level : 0;
		parseInt(d / 10, 10);
		return s.get("sys.uid") == e.uid && t.trigger("mod.chatrank.cqrankupdate", d), d % 20 === 0 ? (g.uplevel.RENDER ? o = g.uplevel.RENDER : (r = i.string.join('<li class="jschartli normal-notice-new" data-type="list" data-level="<%=level%>">', '<i class="sys-icon"></i>', '<p class="text_cont">', "<span>恭喜</span>", '<span class="name"><a href="javascript:;" class="nick-new js-nick"  rel="<%= uid %>" is-show-super-icon="<%=sahf%>" avatar="<%= ic %>"  gid="<%= gid %>"><%= user_nick %></a></span>', '<span style="margin:0 6px 0 0;">升级到</span>', "<% if ( level > 0 && isShowUserLevel ) { %>", '<a style="margin-top:-4px;" class="chat-icon-pad user_level  <%=ulevIn1t9 ? " lve-icon-1to9" : ""%> <%= userIcon %>" title="用户等级：<%= level %>">', "</a>", "<% } %>", "</p>", "</li>"), o = g.uplevel.RENDER = n.compile(r)), l = o({
			level: d,
			uid: e.uid,
			user_nick: e.nn,
			gid: e.gid,
			userIcon: v.returnUlevelClass(d),
			ulevIn1t9: d >= 1 && 9 >= d,
			attr: {
				web_url: s.get("sys.web_url")
			},
			ic: e.ic || "",
			sahf: isNaN(e.sahf) ? 1 : e.sahf,
			isShowUserLevel: c
		})) : void 0
	}, g.uplevel.RENDER = null, g.fansLevelUp = function(e) {
		var t, o, l, c = a.decode(e).too();
		return g.fansLevelUp.RENDER ? o = g.fansLevelUp.RENDER : (t = i.string.join('<li class="jschartli normal-notice-new" data-type="list">', '<i class="sys-icon"></i>', '<p class="honor-yc-tips">', '恭喜<a href="javascript:;" class="nick-new"><%= nn %></a>', '<span class="chat-icon-pad">粉丝等级升级到</span>', '<span class="chat-fans-up"><%=# returnMedalComponent({roomId: rid, medalLev: bl, medalNick: bnn}) %></span>', "，主播更爱你哟", "</p>", "</li>"), o = g.fansLevelUp.RENDER = n.compile(t)), l = o({
			uid: c.uid || "",
			nn: c.nn || "",
			bl: c.bl || 1,
			lbl: c.lbl,
			bnn: c.bnn,
			attr: {
				web_url: s.get("sys.web_url")
			},
			fansMedal: d || {},
			rid: s.get("room.room_id"),
			returnMedalComponent: r.returnMedalComponent
		})
	}, g.fansLevelUp.RENDER = null, g.winAnchorFans = function(e) {
		var t, r, o, l = a.decode(e).too(),
			d = l.ac,
			u = l.bc,
			f = a.decode(l.ai).too(),
			p = a.decode(l.bi).too(),
			m = a.decode(l.ua).too(),
			h = a.decode(l.ub).too(),
			v = {},
			y = {};
		return parseInt(d, 10) !== parseInt(u, 10) ? (parseInt(d, 10) > parseInt(u, 10) ? (v = f, y = m) : (v = p, y = h), g.winAnchorFans.RENDER ? r = g.winAnchorFans.RENDER : (t = i.string.join('<li class="jschartli normal-notice-new" data-type="list" data-anchor-level="<%= winerAnchor.lv %>" data-level="1">', '<i class="sys-icon"></i>', '<p class="text-cont">', "<span>", "<% if (nobleInfo[nl]) { %>", '<span class="chat-icon-pad user-noble">', '<img src="<%= attr.resource_url %><%= nobleInfo[maxDevoteUser.nl].symbol.web_symbol_pic1 %>" title="<%= nobleInfo[maxDevoteUser.nl].symbol.name %>">', "</span>", "<% } %>", '<span class="lianmai-success-uname" data-rel="user-info" data-level="<%= maxDevoteUser.lv %>">', '<a href="javascript:;" class="nick-new js-nick" rel="<%= maxDevoteUser.id %>" avatar="<%= maxDevoteUser.icon %>" data-noble="<%= maxDevoteUser.nl %>"><%= maxDevoteUser.nn %></a>', "</span>", "为主播 ", '<span class="lianmai-success-aname">', '<a href="javascript:;" class="nick-new js-nick" rel="<%= ownerUid %>" avatar="<%= winerAnchor.icon %>" data-noble="<%= winerAnchor.nl %>"><%= winerAnchor.nn %></a>', "</span>", '<span class="highLight">贡献<%= conValue %></span>，助力主播获取胜利！！！', "</span>", "</p>", "</li>"), r = g.winAnchorFans.RENDER = n.compile(t)), o = r({
			winerAnchor: v,
			ownerUid: s.get("room.owner_uid"),
			maxDevoteUser: y,
			conValue: parseInt(y.cb / 100, 10),
			nobleInfo: s.get("room.nobleConfig"),
			attr: {
				resource_url: s.get("sys.resource_url")
			},
			isShowUserLevel: c
		})) : void 0
	}, g.winAnchorFans.RENDER = null, g.wbsharesuc = function(e) {
		e = a.decode(e).too();
		var t, r, o;
		return g.wbsharesuc.RENDER ? r = g.wbsharesuc.RENDER : (t = i.string.join('<li class="jschartli normal-notice-new" data-type="list" data-level="<%=userLev%>">', '<i class="sys-icon"></i>', '<p class="text_cont">', '<span class="name chat-icon-pad"><a href="javascript:;" class="nick-new js0nick" rel="<%= uid %>" is-show-super-icon="<%=sahf%>" avatar="<%= ic %>"><%= nickname %></a></span>', "分享了该直播间", "<% if (exp) { %>", '，获得<span class="highLight"><%= exp %>经验值</span>', "<% } %>", "</p>", "</li>"), r = g.wbsharesuc.RENDER = n.compile(t)), o = r({
			uid: e.uid,
			rid: e.rid,
			nickname: e.nickname,
			gid: e.gid,
			userLev: e.level,
			exp: parseFloat(e.exp),
			attr: {
				web_url: s.get("sys.web_url")
			},
			ic: e.ic || "",
			sahf: isNaN(e.sahf) ? 1 : e.sahf
		})
	}, g.wbsharesuc.RENDER = null, g.peckprop = function(e) {
		var t = g.peckprop.RENDER({
			did: e.did,
			dnk: e.dnk,
			sid: e.sid,
			snk: e.snk,
			pcnt: e.pcnt,
			pnm: e.pnm,
			dct: e.dct || "",
			webUrl: s.get("sys.web_url")
		});
		return t
	}, g.peckprop.RENDER = function() {
		var e = i.string.join('<li class="jschartli normal-notice-new" data-type="list">', '<i class="sys-icon"></i>', '<p class="text-cont">', '<a href="javascript:;" class="nick-new" style="cursor:text;" rel="<%=did%>"><%=dnk%></a>', "<span> 领取了 </span>", '<span class="hy-name nick-new"><%=snk%></span>', "<span> 派送的 </span>", '<span class="hy-org"><%=pcnt%>个<%=pnm%></span>', "<% if(dct.length) {%>", '<span> 。并成功发送节奏弹幕"<%=dct%>"</span>', "<% } %>", "</p>", "</li>");
		return n.compile(e)
	}(), g.useprop = function(e) {
		var t = v.processArrData(e.el),
			i = g.checkGirlPri(t, 1500000173, e),
			a = i ? "chat-girl" : "",
			n = g.checkGuessRank(t),
			r = g.useprop.RENDER({
				clt: e.ct,
				uid: e.uid,
				nn: e.nn,
				dlv: e.dlv,
				dc: e.dc,
				bdl: e.bdl || 0,
				pg: e.pg || 1,
				rg: e.rg || 1,
				girlPrivilege: i,
				girlCls: a,
				hits: e.hits || 1,
				userLev: e.level,
				userIcon: v.returnUlevelClass(e.level),
				ulevIn1t9: e.level >= 1 && e.level <= 9,
				cqName: v.getUserCqName(e.dlv),
				cqTitIcon: v.getCqTitIcon(e.dlv),
				giftCImg: giftConfig.cimg,
				giftName: giftConfig.name,
				giftWidth: giftSize[giftConfig.style],
				giftHeight: giftSize[giftConfig.style],
				attr: {
					web_url: s.get("sys.web_url"),
					resourceUrl: w
				},
				ic: e.ic || "",
				nl: e.nl,
				nobleConfig: x,
				madelConfig: _,
				guessRank: n,
				isShowUserLevel: c
			});
		return r
	}, g.useprop.RENDER = function() {
		var e = i.string.join('<li class="jschartli" data-type="list" data-level="<%=userLev%>">', '<p class="text-cont">', "<% if ( nl && nobleConfig[nl] ) { %>", '<span class="chat-icon-pad user-noble">', '<img src="<%= attr.resourceUrl %><%= nobleConfig[nl].symbol.web_symbol_pic1 %>" title="<%= nobleConfig[nl].symbol.name %>" />', "</span>", "<% } %>", "<% if (guessRank) { %>", '<a href="javascript:;" class="cursor-default"><img class="chat-icon-pad" src="<%= attr.resourceUrl %><%= madelConfig[guessRank].web_img %>" title="<%= madelConfig[guessRank].name %>"></a>', "<% } %>", "<% if ( userLev > 0 && isShowUserLevel) { %>", '<a class="chat-icon-pad user-level<%=ulevIn1t9 ? " lve-icon-1to9" : ""%> <%=userIcon%>" title="用户等级：<%=userLev%>">', "</a>", "<% } %>", '<a href="javascript:;" class="nick <%= girlCls %> js-nick" clt="<%=clt%>" rel="<%=uid%>" avatar="<%=ic%>" gid="<%=pg%>" data-noble="<%= nl %>"><%=nn%></a>', '<span class="chat-icon-pad">赠送给主播</span>', '<span class="gift-name"><%=giftName%></span>', '<img class="lw-imgs" src="<%=giftCImg%>" width="22" height="22">', "<% if (hits > 1) { %>", '<span class="hy-org" style="display:inline-block;"><%=hits%>连击</span>', "<% } %>", "</p>", "</li>");
		return n.compile(e)
	}(), g.videoMomentRecord = function(e) {
		if (!g.videoMomentRecord.RENDER) {
			var t = i.string.join('<li class="jschartli hy-chat <%= isSender ? "chartli" : "" %> normal-notice-new"', ' data-level="<%=node.ul%>"', ' data-type="list" ', "<% if ( node.rl > 0 ) { %>", 'data-anchor-level="<%=node.rl%>"', "<% } %>", ">", '<i class="sys-icon"></i>', '<p class="text-cont">', '<a style="margin-right:1px;margin-bottom:2px;" class="chat-icon-pad anchor-level-icon" title="主播等级：<%= node.rl %>" data-anchor-levelimg="<%=node.rl%>"></a>', "<span>", '<a href="javascript:;" class="nick-new js-nick" rel="<%= uid %>" avatar="<%= node.ic || avatar %>" ><%= name %></a></span>', '<span class="chat-msg-item m"><a class="v-moment-cont" href="<%= attr.vsite%>/show/<%= node.vid %>" target="_blank">录制了一段精彩时刻，快来围观吧！</a></span>', "</p>", "</li>");
			g.videoMomentRecord.RENDER = n.compile(t);
		}
		var a = +s.get("room.owner_uid"),
			r = s.get("room.owner_name"),
			o = +s.get("sys.uid"),
			l = s.get("room.avatar");
		l = l.middle || "", l = l.replace(/^[\w\W]*upload\/([\w\W]*)_middle\.jpg$/, "$1");
		var c = g.videoMomentRecord.RENDER({
			node: e,
			name: r,
			uid: a,
			avatar: l,
			isSender: o === a,
			attr: {
				web_url: s.get("sys.web_url"),
				resourceUrl: w,
				web_ver: "20170724",
				vsite: s.get("sys.vsite_url")
			}
		});
		return c
	}, g.broadcastRecord = function(e, t) {
		var a, s, r;
		return g.broadcastRecord.RENDER ? s = g.broadcastRecord.RENDER : (a = i.string.join('<li class="jschartli normal-notice-new" data-type="list">', '    <i class="sys-icon"></i>', '    <a href="/<%= rid %>" target="_blank" class="honor-yc-tips highLight"><%= title %>：<span class="highLight"><%= onn %></span>', "    <span>开播了！快来围观吧！</span>", "    </a>", "</li>"), s = g.broadcastRecord.RENDER = n.compile(a)), r = s({
			rid: e.rid,
			onn: e.onn,
			title: t
		})
	}, g.broadcastRecord.RENDER = null, g.impressBarrage = function(e) {
		var t, a, s;
		g.impressBarrage.RENDER ? a = g.impressBarrage.RENDER : (t = i.string.join('<li class="jschartli normal-notice-new" data-type="list">', '<i class="sys-icon"></i>', '<p class="text-cont">', '<span class="highLight">消息提醒：</span><a href="javascript:;" class="nick-new"><%= nn %></a><span><%= isAnchor ? "对你的印象是" : "对主播的印象是" %></span>', "<% for(var i=0;i<tags.length;i++){%>", '<span style="color:#ff5d23;margin-left:2px">[<%= tags[i] %>]</span>', "<% } %>", "</p>", "</li>"), a = g.impressBarrage.RENDER = n.compile(t)), e.txt = v.htmlEncode(e.txt);
		var r = (e.txt || "").split("|");
		return 0 === r.length ? "" : s = a({
			nn: e.nn,
			tags: r,
			isAnchor: $SYS.uid == $ROOM.owner_uid
		})
	}, g.guessGame = function(e) {
		return g.guessGame.RENDER ? render = g.guessGame.RENDER : (source = i.string.join('<li class="jschartli normal-notice-new">', '<i class="sys-icon"></i>', '<div class="my_cont clearfix">', '<div class="mycont-r">', "恭喜 ", '<span class="nick-new"><%= data.uname %></span>', " 参与竞猜获得 ", '<span class="highLight"><%= data.ec %>鱼丸</span>', " ！为主播加热度上热门！", "</div>", "</div>", "</li>"), render = g.guessGame.RENDER = n.compile(source)), html = render({
			data: e
		}), html
	}, g.guessGame.RENDER = null, g.motorFishBall = function(e) {
		g.motorFishBall.RENDER ? render = g.motorFishBall.RENDER : (source = i.string.join('<li class="jschartli normal-notice-new" data-type="list" data-level="<%=userLev%>">', '<i class="sys-icon"></i>', '<p class="text-cont">', '<a href="javascript:;" class="nick-new" style="cursor:text;"><%=userNick%></a>', "<span> 领取了 </span>", '<span class="nick-new"><%=senderNick%></span>', "<span> 派发的 </span>", '<span class="hy-org"><%=num%>个<%=awardName%></span>', "</p>", "</li>"), render = g.motorFishBall.RENDER = n.compile(source));
		var t = "",
			a = parseInt(e.retype, 10);
		switch (a) {
		case 0:
			t = "未知";
			break;
		case 1:
			t = "鱼丸";
			break;
		case 2:
			t = "鱼翅"
		}
		return html = render({
			userNick: e.unick,
			senderNick: e.cnick,
			num: e.num,
			awardName: t
		}), html
	}, g.motorFishBall.RENDER = null, g
}), define("douyu/com/user-view-dp", ["jquery", "shark/observer"], function(e, t) {
	function i(e, t) {
		t ? DYS.sub({
			kernelFlag: !0
		}, e) : DYS.sub(e)
	}
	var a = {
		"dys.com.user.login.show": function(e) {
			i({
				action_code: "show_login",
				ext: e
			}, !0)
		},
		"dys.com.user.login.vcode.show": function(e) {
			i({
				action_code: "show_login_code",
				ext: e
			})
		},
		"dys.com.user.login.input.change": function(e) {
			var t;
			switch (e.name) {
			case "username":
				t = "click_login_name";
				break;
			case "password":
				t = "click_login_pw"
			}
			e && delete e.name, i({
				action_code: t,
				ext: e
			})
		},
		"dys.com.user.login.password.forget": function(e) {
			i({
				action_code: "click_login_forgpass",
				ext: e
			}, !0)
		},
		"dys.com.user.login.submit.click": function(e) {
			i({
				action_code: "click_login_tologin",
				ext: e
			})
		},
		"dys.com.user.login.submit.success": function(e) {
			i({
				action_code: "show_login_succ",
				ext: e
			}, !0)
		},
		"dys.com.user.login.submit.fail": function(e) {
			i({
				action_code: "show_login_fail",
				ext: e
			})
		},
		"dys.com.user.login.close.click": function(e) {
			i({
				action_code: "click_login_close",
				ext: e
			})
		},
		"dys.com.user.login.thirds.click": function(e) {
			i({
				action_code: "click_login_other",
				ext: e
			}, !0)
		},
		"dys.com.user.reg.show": function(e) {
			i({
				action_code: "show_sign",
				ext: e
			}, !0)
		},
		"dys.com.user.reg.input.change": function(e) {
			var t;
			switch (e.name) {
			case "nickname":
				t = "click_sign_name";
				break;
			case "password":
				t = "click_sign_pw";
				break;
			case "password2":
				t = "click_sign_pw2";
				break;
			case "protocol":
				t = "click_sign_agree"
			}
			e && delete e.name, i({
				action_code: t,
				ext: e
			})
		},
		"dys.com.user.reg.submit.click": function(e) {
			i({
				action_code: "click_sign_tosign",
				ext: e
			})
		},
		"dys.com.user.reg.submit.success": function(e) {
			i({
				action_code: "show_sign_succ",
				ext: e
			}, !0)
		},
		"dys.com.user.reg.login.fail": function(e) {
			i({
				action_code: "show_sign_fail",
				ext: e
			}, !0)
		},
		"dys.com.user.reg.close.click": function(e) {
			i({
				action_code: "click_sign_close",
				ext: e
			})
		},
		"dys.com.user.reg.vcode9.click": function(e) {
			i({
				action_code: "click_sign_code",
				ext: e
			}, !0)
		},
		"dys.com.user.reg.thirds.click": function(e) {
			i({
				action_code: "click_sign_other",
				ext: e
			}, !0)
		},
		"dys.com.user.phone.show": function(e) {
			i({
				action_code: "show_sign_phone",
				ext: e
			}, !0)
		},
		"dys.com.user.phone.input.change": function(e) {
			var t;
			switch (e.name) {
			case "selectCountry":
				t = "click_sign_phone_cou";
				break;
			case "bindphonenum":
				t = "click_sign_phone";
				break;
			case "phonenum_captcha":
				t = "click_sign_phone_code";
				break;
			case "change_captcha":
				t = "click_sign_phone_newcode";
				break;
			case "yzphonenum":
				t = "click_sign_phone_voicecode";
				break;
			case "get_yzphonenum":
				t = "click_sign_phone_get_voicecode"
			}
			e && delete e.name, "click_sign_phone" == t ? i({
				action_code: t,
				ext: e
			}, !0) : i({
				action_code: t,
				ext: e
			})
		},
		"dys.com.user.phone.submit.click": function(e) {
			i({
				action_code: "click_sign_phone_tophone",
				ext: e
			})
		},
		"dys.com.user.phone.submit.success": function(e) {
			i({
				action_code: "show_sign_phone_succ",
				ext: e
			}, !0)
		},
		"dys.com.user.phone.submit.fail": function(e) {
			i({
				action_code: "show_sign_phone_fail",
				ext: e
			}, !0)
		},
		"dys.com.user.phone.close.click": function(e) {
			i({
				action_code: "click_sign_phone_close",
				ext: e
			})
		}
	};
	for (var n in a)!
	function(e) {
		var i = a[e];
		t.on(e, function(e) {
			i.call(this, e)
		})
	}(n);
	return {
		init: function(e) {
			window.DYS && DYS.sub.setPageCode(e)
		}
	}
}), define("douyu/com/vcode-user", ["jquery", "shark/class", "shark/observer", "douyu/com/user-view-dp"], function(e, t, i, a) {
	var n = {
		type: null,
		input: {
			codesrc: "/member/task/captcha"
		},
		fast: {
			idpre: "gt-captcha-",
			count: 0
		}
	},
		s = t({
			init: function(t) {
				this.config = e.extend(!0, {}, {
					target: null
				}, t), this.render(), this.bindEvt(), this.refresh()
			},
			render: function() {
				this.config.$tar = e(this.config.target), this.config.$el = this.config.$tar.find(".captcha"), this.config.$ipt = this.config.$el.find("input"), this.config.$img = this.config.$el.find("img")
			},
			show: function() {
				this.config.$el.show()
			},
			hide: function() {
				this.config.$el.hide()
			},
			refresh: function() {
				var e = this.config.$img.data("vcodesrc");
				e || (e = passport_host + "api/captcha"), e = e + "?v=" + (new Date).getTime(), this.config.$img.attr("src", e), this.config.$ipt.val("")
			},
			bindEvt: function() {
				var e = this;
				this.config.$img.click(function(t) {
					t.stopPropagation(), t.preventDefault(), e.refresh()
				})
			}
		}),
		r = t({
			init: function(t) {
				this.config = e.extend(!0, {}, {
					target: null
				}, t), this.render()
			},
			nextId: function() {
				return n.fast.idpre + ++n.fast.count
			},
			getResult: function() {
				return this.config.result
			},
			check: function(t) {
				var a = function(a) {
						0 === a.code ? (this.buildAsync(e.trim(a.id)), i.trigger("dys.com.user.login.vcode.show", {
							type: 1
						})) : t(!1)
					},
					n = function() {
						t(!1)
					};
				e.ajax("/member/login/check_capcha_status", {
					type: "post",
					dataType: "json",
					timeout: 5e3,
					success: e.proxy(a, this),
					error: e.proxy(n, this)
				})
			},
			render: function() {
				this.config.$tar = e(this.config.target), this.config.$el = this.config.$tar.find(".captcha-gt")
			},
			build: function(e) {
				var t = this.nextId(),
					a = this;
				this.config.$el.append('<div id="' + t + '"></div>'), this.config.result = null, window.initGeetest({
					gt: e,
					product: "float"
				}, function(e) {
					e.appendTo("#" + t), i.trigger("com.vcode.fast.init", {
						value: a.config.result,
						target: a.config.$tar
					}), e.onSuccess(function() {
						a.config.result = a.plugin.getValidate(), i.trigger("com.vcode.fast.check.success", {
							value: a.config.result,
							target: a.config.$tar
						})
					}), e.onRefresh(function() {
						a.config.result = null
					}), e.onError(function() {
						a.config.result = null
					}), a.plugin = e
				})
			},
			buildAsync: function(e) {
				var t = this,
					i = location.protocol;
				require.use([i + "//static.geetest.com/static/tools/gt.js"], function() {
					t.build(e)
				})
			},
			refresh: function() {
				this.plugin.refresh()
			},
			show: function() {
				this.config.$el.show()
			},
			hide: function() {
				this.config.$el.hide()
			}
		}),
		o = {
			init: function(t) {
				var a = new s({
					target: t
				}),
					o = new r({
						target: t
					});
				n.type = "fast", a.hide();
				try {
					o.check(function(s) {
						s === !1 && (n.type = "input", a.show(), o.hide(), i.trigger("dys.com.user.login.vcode.show", {
							type: 2
						}), i.trigger("com.vcode.fast.init.failed", {
							value: s,
							target: e(t)
						}))
					})
				} catch (l) {
					n.type = "input", a.show(), window.console && console.error(l)
				}
				return {
					refresh: function() {
						"input" === n.type ? a.refresh() : o.refresh()
					},
					isInput: function() {
						return "input" === n.type
					},
					isFast: function() {
						return "fast" === n.type
					},
					getType: function() {
						return n.type
					},
					getFastResult: function() {
						return o.getResult()
					}
				}
			}
		};
	return o
}), function() {
	$.fn.dy_dialog = function(e, t) {}, $.fn.dy_tips_black = function(e, t) {
		t = $.extend(t, {
			trigger: $(this),
			mask: !1,
			fixed: !1
		}), $.dy_dialog.tips_black(e, t)
	}, $.dy_dialog = function(t, i) {
		if ("tips_black" === i.type) {
			var a = new e,
				n = '<div class="shark-ui-alert-content">' + t + "</div>",
				s = "",
				r = "shark-ui-alert shark-ui-alert-tip";
			n += s;
			var o = $.extend({
				target: n,
				animate: !0,
				show: !0,
				className: r,
				afterHide: function(e) {
					this.dispose(), i.callback && i.callback()
				}
			}, i);
			a.init(o), i.timer && setTimeout(function() {
				a.dispose(), i.callback && i.callback()
			}, 1e3 * i.timer), a.dbltouch(a.mask, function() {
				a.hide(), i.callback && i.callback()
			})
		} else {
			var l = new e,
				n = '<div class="shark-ui-dialog-content">' + t + "</div>",
				s = "",
				c = "";
			if (i.buttons) {
				for (var d = 0, u = i.buttons.length; u > d; d++) {
					var f = i.buttons[d];
					c += '<a href="javascript:;" class="shark-ui-confirm-submit ' + (f.className || "") + '" data-type="yes">' + f.content + "</a>"
				}
				s = '<div class="shark-ui-dialog-action">' + c + "</div>"
			}
			"bottom" == i.position ? n = s + n : n += s;
			var p = $.extend({
				target: n,
				animate: !0,
				show: !0,
				fixed: !0,
				content: t,
				buttons: null,
				width: 420,
				title: "提示",
				mask: !1,
				callback: null,
				zIndex: 501,
				className: "shark-ui-confirm",
				afterHide: function(e) {
					this.dispose()
				},
				beforeShow: function(e, t) {
					l.touch($(".shark-ui-confirm-submit", t), function(e) {
						for (var i = l.settings.buttons, a = 0; a < i.length; a++) if (i[a].content == $(e.target).text()) {
							i[a].callback && i[a].callback.call(l, e, t);
							break
						}
					})
				}
			}, i);
			l.init(p), l.dbltouch(l.mask, function() {
				l.hide()
			})
		}
		return l
	}, $.dy_dialog.tips_black = function(e, t) {
		var i = {},
			a = {
				zIndex: 501,
				type: "tips_black"
			};
		return i = "object" == typeof e ? $.extend(a, e) : $.extend(a, {
			button: null,
			timer: 3,
			callback: null,
			minWidth: 200,
			fixed: !0,
			mask: !1,
			height: "auto"
		}), $.dy_dialog(e, $.extend(i, t))
	};
	var e = function() {
			var e = Math.random().toString().replace(".", "");
			this.id = "dialog_" + e, this.settings = {}, this.settings.closeTpl = $('<span class="shark-ui-dialog-close js-dialog-close"></span>'), this.settings.titleTpl = $('<div class="shark-ui-dialog-title"></div>'), this.timer = null, this.showed = !1, this.mask = $()
		};
	e.prototype = {
		init: function(e) {
			var t = e.trigger || $("body");
			this.settings = $.extend({
				fixed: !1
			}, this.settings, e), this.settings.mask && (this.mask = $('<div class="shark-ui-dialog-mask"/>'), t.append(this.mask)), t.append('<div class="shark-ui-dialog" id="' + this.id + '"></div>'), this.dialogContainer = $("#" + this.id);
			var i = this.settings.zIndex || 10;
			this.dialogContainer.css({
				zIndex: i
			}), this.settings.className && this.dialogContainer.addClass(this.settings.className), this.mask.css({
				zIndex: i - 1
			}), this.settings.closeTpl && this.dialogContainer.append(this.settings.closeTpl), this.settings.title && (this.dialogContainer.append(this.settings.titleTpl), this.settings.titleTpl.html(this.settings.title)), this.bindEvent(), this.settings.show && this.show()
		},
		dbltouch: function(e, t) {
			function i(e) {
				return e.preventDefault(), window.getSelection ? window.getSelection().removeAllRanges() : document.selection.empty(), t.call(this, e)
			}
			$(e).on("dblclick", i)
		},
		touch: function(e, t) {
			function i(e) {
				return t.call(this, e)
			}
			$(e).on("click", i)
		},
		bindEvent: function() {
			var e = this;
			$(this.dialogContainer).on("click", ".js-dialog-close", function() {
				return e.hide(), !1
			}), $(document).keydown(function(t) {
				27 === t.keyCode && e.showed && e.hide()
			}), $(this.dialogContainer).on("hide", function() {
				e.hide()
			}), $(window).on("resize", function() {
				e.setPosition()
			})
		},
		dispose: function() {
			this.dialogContainer.remove(), this.mask.remove(), this.timer && clearInterval(this.timer)
		},
		hide: function() {
			var e = this;
			e.settings.beforeHide && e.settings.beforeHide.call(e, e.dialogContainer), this.showed = !1, this.mask.hide(), this.timer && clearInterval(this.timer), this.settings.animate ? (this.dialogContainer.removeClass("zoomIn").addClass("zoomOut"), setTimeout(function() {
				e.dialogContainer.hide(), "object" == typeof e.settings.target && $("body").append(e.dialogContainer.hide()), e.settings.afterHide && e.settings.afterHide.call(e, e.dialogContainer), e.settings.onHide && e.settings.onHide.call(e)
			}, 500)) : (this.dialogContainer.hide(), "object" == typeof this.settings.target && $("body").append(this.dialogContainer), this.settings.afterHide && this.settings.afterHide.call(this, this.dialogContainer), e.settings.onHide && e.settings.onHide.call(e))
		},
		show: function() {
			"string" == typeof this.settings.target ? /^(\.|\#\w+)/gi.test(this.settings.target) ? this.dailogContent = $(this.settings.target) : this.dailogContent = $("<div>" + this.settings.target + "</div>") : this.dailogContent = this.settings.target, this.mask.show(), this.dailogContent.show(), this.height = this.settings.height || "auto", this.width = this.settings.width || "auto", this.dialogContainer.append(this.dailogContent).show().css({
				height: this.height,
				width: this.width
			}), this.settings.minWidth && this.dialogContainer.css({
				"min-width": this.settings.minWidth
			}), this.settings.beforeShow && this.settings.beforeShow.call(this, this.dialogContainer), this.showed = !0, $(this.settings.trigger).blur(), this.setPosition(), $(this.dialogContainer).attr({
				tabindex: 1
			}).focus();
			this.timer && clearInterval(this.timer), this.settings.animate && this.dialogContainer.removeClass("zoomOut").addClass("animated").addClass("zoomIn"), this.settings.onInit && this.settings.onInit.call(this)
		},
		setPosition: function() {
			if (this.showed) {
				var e = this,
					t = e.settings.trigger || $(window);
				this.dialogContainer.show(), this.height = this.settings.height, this.width = this.settings.width, isNaN(this.height) && (this.height = this.dialogContainer.outerHeight && this.dialogContainer.outerHeight() || this.dialogContainer.height()), isNaN(this.width) && (this.width = this.dialogContainer.outerWidth && this.dialogContainer.outerWidth() || this.dialogContainer.width());
				var i = t.height(),
					a = t.width(),
					n = this.width / 2,
					s = this.height / 2,
					r = (a / 2 - n) / a * 100,
					o = (i / 2 - s) / i * 100,
					l = "absolute";
				e.settings.fixed ? l = "fixed" : o += t.scrollTop();
				var c = "auto";
				"bottom" == e.settings.position && (o = "auto", c = 0), e.dialogContainer.css({
					position: l,
					top: o + "%",
					left: r + "%",
					bottom: c
				})
			}
		}
	}
}(), function() {
	window.define && define.fmd && define("douyu/com/dialog", function() {
		return $.dy_dialog
	})
}(), define("douyu/com/msgq", function() {
	var e = 20,
		t = 200;
	navigator.appVersion.indexOf("MSIE") > 0 && (t = 350);
	var i = function(e) {
			return "function" == typeof e
		},
		a = function(e, t, i) {
			var a = e.length,
				n = t(a),
				s = e.splice(0, n);
			return i(s), e
		},
		n = function(e, i, s, r) {
			var o = e.length;
			a(e, i, s), o = e.length, 0 >= o ? r() : setTimeout(function() {
				n(e, i, s, r)
			}, t)
		},
		s = function() {
			return 1
		},
		r = function() {
			window.console && console.log && console.log(list.join(""))
		},
		o = function() {
			this.init.apply(this, arguments)
		};
	return o.prototype.init = function(e) {
		e = e || {}, this.STATE = 0, this.CACHE = [], this._hotplan = i(e.hotplan) ? e.hotplan : s, this._render = i(e.render) ? e.render : r, this._releaseRight = !! e.releaseRight
	}, o.prototype.push = function(e) {
		return this.CACHE.push(e), this._releaseIf(), this
	}, o.prototype._release = function() {
		var e = this.CACHE,
			t = this._hotplan,
			i = this._render,
			a = this;
		n(e, t, i, function() {
			a.STATE = 0
		})
	}, o.prototype._releaseIf = function() {
		var t = this.STATE,
			i = this;
		0 === t && (this.STATE = 1, setTimeout(function() {
			i._release()
		}, e))
	}, {
		create: function(e, t) {
			return new o(e, t)
		}
	}
}), define("douyu/page/room/normal/mod/check-verify", ["jquery", "shark/class", "shark/observer", "shark/util/lang/1.0", "shark/util/template/1.0", "shark/util/cookie/1.0", "douyu/context", "douyu/com/vcode-user", "douyu/com/dialog"], function(e, t, i, a, n, s, r, o) {
	var l = {
		init: function() {
			var e = a.string.join('<div class="checkplace">', "<% if(hasPhone && phoneNumber) { %>", '<div class="warningphonetext">', '为了保护您的账号安全，请输入账号所绑定的完整手机号：<span class="orange"><%=phoneNumber%></span>', "</div>", '<div class="checkphonenumber"><input placeholder="请输入完整手机号" type="text" data-type="phonenumber" maxlength="11"></div>', "<% }else{ %>", '<div class="warningphonetext">', '亲爱的<span class="orange"><%=nickName%></span>用户，<span data-type="codechecktype">检测到您不是在常用环境登录账号请在下方输入验证码验证</span>', "</div>", "<% } %>", '<div class="captcha">', '<input data-type="imgcapchainput" class="ipt ipt-capcha" type="text" maxlength="4" placeholder="请输入右侧验证码" autocomplete="off">', '<img title="点击切换验证码" data-type="imgcapchaimg" src="about:blank" data-vcodesrc="/api/remote_verify/get_captcha">', "</div>", '<div class="captcha-gt">', "</div>", '<div class="checkplacebtnwrap">', '<div class="checkplacebtn" data-type="confirmcheck">确定</div>', "</div>", "</div>");
			this.render = n.compile(e), this.dialogWrap = {}, this.tipParam = {
				className: "tips_blackerror",
				zIndex: 503,
				timer: 2
			}, this.bindEvents(), this.ajaxing = null
		},
		bindEvents: function() {
			var e = this;
			i.on("com.vcode.fast.init", function(t) {
				t.target[0] == e.dialogWrap[0] && e.dialogWrap.find('[data-type="codechecktype"]').text("检测到您不是在常用环境登录账号请拖动下方滑块进行验证")
			})
		},
		getPhone: function(t) {
			var i = this;
			t.type;
			this.ajaxing || (i.ajaxing = e.get("/api/remote_verify/get_MobilePhone", function(a) {
				var n = a.data || {},
					l = "",
					c = {
						device_id: s.get("did"),
						client_type: 0
					};
				i.ver_type = t.isDanmu ? 1 : 2, n.phonestatus ? i.hasPhone = !0 : i.hasPhone = !1, 200 == a.result ? (l = i.render({
					nickName: r.get("sys.nickname"),
					hasPhone: n.phonestatus,
					phoneNumber: n.mobile_phone,
					isDanmu: n.mobile_phone && t.isDanmu
				}), i.checkDialog = e.dy_dialog(l, {
					title: "异常登录验证",
					width: 388,
					mask: 1,
					zIndex: 502,
					className: "dialogcheckplace",
					onInit: function() {
						var a = this,
							s = this.dailogContent,
							r = s.find(".checkplace"),
							l = o.init(r);
						i.dialogWrap = e(a), s.on("click", '[data-type="confirmcheck"]', function() {
							var r, o, d = e(this);
							if (n && n.phonestatus && n.mobile_phone) {
								if (o = s.find('[data-type="phonenumber"]').val(), "" === e.trim(o)) return e.dy_dialog.tips_black("请输入手机号！", i.tipParam), void DYS.sub({
									action_code: "show_testphone_fail",
									ext: {
										ver_type: i.ver_type
									}
								});
								if (!/^\d{1,11}$/.test(o)) return e.dy_dialog.tips_black("手机号格式有误！", i.tipParam), void DYS.sub({
									action_code: "show_testphone_fail",
									ext: {
										ver_type: i.ver_type
									}
								});
								c.mobile_phone = o
							}
							if (l && l.isFast() && !(r = l.getFastResult())) return void e.dy_dialog.tips_black("请拖动滑块通过验证！", i.tipParam);
							if (l && l.isInput()) {
								if (r = s.find('[data-type="imgcapchainput"]').val(), !/^\d{4}$/.test(r)) return void e.dy_dialog.tips_black("验证码格式不正确！", i.tipParam);
								c.code = e.trim(r)
							}
							if (l && l.isFast()) {
								var u = l.getFastResult();
								u && e.extend(c, u)
							}
							i.getCSRFCookie(function(e, s) {
								c[e] = s, i.submitCheck({
									context: d,
									data: c,
									type: t.type,
									success: t.success,
									failure: t.failure,
									dialog: a
								}, n.phonestatus)
							})
						}).on("click", '[data-type="phonenumber"]', function() {
							DYS.sub({
								action_code: "click_testphone_inphone",
								ext: {
									ver_type: i.ver_type
								}
							})
						}).on("change", '[data-type="phonenumber"]', function() {
							if (n && n.phonestatus && n.mobile_phone) {
								if (phoneVal = s.find('[data-type="phonenumber"]').val(), "" === e.trim(phoneVal)) return e.dy_dialog.tips_black("请输入手机号！", i.tipParam), void DYS.sub({
									action_code: "show_testphone_fail",
									ext: {
										ver_type: i.ver_type
									}
								});
								if (!/^\d{1,11}$/.test(phoneVal)) return e.dy_dialog.tips_black("手机号格式有误！", i.tipParam), void DYS.sub({
									action_code: "show_testphone_fail",
									ext: {
										ver_type: i.ver_type
									}
								});
								c.mobile_phone = phoneVal
							}
						}), n.phonestatus && n.mobile_phone && DYS.sub({
							action_code: "show_testphone",
							ext: {
								ver_type: i.ver_type
							}
						})
					},
					onHide: function() {
						this.dailogContent.off()
					}
				})) : 402 == a.result && (e.dy_dialog('<p>亲爱<span class="orange">' + r.get("sys.nickname") + '</span>用户，您的账号今天有多次异常操作，为了您的账号安全，已限制您<span class="orange">今天不能在非常用环境上</span>发弹幕及消费鱼丸鱼翅，请改天再来吧！</p><p>如给您带来不便，请您谅解==！</p>', {
					title: "账号安全风险",
					className: "checklimit",
					mask: 1,
					zIndex: 503,
					buttons: [{
						content: "关闭",
						callback: function() {
							this.hide()
						}
					}]
				}), t.failure(a))
			}, "json").then(function() {
				i.ajaxing = null
			}))
		},
		submitCheck: function(t) {
			var i = this,
				a = "disabled",
				n = (t.dialog, i.hasPhone),
				s = DYS.sub.getPublicExt();
			t.data.ver_type = i.ver_type, t.data.dzh_type = s.ext.dzh_type, t.data.page_code = s.page_code, t.data.roomid = r.get("room.room_id");
			var o = {
				type: "post",
				dataType: "json",
				context: t.context,
				url: "/api/remote_verify/verify_Info",
				data: t.data,
				beforeSend: function() {
					this.addClass(a)
				},
				complete: function() {
					this.removeClass(a)
				},
				error: function() {
					e.dy_dialog.tips_black("验证失败！", i.tipParam), t.failure(), n && DYS.sub({
						action_code: "show_testphone_fail",
						ext: {
							ver_type: i.ver_type
						}
					})
				},
				success: function(a) {
					200 == a.result ? (e.dy_dialog.tips_black("验证成功！", {
						mask: 1,
						className: "tips_blacksuccess",
						zIndex: 503
					}), t.success(a), n && DYS.sub({
						action_code: "show_testphone_succ",
						ext: {
							ver_type: i.ver_type
						}
					}), i.checkDialog.hide()) : 402 == a.result ? (e.dy_dialog.tips_black("验证次数达到上限，明天再来吧！", i.tipParam), t.failure(a), n && DYS.sub({
						action_code: "show_testphone_succ",
						ext: {
							ver_type: i.ver_type
						}
					}), i.checkDialog.hide()) : (e.dy_dialog.tips_black(a.msg, i.tipParam), n && a.phone_fail && DYS.sub({
						action_code: "show_testphone_fail",
						ext: {
							ver_type: i.ver_type
						}
					}), t.failure(a))
				}
			};
			t.context.hasClass(a) || e.ajax(o)
		},
		getCSRFCookie: function(t) {
			var i = this,
				a = s.get(r.get("sys.tvk")),
				n = r.get("sys.tn");
			return a ? void(t && t(n, a)) : void e.ajax({
				url: "/curl/csrfApi/getCsrfCookie",
				type: "GET",
				dataType: "json",
				success: function(e) {
					0 === e.error && i.getCSRFCookie(t)
				}
			})
		}
	},
		c = {
			init: function() {
				l.init()
			},
			checkPhone: function(e) {
				e.success = e.success ||
				function() {}, e.failure = e.failure ||
				function() {}, l.getPhone(e)
			}
		};
	return c
}), define("douyu/page/room/normal/mod/closure-confirm", ["jquery", "shark/observer", "shark/util/flash/data/1.0", "douyu/context", "douyu/page/room/base/api"], function(e, t, i, a, n) {
	var s = {
		init: function() {
			t.on("mod.closureConfirm.showDialog", function(e) {
				s.showDialog(e)
			})
		},
		showDialog: function(t) {
			var a = parseInt(t.wutype, 10),
				s = "";
			switch (a) {
			case 1:
				s = "大R用户";
				break;
			case 2:
				s = "平台大主播";
				break;
			case 3:
				s = "合作白名单用户";
				break;
			case 4:
				s = "政府机构用户";
				break;
			case 5:
				s = "工会管理者";
				break;
			case 6:
				s = "其他特殊账号";
				break;
			default:
				s = ""
			}
			e.dialog({
				content: '该账号为<span style="color: #f00">' + s + "</span>，是否继续执行当前操作？",
				ok: function() {
					t.closureConfirmType ? n.exe("js_keyTitles", i.encode([{
						name: "type",
						value: "gbm"
					}, {
						name: "roomid",
						value: t.rid
					}, {
						name: "userid",
						value: t.uid
					}, {
						name: "username",
						value: t.uname
					}, {
						name: "limittime",
						value: 0
					}, {
						name: "reason",
						value: t.reason
					}, {
						name: "eff",
						value: 1
					}])) : n.exe("js_blackuser", i.encode([{
						name: "type",
						value: "newblackreq"
					}, {
						name: "uid",
						value: t.did
					}, {
						name: "oid",
						value: t.sid
					}, {
						name: "otype",
						value: t.otype
					}, {
						name: "rid",
						value: t.rid
					}, {
						name: "blacktype",
						value: t.blacktype
					}, {
						name: "limittime",
						value: t.limittime
					}, {
						name: "reason",
						value: t.reason
					}, {
						name: "eff",
						value: 1
					}]))
				},
				cancelVal: "取消",
				lock: !0,
				cancel: function() {}
			})
		}
	};
	return {
		init: function() {
			s.init()
		}
	}
}), define("douyu/com/polyfill", function() {
	for (var e = 0, t = ["ms", "moz", "webkit", "o"], i = t.length, a = 0; i > a; ++a) window.requestAnimationFrame = window.requestAnimationFrame || window[t[a] + "RequestAnimationFrame"], window.cancelAnimationFrame = window.cancelAnimationFrame || window[t[a] + "CancelAnimationFrame"] || window[t[a] + "CancelRequestAnimationFrame"];
	window.requestAnimationFrame || (window.requestAnimationFrame = function(t, i) {
		var a = (new Date).getTime(),
			n = Math.max(0, 16 - (a - e)),
			s = window.setTimeout(function() {
				t(a + n)
			}, n);
		return e = a + n, s
	}), window.cancelAnimationFrame || (window.cancelAnimationFrame = function(e) {
		window.clearTimeout(e)
	})
}), define("douyu/com/fps", ["shark/class", "douyu/com/polyfill"], function(e) {
	var t, i = e({
		init: function() {
			this.fps = 0, this.history = [], this.historyLength = 10, this.frames = 0, this.startTime = (new Date).getTime()
		},
		getFPS: function() {
			return this.fps
		},
		getHistory: function(e) {
			return this.history.slice(0, e || this.historyLength)
		},
		start: function() {
			this.animationFrameId || this.loop()
		},
		stop: function() {
			this.animationFrameId && (window.cancelAnimationFrame(this.animationFrameId), this.animationFrameId = null)
		},
		loop: function() {
			var e = this;
			e.step(), e.animationFrameId = window.requestAnimationFrame(function() {
				e.loop()
			})
		},
		step: function() {
			var e, t = (new Date).getTime(),
				i = t - this.startTime;
			this.frames++, i >= 1e3 && (e = Math.round(1e3 * this.frames / i), this.fps = e > 60 ? 60 : e, this.frames = 0, this.startTime = t, this.updateHistory())
		},
		updateHistory: function() {
			this.history.length > this.historyLength && this.history.splice(0, 1), this.history.push({
				fps: this.fps,
				time: (new Date).getTime()
			})
		}
	});
	return t || (t = new i), {
		start: function() {
			return t.start()
		},
		stop: function() {
			return t.stop()
		},
		getFPS: function() {
			return t.getFPS()
		},
		getHistory: function() {
			return t.getHistory(arguments)
		}
	}
}), define("douyu/page/room/normal/mod/fans-medal-config", ["jquery", "shark/observer", "douyu/context", "douyu/com/exjsonp"], function(e, t, i, a) {
	var n = {
		config: {
			resourceUrl: i.get("sys.webconfUrl") + "resource/common/fans_medal_web_v2.json"
		},
		init: function() {
			var i = this;
			i.deferred = e.Deferred(), a.load(i.config.resourceUrl, "fansMedalConfig", function(e) {
				var a, n, s, r = {},
					o = 0;
				if (e) {
					for (a = e.length; a > o; o++) n = e[o], s = n.room_id || 0, r[s] = n.resource;
					t.trigger("crazy.fans.config.data", r), i.deferred.resolve(r), r && t.trigger("crazy.fans.config.data.back")
				}
			})
		}
	};
	return {
		init: function() {
			n.init()
		},
		getData: function() {
			return n.deferred
		}
	}
}), define("douyu/page/room/normal/mod/chat-noble", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "shark/util/flash/data/1.0", "douyu/context", "douyu/page/room/base/api"], function(e, t, i, a, n, s, r) {
	var o = {
		avatarDomain: s.get("sys.avatar_url"),
		defaultAvatar: i.string.format("{0}/app/douyu/res/com/defaultAvatar.png?20161229", s.get("sys.web_url")),
		className: {
			scroll: "status--scroll",
			scrollMax: "status--scroll-max"
		},
		webUrl: s.get("sys.web_url"),
		resourceUrl: s.get("sys.resource_url"),
		nobleConfig: s.get("room.nobleConfig"),
		nobleTotalInfo: null
	},
		l = {
			init: function(t) {
				this.config = e.extend(!0, {
					isNoble: !1,
					isInProtected: !1,
					trial: 0,
					maxUserLevel: 120,
					maxListLength: 20,
					minListLength: 3,
					target: '[data-fans="target"]',
					total: '[data-noble="number"]',
					callback: function() {}
				}, t), this.renderNobleToatlTpl = this.renderNobleToatlList(), e.isFunction(this.config.callback) && this.config.callback.call(this), this.$total = e(this.config.total), this.$target = e(this.config.target), this.$target.length && (this.$target.find('[data-fans="noble"]').html(this.render()), this.$noble = this.$target.find('[ selector="noble-main"]'), this.$list = this.$noble.find('[selector="list"]'), this.initInterface(), this.initScrollbar())
			},
			initScrollbar: function() {
				var e = this;
				e.$list.mCustomScrollbar({
					alwaysShowScrollbar: 2,
					mouseWheel: {
						scrollAmount: 200,
						normalizeDelta: !0
					},
					callbacks: {
						whileScrolling: function() {
							e.$noble[this.mcs.top === e.config.scrollTop ? "addClass" : "removeClass"](o.className.scrollMax)
						},
						onScrollStart: function() {
							e.$list.addClass(o.className.scroll)
						},
						onScroll: function() {
							e.$list.removeClass(o.className.scroll)
						},
						onTotalScroll: function() {
							e.config.scrollTop = this.mcs.top, e.$noble[e.config.isShowInfo ? "addClass" : "removeClass"](o.className.scrollMax)
						}
					}
				})
			},
			render: function() {
				var e, t, n;
				return e = i.string.join('<div class="noble-box--main" selector="noble-main">', '<div class="main--tips">', "{{if (isNoble || isInProtected) && trial != 1}}", '<div class="tips--main">续费贵族，尊享荣耀特权</div>\n', '<a class="btn--normal" href="javascript:;" selector="noble-buy">续费贵族</a>', "{{else}}", '<div class="tips--main">支持<strong title="{{anchorName}}">{{anchorName}}</strong>，成为斗鱼贵族</div>\n', '<a class="btn--normal" href="javascript:;" selector="noble-buy">开通贵族</a>', "{{/if}}", "</div>", '<div class="main--rank-list" selector="list">', '<ul class="r-list clearfix" data-type="list">', '<li class="contribution--noresult">主播很可怜，暂无贵族用户</li>', "</ul>", '<div class="s-noble-count" data-flag="noble-total-wrap" style="display:none;">', '<div class="noble-count-title">本房间莅临<span class="special">贵族人数</span></div>', '<ul class="noble-rank-items" data-flag="noble-total-list">', "</ul>", "</div>", "</div>", "</div>", "</div>"), n = a.compile(e), t = n({
					isNoble: this.config.isNoble,
					isInProtected: this.config.isInProtected,
					trial: this.config.trial,
					anchorName: s.get("room.owner_name"),
					maxListLength: this.config.maxListLength
				})
			},
			renderList: function(e) {
				var t, n, s;
				return t = i.string.join("{{if list.length}}", "{{each list as item}}", "{{if $index < 3}}", '<li class="contribution-item contribution-item-top contribution-item-{{$index + 1}}">', "{{if item.isReality}}", '<a href="javascript:;" class="js-nick" is-show-super-icon="{{item.sahf}}" data-rel="user-info" avatar="{{item.icon}}" rel="{{item.uid}}" gid="{{item.pg}}" data-level="{{item.lv}}" data-noble="{{item.nobleLevel}}">', '<span class="contribution-item-avatar">', '<img src="{{item.avatar}}" alt="{{item.nickname}}">', '<i class="contribution-item-icon"></i>', "</span>", '<span class="r-nick" title="{{item.nickname}}">{{item.nickname}}</span>', "{{if item.nobleIcon}}", '<span class="noble-level"><img src="{{item.nobleIcon}}" alt="{{item.nobleName}}"></span>', "{{/if}}", "</a>", "{{else}}", '<span class="contribution-item-avatar">', '<img src="{{item.avatar}}" alt="{{item.nickname}}">', '<i class="contribution-item-icon"></i>', "</span>", '<span class="r-nick" title="{{item.nickname}}">{{item.nickname}}</span>', "{{/if}}", "</li>", "{{else}}", "{{if $index == 3}}", '<li class="contribution-item contribution-item-{{$index + 1}}">', "{{else}}", '<li class="contribution-item">', "{{/if}}", '<a href="javascript:;" class="js-nick" is-show-super-icon="{{item.sahf}}" data-rel="user-info" avatar="{{item.icon}}" rel="{{item.uid}}" gid="{{item.pg}}" data-level="{{item.lv}}" data-noble="{{item.nobleLevel}}">', "{{if item.nobleIcon}}", '<span class="noble-level"><img src="{{item.nobleIcon}}" alt="{{item.nobleName}}"></span>', "{{/if}}", '<span class="r-nick" title="{{item.nickname}}">{{item.nickname}}</span>', "</a>", "</li>", "{{/if}}", "{{/each}}", "{{else}}", '<li class="contribution--noresult">主播很可怜，暂无贵族用户</li>', "{{/if}}"), s = a.compile(t), n = s({
					list: this.dataHandler(e)
				})
			},
			renderNobleToatlList: function() {
				var e = ["{{ each nobleTotalList as item index }}", "{{ if (item.num > 0) }}", '<li class="noble-rank-item noble-rank-item0{{ item.lev }}">', '<img src="{{ item.icon }}" class="noble-rank-img">', "{{ if (item.num > 9999) }}", '<span class="noble-rank-nums">9999+</span>', "{{ else }}", '<span class="noble-rank-nums">{{ item.num }}</span>', "{{ /if }}", "</li>", "{{ /if }}", "{{ /each }}"].join(""),
					t = a.compile(e);
				return t
			},
			dataHandler: function(a) {
				var r = this,
					l = r.config.maxUserLevel,
					c = r.config.maxListLength,
					d = r.config.minListLength,
					u = e.isArray(a) ? a : [],
					f = 0,
					p = 0,
					m = null,
					h = {},
					g = [];
				for (u = u.slice(0, c), f = u.length, f > 0 && d > f && (f = d), f >= c ? r.config.isShowInfo = !0 : r.config.isShowInfo = !1; f > p; p++) m = u[p], m || g.push({
					isReality: !1,
					nickname: "虚位以待",
					avatar: o.defaultAvatar
				}), m && m.value && (m = n.decode(m.value).too(), m.isReality = !0, m.nn && (m.nickname = m.nn), m.nobleLevel = parseInt(m.ne, 10) || 0, h = o.nobleConfig[m.nobleLevel], h && h.symbol && (m.nobleIcon = s.get("sys.resource_url") + h.symbol.web_symbol_pic1 || "", m.nobleName = h.symbol.name || "贵族用户"), m.icon ? m.avatar = i.string.format("{0}upload/{1}_middle.jpg", o.avatarDomain, m.icon) : m.avatar = o.defaultAvatar, m.lv > 0 ? m.lv = m.lv > l ? l : m.lv : m.lv = 1, t.trigger("mod.center.usergroup.set", m.uid, {
					pg: m.pg,
					rg: m.rg
				}), g.push(m));
				return g
			},
			updateNobleTotal: function(e) {
				var t = parseInt(e, 10) || 0;
				t > 9999 && (t = "9999+"), this.$total.html(t)
			},
			handleNobleTotalList: function() {
				for (var e, t, i = o.nobleTotalInfo || {}, a = o.nobleConfig || {}, s = [], r = n.isArray(i.list) ? n.decode(i.list) : [{
					value: i.list
				}], l = 0; l < r.length; l++) t = r[l], t && t.value && (t = n.decode(t.value).too(), e = a[t.lev] || {}, t.icon = e.symbol && e.symbol.web_symbol_pic2 ? o.resourceUrl + e.symbol.web_symbol_pic2 : o.webUrl + "/app/douyu/res/page/room-normal/noble-count/icon-0" + t.lev + ".png", s.push(t));
				return i.nList = s, s
			},
			appendNobleTotalList: function(e) {
				var t = o.nobleTotalInfo || {},
					i = this.$target.find('[data-flag="noble-total-list"]'),
					a = this.renderNobleToatlTpl({
						nobleTotalList: t.nList || []
					});
				i.html(a), t.nList && t.nList.length >= 7 ? i.addClass("noble-rank-full") : i.removeClass("noble-rank-full"), this.$target.find('[data-flag="noble-total-wrap"]').show()
			},
			updateNobleTotalList: function() {
				var e = o.nobleTotalInfo || {};
				e.sum > 20 && e.list ? (this.handleNobleTotalList(), this.appendNobleTotalList()) : this.$target.find('[data-flag="noble-total-wrap"]').hide()
			},
			initInterface: function() {
				var e = this;
				r.exe("js_getnoble", n.encode([{
					name: "type",
					value: "get_online_noble_list"
				}, {
					name: "rid",
					value: s.get("room.room_id")
				}])), r.reg("room_data_handler", function(i) {
					var a = n.decode(i).too();
					"online_noble_list" === a.type && (a.num && e.updateNobleTotal(a.num), e.config.prevData !== a.nl && (e.config.prevData = a.nl, a.nl ? e.$target.find('[data-fans="noble"] [data-type="list"]').html(e.renderList(n.isArray(a.nl) ? n.decode(a.nl) : [{
						value: a.nl
					}])) : e.$target.find('[data-fans="noble"] [data-type="list"]').html(e.renderList()), e.$list.mCustomScrollbar("update")), t.trigger("chat.fans.change.tab.show", {
						noble: a.nl
					})), "noble_num_info" === a.type && (o.nobleTotalInfo = a, a.sum >= 0 && e.updateNobleTotal(a.sum), e.updateNobleTotalList())
				})
			}
		};
	return l
}), define("douyu/page/room/normal/mod/chat-rank", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "shark/util/flash/data/1.0", "douyu/context", "douyu/page/room/base/api", "douyu/com/exjsonp"], function(e, t, i, a, n, s, r, o) {
	var l = {
		avatarDomain: s.get("sys.avatar_url"),
		defaultAvatar: i.string.format("{0}/app/douyu/res/com/defaultAvatar.png?20161229", s.get("sys.web_url")),
		nobleConfig: s.get("room.nobleConfig"),
		rankSwitch: i.string.format("{0}/resource/common/gxrsw/web.json", s.get("sys.webconfUrl"))
	},
		c = {
			formatNumber: function(e) {
				var t = 0,
					i = e.unit || "";
				switch (i) {
				case "千万":
					t = 7;
					break;
				case "百万":
				case "t":
				case "T":
					t = 6;
					break;
				case "万":
					t = 4;
					break;
				case "千":
				case "k":
				case "K":
					t = 3;
					break;
				case "百":
					t = 2
				}
				return parseFloat(Number(e.number) || 0 / Math.pow(10, t)).toFixed(e.precision || 0) + (e.isUnit ? i : "")
			}
		},
		d = {
			init: function(t) {
				this.config = e.extend(!0, {
					hasInvisible: !1,
					isFaceScore: !1,
					maxUserLevel: 120,
					maxListLength: 10,
					maxMonthLength: 50,
					target: '[data-fans="target"]',
					isYzPage: !1,
					callback: function() {}
				}, t), e.isFunction(this.config.callback) && this.config.callback.call(this), this.$target = e(this.config.target), this.$rankAllPop || (this.$rankAllPop = e(i.string.join('<div class="rank-all-pop js-page-allrank hide" data-monthrank="monthRank" >', '<div class="rank-all-container">', '<div class="rank-all-header">', '<a data-rank="hideallrank" href="javascript:;" class="rank-all-close"></a>', "</div>", '<div class="rank-all-content f-cn" data-fans="all"></div>', "</div>", "</div>")), e("#js-fans-rank").before(this.$rankAllPop), this.$target = this.$target.add(this.$rankAllPop)), this.$target.length && (this.$weekRank = this.$target.find('[data-fans="week"]').html(this.render(1)), this.$target.find('[data-fans="all"]').html(this.render()), this.initUserRole(), this.initInterface(), this.checkRankSwitch(), this.bindEvents())
			},
			initUserRole: function() {
				this.isAnchor = String(s.get("sys.uid")) === String(s.get("room.owner_uid")), this.isSuper = 5 === parseInt(s.get("sys.groupid"), 10)
			},
			checkRankSwitch: function() {
				var i = e('#js-fans-rank [data-fans="week"] .r-list'),
					a = e('[data-fans="week"] .rank-all-trigger');
				a.hide();
				var n = this;
				o.load(l.rankSwitch, "rankAllSwitch", function(e) {
					var r = e || {},
						o = r.sw || {},
						l = r.month || {},
						c = 0 == o[s.get("room.cate_id")],
						d = 0 == l[s.get("room.cate_id")],
						u = 1 === +l[s.get("room.cate_id")];
					d && c ? (a.remove(), i.addClass("is-rankClosed"), t.trigger("rank.message.change.allClosed", !0)) : (n.yzMonthRankPage(u), n.config.isYzPage = !0, a.show())
				}, function() {
					a.show()
				})
			},
			yzMonthRankPage: function(t) {
				if (t) if (e('#js-fans-rank [data-rank="showallrank"]').addClass("js_monthrank").html("贡献月榜 >"), e('#js-fans-rank [data-fans="all"]').attr("fans", "month"), e('[data-monthrank="monthRank"]').removeClass("js-page-allrank").addClass("js-yz-monthrank"), this.$rankInfo || (this.$rankInfo = e(i.string.join('<div class="yzmonth-rankInfo">', '按照最近<span class="highlight-color">30天</span>累计贡献值进行排名', "</div>")), e('.js-yz-monthrank [data-fans="all"]').before(this.$rankInfo)), this.config.prevMonth) {
					var a = this.config.prevMonth;
					this.randerMonthListData(a)
				} else e('.js-yz-monthrank [data-type="list"]').html(this.renderList([], "month"))
			},
			render: function(e) {
				var t, n, s;
				return t = i.string.join("{{if isWeek }}", '<div class="rank-all-trigger">', "<span>点击右侧查看详情</span>", '<a data-rank="showallrank" href="javascript:;">贡献总榜 ></a>', "</div>", "{{/if}}", '<ul class="r-list clearfix" data-type="list">', '<li class="contribution--noresult"></li>', "</ul>", "{{if isWeek && hasInvisible }}", '<div class="noble-invisible">', '<div class="noble-invisible-container main--tips">', '<div class="noble-invisible-tips tips--main">贵族用户可以设置榜单匿名啦~</div> ', '<div class="noble-invisble-enter">', '<span class="noble-invisble-enter-tips">贡献榜隐身</span>', '<label class="noble-invisible-trigger btn--toggle status--checked" selector="toggle">', "<em>", '<input type="checkbox">', '<span class="icon--btn-toggle"></span>', "</em>", "</label>", "</div>", "</div>", "</div>", "{{/if}}"), s = a.compile(t), n = s({
					hasInvisible: this.config.hasInvisible,
					isWeek: e
				})
			},
			renderList: function(e, t) {
				var n, s, r;
				return n = i.string.join("{{if list.length}}", "{{each list as item}}", "{{if $index < 3}}", "{{if item.isOwn}}", '<li class="contribution-item contribution-item-top contribution-item-{{$index + 1}}" selector="self">', "{{else}}", '<li class="contribution-item contribution-item-top contribution-item-{{$index + 1}}">', "{{/if}}", '<a href="javascript:;" class="js-nick" is-show-super-icon="{{item.sahf}}" data-ranktype="{{type}}" data-rel="user-info" avatar="{{item.icon}}" rel="{{item.uid}}" gid="{{item.pg}}" data-level="{{item.level}}" data-noble="{{item.nobleLevel}}" data-invisible="{{item.isInvisible}}" data-invisiblenick="{{item.nick}}">', '<span class="contribution-item-avatar">', '<img src="{{item.avatar}}">', "{{if item.isShowInvisible}}", '<span class="invisible--holder"><span class="invisible--holder-text">已隐身</span></span>', "{{/if}}", '<i class="contribution-item-icon"></i>', "</span>", "{{if item.isInvisible}}", '<span class="r-nick status--invisible" title="{{item.nickname}}">{{item.nickname}}</span>', "{{else}}", '<span class="r-nick" title="{{item.nickname}}">{{item.nickname}}</span>', "{{/if}}", "</a>", "{{if item.isShowMedal}}", "{{if item.nobleIcon}}", '<span class="noble-level"><img src="{{item.nobleIcon}}" alt="{{item.nobleName}}"></span>', "{{/if}}", '<span class="l-icon cuserlevel level-{{item.level}} {{item.imgType}} {{item.imgSize}}" data-uid="{{item.uid}}" title="用户等级：{{item.level}}" selector="user-level"></span>', "{{/if}}", "{{if isFaceScore}}", '<span class="r-contribution" title="{{item.gold}}贡献">{{item.fgold}}贡献</span>', "{{/if}}", "</li>", "{{else}}", "{{if $index == 3}}", "{{if item.isOwn}}", '<li class="contribution-item contribution-item-{{$index + 1}}" selector="self">', "{{else}}", '<li class="contribution-item contribution-item-{{$index + 1}}">', "{{/if}}", "{{else}}", "{{if item.isOwn}}", '<li class="contribution-item contribution-item-a4" selector="self">', "{{else}}", '<li class="contribution-item contribution-item-a4">', "{{/if}}", "{{/if}}", "{{if isFaceScore}}", '<span class="r-contribution" title="{{item.gold}}贡献">{{item.fgold}}贡献</span>', "{{/if}}", '<i class="n-icon">{{$index + 1}}</i>', "{{if item.isShowMedal}}", "{{if item.nobleIcon}}", '<span class="noble-level"><img src="{{item.nobleIcon}}" alt="{{item.nobleName}}"></span>', "{{/if}}", '<span class="l-icon cuserlevel level-{{item.level}} {{item.imgType}} {{item.imgSize}}" data-uid="{{item.uid}}" title="用户等级：{{item.level}}" selector="user-level"></span>', "{{/if}}", '<a href="javascript:;" class="js-nick" is-show-super-icon="{{item.sahf}}" data-ranktype="{{type}}" data-rel="user-info" avatar="{{item.icon}}" rel="{{item.uid}}" gid="{{item.pg}}" data-level="{{item.level}}" data-noble="{{item.nobleLevel}}" data-invisible="{{item.isInvisible}}" data-invisiblenick="{{item.nick}}">', "{{if item.isInvisible}}", '<span class="r-nick status--invisible" title="{{item.nickname}}">', "{{if item.isShowInvisible}}", '<span class="r-nickname">{{item.nickname}}</span>(已隐身)', "{{else}}", "{{item.nickname}}", "{{/if}}", "</span>", "{{else}}", '<span class="r-nick" title="{{item.nickname}}">{{item.nickname}}</span>', "{{/if}}", "</a>", "{{if item.trendTitle}}", '<span class="r-img {{item.trend}}" title="{{item.trendTitle}}"></span>', "{{else}}", '<span class="r-img {{item.trend}}"></span>', "{{/if}}", "</li>", "{{/if}}", "{{/each}}", "{{else}}", '<li class="contribution--noresult"></li>', "{{/if}}"), r = a.compile(n), s = r({
					list: this.dataHandler(e, t),
					isFaceScore: this.config.isFaceScore,
					type: t
				})
			},
			bindEvents: function() {
				var i = this;
				this.$weekRank.on("click", '[data-rank="showallrank"]', function() {
					e(this).hasClass("js_monthrank") && r.exe("js_subscribe_protocol", {
						type: "sub",
						msg_types: ["umrtpgb"]
					}), i.$rankAllPop.removeClass("hide"), e('.js-yz-monthrank [data-fans="all"]').mCustomScrollbar("destroy").mCustomScrollbar(), t.trigger("dys", {
						key: "dys.room.rank.week.all.click",
						is_anch: i.isAnchor ? 1 : 0
					})
				}), this.$rankAllPop.on("click", '[data-rank="hideallrank"]', function() {
					i.$rankAllPop.addClass("hide")
				})
			},
			dataHandler: function(a, r) {
				var o = this,
					d = o.config.maxUserLevel,
					u = o.config.maxListLength,
					f = o.config.maxMonthLength,
					p = e.isArray(a) ? a : [],
					m = 0,
					h = 0,
					g = null,
					v = {},
					y = [];
				for (p = "month" === r ? p.slice(0, f) : p.slice(0, u), m = p.length; m > h; h++) if (g = p[h], g && g.value) {
					switch (g = n.decode(g.value).too(), g.isShowMedal = !0, String(s.get("sys.uid")) === String(g.uid) && (g.isOwn = !0), g.isInvisible = parseInt(g.ih, 10) || 0, g.isInvisible && (g.isOwn || o.isAnchor || o.isSuper ? (g.nick = g.nickname + "(已隐身)", g.isShowInvisible = !0, g.isShowMedal = !0, "month" === r && g.iconrl && (g.icon = g.iconrl)) : (g.nick = "神秘人", "month" === r && (g.nickname = "神秘人"), g.isShowMedal = !1)), g.nobleLevel = parseInt(g.ne, 10) || 0, v = l.nobleConfig[g.nobleLevel], v && v.symbol && (g.nobleIcon = s.get("sys.resource_url") + v.symbol.web_symbol_pic2 || "", g.nobleName = v.symbol.name || "贵族用户"), g.gold = g.gold ? g.gold / 100 : 0, g.gold >= Math.pow(10, 6) ? g.fgold = c.formatNumber({
						number: g.gold,
						unit: "万"
					}) : g.fgold = g.gold, g.level > 0 ? g.level = g.level > d ? d : g.level : g.level = 1, g.imgType = g.level >= 70 ? "" : "level-bgpng", g.imgSize = g.level >= 100 ? "level-size2" : " level-size1", g.icon ? g.avatar = i.string.format("{0}upload/{1}_middle.jpg", l.avatarDomain, g.icon) : g.avatar = l.defaultAvatar, parseInt(g.rs, 10)) {
					case 1:
						g.trend = "rank-up";
						break;
					case -1:
						g.trend = "rank-down";
						break;
					case 0:
						g.trend = "rank-normal"
					}
					g.lrk >= 1 && g.lrk <= u ? g.trendTitle = "之前排名第" + g.lrk + "位" : g.trendTitle = "之前未上榜", "month" === r && (g.trendTitle = ""), t.trigger("mod.center.usergroup.set", g.uid, {
						pg: g.pg,
						rg: g.rg
					}), y.push(g)
				}
				return y
			},
			updateCurrentUserLevel: function(t) {
				var a = this.config.maxUserLevel,
					n = parseInt(t, 10),
					s = "level-next-1";
				n && a >= n && (s = i.string.format("level-{0}", n)), this.$target.find('[selector="self"]').each(function() {
					e(this).find('[selector="user-level"]').removeClass(function() {
						return this.className.match(/level-\d*/g).join(" ")
					}).addClass(s).attr({
						title: "用户等级：" + n
					}), e(this).find('[data-rel="user-info"]').data("level", n)
				})
			},
			initInterface: function() {
				var i = this;
				r.exe("js_rewardList"), r.reg("room_data_cqrank", function(a) {
					var s = n.decode(a).too(),
						r = s.list,
						o = s.list_all;
					"ranklist" === s.type && (i.config.prevWeek !== r && (i.config.prevWeek = r, i.$target.find('[data-fans="week"] [data-type="list"]').html(i.renderList(n.isArray(r) ? n.decode(r) : [{
						value: r
					}], "week"))), i.config.prevAll !== o && (i.config.prevAll = o, e('.js-page-allrank [data-type="list"]').html(i.renderList(n.isArray(o) ? n.decode(o) : [{
						value: o
					}], "all"))), t.trigger("chat.fans.change.tab.show", {
						week: r,
						all: o
					}))
				}), r.reg("room_data_cqrankupdate", function(e) {
					t.trigger("mod.chat.msg.res.rankupdate", e)
				}), r.reg("room_data_rankgap", function(e) {
					t.trigger("mod.chat.msg.res.rankgap", e)
				}), t.on("mod.chatrank.cqrankupdate", function(e) {
					i.updateCurrentUserLevel(e)
				}), r.reg("room_data_handler", function(e) {
					var a = n.decode(e).too(),
						s = a.list,
						r = i.config;
					"hide_status_change" === a.type && 2 === parseInt(a.hide_type, 10) && t.trigger("mod.fans.rank.invisible.change", {
						isInvisible: parseInt(a.is_hide, 10) || 0
					}), "umrtpgb" === a.type && r.prevMonth !== s && (i.config.prevMonth = s, r.isYzPage && i.randerMonthListData(s))
				})
			},
			randerMonthListData: function(t) {
				e('.js-yz-monthrank [data-type="list"]').html(this.renderList(n.isArray(t) ? n.decode(t) : [{
					value: t
				}], "month"))
			}
		};
	return d
}), define("douyu/page/room/normal/mod/fans-medal-rank", ["jquery", "douyu/context", "shark/observer", "shark/util/cookie/1.0", "shark/util/lang/1.0", "shark/util/template/1.0", "shark/util/flash/data/1.0", "douyu/page/room/base/api", "douyu/page/room/normal/mod/get-medal-config", "douyu/page/room/normal/mod/fans-medal-config"], function(e, t, i, a, n, s, r, o, l, c) {
	var d = {},
		u = {
			avatarDomain: t.get("sys.avatar_url"),
			defaultAvatar: n.string.format("{0}/app/douyu/res/com/defaultAvatar.png?20110329", t.get("sys.web_url")),
			isOpenfans: t.get("room.is_set_fans_badge"),
			currentRoomId: parseInt(t.get("room.room_id"), 10),
			fansSpecialUrl: "http://www.douyu.com/t/fans"
		},
		f = {
			selfSource: {
				is_cbdg: "",
				is_bdg: "",
				bdg_id: "",
				cbdg_id: ""
			},
			init: function(t) {
				this.config = e.extend(!0, {
					maxListLength: 50,
					minListLength: 3,
					maxLvel: 30,
					hasInvisible: !1,
					target: '[data-fans="target"]',
					callback: function() {}
				}, t), e.isFunction(this.config.callback) && this.config.callback.call(this), this.$target = e(this.config.target), this.$target.length && (this.tpls = {
					renderFansAllList: this.renderFansAllList(),
					renderFansList: this.renderFansList(),
					selfInfo: this.renderSelfInfo()
				}, this.$fans = this.$target.find('[data-fans="fans"]'), this.$fansTab = e('[data-fans="trigger"]').find('[data-fans="fans"]'), this.$list = this.$fans.find(".fans-modify-list"), this.render(), this.renderAll(), this.initInterface(), this.bindEvent(), this.initScrollbar())
			},
			initScrollbar: function() {
				this.$fans.find(".fans-modify-list").mCustomScrollbar({
					alwaysShowScrollbar: 2,
					mouseWheel: {
						scrollAmount: 200,
						normalizeDelta: !0
					}
				})
			},
			renderAll: function() {
				this.$fansRankAll || (this.$fansRankAll = e(n.string.join('<div class="fansRank-all-pop hide">', '<div class="fansRank-all-wrap">', '<div class="fansRank-all-header">', '<a href="javascript:;" class="fansRank-all-close"></a>', "</div>", '<div class="fansRank-all-content">', '<div class="fans-all-noresult"></div>', "</div>", '<div class="fansRank-all-bottom"></div>', "</div>", "</div>")), e("#js-fans-rank").before(this.$fansRankAll))
			},
			render: function() {
				var i, a, r;
				i = n.string.join('<div class="fans-has-medal clearfix" data-self="info">', '<a target="_blank" data-fans="get" href="<%= fansSpecialUrl %>">按近7天亲密度上升排行</a>', '<span class="show-fans-all">粉丝等级总榜 ></span>', "</div>", '<div class="fans-modify-list" selector="list">', '<ul class="r-list clearfix" data-type="list">', "<% if (isOpenfans) {%>", '<li class="no-fans-rank"></li>', "<%} else {%>", '<li class="no-open-fans"></li>', "<% } %>", "</ul>", "</div>", '<div class="contribution-item-last" data-list="last">', '<div class="fans-total-num">粉丝总人数：<span data-fans="allnum">0</span></div>', "<% if (hasInvisible) { %>", '<div class="main--tips">', '<div class="tips--main">粉丝榜单隐身</div>', '<label class="btn--toggle" selector="toggle">', '<em><input type="checkbox"><span class="icon--btn-toggle"></span></em>', "</label>", "</div>", "<% } %>", "</div>"), r = s.compile(i), a = r({
					isOpenfans: u.isOpenfans,
					hasInvisible: this.config.hasInvisible,
					fansSpecialUrl: u.fansSpecialUrl
				}), this.$fans.html(a), this.$selfInfo = this.$fans.find('[data-self="info"]'), this.$fansList = this.$fans.find('[data-type="list"]'), this.$listLast = this.$fans.find('[data-list="last"]'), this.$fansNumber = this.$fans.find('[data-fans="allnum"]'), t.get("room.owner_uid") == t.get("sys.uid") && e(".fansRank-all-bottom").hide()
			},
			updateData: function(e) {
				parseInt(e, 10) >= 1 && this.$listLast.show(), this.$fansNumber.html(e)
			},
			renderSelfInfo: function() {
				var e, t;
				return e = n.string.join('<div class="fans-myInfo-wrap">', '<span class="fansAll-my-info">', "我的排名：", '<i class="my-rank-num" data-rank="bl">', "<% if (pos) { %>", "<% if (pos <= 500) { %>", "<%= pos %>", "<% } else { %>", "500+", "<% } %>", "<% } %>", "</i>", "</span>", "<%=# returnMedalComponent({roomId: roomId, medalLev: bl, medalNick: bnn}) %>", "</div>"), t = s.compile(e)
			},
			renderFansAllList: function(e, t) {
				var i, a;
				return i = n.string.join("<% for (var i = 0;i < data.length; i++) {%>", "<%if (i < 3){%>", '<li class="contribution-list contribution-list-top contribution-list-<%= i + 1 %>" data-rel="user-info" data-fansMedal-lev="<%= data[i].lv %>" data-fansMedal-nick="<%= data[i].fansId %>" data-level="<%= data[i].lev %>"><i class="n-icon"><%= i+1 %></i><img src="<%= data[i].avatar%>">', "<%} else {%>", '<li class="contribution-list" data-rel="user-info" data-fansMedal-lev="<%= data[i].lv %>" data-fansMedal-nick="<%= data[i].fansId %>" data-level="<%= data[i].lev %>"><i class="n-icon"><%= i+1 %></i>', "<% } %>", "<% if (data[i].isShowInvisible) { %>", '<span class="js-nick r-nick status--invisible" style="cursor: pointer;" title="<%= data[i].nickname %>" is-show-super-icon="<%= data[i].sahf%>" avatar="<%= data[i].ic%>" gid="<%= data[i].pg %>" rel="<%= data[i].uid %>" data-invisiblenick="<%= data[i].nickname %>" data-invisible="<%= data[i].hd %>"  data-noble="<%= data[i].nl %>">', "<%= data[i].nickname %>（已隐身）", "</span>", "<% } else { %>", "<% if (data[i].isVisibility == 1) { %>", '<span class="js-nick r-nick status--invisible" style="cursor: pointer;" title="<%= data[i].nickname %>" is-show-super-icon="<%= data[i].sahf%>" avatar="<%= data[i].ic%>" gid="<%= data[i].pg %>" rel="<%= data[i].uid %>" data-invisiblenick="<%= data[i].nickname %>" data-invisible="<%= data[i].hd %>"  data-noble="<%= data[i].nl %>">', "<%= data[i].nickname %>", "</span>", "<% } else { %>", '<span class="js-nick r-nick" style="cursor: pointer;" title="<%= data[i].nickname %>" is-show-super-icon="<%= data[i].sahf%>" avatar="<%= data[i].ic%>" gid="<%= data[i].pg %>" rel="<%= data[i].uid %>" data-invisiblenick="<%= data[i].nickname %>" data-invisible="<%= data[i].hd %>"  data-noble="<%= data[i].nl %>">', "<%= data[i].nickname %>", "</span>", "<% } %>", "<% } %>", "<% if (data[i].isRealUser &&　data[i].isShowMedal) { %>", "<%=# returnMedalComponent({roomId: roomId, medalLev: data[i].lv, medalNick: data[i].fansId}) %>", "<% } %>", "</li>", "<% } %>"), a = s.compile(i)
			},
			renderFansList: function(e, t) {
				var i, a;
				return i = n.string.join("<% for (var i = 0;i < data.length; i++) {%>", "<%if (i < 3){%>", '<li class="contribution-list contribution-list-top contribution-list-<%= i + 1 %>" data-rel="user-info" data-fansMedal-lev="<%= data[i].lv %>" data-fansMedal-nick="<%= data[i].fansId %>" data-level="<%= data[i].lev %>"><i class="n-icon"><%= i+1 %></i><img src="<%= data[i].avatar%>">', "<%} else {%>", '<li class="contribution-list" data-rel="user-info" data-fansMedal-lev="<%= data[i].lv %>" data-fansMedal-nick="<%= data[i].fansId %>" data-level="<%= data[i].lev %>"><i class="n-icon"><%= i+1 %></i>', "<% } %>", "<% if (data[i].isShowInvisible) { %>", '<span class="js-nick r-nick status--invisible" style="cursor: pointer;" title="<%= data[i].nickname %>" is-show-super-icon="<%= data[i].sahf%>" avatar="<%= data[i].ic%>" gid="<%= data[i].pg %>" rel="<%= data[i].uid %>" data-invisiblenick="<%= data[i].nickname %>" data-invisible="<%= data[i].hd %>"  data-noble="<%= data[i].nl %>">', "<%= data[i].nickname %>（已隐身）", "</span>", "<% } else { %>", "<% if (data[i].isVisibility == 1) { %>", '<span class="js-nick r-nick status--invisible" style="cursor: pointer;" title="<%= data[i].nickname %>" is-show-super-icon="<%= data[i].sahf%>" avatar="<%= data[i].ic%>" gid="<%= data[i].pg %>" rel="<%= data[i].uid %>" data-invisiblenick="<%= data[i].nickname %>" data-invisible="<%= data[i].hd %>"  data-noble="<%= data[i].nl %>">', "<%= data[i].nickname %>", "</span>", "<% } else if (data[i].isRealUser) { %>", '<span class="js-nick r-nick" style="cursor: pointer;" title="<%= data[i].nickname %>" is-show-super-icon="<%= data[i].sahf%>" avatar="<%= data[i].ic%>" gid="<%= data[i].pg %>" rel="<%= data[i].uid %>" data-invisiblenick="<%= data[i].nickname %>" data-invisible="<%= data[i].hd %>"  data-noble="<%= data[i].nl %>">', "<%= data[i].nickname %>", "</span>", "<% } else { %>", '<span class="r-nick">', "<%= data[i].nickname %>", "</span>", "<% } %>", "<% } %>", "<% if (data[i].isRealUser &&　data[i].isShowMedal) { %>", "<%=# returnMedalComponent({roomId: roomId, medalLev: data[i].lv, medalNick: data[i].fansId}) %>", "<% if (data[i].fansIntimacy) { %>", '<span class="fansIntimacy-count">', "<%= data[i].fansIntimacy %>", "</span>", "<% } %>", '<span class="rankChange-status rankChange-status-<%= data[i].rankChange + 1 %>"></span>', "<% } %>", "</li>", "<% } %>"), a = s.compile(i)
			},
			handleRankListData: function(i, a, s) {
				this.isAnchor = String(t.get("sys.uid")) === String(t.get("room.owner_uid")), this.isSuper = 5 === parseInt(t.get("sys.groupid"), 10);
				var o = this,
					l = o.config.maxListLength,
					c = o.config.minListLength,
					d = o.config.maxLvel,
					f = e.isArray(i) ? i : [],
					p = 0,
					m = null,
					h = [];
				f = f.slice(0, l), p = f.length, !s && p > 0 && c > p && (p = c);
				for (var g = 0; p > g; g++) m = f[g], m || h.push({
					isRealUser: !1,
					nickname: "虚位以待",
					avatar: u.defaultAvatar,
					fansIntimacy: "--",
					rankChange: 0
				}), m && m.value && (m = r.decode(m.value).too(), m.isRealUser = !0, String(t.get("sys.uid")) === String(m.uid) && (m.isOwn = !0), a && (m.fansId = a), m.nn && (m.nickname = m.nn), m.ic ? m.avatar = n.string.format("{0}upload/{1}_middle.jpg", u.avatarDomain, m.ic) : m.avatar = u.defaultAvatar, m.bl > 0 ? m.lv = m.bl > d ? d : m.bl : m.lv = 1, m.fansIntimacy = parseInt(m.fim / 100, 10) || "--", m.rankChange = parseInt(m.rc, 10) || 0, m.isVisibility = parseInt(m.hd, 10) || 0, m.isVisibility ? m.isOwn || o.isAnchor || o.isSuper ? (m.isShowInvisible = !0, m.isShowMedal = !0) : m.isShowMedal = !1 : m.isShowMedal = !0, h.push(m));
				return h
			},
			renderSelf: function(t) {
				var i = "",
					a = this;
				t && 0 === parseInt(f.isOpenfans, 10) && (f.isOpenfans = 1), i = this.tpls.selfInfo({
					pos: t.pos || a.selfPos,
					bnn: t.bnn || a.selfBnn,
					bl: t.bl || a.selfBl,
					fansMedal: d || {},
					returnMedalComponent: l.returnMedalComponent,
					roomId: u.currentRoomId
				}), e(".fansRank-all-bottom").html(i)
			},
			initInterface: function() {
				var t, a, n = this,
					s = {},
					f = [];
				o.reg("room_data_fansRank", function(o) {
					var p = r.decode(o).too();
					c.getData().then(function(o) {
						if (d = o, "fswrank" === p.type) {
							if (p.list) {
								if (s = r.isArray(p.list) ? r.decode(p.list) : [{
									value: p.list
								}], f = n.handleRankListData(s, p.bnn), n.$fansList.html(n.tpls.renderFansList({
									data: f,
									fansMedal: d || {},
									returnMedalComponent: l.returnMedalComponent,
									roomId: u.currentRoomId
								})), r.isArray(p.list)) {
									t = r.decode(p.list);
									for (var c = 0; c < t.length; c++) a = r.decode(t[c].value).too(), i.trigger("mod.center.usergroup.set", a.uid, {
										pg: a.pg,
										rg: a.rg
									})
								} else a = r.decode(p.list).too(), i.trigger("mod.center.usergroup.set", a.uid, {
									pg: a.pg,
									rg: a.rg
								});
								u.isOpenfans = 1
							}
							i.trigger("chat.fans.change.tab.show", {
								fansMedal: p.list
							})
						}
						if ("frank" === p.type) {
							if (p.list) {
								if (s = r.isArray(p.list) ? r.decode(p.list) : [{
									value: p.list
								}], f = n.handleRankListData(s, p.bnn), e(".fansRank-all-content").html(n.tpls.renderFansAllList({
									data: f,
									fansMedal: d || {},
									returnMedalComponent: l.returnMedalComponent,
									roomId: u.currentRoomId
								})), r.isArray(p.list)) {
									t = r.decode(p.list);
									for (var c = 0; c < t.length; c++) a = r.decode(t[c].value).too(), i.trigger("mod.center.usergroup.set", a.uid, {
										pg: a.pg,
										rg: a.rg
									})
								} else a = r.decode(p.list).too(), i.trigger("mod.center.usergroup.set", a.uid, {
									pg: a.pg,
									rg: a.rg
								});
								u.isOpenfans = 1
							}
							n.updateData(p.fc || 0)
						}
						if ("blst" === p.type) {
							var m = r.isArray(p.list) ? r.decode(p.list) : [{
								value: p.list
							}],
								h = e.isArray(m) ? m : [];
							n.handleDpData(p);
							for (var c = 0; c < h.length; c++) {
								var g = h[c];
								if (g && g.value && (g = r.decode(g.value).too(), parseInt(g.rid, 10) === u.currentRoomId)) {
									n.selfBl = g.bl, n.selfBnn = g.bnn, n.renderSelf(g);
									break
								}
							}
						}
						if ("ru" === p.type) {
							var v = "--";
							p.pos > 0 && p.pos <= 500 ? v = p.pos : p.pos > 500 && (v = "500+"), e(".my-rank-num").html(v), n.selfPos = v
						}
						if ("gbi" === p.type && (u.isOpenfans = 1, n.selfSource.is_bdg = 1, n.selfSource.is_cbdg = 1, n.selfSource.cbdg_id = u.currentRoomId, parseInt(n.$fansNumber.html(), 10) >= 50 && n.$fansNumber.html(parseInt(n.$fansNumber.html(), 10) + 1), n.selfBl = p.bl, n.selfBnn = p.bnn, n.renderSelf(p)), "synfim" === p.type) {
							u.isOpenfans = 1, n.selfSource.is_bdg = 1, n.selfSource.is_cbdg = 1, n.selfSource.cbdg_id = u.currentRoomId, n.selfBl = p.bl, n.selfBnn && n.renderSelf(p)
						}
						"obres" === p.type && (0 === parseInt(p.result, 10) && 1 === parseInt(p.ot, 10) ? n.selfSource.bdg_id = p.rid : 0 !== parseInt(p.result, 10) || 2 !== parseInt(p.ot, 10) && 3 !== parseInt(p.ot, 10) || (n.selfSource.bdg_id = 0))
					})
				})
			},
			handleDpData: function(t) {
				var i = t.wf ? parseInt(t.wf, 10) : 0,
					a = r.isArray(t.list) ? r.decode(t.list) : [{
						value: t.list
					}];
				1 === parseInt(u.isOpenfans, 10) && (this.selfSource.cbdg_id = u.currentRoomId), 0 === i ? this.selfSource.is_bdg = 0 : 1 !== i && 2 !== i || (this.selfSource.is_bdg = 1);
				for (var n = e.isArray(a) ? a : [], s = 0; s < n.length; s++) {
					var o = n[s];
					o && o.value && (o = r.decode(o.value).too(), 2 === i && 0 === s && (this.selfSource.bdg_id = o.rid), parseInt(o.rid, 10) === u.currentRoomId && (this.selfSource.is_cbdg = 1))
				}
				this.selfSource.cbdg_id || 1 !== parseInt(u.isOpenfans, 10) || (this.selfSource.cbdg_id = u.currentRoomId), this.selfSource.is_cbdg || (this.selfSource.is_cbdg = 0)
			},
			bindEvent: function() {
				var t = this;
				this.$selfInfo.on("click", '[data-fans="get"]', function() {
					1 === parseInt(u.isOpenfans, 10) && (t.selfSource.cbdg_id = u.currentRoomId), i.trigger("dys", e.extend(!0, {
						key: "dys.click.fans.rank.getmoreinfo"
					}, t.selfSource))
				}), this.$fansTab.on("click", function() {
					1 === parseInt(u.isOpenfans, 10) && (t.selfSource.cbdg_id = u.currentRoomId), i.trigger("dys", e.extend(!0, {
						key: "dys.click.fans.rank"
					}, t.selfSource))
				}), e(".show-fans-all").on("click", function() {
					t.$fansRankAll.removeClass("hide")
				}), e(".fansRank-all-close").on("click", function() {
					t.$fansRankAll.addClass("hide")
				})
			}
		};
	return f
}), define("douyu/page/room/normal/mod/chat-fans", ["jquery", "shark/observer", "douyu/page/room/normal/mod/chat-noble", "douyu/page/room/normal/mod/chat-rank", "douyu/page/room/normal/mod/fans-medal-rank", "douyu/context"], function(e, t, i, a, n, s) {
	var r = {
		type: {
			week: "week",
			all: "all",
			noble: "noble",
			fansMedal: "fans"
		},
		className: {
			isInvisible: "status--checked",
			isFaceScore: "status--face",
			isNoble: "status--noble",
			isHover: "status--hover"
		},
		nobleConfig: s.get("room.nobleConfig") || {}
	},
		o = {
			status: {
				isInited: 0
			},
			init: function(t) {
				this.config = e.extend(!0, {
					target: "#js-fans-rank",
					currentClass: "cur",
					currentType: r.type.week,
					isAutoToggle: !1,
					isFaceScore: s.get("room.isVertical") || 0,
					isNoble: !1,
					isInvisible: !1,
					hasInvisible: !1,
					onChange: function() {}
				}, t), this.$fans = e(this.config.target), this.$fans.length && (this.$trigger = this.$fans.find('[data-fans="trigger"]'), this.$target = this.$fans.find('[data-fans="target"]'), this.initInterface(), this.bindEvent())
			},
			initInterface: function() {
				var i = this;
				t.on("mod.noble.info.get.rank", function(e) {
					"memberinfores" === e.type && (i.config.isNoble = parseInt(e.nl, 10) || 0, i.config.isInProtected = parseInt(e.npts, 10) || 0, i.config.trial = parseInt(e["try"], 10) || 0, i.config.isNoble ? i.config.hasInvisible = r.nobleConfig[i.config.isNoble].top_list_hide || 0 : i.config.hasInvisible = 0, i.status.isInited || (i.initRely(), i.status.isInited = 1))
				}), t.on("mod.fans.rank.invisible.change", function(e) {
					i.config.isInvisible = Boolean(e.isInvisible), i.toggleInvisibleState()
				}), t.on("chat.fans.change.tab.show", function(t) {
					i.config.source = e.extend(!0, {}, i.config.source, t), i.toggleShow()
				}), t.on("chat.fans.change.tab.noble", function(e) {
					1 === parseInt(e.state, 10) ? (i.config.currentType = r.type.noble, i.show()) : i.toggleShow()
				})
			},
			initRely: function() {
				var e = this,
					t = e.config;
				e.config.isFaceScore && e.$fans.addClass(r.className.isFaceScore), e.config.hasInvisible && e.$fans.addClass(r.className.isNoble), i.init({
					isNoble: t.isNoble,
					isInProtected: t.isInProtected,
					trial: t.trial,
					target: e.$target,
					total: e.$trigger.find('[data-noble="number"]')
				}), a.init({
					hasInvisible: t.hasInvisible,
					isFaceScore: t.isFaceScore,
					target: e.$target
				}), n.init({
					hasInvisible: t.hasInvisible,
					target: e.$target
				}), e.config.hasInvisible && e.getInvisible()
			},
			toggleShow: function() {
				var e = this,
					t = e.config.source;
				e.config.isAutoToggle && (t.week && t.week.length ? e.config.currentType = r.type.week : t.noble && t.noble.length ? e.config.currentType = r.type.noble : e.config.currentType = r.type.fansMedal), e.show()
			},
			show: function() {
				var e = this,
					i = e.config;
				e.$trigger.find("[data-fans]").removeClass(i.currentClass), e.$target.find("[data-fans]").removeClass(i.currentClass), e.$trigger.find('[data-fans="' + i.currentType + '"]').addClass(i.currentClass), e.$target.find('[data-fans="' + i.currentType + '"]').addClass(i.currentClass), i.onChange.call(e, i.currentType), t.trigger("mod.chat.height.change")
			},
			setInvisible: function() {
				var t = this;
				t.config.isSending || (t.config.isSending = !0, e.ajax({
					url: "/member/noble/setHideStatus",
					type: "POST",
					dataType: "json",
					async: !1,
					data: {
						type: 2,
						rid: s.get("room.room_id"),
						status: t.config.isInvisible ? 0 : 1
					},
					error: function() {
						e.dialog.tips_black("网络错误！设置榜单隐身状态失败！")
					},
					success: function(i) {
						0 === parseInt(i.code, 10) ? (t.config.isInvisible = !t.config.isInvisible, t.toggleInvisibleState(), t.showToast()) : e.dialog.tips_black(i.msg || "未知错误！设置榜单隐身状态失败！")
					},
					complete: function() {
						setTimeout(function() {
							t.config.isSending = !1
						}, 3e4)
					}
				}))
			},
			getInvisible: function() {
				var t = this;
				t.config.isSending = !0, e.ajax({
					url: "/member/noble/getHideStatus",
					type: "GET",
					dataType: "json",
					data: {
						type: 2,
						rid: s.get("room.room_id")
					},
					error: function() {
						e.dialog.tips_black("网络错误！获取榜单隐身状态失败！"), t.config.isSending = !1
					},
					success: function(i) {
						0 === parseInt(i.code, 10) ? (t.config.isInvisible = Boolean(parseInt(i.status, 10) || 0), t.toggleInvisibleState()) : e.dialog.tips_black(i.msg || "未知错误！获取榜单隐身状态失败！"), t.config.isSending = !1
					}
				})
			},
			toggleInvisibleState: function() {
				this.$target.find('[selector="toggle"]')[this.config.isInvisible ? "addClass" : "removeClass"](r.className.isInvisible)
			},
			showToast: function() {
				var t, i;
				"fans" === this.config.currentType ? (t = "粉丝榜隐身已解除", i = "已在主播的粉丝榜中隐身") : (t = "贡献榜隐身已解除", i = "已在主播的贡献榜中隐身");
				var a = this.config.isInvisible ? i : t,
					n = e('<div class="toast-box" selector="toast-box"><div class="toast-item"><span>' + a + "</span></div></div>");
				this.$target.find('[selector="toast-box"]').remove(), this.$target.append(n), setTimeout(function() {
					n.remove()
				}, 1500)
			},
			bindEvent: function() {
				var i = this,
					a = function(e) {
						e.preventDefault(), e.stopPropagation()
					};
				i.$trigger.on("click.fans", "[data-fans]", function(n) {
					var o = e(this),
						l = o.data("fans");
					switch (i.config.isAutoToggle = !1, i.config.currentType !== l && (i.config.currentType = l, i.show()), l) {
					case r.type.week:
						t.trigger("dys", {
							key: "dys.room.rank.week.click",
							is_anch: String(s.get("sys.uid")) === String(s.get("room.owner_uid")) ? 1 : 0
						});
						break;
					case r.type.all:
						t.trigger("dys", {
							key: "dys.room.rank.all.click"
						});
						break;
					case r.type.noble:
						t.trigger("dys", {
							key: "dys.room.rank.noble.click"
						})
					}
					a(n)
				}), i.$target.on({
					mouseenter: function() {
						i.$fans.addClass(r.className.isHover)
					},
					mouseleave: function() {
						i.$fans.removeClass(r.className.isHover)
					}
				}).on("click.setInvisible", '[selector="toggle"]', function(e) {
					a(e), i.setInvisible()
				}).on("click.buyNoble", '[selector="noble-buy"]', function(e) {
					t.trigger("mod.normal.noble.buy"), i.config.isNoble ? t.trigger("dys", {
						key: "dys.room.fans.noble.renewal",
						level: i.config.isNoble
					}) : t.trigger("dys", {
						key: "dys.room.fans.noble.open"
					}), a(e)
				})
			}
		};
	return {
		init: function(e) {
			o.init(e)
		}
	}
}), define("douyu/page/room/normal/mod/chat-exp", ["jquery", "shark/class", "shark/util/lang/1.0", "shark/observer", "shark/util/template/1.0", "douyu/context", "douyu/com/user"], function(e, t, i, a, n, s, r) {
	var o = {
		ratio: 1366,
		smallScreenCol: 6,
		bigScreenCol: 7,
		emw: 42,
		emh: 42,
		emb: 1,
		defaultThumbTop: 2,
		state: {
			open: "open",
			close: "close"
		},
		defaultFaceListConfig: [{
			id: "101",
			type: "png",
			title: "666"
		}, {
			id: "102",
			type: "png",
			title: "发呆"
		}, {
			id: "103",
			type: "png",
			title: "拜拜"
		}, {
			id: "104",
			type: "png",
			title: "晕"
		}, {
			id: "105",
			type: "png",
			title: "弱"
		}, {
			id: "106",
			type: "png",
			title: "傲慢"
		}, {
			id: "107",
			type: "png",
			title: "开心"
		}, {
			id: "108",
			type: "png",
			title: "奋斗"
		}, {
			id: "109",
			type: "png",
			title: "很酷"
		}, {
			id: "110",
			type: "png",
			title: "流泪"
		}, {
			id: "111",
			type: "png",
			title: "鄙视"
		}, {
			id: "112",
			type: "png",
			title: "得意"
		}, {
			id: "113",
			type: "png",
			title: "抠鼻"
		}, {
			id: "114",
			type: "png",
			title: "亲亲"
		}, {
			id: "115",
			type: "png",
			title: "偷笑"
		}, {
			id: "116",
			type: "png",
			title: "口罩"
		}, {
			id: "117",
			type: "png",
			title: "委屈"
		}, {
			id: "118",
			type: "png",
			title: "难过"
		}, {
			id: "119",
			type: "png",
			title: "吐血"
		}, {
			id: "120",
			type: "png",
			title: "大怒"
		}, {
			id: "121",
			type: "png",
			title: "赞"
		}, {
			id: "122",
			type: "png",
			title: "睡觉"
		}, {
			id: "123",
			type: "png",
			title: "骷髅"
		}, {
			id: "124",
			type: "png",
			title: "调皮"
		}, {
			id: "125",
			type: "png",
			title: "惊讶"
		}, {
			id: "126",
			type: "png",
			title: "撇嘴"
		}, {
			id: "127",
			type: "png",
			title: "拥抱"
		}, {
			id: "128",
			type: "png",
			title: "背锅"
		}, {
			id: "129",
			type: "png",
			title: "闭嘴"
		}, {
			id: "130",
			type: "png",
			title: "吃药"
		}, {
			id: "131",
			type: "png",
			title: "可怜"
		}, {
			id: "132",
			type: "png",
			title: "呕吐"
		}, {
			id: "133",
			type: "png",
			title: "敲打"
		}, {
			id: "134",
			type: "png",
			title: "心碎"
		}, {
			id: "135",
			type: "png",
			title: "嘘"
		}, {
			id: "136",
			type: "png",
			title: "中箭"
		}, {
			id: "137",
			type: "png",
			title: "抓狂"
		}, {
			id: "001",
			type: "png",
			title: "流汗"
		}, {
			id: "002",
			type: "png",
			title: "丢药"
		}, {
			id: "003",
			type: "png",
			title: "白眼"
		}, {
			id: "004",
			type: "png",
			title: "火箭"
		}, {
			id: "005",
			type: "png",
			title: "色"
		}, {
			id: "006",
			type: "png",
			title: "点蜡"
		}, {
			id: "007",
			type: "png",
			title: "抽烟"
		}, {
			id: "008",
			type: "png",
			title: "可爱"
		}, {
			id: "009",
			type: "png",
			title: "炸弹"
		}, {
			id: "010",
			type: "png",
			title: "吃丸子"
		}, {
			id: "011",
			type: "png",
			title: "害怕"
		}, {
			id: "012",
			type: "png",
			title: "疑问"
		}, {
			id: "013",
			type: "png",
			title: "阴险"
		}, {
			id: "014",
			type: "png",
			title: "害羞"
		}, {
			id: "015",
			type: "png",
			title: "笑哭"
		}, {
			id: "016",
			type: "png",
			title: "猪头"
		}, {
			id: "017",
			type: "png",
			title: "困"
		}]
	},
		l = t({
			getDoms: function() {
				this.doms = {
					$chatSpeak: e(".chat-speak"),
					$el: e(".face-box"),
					$html: e("html"),
					$body: e("body")
				}
			},
			init: function(t) {
				this.config = e.extend(!0, {}, {
					row: 6,
					col: 7,
					isExcute: !1,
					fullpageThumbMove: !0,
					thumbTop: o.defaultThumbTop,
					thumbH: 0,
					currPage: 1,
					sumPage: 0,
					lastPage: 0,
					state: o.state.close,
					rendered: !1,
					faceListConfig: window.faceListConfig ? window.faceListConfig : o.defaultFaceListConfig
				}, t), this.getDoms(), this.bindEvent()
			},
			initPage: function(e) {
				e !== !0 && 0 !== this.doms.$el.find(".face_container").length || (this.config.rendered = !0, this.render()), this.initToggle(), this.bindMouseWheelEvent()
			},
			layout: function(t) {
				this.config.rendered !== !1 && (this.config = e.extend(!0, {}, {
					fullpageThumbMove: !0,
					thumbTop: o.defaultThumbTop,
					thumbH: 0,
					currPage: 1,
					sumPage: 0,
					lastPage: 0
				}, t), this.initPage(!0))
			},
			render: function() {
				var t, i, a, n, s = this,
					r = [],
					l = o.emb,
					c = s.config.row,
					d = s.config.col,
					u = c * d,
					f = s.config.lastPage,
					p = s.config.thumbH,
					m = s.config.faceListConfig,
					h = 0,
					g = 0,
					v = m.length,
					y = "";
				t = (o.emw + l) * d, i = (o.emh + l) * c, h = i, g = i - 16, a = parseInt(v / u), n = v % u, n > 0 && (a += 1), f = a - 1, p = 1 * g / a;
				for (var b = 0; a > b; b++) r.push({
					stoe: {
						sIndex: b * u,
						eIndex: b == a - 1 ? v - 1 : b * u + (u - 1)
					},
					currPage: b
				});
				y = s.makeContentHtml({
					faceListConfig: m,
					pageInfo: r,
					scrollbarH: g,
					defaultThumbTop: o.defaultThumbTop,
					thumbH: p,
					faceNum: u,
					row: c,
					col: d,
					fw: t,
					fh: i
				}), s.doms.$el.html(y), s.doms.$el.css({
					width: t + 24 + 2 + "px",
					height: i + 2 + "px",
					top: -(i + 20) + "px"
				}), s.config = e.extend(!0, this.config, {
					sectionH: h,
					scrollbarH: g,
					sumPage: a,
					lastPage: f,
					thumbH: p
				})
			},
			makeContentHtml: function(e) {
				var t, a, r;
				return t = i.string.join('<div class="scrollbar" style="height:<%= scrollbarH %>px">', '<div class="track" style="height:<%= scrollbarH %>px">', '<div class="thumb" style="top: <%= defaultThumbTop %>px; height:<%= thumbH %>px">', '<div class="face_page" style="display:none">', '<div class="pagenum">0/0</div>', "</div>", "</div>", "</div>", "</div>", '<div class="facePad" id="facePad" style="width:<%=fw%>px;height:<%=fh%>px">', '<div class="new_face_list clearfix viewport" id="new_face_list" style="width:<%=fw%>px;height:<%=fh%>px">', '<div class="face_container overview clearfix" style="width:<%=fw%>px">', "<% for(var i=0;i<pageInfo.length;i++) { %>", "<% var pageData= pageInfo[i]; %>", "<% var onePageStartIndex = pageData.stoe.sIndex; %>", "<% var onePageEndIndex = pageData.stoe.eIndex; %>", "<% var lastIndex = (i+1)*faceNum - 1; %>", '<section class="section" style="width:<%=fw%>px;height:<%=fh%>px">', "<% for(var j = onePageStartIndex ; j <= onePageEndIndex; j++) { %>", "<% if( (j + 1) % col == 0 && (j + 1)/faceNum < onePageEndIndex && j==lastIndex){ %>", '<em class="dy<%=faceListConfig[j].id%> emBRN emBBN" rel="dy<%=faceListConfig[j].id%>" name="faceimg" ftype="chat" title="<%=faceListConfig[j].title%>">', '<img src="<%=web_url%>app/douyu/res/page/room-normal/face/dy<%=faceListConfig[j].id%>.', '<%= !!faceListConfig[j].type ? faceListConfig[j].type : "png" %>', '?v=<%=version%>"/>', "</em>", "<% } else if( j >= ( (i+1) * faceNum - col ) && j < ((i+1) * faceNum ) && j!=lastIndex ){ %>", '<em class="dy<%=faceListConfig[j].id%> emBBN" rel="dy<%=faceListConfig[j].id%>" name="faceimg" ftype="chat" title="<%=faceListConfig[j].title%>">', '<img src="<%=web_url%>app/douyu/res/page/room-normal/face/dy<%=faceListConfig[j].id%>.', '<%= !!faceListConfig[j].type ? faceListConfig[j].type : "png" %>', '?v=<%=version%>"/>', "</em>", "<% } else if( (j + 1) % col == 0 && (j + 1)/faceNum < onePageEndIndex && j!=lastIndex ){ %>", '<em class="dy<%=faceListConfig[j].id%> emBRN" rel="dy<%=faceListConfig[j].id%>" name="faceimg" ftype="chat" title="<%=faceListConfig[j].title%>">', '<img src="<%=web_url%>app/douyu/res/page/room-normal/face/dy<%=faceListConfig[j].id%>.', '<%= !!faceListConfig[j].type ? faceListConfig[j].type : "png" %>', '?v=<%=version%>"/>', "</em>", "<% } else{ %>", '<em class="dy<%=faceListConfig[j].id%>" rel="dy<%=faceListConfig[j].id%>" name="faceimg" ftype="chat" title="<%=faceListConfig[j].title%>">', '<img src="<%=web_url%>app/douyu/res/page/room-normal/face/dy<%=faceListConfig[j].id%>.', '<%= !!faceListConfig[j].type ? faceListConfig[j].type : "png" %>', '?v=<%=version%>"/>', "</em>", "<% } %>", "<% } %>", "</section>", "<% } %>", "</div>", "</div>", "</div>", '<div class="up"></div>', '<div class="down"></div>', '<span class="face-arrow face-arrow1"></span>', '<span class="face-arrow face-arrow2"></span>'), a = n.compile(t), r = a({
					faceListConfig: e.faceListConfig,
					pageInfo: e.pageInfo,
					scrollbarH: e.scrollbarH,
					defaultThumbTop: e.defaultThumbTop,
					thumbH: e.thumbH,
					faceNum: e.faceNum,
					row: e.row,
					col: e.col,
					fw: e.fw,
					fh: e.fh,
					web_url: s.get("sys.web_url"),
					version: 20170626
				})
			},
			down: function(t, i) {
				var a = this,
					n = i || window.event,
					s = e("#container");
				a.config = e.extend(!0, this.config, {
					isExcute: !0,
					startY: n.pageY,
					thumbY: t.offsetTop
				}), a.Move = a.processFn(a.move, a, t), a.Up = a.processFn(a.up, a, t), s.bind("mousemove", a.Move), s.bind("mouseup", a.Up), a.doms.$el.find(".thumb").bind("mouseup", a.Up), a.doms.$el.find(".track").bind("mouseup", a.Up)
			},
			move: function(t, i) {
				var a = this,
					n = a.doms,
					s = i || window.event,
					r = a.config.thumbH,
					l = o.defaultThumbTop,
					c = a.config.currPage,
					d = 0,
					u = l + r * a.config.lastPage,
					f = (c - 1) * r - .5 * r + l,
					p = (c - 1) * r + .5 * r + l,
					m = a.config.prevEndY ? a.config.prevEndY : 0,
					h = s.pageY,
					g = a.config.thumbY;
				if (d = h ? g + (h - a.config.startY) : g, n.$html.css({
					"user-select": "none"
				}), n.$body.css({
					"user-select": "none"
				}), l >= d ? d = l : d >= u && (d = u), e(t).css({
					top: d + "px"
				}), a.config.isExcute) if (0 > h - m) f >= d && a.pageUp();
				else {
					if (!(h - m > 0)) return;
					d >= p && a.pageDown()
				}
				return a.config = e.extend(!0, this.config, {
					fullpageThumbMove: !1,
					endY: h,
					prevEndY: h
				}), !1
			},
			up: function(t, i) {
				var a = this,
					n = e("#container"),
					s = i || window.event,
					r = a.config.thumbH,
					l = o.defaultThumbTop,
					c = a.config.endY,
					d = a.config.startY,
					u = a.config.isExcute,
					f = a.config.currPage,
					p = a.config.thumbTop,
					m = l + r * a.config.lastPage,
					h = a.config.thumbY + (c - d),
					g = (f - 1) * r - .5 * r + l,
					v = (f - 1) * r + .5 * r + l;
				c = s.pageY, a.config = e.extend(!0, this.config, {
					isExcute: !1,
					fullpageThumbMove: !1,
					endY: c
				}), u && (l >= h ? h = l : h >= m && (h = m), 0 > c - d && g >= h ? (a.pageUp(), t.style.top = h + "px") : c - d >= 0 && h >= v ? (a.pageDown(), t.style.top = h + "px") : (p = l + (f - 1) * r, a.doms.$el.find(".thumb").css({
					top: p + "px"
				}), a.config.thumbTop = p)), n.unbind("mousemove", a.Move), n.unbind("mouseup", a.Up), a.doms.$el.find(".thumb").unbind("mouseup", a.Up), a.doms.$el.find(".track").unbind("mouseup", a.Up)
			},
			processFn: function(e, t, i) {
				return function(a) {
					e.call(t, i, a)
				}
			},
			getPosition: function(e, t) {
				t = t || document.body;
				var i = e.offsetLeft,
					a = e.offsetTop;
				for (p = e.offsetParent;
				(p != t || p != document.body) && p;) window.navigator.userAgent.indexOf("MSIE 8.0") > -1 ? (i += p.offsetLeft, a += p.offsetTop) : (i += p.offsetLeft + p.clientLeft, a += p.offsetTop + p.clientTop), p = p.offsetParent;
				var n = {};
				return n.x = i, n.y = a, n
			},
			facePage: function() {
				var e = this,
					t = e.config.currPage,
					i = e.config.thumbH,
					a = e.config.thumbTop,
					n = e.doms.$el.find(".face_page"),
					s = e.doms.$el.find(".pagenum"),
					r = (i - s.height()) / 2;
				s.html(t + "/" + e.config.sumPage), n.css({
					display: "none"
				}), n.css({
					top: r + "px"
				}), n.stop().fadeIn(1500, function() {
					n.stop().fadeOut("fast", function() {
						n.css({
							display: "none"
						})
					})
				}), e.config.fullpageThumbMove === !0 && (a = o.defaultThumbTop + (t - 1) * i, e.doms.$el.find(".thumb").css({
					top: a + "px"
				}), e.config.thumbTop = a)
			},
			_addWheel: function(e, t) {
				function i(e) {
					var i = e || event,
						a = i.wheelDelta ? i.wheelDelta < 0 : i.detail > 0;
					return t(a), i.preventDefault && i.preventDefault(), !1
				}
				e.onmousewheel = null, e.onmousewheel = i, e.removeEventListener && e.removeEventListener("DOMMouseScroll", i, !1), e.addEventListener && e.addEventListener("DOMMouseScroll", i, !1)
			},
			processWheel: function(e) {
				this.config.fullpageThumbMove = !0, this[e ? "pageDown" : "pageUp"]()
			},
			moveSection: function() {
				var e = this,
					t = e.doms.$el.find(".face_container"),
					i = -(e.config.currPage - 1) * e.config.sectionH;
				t.stop().animate({
					top: i
				}, 300)
			},
			pageUp: function() {
				var e = this,
					t = e.config.currPage;
				t = 1 >= t ? 1 : t - 1, e.config.currPage = t, e.moveSection(), e.facePage()
			},
			pageDown: function() {
				var e = this,
					t = e.config.currPage,
					i = e.config.sumPage;
				t = t >= i ? i : t + 1, e.config.currPage = t, e.moveSection(), e.facePage()
			},
			toggle: function() {
				this.config && this[this.config.state === o.state.open ? "close" : "open"]()
			},
			initToggle: function() {
				this.config && this[this.config.state === o.state.close ? "close" : "open"]()
			},
			open: function() {
				this.config.state = o.state.open, this.doms.$el.show(), a.trigger("mod.chat.msg.color.hide")
			},
			close: function() {
				this.config.state = o.state.close, this.doms.$el.hide()
			},
			bindMouseWheelEvent: function() {
				var e = this;
				$faceContainer = this.doms.$el.find(".face_container"), e._addWheel($faceContainer[0], function(t) {
					e.processWheel(t)
				})
			},
			bindEvent: function() {
				var t = this,
					i = this.doms,
					n = i.$el,
					s = e("#container");
				n.on("click", ".face_container em", function(i) {
					i.preventDefault(), r.check() ? "chat" == e(this).attr("ftype") && (t.toggle(), a.trigger("mod.chat.msg.exp", e(this).attr("rel"))) : r.show(), a.trigger("dys", {
						key: "dys.room.face.click",
						code: e(this).attr("rel")
					})
				}), n.on("mouseover", ".face_container em", function(t) {
					e(this).addClass("hoverEm").siblings("em").removeClass("hoverEm")
				}).on("mouseout", ".face_container em", function(t) {
					e(this).removeClass("hoverEm")
				}), n.on("click", ".track", function(i) {
					var a = i || window.event,
						s = a.pageY,
						r = t.config.thumbTop,
						o = t.getPosition(n.get(0), e("#room_container").get(0)).y,
						l = r + o;
					t.config.fullpageThumbMove = !0, "thumb" != i.target.className && (l > s ? t.pageUp() : t.pageDown())
				}), s.on("click touchstart", ".face-box .up", function(e) {
					t.config.fullpageThumbMove = !0, t.pageUp()
				}), s.on("click touchstart", ".face-box .down", function(e) {
					t.config.fullpageThumbMove = !0, t.pageDown()
				}), s.delegate(".face-box .thumb", "mousedown", function(e) {
					t.down.call(t, this, e)
				}), i.$chatSpeak.find(".expression").on("click", ".e-btn", function(i) {
					var a = e(this);
					return t.initPage(!1), t.toggle(), a["open" === t.config.state ? "addClass" : "removeClass"]("active"), i.preventDefault(), i.stopPropagation(), !1
				}), a.on("mod.layout.change", function() {
					t.layout({
						row: 6,
						col: t.doms.$body.hasClass("layout-little") ? o.smallScreenCol : o.bigScreenCol,
						state: t.config.state
					})
				}), a.on("toggle", t.toggle), a.on("mod.chat.exp.hide", function() {
					t.close()
				})
			}
		});
	return {
		init: function(e) {
			new l(e)
		}
	}
}), define("douyu/page/room/normal/mod/chat-color", ["jquery", "shark/class", "shark/observer", "shark/util/storage/1.0", "shark/util/flash/data/1.0", "shark/util/storage/1.0", "shark/util/lang/1.0", "shark/util/template/2.0", "douyu/context", "douyu/com/user", "douyu/page/room/base/api"], function(e, t, i, a, n, s, r, o, l, c, d) {
	var u = e(".color-box"),
		f = (u.find(".c-con"), t({
			init: function(t) {
				var i = e("#js-color-barrage");
				e("#js-fans-barrage");
				this.config = e.extend(!0, {}, {
					anchorMedalSwitch: l.get("room.is_set_fans_badge"),
					fansSpecialUrl: "http://www.douyu.com/t/fans",
					defaultBarragePush: [{
						col: 2,
						ul: 0,
						ubl: 6
					}, {
						col: 3,
						ul: 0,
						ubl: 9
					}, {
						col: 6,
						ul: 0,
						ubl: 12
					}, {
						col: 4,
						ul: 0,
						ubl: 15
					}, {
						col: 5,
						ul: 0,
						ubl: 18
					}, {
						col: 1,
						ul: 0,
						ubl: 21
					}],
					fansBarrageSetData: null,
					fansBarrageSetFlag: "fansBarrageSetData",
					fansBarrageSetKey: l.get("room.room_id") + "_" + l.get("sys.uid"),
					nobleChatBarrage: !1,
					$el: i,
					chatColorType: 1,
					fishNotFocus: 0,
					usesharkfinBtn: e("#J_usesharkfin"),
					usedmcardBtn: e("#J_usedmcard"),
					isColor: !1,
					indexColor: 0,
					ticketroom: i.find(".data-ticketroom"),
					ticketTip: i.find(".color-box-tip").eq(0),
					leftNumTip: i.find('[data-selector="leftnum"]'),
					colorList: i.find(".color-list"),
					superMsgBtn: e("#js-super-msg"),
					pid: "",
					ifs: 0,
					sMsg: 0,
					dmCardNum: 0,
					sharkfinNum: 0,
					nobleInfo: {
						nl: 0
					}
				}, t), this.kplColor = {
					color: "",
					voteId: ""
				}, this.getColorStorage(), this.initNobleBarrage(), this.initFansBarrage().init()
			},
			getColorStorage: function() {
				var t, a, n = this,
					s = n.config,
					r = n.kplColor;
				i.on("mod.chat.msg.color.vote", function(i) {
					e.map(i, function(e, i) {
						e.select && 1 === +e.select && e.value && e.type && (t = +e.type, a = e.value, s.indexColor = t, r.color = a, r.voteId = t)
					})
				})
			},
			setDefaultColor: function(t) {
				var a, n, s = this,
					r = this.config,
					o = this.kplColor,
					l = o.voteId,
					c = o.color,
					d = r.$el;
				a = e("#js-chat-speak").find("#js-fans-barrage"), a.find(".fans-barrage-btn").removeClass("active"), a.find(".color-default").parent().addClass("selected").siblings().removeClass("selected"), n = a.find('[data-type="fans-barrage-btn"]'), c && 0 === +r.nl ? (n.eq(0).css("background-color", c), n.css("color", c)) : n.removeAttr("style"), d = r.$el, d.find('[data-type="cbt"]').html('<i class="c-icon"></i>').removeClass("c-btn-on").removeAttr("style"), d.find(".color-default").parent().addClass("selected").siblings().removeClass("selected"), r.ticketTip.show(), r.isColor = !1, r.indexColor = l ? l : 0, r.pid = "", r.ifs = 0, "fishColor" != t && s.fansBarrageSetConfig(), r.fishNotFocus ? i.trigger("mod.chat.msg.color.set", null) : r.fishNotFocus = 1, c && 0 === +r.nl && i.trigger("mod.chat.msg.color.set", c)
			},
			freeColor: function(t, i, a) {
				var n = this,
					s = n.config.colorList.find("li");
				n.config.eid = a, n.config.isTicketRoom = !0, i === !0 ? s.each(function(e, t) {
					n.updateColor(e, "1")
				}) : e(t).each(function(e, t) {
					n.updateColor(t.col, t.free)
				})
			},
			updateColor: function(e, t) {
				var i = '<span class="color-description">免费</span>',
					a = this.config.colorList.find("li").eq(e);
				a.find("span").remove(), "1" === t ? (a.append(i), a.find("[data-type]").data("type", "free")) : a.find("[data-type]").data("type", "cbli")
			},
			initNobleBarrage: function() {
				var t = ['<div class="noble--barrage-toggle">', '<i class="icon--barrage-toggle"></i>', '<div class="dy--tips status--hover-show hide">', '<div class="tips--trans-outer">', '<div class="tips--trans-inner">', "</div>", "</div>", '<div class="tips--main">', '<div class="tips--content">', "发贵族弹幕", "</div>", "</div>", "</div>", "</div>"].join(""),
					a = ['<div class="noble--error" style="display:none">', '<a class="noble-error--close" href="javascript:;">×</a>', '<div class="noble-error--tran-outer">', '<div class="noble-error--tran-inner">', "</div>", "</div>", '<div class="nobel-error--main">', '<i class="nobel-error--icon"></i>', '<div class="error-main--content">', '<h3 class="content--title">', "我的弹幕，跟你的不同", "</h3>", "<p>", "贵族弹幕-伯爵以上贵族专属特权", "</p>", '<a class="btn" href="javascript:;">', "开通贵族", "</a>", "</div>", "</div>", "</div>"].join(""),
					n = this,
					s = e(".noble--barrage-box");
				n.nobleBox || (s.append(t), n.nobleBox = s, n.nobleError = e(a), n.nobleBox.append(n.nobleError)), n.nobleBoxHover = s.find(".status--hover-show"), s.on("click", ".noble-error--close", function() {
					s.find(".noble--error").hide()
				}).on("click", ".noble--barrage-toggle", function() {
					var e, t, a;
					if (n.config.nobleInfo.load) {
						if (e = s.hasClass("status--nobel-disabled"), t = s.find(".icon--barrage-toggle"), a = t.hasClass("status--active"), 0 == n.config.nobleInfo.nl) return 0 !== n.config.nobleInfo.npl ? void n.showNobleBarrageError("续费贵族") : void n.showNobleBarrageError("开通贵族");
						if (1 != n.config.nobleInfo.ncp) return void n.showNobleBarrageError("升级贵族");
						n.toggleNobleBarrage(!a), n.setDefaultColor(), i.trigger("mod.room.chat.super.msg.switch", 0)
					}
				}).on("click", ".noble--error .btn", function() {
					s.find(".noble--error").hide();
					var e = {};
					e.level = 3, i.trigger("mod.normal.noble.buy", e)
				})
			},
			toggleNobleBarrage: function(t) {
				var a = this.nobleBox.find(".icon--barrage-toggle");
				if (t === !0 && 1 != this.config.sMsg) this.config.nl = 1, a.addClass("status--active"), this.nobleTips("贵族弹幕已启用"), this.kplColor.color && i.trigger("mod.chat.msg.color.set", null);
				else if (this.config.nl = 0, a.removeClass("status--active"), this.nobleTips("贵族弹幕已关闭"), this.kplColor.color) {
					var n = this.kplColor.color,
						s = e("#js-chat-speak").find("#js-fans-barrage");
					fansBarrageBtn = s.find('[data-type="fans-barrage-btn"]'), fansBarrageBtn.eq(0).css("background-color", n)
				}
			},
			nobleTips: function(e) {
				this.nobleBoxHover.find(".tips--content").text(e)
			},
			resetNobleBarrage: function(e) {
				var t = this.config.nobleInfo;
				if (t.load = !0, t.npl = e.npl || 0, e.nl > 0) {
					t.nl = e.nl;
					var i = $ROOM.nobleConfig[e.nl] || {};
					t.ncp = parseInt(i.noble_barrage, 10) || 0
				}
				1 == t.ncp ? (this.config.nobleChatBarrage = !0, this.nobleBox.removeClass("status--nobel-disabled"), this.nobleBox.find(".noble--error").hide(), this.nobleBoxHover.removeClass("hide"), this.toggleNobleBarrage(!0), this.setDefaultColor(), this.showGuide()) : 0 == e.nl ? (this.toggleNobleBarrage(!1), this.nobleBox.addClass("status--nobel-disabled"), this.nobleBoxHover.addClass("hide")) : (this.toggleNobleBarrage(!1), this.nobleBoxHover.addClass("hide"), this.nobleBox.removeClass("status--nobel-disabled"))
			},
			showNobleBarrageError: function(t) {
				var i = e("#js-chat-speak").offset().left,
					a = this.nobleBox.offset().left;
				this.nobleBox.find(".noble-error--tran-outer").css({
					marginLeft: 0,
					left: a - i + 3
				}), this.nobleError.show().find(".btn").text(t || "开通贵族")
			},
			showGuide: function() {
				var e = "noble-barrage-guide",
					t = s.get(e);
				if (1 != t) {
					var i = this;
					i.nobleBoxHover.show(), setTimeout(function() {
						s.set(e, 1), i.nobleBoxHover.removeAttr("style")
					}, 3e3)
				}
			},
			getFansBarrageSetData: function() {
				var e, t = this.config;
				return c.check() ? (e = s.get(t.fansBarrageSetFlag), t.fansBarrageSetData = e || {}) : t.fansBarrageSetData = {}, t.fansBarrageSetData
			},
			fansBarrageSetConfig: function(e) {
				var t = this.config,
					i = t.fansBarrageSetData;
				if (e) i[t.fansBarrageSetKey] = e;
				else {
					if (!i.hasOwnProperty(t.fansBarrageSetKey)) return;
					delete i[t.fansBarrageSetKey]
				}
				s.set(t.fansBarrageSetFlag, i, 2592e3)
			},
			initFansBarrage: function() {
				var t = this,
					a = this.config,
					l = this.kplColor,
					u = {
						fansTipTimer: ""
					},
					f = {
						init: function() {
							this.doms = {
								$fishBarrage: e("#js-color-barrage"),
								$chatWrapper: e("#js-chat-speak"),
								$nobleEnter: e("#js-chat-speak .noble--barrage-box")
							}, this.tempHtml = {
								fansBarrageList: this.fansBarrageListRender(),
								fansBarrageTip: this.fansBarrageTipRender()
							}, t.getFansBarrageSetData(), this.fansBarrageAppend(), this.observerBind()
						},
						fansBarrageAppend: function() {
							var e = this,
								t = this.doms,
								i = ['<div data-tag="fans-barrage-tip" style="position: relative"></div>'].join("");
							t.$nobleEnter && (t.$fansEnter = t.$chatWrapper.find("#js-fans-barrage"), t.$fansEnter.find(".fans-barrage-icon").attr("data-type", "fans-barrage-btn"), t.$fansEnter.append(i), t.$fansEnterTipWarp = t.$chatWrapper.find('[data-tag="fans-barrage-tip"]'), e.fansBarrageGuideTip(), e.bindEvent())
						},
						fansBarrageListRender: function(e) {
							var t, i;
							return t = r.string.join('<div class="fans-barrage-box hide" data-tag="fans-barrage-list" data-type="cbl">', '<div class="fans-barrage-title">', '<a class="fans-barrage-right fr" target="_blank" href="{{ fansSpecialUrl }}" data-tag="medal-introduce-enter"><em class="fans-barrage-last">了解粉丝特权</em></a>', "<p>粉丝专属弹幕</p>", "</div>", '<ul class="fans-barrage-list clearfix" data-tag="fans-barrage-ul">', '<li class="selected">', '<div data-tag="fans-color-list" class="colorwrap fanscolor-default color-default" data-type="free"><i></i></div>', '<span class="color-description">默认</span>', "</li>", "{{ each fansColorMap as item index }}", "{{ if item.ul }}", "<li>", '<div data-tag="fans-color-list" data-color-id="{{ item.col }}" class="colorwrap color0{{ item.col }}" data-type="free"><i></i></div>', "</li>", "{{ else }}", '<li class="fans-barrage-lock">', '<div data-tag="fans-color-list" data-color-id="{{ item.col }}" class="colorwrap color0{{ item.col }}" data-type="free"><i></i></div>', '<div class="fans-barrage-tips">', "<span>粉丝等级{{ item.ubl }}级免费使用</span>", '<span class="fans-barrage-arrow"></span>', "</div>", "</li>", "{{ /if }}", "{{ /each }}", "</ul>", '<div class="fans-barrage-colordes">', "{{ if fansColorStatus }}", '<p class="fans-barrage-des">粉丝等级达到<strong>15级</strong>，弹幕可在聊天区<strong>悬浮展示</strong>噢~</p>', "{{ else }}", '<p class="fans-barrage-des">成为主播的<strong>{{ fansColorMap[0].ubl }}级</strong>粉丝即可<strong>免费</strong>发送粉丝弹幕啦！</p>', "{{ /if }}", "</div>", '<span class="fans-barrage-arrow" data-tag="fans-barrage-arrow"></span>', '<span class="fans-barrage-arrow fans-barrage-arrow-out" data-tag="fans-barrage-arrow"></span>', "</div>"), i = o.compile(t)
						},
						fansBarrageTipRender: function() {
							var e, t;
							return e = r.string.join('{{ if type == "fansNotOpen" }}', '<div class="disfans-box clearfix" style="display: block;" data-tag="fansBarrageTip">', "<p>该主播未开通粉丝徽章，无法使用粉丝弹幕</p>", '<a class="fans-barrage-intro" target="_blank" href="{{ fansSpecialUrl }}">了解更多&rsaquo;&rsaquo;</a>', '<span class="fans-barrage-arrow" style="left: 50%; margin-left: -6px;"></span>', '<span class="fans-barrage-arrow fans-barrage-arrow-out" style="left: 50%; margin-left: -6px;"></span>', "</div>", "{{ /if }}", '{{ if type == "fansColorOnline" }}', '<div class="fans-barrage-tips " style="display: block;" data-tag="fansBarrageTip">', "<span>粉丝专属弹幕已上线噢~</span>", '<span class="fans-barrage-arrow" style="left: 50%; margin-left: -6px;"></span>', "</div>", "{{ /if }}"), t = o.compile(e)
						},
						fansBarrageTipAppend: function(e) {
							var t, i, n, s, r = this,
								o = this.doms,
								l = o.$chatWrapper.offset().left;
							e && (i = o.$fansEnter.find('[data-tag="fansBarrageTip"]'), clearTimeout(u.fansTipTimer), i.remove(), t = r.tempHtml.fansBarrageTip({
								type: e.type,
								fansSpecialUrl: a.fansSpecialUrl
							}), o.$fansEnterTipWarp.append(t), i = o.$fansEnter.find('[data-tag="fansBarrageTip"]'), n = i.find(".fans-barrage-arrow"), i.css({
								left: "50%",
								marginLeft: -i.outerWidth() / 2
							}), s = i.offset().left, 0 > s - l && (i.css({
								marginLeft: -i.outerWidth() / 2 + (l - s)
							}), n.css({
								marginLeft: -6 - (l - s)
							})), i.removeClass("hide"), u.fansTipTimer = setTimeout(function() {
								i.fadeOut(500, function() {
									i.remove()
								})
							}, 3e3))
						},
						fansBarrageGuideTip: function() {
							var e = this;
							s.get("fansBarrageGuide") || (e.fansBarrageTipAppend({
								type: "fansColorOnline"
							}), s.set("fansBarrageGuide", 1, 31536e3))
						},
						showFansBarrageTipInit: function() {
							var e, t, i = this.doms;
							i.$chatWrapper && i.$fansEnter && (e = i.$chatWrapper.offset().left, t = i.$fansEnter.offset().left, i.$fansEnter.find('[data-tag="fans-barrage-arrow"]').css({
								marginLeft: 0,
								left: t - e + 4
							}))
						},
						fansBarrageListAppend: function(t) {
							var i, n, s, r, o = this,
								d = this.doms,
								u = this.tempHtml;
							if (t) if (t && t.length > 0 ? s = t[0].ul ? 1 : 0 : (t = a.defaultBarragePush, s = 0), d.$fansBarrageList) o.fansBarrageListUpdate(t);
							else {
								if (i = u.fansBarrageList({
									fansColorStatus: s,
									fansColorMap: t,
									fansSpecialUrl: a.fansSpecialUrl
								}), d.$fansEnter.append(i), d.$fansBarrageList = d.$fansEnter.find('[data-tag="fans-barrage-list"]'), d.$fansBarrageUl = d.$fansEnter.find('[data-tag="fans-barrage-ul"]'), n = d.$fansBarrageUl.find("li"), n.eq(n.length - 1).addClass("last"), n.eq(n.length - 2).addClass("last-second"), o.showFansBarrageTipInit(), !a.fansBarrageSetData) return;
								r = a.fansBarrageSetData[a.fansBarrageSetKey], c.check() && r && !a.nobleChatBarrage && d.$chatWrapper.find('[data-tag="fans-color-list"][data-color-id="' + r.indexColor + '"]').trigger("click", "triggerClick"), l && l.color && e(".fans-barrage-list .fanscolor-default").eq(0).css("background-color", l.color)
							}
						},
						fansBarrageListUpdate: function(t) {
							var i = this.doms,
								a = 0;
							if (t && e.isArray(t) && i.$fansBarrageUl) {
								for (; a < t.length; a++) t[a].ul ? i.$fansBarrageUl.find("li").eq(a + 1).removeClass("fans-barrage-lock") : i.$fansBarrageUl.find("li").eq(a + 1).addClass("fans-barrage-lock");
								t[0].ul ? i.$fansEnter.find(".fans-barrage-des").html("粉丝等级达到<strong>15级</strong>，弹幕可在聊天区<strong>悬浮展示</strong>噢~") : i.$fansEnter.find(".fans-barrage-des").html("成为主播的<strong>6级</strong>粉丝即可<strong>免费</strong>发送粉丝弹幕啦！")
							}
						},
						bindEvent: function() {
							var n = this,
								s = this.doms;
							e("#container").on("click", function(r) {
								var o, l = e(r.target);
								if ("fans-barrage-btn" === l.data("type")) {
									if (!c.check()) return void c.show("login");
									if (a.chatColorType = 1, !a.anchorMedalSwitch) return void n.fansBarrageTipAppend({
										type: "fansNotOpen"
									});
									a.isColor ? t.setDefaultColor() : (o = s.$fansEnter.find('[data-type="cbl"]'), o && o.length || (n.fansBarrageListAppend([]), o = s.$fansEnter.find('[data-type="cbl"]')), o.toggleClass("hide"), o.hasClass("hide") || i.trigger("mod.chat.noble.barrage.hide"))
								} else l.parents("#js-fans-barrage").length || s.$fansEnter.find('[data-type="cbl"]').addClass("hide")
							}), s.$chatWrapper.on("click", '.fans-barrage-list [data-tag="fans-color-list"]', function(n, r) {
								var o = e(this),
									l = o.parent().index() - 1,
									c = o.css("backgroundColor"),
									d = e("#js-color-barrage").find('[data-type="cbt"]');
								return o.parent().hasClass("selected") ? void 0 : o.hasClass("color-default") ? void t.setDefaultColor() : void(0 > l || o.parent().hasClass("fans-barrage-lock") || (s.$fansEnter.find('[data-type="fans-barrage-btn"]').css("color", c).attr("data-status", "chat-color"), d.length && d.removeAttr("data-status"), a.isColor = !0, a.indexColor = o.data("color-id"), a.ifs = 1, a.pid = "", t.fansBarrageSetConfig({
									indexColor: a.indexColor
								}), i.trigger("mod.chat.noble.barrage.hide"), i.trigger("mod.room.chat.super.msg.switch", 0), i.trigger("mod.chat.msg.color.set", c, r), o.parent().addClass("selected").siblings().removeClass("selected"), s.$fansEnter.find(".fans-barrage-btn").css({
									backgroundColor: c
								})))
							})
						},
						observerBind: function() {
							var e = this;
							this.doms;
							d.reg("room_data_handler", function(t) {
								var i, s = n.decode(t).too(),
									r = [],
									o = [];
								if ("fdm" == s.type) {
									if (!s.list) return;
									r = n.isArray(s.list) ? n.decode(s.list) : [{
										value: s.list
									}];
									for (var l = 0; l < r.length; l++) i = r[l], i && i.value && (i = n.decode(i.value).too(), i.col = parseInt(i.col, 10), i.ul = parseInt(i.ul, 10), i.ubl = parseInt(i.ubl, 10), o[l] = i);
									a.defaultBarragePush = o, e.fansBarrageListAppend(o)
								}
								"adp" == s.type && (new Date).getTime() < 1e3 * s.cdt && (a.defaultBarragePush = [{
									col: 2,
									ul: 1,
									ubl: 6
								}, {
									col: 3,
									ul: 1,
									ubl: 9
								}, {
									col: 6,
									ul: 1,
									ubl: 12
								}, {
									col: 4,
									ul: 1,
									ubl: 15
								}, {
									col: 5,
									ul: 1,
									ubl: 18
								}, {
									col: 1,
									ul: 1,
									ubl: 21
								}], a.anchorMedalSwitch = 1, e.fansBarrageListAppend(a.defaultBarragePush))
							}), d.reg("room_data_handler", function(t) {
								var i = n.decode(t).too();
								"cdcp" == i.type && e.showFansBarrageTipInit()
							}), d.reg("room_data_ShieldDan", function(e) {
								var t;
								n.decode(e).too();
								i.trigger("mod.chat.blackList.set", e), t = i.fire("mod.chat.blackList.get", e), d.exe("js_myblacklist", t.list.join("|"))
							}), i.on("fans.medal.switch.set", function() {
								a.anchorMedalSwitch = 1
							}), i.on("fans.barrage.list.append", function() {
								e.fansBarrageListAppend([])
							})
						}
					};
				return f
			}
		}));
	i.on("mod.chat.msg.color.get", function() {
		return {
			color: colorBarrage.config.indexColor,
			pid: colorBarrage.config.pid,
			eid: colorBarrage.config.eid,
			nl: colorBarrage.config.nl,
			ifs: colorBarrage.config.ifs,
			sMsg: colorBarrage.config.sMsg
		}
	}), i.on("mod.chat.msg.color.hide", function() {
		colorBarrage.config.$el.find('[data-type="cbl"]').addClass("hide")
	}), i.on("mod.chat.msg.color.free", function(e) {
		colorBarrage.freeColor(e.corlorArr, e.freeAll, e.eid)
	}), i.on("mod.chat.noble.barrage.show", function() {
		colorBarrage.toggleNobleBarrage(!0)
	}), i.on("mod.chat.noble.barrage.hide", function() {
		colorBarrage.toggleNobleBarrage(!1)
	}), i.on("mod.room.chat.gift.noble.info", function(e) {
		colorBarrage.resetNobleBarrage(e)
	}), i.on("mod.room.chat.super.msg.switch", function(t) {
		var a, n = e("#js-chat-speak").find(".cs-textarea");
		t ? (colorBarrage.setDefaultColor(), i.trigger("mod.chat.noble.barrage.hide"), colorBarrage.config.sMsg = 1, a = "守护天神专属巨大弹幕，快来试试吧！", colorBarrage.config.superMsgBtn && colorBarrage.config.superMsgBtn.find('[data-type="super-msg-btn"]').addClass("cur")) : (colorBarrage.config.sMsg = 0, a = "守护天神专属巨大弹幕，快来试试吧！", colorBarrage.config.superMsgBtn && colorBarrage.config.superMsgBtn.find('[data-type="super-msg-btn"]').removeClass("cur"), a = "试着输入“#关注”吧，可以关注主播噢"), n && n.attr("placeholder", a)
	});
	var p = {
		init: function() {
			e("#container").append("<div class='summer_enter'><img class='summer_bg' src='" + $SYS.web_url + "app/douyu/res/page/room-normal/activity_summer/summer_header.gif' /><div class='summer_header_close'></div></div>"), e(window).width() < 1900 && e(".summer_enter .summer_bg").css({
				width: "100%",
				left: 0,
				"margin-left": 0
			}), e("#header").css({
				top: "60px"
			}), e("#mainbody").css({
				"margin-top": "110px"
			}), e("#left").css({
				top: "111px"
			}), e(".summer_enter").on("click", function() {
				window.open("/actives/summer")
			}), e(".summer_enter .summer_header_close").on("click", function(t) {
				t.stopPropagation(), e(".summer_enter").hide(), e("#header").css({
					top: "0"
				}), e("#mainbody").css({
					"margin-top": "50px"
				}), e("#left").css({
					top: "51px"
				}), localStorage.setItem("summer_close_count", 1)
			}), !localStorage.getItem("summer_close_count") && c.check() ? e(".summer_enter").show() : (e(".summer_enter").hide(), e("#header").css({
				top: "0"
			}), e("#mainbody").css({
				"margin-top": "50px"
			}), e("#left").css({
				top: "51px"
			}))
		}
	};
	return {
		init: function(e) {
			colorBarrage = new f(e), p.init()
		},
		val: function() {
			return colorBarrage.config.indexColor
		}
	}
}), define("douyu/page/room/normal/mod/chat-shield", ["jquery", "shark/observer", "shark/class", "douyu/com/fps", "shark/util/flash/data/1.0", "douyu/page/room/base/api", "shark/util/storage/1.0", "douyu/page/room/normal/mod/chat-msg-tmp", "douyu-liveH5/live/js/player"], function(e, t, i, a, n, s, r, o, l) {
	var c = {
		checkedMap: {
			allGift: !1,
			message: !1,
			videoBroadcast: !1,
			smallgift: !1,
			isGetFpsMsg: !1,
			tipsFlag: !1,
			isActiveStatus: !0
		},
		checkedNum: 0,
		className: {
			liActive: "shie-checked",
			wrapActive: "shie-switch-open"
		},
		flag: !0,
		maxStatus: 4,
		storageName: "chat-shield-config",
		fpsMonitorSwitch: 1,
		fpsLoopTimer: null
	},
		d = i({
			fpsStart: function() {
				a.start(), this.loopMonitorFPS()
			},
			loopMonitorFPS: function() {
				var e, t = this,
					i = function() {
						return l.useH5 ? c.fpsMonitorSwitch ? c.checkedMap.smallgift ? !1 : (e = a.getFPS(), void(15 > e && t.showLowFpsTips())) : (clearInterval(c.fpsLoopTimer), !1) : !1
					};
				setInterval(i, 500)
			},
			init: function(i) {
				var a = this;
				a.config = e.extend(!0, {}, {
					target: "#js-shie-gift"
				}, i), t.on("mod.center.userrole.ready", function(e) {
					a.config.isCurrentAnchor = e.isAnchor()
				}), a.getDoms(), a.fpsStart(), a.bindEvent()
			},
			getDoms: function() {
				var t = this,
					i = e("#js-shie-gift");
				t.doms = {
					shieGiftWrap: i,
					shieSwitch: e("#shie-switch"),
					allShieType: i.find("[data-shield-type]"),
					allGift: i.find('[data-shield-type="allGift"]'),
					videoBroadcast: i.find('[data-shield-type="videoBroadcast"]'),
					shieTip: i.find('[data-shield-tip="tip"]')
				}
			},
			getShieldArr: function(t) {
				var i = this,
					a = {},
					n = "";
				e(i.config.target).find("[data-shield-type]").each(function(t) {
					parseInt(e(this).attr("data-shield-status"), 10) ? a[e(this).attr("data-shield-type")] = 1 : a[e(this).attr("data-shield-type")] = 0
				}), n = JSON.stringify(a), i.videoBroadcast(), i.GiftEffect(), t || s.exe("js_shieldEffects", n), r.set(c.storageName, n)
			},
			initShieType: function() {
				var t = r.get(c.storageName) || "",
					i = this;
				if (t) try {
					var a = JSON.parse(t);
					e.each(a, function(e, t) {
						i.singalCheacd(e, t)
					}), i.getShieldArr()
				} catch (n) {}
			},
			GiftEffect: function() {
				var e = parseInt(this.doms.allGift.attr("data-shield-status"), 10);
				s.exe("js_shieGiftEffect", e ? 1 : 0)
			},
			videoBroadcast: function() {
				var e = parseInt(this.doms.videoBroadcast.attr("data-shield-status"), 10);
				s.exe("js_effectVisible", e ? 1 : 0)
			},
			bindEvent: function() {
				var t = this,
					i = t.doms;
				i.shieSwitch.on("click.shieldGift", function() {
					var e = "",
						i = 0;
					c.flag ? (c.checkedNum = c.maxStatus, e = "屏蔽", i = 1) : (c.checkedNum = 0, e = "开启", i = 0), t.dpFunction(c.flag, t.dpAllTypeHandle(c.flag)), t.checkedNumStyle(t.config.isCurrentAnchor), o.sysMsgTips({
						msg: "已" + e + "全部特效"
					}), t.getShieldArr(), s.exe("js_data_server_shield", "type@=dmfbdreq/" + t.getShieldStatusSTT("all", i))
				}), i.allShieType.on("click.shieldType", function(i, a) {
					var n = e(this),
						r = 0;
					n.toggleClass(c.className.liActive), t.changeStatus(n, n.index() - 1), t.getShieldArr(), r = n.hasClass(c.className.liActive) ? 1 : 0;
					var l = "",
						d = "";
					l = 1 == r ? "屏蔽" : "开启", 1 == n.index() ? d = "全部礼物信息" : 2 == n.index() ? d = "信息通知弹幕" : 3 == n.index() ? d = "视频区礼物广播" : 4 == n.index() && (d = "小礼物和领取弹幕"), o.sysMsgTips({
						msg: "已" + l + d
					}), s.exe("js_data_server_shield", "type@=dmfbdreq/" + t.getShieldStatusSTT(n.attr("data-shield-type"), r))
				}), s.reg("room_data_shield_effects", function(i) {
					var a, n = JSON.parse(i),
						r = {};
					if (e.isPlainObject(n)) {
						for (a in n) t.singalCheacd(a, n[a]) && (r[a] = parseInt(n[a], 10) || 0);
						s.exe("js_shieldEffects", i), t.getShieldArr(1), s.exe("js_data_server_shield", "type@=dmfbdreq/" + t.getShieldStatusSTT(r))
					}
				}), s.reg("room_bus_shild", function() {
					l.useH5 || s.exe("js_data_isAction", c.checkedMap.isActiveStatus), t.initShieType()
				}), s.reg("room_data_FPS", function(e) {
					parseInt(e, 10) < 15 && t.showLowFpsTips()
				}), s.reg("room_data_handler", function(i) {
					var a = n.decode(i).too(),
						s = {},
						r = {};
					"dmfbdres" === a.type && (n.isArray(a.dfl) ? (s = n.decode(a.dfl), e.each(s, function(e) {
						var t = n.decode(this.value).too();
						r[t.sn] = t.ss
					})) : (s = n.decode(a.dfl).too(), r[s.sn] = s.ss), t.setShieldView(r))
				}), t.getActiveStatus()
			},
			getShieldStatusSTT: function(t, i) {
				var a = [],
					s = {
						smallgift: 105,
						allGift: 106,
						message: 107,
						videoBroadcast: 108
					},
					r = "";
				return "object" == typeof t ? e.each(t, function(e) {
					a.push("sn@A=" + s[e] + "@Sss@A=" + (t[e] || 0))
				}) : "all" === t ? e.each(s, function(e) {
					a.push("sn@A=" + s[e] + "@Sss@A=" + i)
				}) : t && a.push("sn@A=" + s[t] + "@Sss@A=" + i), a.length && (r = n.encode([{
					name: "dfl",
					value: a.join("/")
				}])), r
			},
			setShieldView: function(t) {
				var i = {
					smallgift: 105,
					allGift: 106,
					message: 107,
					videoBroadcast: 108
				},
					a = {};
				e.each(i, function(e) {
					a[e] = "" + t[this] == "1" ? 1 : 0
				}), r.set(c.storageName, JSON.stringify(a)), this.initShieType()
			},
			getActiveStatus: function() {
				e(window).on({
					"blur.fps": function() {
						c.checkedMap.isActiveStatus = !1, l.useH5 || s.exe("js_data_isAction", c.checkedMap.isActiveStatus)
					},
					"focus.fps": function() {
						c.checkedMap.isActiveStatus = !0, l.useH5 || s.exe("js_data_isAction", c.checkedMap.isActiveStatus)
					}
				})
			},
			showLowFpsTips: function() {
				var t = e(".shie-gift"),
					i = t.find(".shie-tips-label"),
					a = t.find('[data-shield-type="smallgift"]'),
					n = t.find('[data-shie="tips"]'),
					o = t.find('[data-shie="cls"]'),
					d = null,
					u = this,
					f = (new Date).setSeconds((new Date).getSeconds() + 43200),
					p = (new Date).getTime(),
					m = null,
					h = e("#js-chat-cont .giftbatter-box").children();
				m = setTimeout(function() {
					1 !== parseInt(a.attr("data-shield-status"), 10) && !c.checkedMap.isGetFpsMsg && c.checkedMap.isActiveStatus && h.length > 0 && (c.checkedMap.isGetFpsMsg = !0, a.click(), l.useH5 || s.exe("js_data_FPSBack"), d = setTimeout(function() {
						c.checkedMap.tipsFlag = !0, clearTimeout(d)
					}, 5e3), r.get("shiePropTips") || (r.get("halfDayShow") ? 1 === parseInt(r.get("halfDayShow").split("|")[0], 10) && (r.set("halfDayShow", "2|" + !1, parseInt((r.get("halfDayShow").split("|")[1] - p) / 1e3, 10)), n.show()) : (r.set("halfDayShow", "1|" + f, 43200), n.show()))), clearTimeout(m)
				}, 200), r.get("shiePropTips") || (o.on("click.tipsCls", function() {
					r.set("halfDayShow", "2|" + !1, parseInt((r.get("halfDayShow").split("|")[1] - p) / 1e3, 10)), n.hide(), u.getTipsStatus()
				}), e("#container").on("click.tipsCls", function(t) {
					var i = e(t.target);
					i.parents(".shie-tips").length || c.checkedMap.tipsFlag && (n.hide(), u.getTipsStatus())
				}), i.on("click", function() {
					var t = e(".shie-gift").find('[data-input="tips"]'),
						i = new Date,
						a = 604800 - (3600 * i.getHours() + 60 * i.getMinutes() + i.getSeconds());
					t.is(":checked") ? r.set("shiePropTips", !0, a) : r.set("shiePropTips", !1)
				}))
			},
			getTipsStatus: function() {
				var t = e(".shie-gift").find('[data-input="tips"]'),
					i = new Date,
					a = 604800 - (3600 * i.getHours() + 60 * i.getMinutes() + i.getSeconds());
				t.is(":checked") && r.set("shiePropTips", !0, a)
			},
			changeStatus: function(t) {
				var i = this,
					a = e(t);
				a.hasClass(c.className.liActive) ? i.singalCheacd(a.attr("data-shield-type"), 1) : i.singalCheacd(a.attr("data-shield-type"), 0)
			},
			checkedNumStyle: function(e) {
				var t = this,
					i = t.doms;
				c.checkedNum <= 0 ? t.allRemoveStyle() : c.checkedNum >= c.maxStatus ? t.allAddStyle(e) : (i.shieGiftWrap.addClass(c.className.wrapActive), t.addActive(i.shieSwitch))
			},
			allAddStyle: function(e) {
				var t = this,
					i = t.doms;
				c.flag = !1, i.shieGiftWrap.addClass(c.className.wrapActive), t.addActive(i.shieSwitch), t.addActive(i.allShieType), e && (t.removeActive(i.allGift), i.shieSwitch.removeClass(c.className.liActive), i.shieSwitch.addClass("shie-checked-notall"), c.checkedNum--), t.extremeStatus(1, e)
			},
			allRemoveStyle: function() {
				var e = this,
					t = e.doms;
				c.flag = !0, t.shieGiftWrap.removeClass(c.className.wrapActive), t.shieSwitch.removeClass(c.className.liActive), t.shieSwitch.removeClass("shie-checked-notall"), e.removeActive(t.shieSwitch), e.removeActive(t.allShieType), e.extremeStatus(0)
			},
			singalCheacd: function(e, t) {
				var i = this,
					a = i.doms,
					n = a.shieGiftWrap.find('[data-shield-type="' + e + '"]'),
					s = parseInt(n.attr("data-shield-status"), 10),
					r = i.dpType(e),
					o = 0;
				return c.flag = !1, parseInt(t, 10) ? s || (c.checkedNum++, a.shieGiftWrap.addClass(c.className.wrapActive), c.checkedNum > 0 && c.checkedNum < 4 ? a.shieSwitch.addClass("shie-checked-notall") : 4 === c.checkedNum && i.addActive(a.shieSwitch), i.addActive(n), i.dpFunction(1, r), o = 1) : (s && (c.checkedNum--, i.removeActive(n), i.dpFunction(0, r), o = 1), c.checkedNum > 0 && c.checkedNum < 4 ? (a.shieSwitch.addClass("shie-checked-notall"), a.shieSwitch.removeClass(c.className.liActive)) : 0 === c.checkedNum && (c.flag = !0, i.allRemoveStyle())), c.checkedMap[n.attr("data-shield-type")] = parseInt(n.attr("data-shield-status"), 10), o
			},
			extremeStatus: function(e, t) {
				var i = 0;
				e && (i = 1);
				for (var a in c.checkedMap) c.checkedMap[a] = i;
				t && (c.checkedMap.allGift = 0)
			},
			addActive: function(t) {
				var i = e(t);
				i.attr("data-shield-status", 1).addClass(c.className.liActive)
			},
			removeActive: function(t) {
				var i = e(t);
				i.attr("data-shield-status", 0).removeClass(c.className.liActive)
			},
			dpAllTypeHandle: function(t) {
				var i = this,
					a = i.doms.allShieType,
					n = [];
				return a.each(function(a, s) {
					var r = parseInt(e(s).attr("data-shield-status"), 10);
					t != r && n.push(i.dpType(e(s).attr("data-shield-type")))
				}), n.join(",")
			},
			dpFunction: function(e, i) {
				e ? t.trigger("dys", {
					key: "dys.room.gift..shield_gift_select",
					shield_sel: i
				}) : t.trigger("dys", {
					key: "dys.room.gift..shield_gift_cancel",
					shield_can: i
				})
			},
			dpType: function(e) {
				var t;
				switch (!0) {
				case "allGift" === e:
					t = 1;
					break;
				case "message" === e:
					t = 2;
					break;
				case "videoBroadcast" === e:
					t = 3;
					break;
				case "smallgift" === e:
					t = 4
				}
				return t
			}
		});
	return t.on("mod.chat.msg.shield", function() {
		return c.checkedMap
	}), {
		init: function(e) {
			return new d(e)
		},
		val: function() {
			return c.checkedMap
		}
	}
}), define("douyu/page/room/normal/mod/chat-msg", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/flash/data/1.0", "shark/util/storage/1.0", "shark/util/template/1.0", "douyu/context", "douyu/com/user", "douyu/com/vcode-user", "douyu/com/msgq", "douyu/com/exjsonp", "douyu/page/room/base/api", "douyu/page/room/normal/mod/chat-msg-tmp", "douyu/page/room/normal/mod/check-verify", "douyu/com/vcode-v3", "douyu/page/room/normal/mod/account-security", "douyu/page/room/normal/mod/closure-confirm"], function(e, t, i, a, n, s, r, o, l, c, d, u, f, p, m, h, g) {
	var v = !1,
		y = window.location.href,
		b = y.indexOf("&dydg") > -1 || y.indexOf("?dydg") > -1,
		k = {
			limitConfig: {
				low: 30,
				vistor: 200,
				normal: 200,
				anchor: 1e3,
				roomAdmin: 1e3,
				superAdmin: 1e3
			},
			defaultLenConf: {
				low: 30,
				vistor: 200,
				normal: 200,
				anchor: 1e3,
				roomAdmin: 1e3,
				superAdmin: 1e3
			},
			bufferLenConf: {
				low: 5,
				vistor: 100,
				normal: 100,
				anchor: 200,
				roomAdmin: 200,
				superAdmin: 200
			},
			comboConfig: r.get("room.comboConfig") || {},
			nobleBarrageSuspendTime: 3e3,
			nobleBarrageSuspendTimer: 0,
			msgBarrageQueue: [],
			msgBarrageScroll: 0,
			avatarDomain: r.get("sys.avatar_url"),
			defaultAvatar: i.string.format("{0}/app/douyu/res/com/defaultAvatar.png?20161229", r.get("sys.web_url")),
			V3Instance: null
		},
		w = {},
		_ = {},
		x = {},
		C = {},
		T = window.$COLLIGATE ? window.$COLLIGATE.NobleSuspend || 0 : 0;
	_.checkBrowser = function() {
		(window.navigator.userAgent.indexOf("MSIE 8") > -1 || window.navigator.userAgent.indexOf("MSIE 9") > -1) && (v = !0)
	}, _.init = function() {
		_.checkBrowser(), _.$chatCont = e("#js-chat-cont"), _.$chatContWrap = _.$chatCont.find('[data-type="chat-cont"]'), _.$chatList = _.$chatContWrap.find('ul[data-type="chat-list"]'), _.$roll = _.$chatCont.find('[data-type="roll"]'), _.chatCls = _.$chatCont.find(".chat-cls"), _.$chatSpeak = e("#js-chat-speak"), _.initMoreMessage(), _.initNobleBarrage(), p.init(), v && _.listenBarrageScroll()
	}, _.listenBarrageScroll = function() {
		i.interval(function() {
			w.scrollToBottom(), w.listenNobleBarrage()
		}, 1e3, !0)
	}, _.initNobleBarrage = function() {
		if (1 === T) {
			var t = _.$chatContWrap.length ? _.$chatContWrap[0].clientWidth : "";
			_.nobleLayerWrap = e('<div class="noble-barrage-suspend"><ul class="c-list"></ul></div>'), _.nobleLayerWrap.append(_.chatCls), _.nobleLayerWrap.css({
				width: t
			}), _.nobleBarrageLayer = _.nobleLayerWrap.find(".c-list"), _.chatCls.css("top", "auto"), _.$chatCont.prepend(_.nobleLayerWrap)
		}
		var i = r.get("sys.webconfUrl") + "/resource/noble/global/web.json";
		d.load(i, "nobleGlobalConfig", function(e) {
			e.barrage_bgcolor && _.changeNobleBarrageStyle({
				color: e.barrage_bgcolor
			})
		})
	}, _.changeNobleBarrageStyle = function(t) {
		var i = e("#nobleBarrageStyle"),
			a = "<style>.chat-cont li.noble-chart{background-color:" + t.color + "}</style>";
		0 === i.length && (e('<div id="nobleBarrageStyle"></div>').appendTo("body"), i = e("#nobleBarrageStyle")), i.html(a)
	}, _.initMoreMessage = function() {
		var t = e(['<div class="chat-more-message">', '<div class="chat-more-message-bg"></div>', '<span class="js-chat-more-message chat-more-message-txt">有0条新消息</span>', '<span class="chat-more-message-downarrow"></span>', "</div>"].join(""));
		_.$moreMessageWrap = t, _.$moreMessage = t.find(".js-chat-more-message"), _.$chatContWrap.after(t), t.on("click", function() {
			w.release()
		})
	}, x.init = function() {
		_.$chatCont.on("click", "span.js-distribute-barrage", function() {
			var i = e(this).data(),
				a = +i.jump_type;
			if (4 !== a) {
				var n = i.reverse ? "dys.room.normal.click.athena.reverse" : "dys.room.normal.click.athena.supermsg",
					s = e.extend({
						key: n,
						ctid: $ROOM.cate_id
					}, i);
				t.trigger("dys", s), e.get("/lapi/athena/room/catch", {
					t: (new Date).getTime(),
					bizid: i.bid,
					bthid: i.booth_id,
					conId: i.con_id,
					roomId: r.get("room.room_id") || 0
				}), window.open(i.jurl)
			}
		}).on("click", "span.js-normal-barrage", function() {
			var t, i = e(this),
				n = r.get("room.room_id"),
				s = r.get("sys.uid"),
				o = i.data("trid"),
				l = i.data("sdid"),
				c = i.data("type"),
				d = i.data("url"),
				f = i.html();
			n != o && (0 === c ? window.open(d) : (t = [{
				name: "sdid",
				value: l
			}, {
				name: "trid",
				value: o
			}, {
				name: "content",
				value: f
			}, {
				name: "rid",
				value: n
			}, {
				name: "uid",
				value: s
			}], u.exe("js_superDanmuClick", a.encode(t)), window.open("/special/jump/" + o)))
		}).on("click", '[data-buy="defensemute"]', function() {
			t.trigger("mod.normal.noble.buy"), t.trigger("dys", {
				key: "dys.noble.buy.defensemute"
			})
		}).on({
			"click.fans": function(i) {
				i.stopPropagation(), t.trigger("dys", {
					key: "dys.click.msg.fans.medal",
					bdg_id: e(this).data("fans")
				})
			},
			"mouseenter.fans": function(t) {
				var i = e(this);
				return n.get("fans_" + i.data("fans")) ? void i.attr({
					title: n.get("fans_" + i.data("fans"))
				}) : void e.ajax({
					url: "/fansbadge/fansbadge/getAnchorInfo",
					type: "GET",
					dataType: "json",
					data: {
						rid: i.data("fans") || 0,
						auth: i.data("hc") || ""
					},
					error: function() {
						e.dialog.tips_black("网络错误")
					},
					success: function(t) {
						var a;
						0 === parseInt(t.result, 10) ? (a = t.is_live ? "(正在直播)" : "(不在直播)", i.attr({
							title: t.nn + a || ""
						}), n.set("fans_" + i.data("fans"), t.nn + a, 10)) : e.dialog.tips_black(t.msg || "")
					}
				})
			}
		}, '[data-msg="fans"]'), t.on("mod.chat.msg.setroll.chat", function(e) {
			2 == e ? k.limitMaxl = k.defaultMaxl : k.limitMaxl = k.defaultMaxl + k.limitMaxBufferl
		}), _.$chatContWrap.on("scroll", function(e) {
			w.whatchMore()
		})
	}, w.init = function() {
		var e = function(e) {
				var t = 1;
				return e >= 1 && 5 >= e ? t = 1 : e >= 6 && 25 >= e ? t = 2 : e >= 26 && 100 >= e ? t = 4 : e >= 101 && 200 >= e ? t = 8 : e >= 201 && 400 >= e ? t = 16 : e >= 401 && 600 >= e ? t = 32 : e >= 601 && (t = 64), navigator.appVersion.indexOf("MSIE") > 0 && (t += 2), t
			};
		w.bufferLength = 0, w.Queue = c.create({
			hotplan: e,
			render: function(e) {
				w.addView(e.join(""), e.length)
			}
		}), t.on("rank.message.change.allClosed", function(e) {
			w.rankAllClosed = e
		}), t.on("mod.center.userrole.ready", function(e) {
			return v ? (k.limitMaxl = k.limitConfig.low, k.defaultMaxl = k.defaultLenConf.low, void(k.limitMaxBufferl = k.bufferLenConf.low)) : void(e.isVistor() ? (k.limitMaxl = k.limitConfig.vistor, k.defaultMaxl = k.defaultLenConf.vistor, k.limitMaxBufferl = k.bufferLenConf.vistor) : e.isSuperAdmin() ? (k.limitMaxl = k.limitConfig.superAdmin, k.defaultMaxl = k.defaultLenConf.superAdmin, k.limitMaxBufferl = k.bufferLenConf.superAdmin) : e.isRoomAdmin() ? (k.limitMaxl = k.limitConfig.roomAdmin, k.defaultMaxl = k.defaultLenConf.roomAdmin, k.limitMaxBufferl = k.bufferLenConf.roomAdmin) : e.isAnchor() ? (k.limitMaxl = k.limitConfig.anchor, k.defaultMaxl = k.defaultLenConf.anchor, k.limitMaxBufferl = k.bufferLenConf.anchor) : (k.limitMaxl = k.limitConfig.normal, k.defaultMaxl = k.defaultLenConf.normal, k.limitMaxBufferl = k.bufferLenConf.normal))
		}), t.on("mod.chat.msg.msg", function(e, t) {
			void 0 !== e && "" !== e && w.addQueue(e, t)
		}), t.on("mod.chat.msg.clear.chat", function() {
			w.clearChat()
		}), t.on("mod.chat.locker.release", function() {
			w.release()
		})
	}, w.whatchMore = function() {
		var e = _.$chatContWrap[0],
			t = e.scrollHeight,
			i = e.scrollTop;
		parseInt(t - _.$chatContWrap.height() - i, 10) <= 0 ? (w.release(), _.$moreMessageWrap.hide()) : (_.$roll.addClass("c-scr"), _.$chatCont.find('[data-type="roll"]').find("span").text("解锁"), k.limitMaxl = k.defaultMaxl + k.limitMaxBufferl, w.bufferLength > 0 && _.$moreMessageWrap.show())
	}, w.listenNobleBarrage = function() {
		if (0 !== T) {
			var t = _.$chatCont.find(".js-noble-barrage-tag"),
				i = _.$chatCont.offset().top;
			e(t).each(function(t, a) {
				var n = e(a).offset().top;
				return i > n ? void w.addNobleBarrageLayer(a) : !1
			})
		}
	}, w.addNobleBarrageLayer = function(t) {
		var i, a = e(".noble-barrage-suspend");
		clearTimeout(k.nobleBarrageSuspendTimer), e(t).removeClass("js-noble-barrage-tag"), i = e(t)[0].outerHTML, _.nobleBarrageLayer.empty().show().append(i), a.find(".c-list .js-fans-chart span[chatid]").css("color", "#3c3c3c"), a.find(".c-list .js-fans-chart").addClass("fans-chart"), _.nobleLayerWrap.stop(!0).animate({
			top: 0
		}, 300, function() {
			k.nobleBarrageSuspendTimer = setTimeout(function() {
				var i = e(t).outerHeight(!0);
				_.nobleLayerWrap.animate({
					top: "-=" + i
				}, 300, function() {
					_.nobleBarrageLayer.hide().html(""), _.nobleLayerWrap.css({
						top: 0
					})
				})
			}, k.nobleBarrageSuspendTime)
		})
	}, w.addQueue = function(t, i) {
		if (e(t).find(".nick").attr("rel") === $SYS.uid) w.addView(t, 1, !0);
		else {
			if (b && console.info("当前200ms内的缓存数量为：", w.Queue.CACHE.length), w.Queue.CACHE.length > 150 && i && ("chatres" === i.type || "chatmsg" === i.type)) {
				var a = parseInt(2 * Math.random(), 10);
				if (a) return void(b && console.info("已抛弃弹幕：", i.sttCode))
			}
			w.Queue.push(t)
		}
	}, w.addView = function(e, t, i) {
		var a = "99+";
		_.$chatList.append(e), w.limit(), _.$roll.hasClass("c-scr") ? (w.bufferLength += t || 1, a = w.bufferLength <= 99 ? w.bufferLength : a, _.$moreMessage.text("有" + a + "条新消息"), _.$moreMessageWrap.show(), (w.bufferLength >= k.limitMaxBufferl || i) && (w.release(), w.listenNobleBarrage())) : (w.release(), w.listenNobleBarrage())
	}, w.clearChat = function() {
		_.$chatList.html(""), f.sysMsgTips({
			msg: "已清空所有弹幕内容"
		}), w.release()
	}, w.release = function() {
		k.limitMaxl = k.defaultMaxl, w.bufferLength = 0, _.$moreMessage.text("有0条新消息"), _.$moreMessageWrap.hide(), _.$roll.removeClass("c-scr"), _.$chatCont.find('[data-type="roll"]').find("span").text("锁定"), w.scrollToBottom()
	}, w.limit = function() {
		var e = _.$chatList.children(),
			t = e.length - k.limitMaxl;
		t > 0 && (e.slice(0, t).remove(), w.release())
	}, w.scrollToBottom = function() {
		if (!_.$roll.hasClass("c-scr")) {
			var e = _.$chatContWrap.prop("scrollHeight");
			_.$chatContWrap.scrollTop(e)
		}
	}, w.sendVerify = function(t) {
		p.checkPhone({
			isDanmu: 1,
			success: function() {
				e.isFunction(t) && t()
			}
		})
	}, w.muteNoSession = {
		tpl: function() {
			var e = ['<div class="super-global-mute-wrap" id="super-global-mute-wrap">', '<div class="super-global-mute-close js-close">×</div>', '<span class="super-global-mute-icon"></span>', '<div class="super-global-mute-header">请通过安全校验</div>', '<div class="super-global-mute-area"></div>', '<div class="super-global-mute-captcha js-captcha js-captcha-error"></div>', "</div>"].join("");
			return e
		},
		show: function(t) {
			var i = this;
			i.dstUid = t, e("#super-global-mute-wrap").length || (e("body").append(i.tpl()), i.v3Init(), i.bindEvt())
		},
		hide: function() {
			e("#super-global-mute-wrap").length && e("#super-global-mute-wrap").remove()
		},
		v3Init: function() {
			if (!k.V3Instance) {
				var t = this,
					i = e("#super-global-mute-wrap").find(".js-captcha");
				k.V3Instance = m.init(i, {
					op_type: 30,
					idpre: "super-global-mute",
					success: t.muteAjax ||
					function() {},
					error: t.v3Error ||
					function() {}
				}, {
					area: ".super-global-mute-area"
				})
			}
		},
		refresh: function() {
			k.V3Instance && k.V3Instance.refresh()
		},
		getResult: function() {
			var e = {};
			return k.V3Instance && (e = k.V3Instance.getFastResult()), e
		},
		v3Error: function() {
			e("#super-global-mute-wrap").find("js-captcha-error").text("验证码加载失败，请稍后重试。")
		},
		muteAjax: function() {
			var t = w.muteNoSession,
				i = e.extend(!0, {
					dst_uid: t.dstUid || "",
					room_id: r.get("room.room_id")
				}, t.getResult());
			e.ajax({
				url: "/member/forwardmute/index",
				type: "post",
				data: i,
				dataType: "json",
				success: function(i) {
					0 === +i.code ? (t.hide(), k.V3Instance = null) : (i.msg && e.dialog.tips_black(i.msg), t.refresh())
				},
				error: function() {
					e.dialog.tips_black("请求失败")
				}
			})
		},
		bindEvt: function() {
			var t = this;
			e("#super-global-mute-wrap").on("click", ".js-close", function() {
				t.hide(), k.V3Instance = null
			})
		}
	};
	var S = function(i, n) {
			var s = t.fire("mod.center.userrole.get"),
				o = {
					len: 200
				},
				l = {};
			"full" === t.fire("mod.video.state.get") ? 2 : 1;
			if ("chatres" === i.type || "chatmsg" === i.type) {
				var c = "";
				switch (isNaN(i.egtt) && (i.egtt = 0), parseInt(i.egtt, 10)) {
				case 1:
					c = "6鱼翅礼物666连击即可获得";
					break;
				case 2:
					c = "66鱼翅礼物666连击即可获得";
					break;
				case 4:
					c = "666鱼翅礼物666连击即可获得";
					break;
				default:
					c = ""
				}
				l = e.extend(!0, {}, {
					isSender: parseInt(i.uid, 10) === parseInt(r.get("sys.uid"), 10),
					sttCode: n,
					type: i.type,
					uid: i.uid,
					nn: i.nn,
					txt: i.txt,
					cid: i.cid,
					cbid: i.cbid,
					level: parseInt(i.level, 10) || 0,
					gt: parseInt(i.gt, 10) || 0,
					col: parseInt(i.col, 10) || 0,
					ct: parseInt(i.ct, 10) || 0,
					rg: parseInt(i.rg, 10) || 1,
					pg: parseInt(i.pg, 10) || 1,
					dlv: i.dlv || 0,
					dc: i.dc || 0,
					bdlv: i.bdlv || 0,
					ut: i.ut || "",
					at: i.at || "",
					el: i.el || "",
					shark: i.shark || "",
					egtt: parseInt(i.egtt, 10),
					txtitle: c,
					ic: i.ic || "",
					nl: parseInt(i.nl) || 0,
					nc: parseInt(i.nc) || 0,
					bnn: i.bnn,
					hc: i.hc,
					bl: parseInt(i.bl, 10) || 0,
					hl: parseInt(i.hl, 10) || 0,
					brid: i.brid,
					ol: parseInt(i.ol, 10) || 0,
					sahf: parseInt(isNaN(i.sahf) ? 1 : i.sahf, 10),
					lk: i.lk || "",
					vipfan: i.vipfan || 0,
					jskc: +i.jskc || 0,
					jsk: +i.jsk || 0
				}, l), "chatres" === i.type && (l.isSender = !0, l.len = parseInt(i.len, 10), e.extend(!0, o, {
					isSender: !0,
					res: i.res,
					cd: parseInt(i.cd, 10),
					len: parseInt(i.len, 10)
				}), t.trigger("mod.chat.msg.send.cd", o.cd), _.$chatSpeak.find('[data-type="cont"]').prop({
					maxlength: o.len
				}))
			}
			if ("chatmessage" === i.type && (l = e.extend(!0, {}, {
				isSender: parseInt(i.sender, 10) === parseInt(r.get("sys.uid"), 10),
				uid: i.sender,
				nn: i.sender_nickname,
				txt: i.content,
				cid: i.chatmsgid,
				level: parseInt(i.level, 10) || 0,
				gt: parseInt(i.gt, 10) || 0,
				col: parseInt(i.col, 10) || 0,
				ct: parseInt(i.ct, 10) || 0,
				rg: parseInt(i.sender_rg, 10) || 1,
				pg: parseInt(i.sender_pg, 10) || 1,
				dlv: i.m_deserve_lev || 0,
				dc: i.cq_cnt || 0,
				bdlv: i.best_dlev || 0,
				len: parseInt(i.maxl, 10),
				ut: i.ut || "",
				at: i.at || "",
				shark: i.shark || ""
			}, l), e.extend(!0, o, {
				isSender: parseInt(i.sender, 10) === parseInt(r.get("sys.uid"), 10),
				res: i.rescode,
				cd: parseInt(i.cd, 10),
				len: parseInt(i.len, 10)
			}), t.trigger("mod.chat.msg.send.cd", o.cd), _.$chatSpeak.find('[data-type="cont"]').prop({
				maxlength: o.len
			})), o.res > 0) {
				if (o.isSender) {
					var d = "";
					switch (o.res) {
					case "2":
						d = "您已被禁言";
						break;
					case "5":
						d = "全站禁言";
						break;
					case "6":
						d = "主播设置仅粉丝可发言";
						break;
					case "206":
						d = "非法操作";
						break;
					case "208":
						d = "目标用户未找到";
						break;
					case "289":
						d = "请不要重复发言";
						break;
					case "290":
						d = "您的发言速度过快";
						break;
					case "294":
						e.dialog({
							content: "鱼翅余额不足，点击获取！",
							icon: "warning",
							okVal: "确定",
							ok: function() {
								window.location.href = "/web_game/welcome/18", t.trigger("dys", {
									key: "dys.room.barrage.send.charge.action"
								})
							},
							cancelVal: "取消",
							cancel: function() {}
						}), t.trigger("dys", {
							key: "dys.room.barrage.send.charge.show"
						});
						break;
					case "363":
						w.sendVerify(function() {
							u.exe("js_sendmsg", a.encode([{
								name: "content",
								value: i.txt.replace(/\\/g, "\\\\")
							}, {
								name: "col",
								value: i.col
							}, {
								name: "sender",
								value: r.get("sys.uid")
							}]))
						});
						break;
					case "391":
						t.trigger("mod.chat.msg.msg", f.barrage(l)), h.init({
							dys_type: 1
						})
					}
					d.length && f.sysMsgTips({
						msg: d
					})
				}
				return void("288" != o.res && "356" != o.res || (t.trigger("mod.chat.msg.msg", f.barrage(l, k.comboConfig)), t.trigger("mod.center.usergroup.set", l.uid, {
					pg: l.pg,
					rg: l.rg
				})))
			}
			if (s.isSuperAdmin() || s.isAnchor() || (o.len = l.len), t.trigger("mod.chat.msg.msg", f.barrage(l, k.comboConfig), l), t.trigger("mod.center.usergroup.set", l.uid, {
				pg: l.pg,
				rg: l.rg
			}), r.get("sys.uid") == l.uid && l.col > 0) {
				if (1 === l.col && "hjs" === l.shark) return;
				t.trigger("mod.userinfo.change", {
					change: {
						exp: 10
					}
				})
			}
		},
		I = function(e) {
			var i;
			if ("uenter" === e.type) {
				var n = "";
				switch (isNaN(e.egtt) && (e.egtt = 0), parseInt(e.egtt, 10)) {
				case 1:
					n = "6鱼翅礼物666连击即可获得";
					break;
				case 2:
					n = "66鱼翅礼物666连击即可获得";
					break;
				case 4:
					n = "666鱼翅礼物666连击即可获得";
					break;
				default:
					n = ""
				}
				i = {
					level: parseInt(e.level, 10),
					lev: parseInt(e.level / 10, 10),
					dlv: parseInt(e.dlv, 10) || 0,
					dc: parseInt(e.dc, 10) || 0,
					bdlv: parseInt(e.bdlv, 10) || 0,
					gt: parseInt(e.gt, 10) || 0,
					rg: parseInt(e.rg, 10) || 1,
					pg: parseInt(e.pg, 10) || 1,
					uid: parseInt(e.uid, 10),
					nn: e.nn || "",
					ut: e.ut || "",
					at: e.at || "",
					el: e.el || "",
					egtt: parseInt(e.egtt, 10),
					txtitle: n,
					ic: e.ic || "",
					crw: e.crw,
					nl: parseInt(e.nl) || 0,
					ceid: parseInt(e.ceid, 10) || 0,
					cbid: e.cbid,
					ol: parseInt(e.ol, 10) || 0,
					sahf: parseInt(isNaN(e.sahf) ? 1 : e.sahf, 10)
				};
				var s = !1;
				if (t.trigger("douyu.halloween.isUenterHalloween", i, function(e) {
					s = e
				}), s) return
			}
			if ("userenter" === e.type) {
				var r = a.decode(e.userinfo).too();
				i = {
					level: parseInt(r.level, 10),
					lev: parseInt(r.level / 10, 10),
					dlv: parseInt(r.m_deserve_lev, 10) || 0,
					dc: parseInt(r.cq_cnt, 10) || 0,
					bdlv: parseInt(r.best_dlev, 10) || 0,
					gt: parseInt(r.gt, 10) || 0,
					rg: parseInt(r.rg, 10) || 1,
					pg: parseInt(r.pg, 10) || 1,
					uid: parseInt(r.id, 10),
					nn: r.nick || "",
					ut: e.ut || "",
					at: e.at || ""
				}
			}
			t.trigger("mod.chat.msg.msg", f.userEnter(i, k.comboConfig)), t.trigger("mod.center.usergroup.set", i.uid, {
				pg: i.pg,
				rg: i.rg
			})
		},
		j = function(e) {
			var i, a = "",
				n = r.get("sys.uid"),
				s = "newblackres" === e.type;
			if (e.closureConfirmType = 0, "newblackres" === e.type) {
				parseInt(e.otype, 10);
				switch (i = parseInt(e.ret, 10), s = s && (264 === i || 0 === i), i) {
				case 0:
					a = e.sid == n ? '<span class="nick-new">' + e.dnic + "</span>已被成功禁言" : '<span class="nick-new">' + e.dnic + "</span>已被禁言", n && e.sid && e.did && r.get("sys.owner_uid") && n == e.sid && r.get("sys.owner_uid") == e.did && t.trigger("mod.anchorwhitelist.sendEmail", {
						uid: e.did,
						operate_type: "mute"
					});
					break;
				case 4807:
				case 4808:
					a = "该用户已被禁言";
					break;
				case 264:
					a = '贵族用户 <span class="nick-new">' + (e.dnic || e.did) + "</span>", a += ' 防御了房管 <span class="nick-new">' + (e.snic || e.sid) + "</span> 的禁言 ", a += '<a class="noble--gagbtn" data-buy="defensemute" href="javascript:;">购买贵族防御禁言</a>';
					break;
				case 268:
					return void w.muteNoSession.show(e.did);
				case 4822:
					t.trigger("mod.closureConfirm.showDialog", e)
				}
			}
			"ntmet" !== e.type && "muteinfo" !== e.type || t.trigger("mod.chat.msg.mute", e), t.trigger("mod.chat.msg.msg", f[s ? "sysHtmlMsg" : "sysMsg"]({
				msg: a
			}))
		};
	return C.init = function() {
		u.reg("room_data_chat", function(e) {
			S(a.decode(e).too(), e)
		}), u.reg("room_data_chat2", function(e) {
			S(a.decode(e).too(), e)
		}), u.reg("room_data_nstip", function(e) {
			I(a.decode(e).too())
		}), u.reg("room_data_nstip2", function(e) {
			I(a.decode(e).too())
		}), u.reg("room_data_luckdrawcd", function(e) {
			t.trigger("mod.chat.msg.msg", f.lottery(e))
		}), u.reg("room_data_chatrep", function(t) {
			var i = a.decode(t).too(),
				n = "";
			n = 1 == i.state ? "<p>您已成功举报！<p><br><p>超管在后台确认违规后，会对该用户<br />进行相应的处理，并对首位举报的用户赠<br />送100鱼丸。 鱼丸会直接发放到帐号上，无需通<br />过任务大厅领取。</p>" : "<p>举报失败</p>", e.dialog.alert(n)
		}), u.reg("room_data_setadm", function(e) {
			var i = a.decode(e).too(),
				n = parseInt(i.rescode, 10);
			0 !== n && 206 !== n && 208 !== n && 214 !== n || (0 === parseInt(i.rescode, 10) ? (t.trigger("mod.chat.msg.msg", f.setAdmin(i)), t.trigger("mod.center.usergroup.set", i.userid, {
				rg: i.group
			})) : 214 === parseInt(i.rescode, 10) ? f.sysMsgTips({
				msg: "房管数量已达上限"
			}) : 206 === parseInt(i.rescode, 10) ? f.sysMsgTips({
				msg: "非法操作"
			}) : 208 === parseInt(i.rescode, 10) && f.sysMsgTips({
				msg: "用户不在房间"
			})), t.trigger("mod.room.userrole.get", i || {})
		}), u.reg("room_data_onekeyacc", function(i) {
			var n = a.decode(i).too();
			if (n.closureConfirmType = 1, "gbmres" === n.type) {
				if ("4822" === n.ret) return void t.trigger("mod.closureConfirm.showDialog", n);
				t.trigger("mod.chat.msg.msg", f.oneKey(n)), r.get("sys.uid") == n.uid && (t.trigger("mod.center.onekey.closure", {
					code: 57
				}), e.dialog.tips_black("当前用户已被封号不能发送弹幕！", 3)), r.get("sys.uid") == n.ouid && t.trigger("mod.anchorwhitelist.sendEmail", {
					uid: n.uid,
					operate_type: "ban"
				})
			}
		}), u.reg("room_data_sys", function(e) {
			j(a.decode(e).too())
		}), u.reg("room_data_schat", function(e) {
			t.fire("mod.chat.msg.shield").message || t.trigger("mod.chat.msg.msg", f.superBarrage(e))
		}), u.reg("room_data_athena_supermsg", function(e) {
			t.fire("mod.chat.msg.shield").message || t.trigger("mod.chat.msg.msg", f.athenaSuperBarrage(e))
		}), t.on("mod.chat.msg.gift", function(e, i) {
			var n, s = a.decode(e).too();
			if ("dgb" === s.type || "bgd" === s.type) {
				if (n = f.gift(e, i), s.uid != r.get("sys.uid") && t.fire("mod.chat.msg.shield").allGift) return !1;
				t.trigger("mod.center.usergroup.set", s.uid, {
					pg: s.pg || 1,
					rg: s.rg || 1
				})
			}
			if ("donateres" === s.type) {
				var o = a.decode(s.sui).too();
				if (n = f.balls(e), o.id != r.get("sys.uid") && t.fire("mod.chat.msg.shield").allGift) return !1;
				t.trigger("mod.center.usergroup.set", o.id, {
					pg: o.pg || 1,
					rg: o.rg || 1
				})
			}
			t.trigger("mod.chat.msg.msg", n)
		}), t.on("room.gift.treasure.data.draw", function(e) {
			var i = ""; + e.did !== +r.get("sys.uid") && t.fire("mod.chat.msg.shield").smallgift || (i = parseInt(e.silver, 10) ? f.peck(e) : f.peckprop(e), t.trigger("mod.chat.msg.msg", i))
		}), t.on("mod.chat.msg.res.rankupdate", function(e) {
			var i = a.decode(e).too();
			return i.uid != r.get("sys.uid") && t.fire("mod.chat.msg.shield").message ? !1 : 2 === parseInt(i.rkt, 10) && w.rankAllClosed ? !1 : void t.trigger("mod.chat.msg.msg", f.rankupdate(e))
		}), t.on("mod.chat.msg.res.rankgap", function(e) {
			t.trigger("mod.chat.msg.msg", f.rankgap(e))
		}), u.reg("room_data_ulgrow", function(e) {
			var i = a.decode(e).too();
			return i.uid != r.get("sys.uid") && t.fire("mod.chat.msg.shield").message ? !1 : void t.trigger("mod.chat.msg.msg", f.uplevel(e))
		}), u.reg("room_data_handler", function(e) {
			var i = a.decode(e).too();
			return i.uid != r.get("sys.uid") && t.fire("mod.chat.msg.shield").message ? !1 : void("blab" !== i.type || 1 !== parseInt(i.ba, 10) && 3 !== parseInt(i.ba, 10) || t.trigger("mod.chat.msg.msg", f.fansLevelUp(e)))
		}), u.reg("room_yz_data", function(e) {
			var i = a.decode(e).too();
			return i.uid != r.get("sys.uid") && t.fire("mod.chat.msg.shield").message ? !1 : void("apkb" === i.type && 4 === parseInt(i.cmd, 10) && t.trigger("mod.chat.msg.msg", f.winAnchorFans(e)))
		}), u.reg("room_data_wbsharesuc", function(e) {
			var i = a.decode(e).too();
			return i.uid != r.get("sys.uid") && t.fire("mod.chat.msg.shield").message ? !1 : void t.trigger("mod.chat.msg.msg", f.wbsharesuc(e))
		}), u.reg("room_data_handler", function(e) {
			var i = a.decode(e).too();
			"redirect" === i.type && "wdf_video" === i.msgtype && t.trigger("mod.chat.msg.msg", f.videoMomentRecord(i))
		}), u.reg("room_data_handler", function(e) {
			var i = a.decode(e).too();
			if ("gbroadcast" === i.type) {
				var n = r.get("sys.webconfUrl").replace(/^http(s?):/, "").replace(/\/$/g, "") + "/resource/common/privilege_broadcast/broadcast.json";
				d.load(n, "privilegeBroadcasConfig", function(e) {
					var n;
					1 === parseInt(i.ft, 10) ? n = JSON.parse(i.gbcc) : 2 === parseInt(i.ft, 10) && (n = a.decode(i.gbcc).too());
					var s = e[n.param].title;
					t.trigger("mod.chat.msg.msg", f.broadcastRecord(n, s))
				})
			}
		}), t.on("mod.center.onekey.closure", function() {
			t.trigger("mod.gift.auto.send.set", !1), t.trigger("mod.task.destroy", !1), t.trigger("mod.olyw.destroy", !1), t.trigger("mod.guess.destroy", !1), _.$chatSpeak.find('[data-type="send"]').addClass("b-btn-gray")
		}), u.reg("room_GCBroadCast_data", function(e) {
			function n(e) {
				var t = new String(Math.round(e / 1e3) / 10);
				return t.indexOf(".") > -1 ? t : t + ".0"
			}
			function s(e, t) {
				return i.string.format("{0}upload/{1}_middle.jpg", e, t)
			}
			var r = a.decode(e).too();
			if ("qzembls" === r.type) {
				var o = r.qzels,
					l = !1;
				if ("" === o && (l = !0), !l) {
					o = a.isArray(o) ? a.decode(o) : [{
						value: o
					}];
					for (var c = 0, d = o.length; d > c; c++) {
						var u = o[c].value,
							p = u && a.decode(u).too(),
							m = k.defaultAvatar;
						if (p) {
							var h = {
								ec: p.ec >= 1e4 ? n(p.ec) + "万" : p.ec,
								uname: p.uname,
								icon: p.icon ? s(k.avatarDomain, p.icon) : m
							};
							t.trigger("mod.chat.msg.msg", f.guessGame(h))
						}
					}
				}
			}
		}), u.reg("room_data_handler", function(e) {
			var i = a.decode(e).too();
			return i.unick != r.get("sys.nickname") && t.fire("mod.chat.msg.shield").smallgift ? !1 : void("clubreward" === i.type && t.trigger("mod.chat.msg.msg", f.motorFishBall(i)))
		}), t.on("mod.gift.svga.unsupport", function(e) {
			f.sysMsgTips({
				msg: e
			})
		}), u.reg("room_data_handler", function(t) {
			var i = a.decode(t).too();
			"active_uatn" === i.type && ("1" == i.tt && e.dialog.tips_black("当天累计发送2条弹幕，活跃值+" + i.pa), "2" == i.tt && e.dialog.tips_black("累计观看直播5分钟，活跃值+" + i.pa)), "active_uctn" == i.type && (e("#container .summer_gift_box").length || (e("#container").append("<div class='summer_gift_box'></div>"), e("#container").append("<div class='summer_gift_box_open'></div>"), e("#container").append("<div class='summer_gift_detail'><div class='gift_close'></div><div class='gift_title'><span>使用斗鱼APP打开直播间</span>，即可获得以下奖励~</div><div class='gift_detail'><span>5天直播间免广告</span><span>小礼物 x 50</span></div><div class='gift_tip'>完成任务后奖励自动发放</div><div class='gift_download_app'><p>扫一扫</p><p>下载APP</p></div></div>")), setTimeout(function() {
				e("#container .summer_gift_box").animate({
					top: "50%"
				}, 1e3, "linear", function() {
					e("#container .summer_gift_box").fadeOut(500), setTimeout(function() {
						e("#container .summer_gift_box_open").fadeIn(1e3, function() {
							e("#container .summer_gift_box_open").hide(), e("#container .summer_gift_detail").fadeIn(500)
						})
					}, 200)
				}), e("#container .summer_gift_detail .gift_close").on("click", function() {
					e("#container .summer_gift_box").remove(), e("#container .summer_gift_box_open").remove(), e("#container .summer_gift_detail").remove()
				})
			}, 1e3))
		})
	}, {
		init: function() {
			_.init(), x.init(), w.init(), C.init(), g.init()
		}
	}
}), define("douyu/page/room/normal/mod/chat-cmd", ["jquery", "shark/observer", "shark/util/flash/data/1.0", "douyu/page/room/base/api"], function(e, t, i, a) {
	var n, s, r, o, l, c, d;
	return n = {
		broadcastResultUrl: "/api/bcmd/dealBroadResult",
		gatewayResultUrl: "/api/bcmd/dealResult",
		cdTime: 1
	}, s = {
		interval: function() {
			var e = d.doms.sender,
				t = e.html(),
				i = n.cdTime,
				a = null,
				s = null;
			s = function() {
				0 >= i ? (e.removeClass("b-btn-gray").html(t), clearInterval(a)) : (e.addClass("b-btn-gray").html(i), i--)
			}, s(), a = setInterval(function() {
				s()
			}, 1e3)
		}
	}, l = {
		isCurrentAnchor: function() {
			return Number($SYS.uid) === $ROOM.owner_uid
		}
	}, d = {
		init: function() {
			var t, i = e("#anchor-info");
			this.timer = null, this.doms = {
				chatBox: e("#js-live-room-normal-right"),
				speakBox: e("#js-chat-speak"),
				followBtn: i.find('[data-anchor-info="follow"]'),
				followedBtn: i.find('[data-anchor-info="followed"]'),
				fansNum: i.find('[data-anchor-info="nic"]')
			}, t = this.doms, t.speakCont = t.speakBox.find('[data-type="cont"]'), t.sender = t.speakBox.find('[data-type="send"]'), t.speakBox.before('<div class="chat-cmdbox"><div class="chat-cmdboxresult"><div class="chat-cmdboxresult-content"></div><div class="chat-cmdboxresult-close js-chat-cmdboxresult-close"></div></div></div>'), t.cmdBox = t.speakBox.prev().find(".chat-cmdboxresult-content"), t.cmdBoxWrap = t.cmdBox.parent(), this.closeCmdBox()
		},
		closeCmdBox: function() {
			var t = this.doms;
			t.cmdBoxWrap.on("click", ".js-chat-cmdboxresult-close", function() {
				var t = e(this);
				t.parent().css("height", "0px")
			})
		},
		clearInput: function() {
			this.doms.speakCont.val("")
		},
		setCont: function(e, t, i) {
			var a = t || {
				common: "#f03",
				keyword: "#46abff"
			};
			this.doms.cmdBox.html(this.translate(e, a.keyword)).css("color", a.common), this.showCont(1e3 * (i || 60))
		},
		showCont: function(e) {
			var t = this,
				i = this.doms.cmdBoxWrap.stop(!0, !0),
				a = i.height("auto").height();
			clearTimeout(t.timer), i.height(0).animate({
				height: a
			}, function() {
				t.timer = setTimeout(function() {
					i.animate({
						height: 0
					})
				}, e)
			})
		},
		tpls: {
			cmdFailed: "指令操作失败！",
			followAnchorOwn: "不可以关注自己的直播间噢！<br />如需帮助，请输入“#帮助”或“#help”",
			willJump: "空降部队准备完毕，3秒后即将空降",
			unsafeScript: "抱歉，暂时无法支持您输入的内容|br|如需帮助，请输入“#帮助”或“#help”"
		},
		cachedResult: {},
		translate: function(e, t) {
			return e.replace(/\|br\|/g, "<br>").replace(/“([^”]+)”/g, '“<span style="color:' + t + '">$1</span>”')
		}
	}, r = {
		"帮助|help": function(t, a) {
			var s = {
				type: "cmdres",
				cmd: e.trim(t + " " + a)
			},
				r = i.encode(s),
				o = r,
				l = d.cachedResult[o];
			return l ? (d.setCont(l.str_msg, l.colors, l.str_msg_showtime), DYS.sub({
				action_code: "click_msginstr_send",
				ext: {
					instr: s.cmd,
					is_right: 1
				}
			})) : c.getResult(n.gatewayResultUrl, o, 1), d.clearInput(), !1
		}
	}, o = {
		"空降": function(t, i) {
			var a = window.location;
			return e.trim(i) ? (d.setCont(d.tpls.willJump), setTimeout(function() {
				a.href = a.protocol + "//" + a.host + "/" + i
			}, 3e3), DYS.sub({
				action_code: "click_msginstr_send",
				ext: {
					instr: t,
					is_right: 1
				}
			}), d.clearInput(), !0) : void 0
		},
		"关注": function(i) {
			var a = d.doms,
				n = $ROOM.room_id,
				s = d.tpls;
			return l.isCurrentAnchor() ? (d.setCont(d.tpls.followAnchorOwn), DYS.sub({
				action_code: "click_msginstr_send",
				ext: {
					instr: i,
					is_right: 0
				}
			})) : e.ajax("/room/follow/add_cmd_confuse/" + n, {
				type: "post",
				dataType: "json",
				data: {
					room_id: n
				},
				error: function() {
					d.setCont(s.cmdFailed)
				},
				success: function(e) {
					var n = 0;
					e && 0 === e.error ? (n = 1, t.trigger("mod.normal.follow.render", e.data), a.followBtn.addClass("hide"), a.followedBtn.removeClass("hide")) : n = 0, d.setCont(e.msg), DYS.sub({
						action_code: "click_msginstr_send",
						ext: {
							instr: i,
							is_right: n
						}
					})
				}
			}), d.clearInput(), !1
		},
		"取关": function(i) {
			var a = d.doms,
				n = $ROOM.room_id,
				s = d.tpls;
			return l.isCurrentAnchor() ? void 0 : (e.ajax("/room/follow/cancel_cmd_confuse/" + n, {
				type: "post",
				dataType: "json",
				data: {
					room_id: n
				},
				error: function() {
					d.setCont(s.cmdFailed), DYS.sub({
						action_code: "click_msginstr_send",
						ext: {
							instr: i,
							is_right: 0
						}
					})
				},
				success: function(e) {
					var n = 0;
					e && 0 === e.error ? (n = e.error ? 0 : 1, a.followBtn.removeClass("hide"), a.followedBtn.addClass("hide"), t.trigger("mod.normal.follow.render", e.data)) : n = 0, d.setCont(e.msg), DYS.sub({
						action_code: "click_msginstr_send",
						ext: {
							instr: i,
							is_right: n
						}
					})
				}
			}), d.clearInput(), !0)
		},
		"开始投票|结束投票|查看投票结果|开始猜词|放弃猜词": function(e, t) {
			var a = i.encode([{
				value: t
			}]),
				n = [{
					name: "type",
					value: "cmd"
				}, {
					name: "cmd",
					value: e
				}, {
					name: "params",
					value: a
				}];
			return c.exeCmd(n), !0
		}
	}, c = {
		init: function() {
			this.whiteList = !1, this.bindEvents()
		},
		bindEvents: function() {
			var e = this;
			t.on("mod.chat.cmd.check", function(t) {
				var i, a = !1,
					n = e.getCmd(t),
					s = n.action,
					l = n.param;
				if (!s) return !1;
				if (/<script[^>]*?>/.test(l)) return d.setCont(d.tpls.unsafeScript), DYS.sub({
					action_code: "click_msginstr_send",
					ext: {
						instr: s,
						is_right: 0
					}
				}), !0;
				for (i in r) if (new RegExp("^(" + i + ")$").test(s)) {
					a = r[i](s, l);
					break
				}
				for (i in o) if (new RegExp("^(" + i + ")$").test(s)) {
					a = o[i](s, l);
					break
				}
				return a
			}), a.reg("room_data_commandresult", function(t) {
				e.getResult(n.broadcastResultUrl, t, 0, 1)
			}), a.reg("room_data_handler", function(t) {
				var a = i.decode(t).too();
				"cmdres" === a.type && (a.cd = a.cd ? a.cd : 0, a.len = a.len ? a.len : 200, n.cdTime = a.cd / 1e3, s.interval(), e.getResult(n.gatewayResultUrl, t))
			})
		},
		getCmd: function(t) {
			var i = /^#([^#| ]+)\s?(.*)/i,
				a = e.trim(t),
				n = a.match(i) || [];
			return n && n[0] ? {
				input: a,
				action: n[1].replace(/\\/g, "\\\\"),
				param: n[2].replace(/\\/g, "\\\\")
			} : {}
		},
		exeCmd: function(e) {
			a.exe("js_barrage_command", i.encode(e)), d.clearInput()
		},
		getResult: function(t, n, s, r) {
			var o = i.decode(n).too();
			e.ajax({
				url: t,
				type: "post",
				data: "str=" + encodeURIComponent(n),
				dataType: "json",
				error: function() {
					d.setCont(d.tpls.cmdFailed), DYS.sub({
						action_code: "click_msginstr_send",
						ext: {
							instr: o.cmd,
							is_right: 0
						}
					})
				},
				success: function(e) {
					var t = e.data,
						i = 0;
					0 === e.error && t && t.str_msg && (s && (d.cachedResult[n] = t), r && a.exe("js_barrage_command_showresult", t.str_msg, t.str_msg_showtime), d.setCont(t.str_msg, t.colors, t.str_msg_showtime), i = t.is_right || 0, DYS.sub({
						action_code: "click_msginstr_send",
						ext: {
							instr: o.cmd,
							is_right: i
						}
					}))
				}
			})
		}
	}, {
		init: function() {
			d.init(), c.init()
		}
	}
}), define("douyu/page/room/normal/mod/chat-link-barrage", ["jquery", "shark/observer", "shark/util/flash/data/1.0", "douyu/context", "douyu/com/user", "douyu/page/room/base/api"], function(e, t, i, a, n, s) {
	var r = {
		init: function() {
			this.initConfigs(), this.initDoms(), this.checkSwitch(), this.bindListen()
		},
		initConfigs: function() {
			this.configs = {
				urls: {
					handleLink: "/lapi/member/barrageLink/filter"
				},
				isSending: 0,
				isBindPhone: 1,
				linkBarrageSwitch: a.get("colligate.barrage_link.switch"),
				linkBarrageConfig: a.get("colligate.barrage_link.link_pre"),
				isRenderPanel: 0,
				linkCheckRegMap: null,
				typeMap: {
					1: 1,
					2: 2,
					3: 3,
					4: 4
				}
			}, this.linkRes = {
				canUse: 1,
				linkSwitch: 0,
				lastValue: "",
				linkValue: ""
			}
		},
		initDoms: function() {
			this.doms = {
				$chatSpeak: e("#js-chat-speak"),
				$linkBarrageBtn: e("#js-chat-speak").find("#js-link-barrage")
			}
		},
		startApp: function() {
			this.doms.$linkBarrageBtn.removeClass("hide"), this.bindEvent()
		},
		checkSwitch: function() {
			return this.configs.linkBarrageSwitch && this.configs.linkBarrageConfig ? void this.startApp() : !1
		},
		appendLinkBarragePanel: function() {
			var e = this.doms,
				t = ['<div class="hyperlink-chat-box" style="display: none;">', '<div class="hyperlink-chat-title">', "<h3>超链弹幕</h3>", "<p>想去哪？我的弹幕引导你~</p>", "</div>", '<div class="hyperlink-chat-close"></div>', '<a href="https://www.douyu.com/cms/gong/201801/05/7017.shtml" target="_blank" class="hyperlink-chat-introduce">介绍</a>', '<div class="hyperlink-chat-content">', '<div class="hyperlink-chat-info">设置以下跳转链接，其他人点击你的弹幕可直接过去哟~</div>', '<div class="hyperlink-chat-link">', '<textarea class="js-linkBarrage-area" type="text" placeholder="房间号/鱼吧贴子链接/视频链接"></textarea>', "</div>", "</div>", '<div class="hyperlink-chat-attention" style="display:none;">请勿重复发送弹幕！</div>', "</div>"].join("");
			e.$chatSpeak.append(t), e.$linkBarragePanel = e.$chatSpeak.find(".hyperlink-chat-box"), e.$linkBarrageArea = e.$chatSpeak.find(".js-linkBarrage-area"), e.$remainTip = e.$chatSpeak.find(".hyperlink-chat-attention")
		},
		reqHandleLink: function(t) {
			var i = this,
				a = i.configs.urls,
				n = e.Deferred(),
				s = encodeURI(t);
			return e.ajax({
				url: a.handleLink,
				dataType: "json",
				data: {
					link: s
				}
			}).done(function(e) {
				e && 0 == e.error && e.data ? n.resolve(e.data) : n.reject(0, e.data)
			}).fail(function(e) {
				n.reject(0)
			}), n
		},
		handleLinkBarrageData: function() {
			var t = this,
				i = this.doms,
				a = (new RegExp(/^\d{1,12}$/), e.Deferred()),
				n = this.linkRes,
				s = i.$linkBarrageArea.val().toString();
			return n.linkValue = s.trim(), n.canUse = 1, n.linkSwitch ? "" != n.linkValue ? this.reqHandleLink(n.linkValue).done(function(e) {
				n.lastValue = n.linkValue, n.linkValue = e, a.resolve(n)
			}).fail(function(e, i) {
				n.canUse = 0, a.resolve(n), t.showRemainTips(i || "请填写正确的链接信息")
			}) : (t.showRemainTips("请输入跳转链接"), n.canUse = 0, a.resolve(n)) : (n.linkSwitch = 0, a.resolve(n)), a
		},
		showRemainTips: function(e) {
			var t = this.doms;
			t.$remainTip.text(e).show()
		},
		checkCanUse: function() {
			return n.check() ? this.configs.isBindPhone ? !0 : (e.dialog.tips_black("绑定手机号才能发超链弹幕哟"), !1) : (n.show("login"), !1)
		},
		openLinkBarrage: function() {
			var e = this.configs,
				t = this.doms;
			this.checkCanUse() && (e.isRenderPanel || (e.isRenderPanel = 1, this.appendLinkBarragePanel(), this.bindAreaEvent()), t.$linkBarragePanel.show(), this.linkRes.linkSwitch = 1)
		},
		closeLinkBarrage: function() {
			var e = this.doms;
			e.$linkBarragePanel.hide(), e.$remainTip.hide(), e.$linkBarrageArea.val(""), this.linkRes.linkSwitch = 0
		},
		bindEvent: function() {
			var i = this,
				a = i.doms;
			a.$chatSpeak.on("click", "#js-link-barrage", function() {
				return i.openLinkBarrage(), t.trigger("dys", {
					key: "dys.room.linkBarrage.enterbtn"
				}), !1
			}).on("click", ".hyperlink-chat-close", function() {
				return i.closeLinkBarrage(), !1
			}).on("click", ".hyperlink-chat-introduce", function() {
				t.trigger("dys", {
					key: "dys.room.linkBarrage.intro"
				})
			}), e("#js-chat-cont").on("click", ".hyperlink-chat-msg", function() {
				var a = e(this),
					n = i.configs.typeMap;
				t.trigger("dys", {
					key: "dys.room.linkBarrage.lmsg",
					type: n[a.attr("data-msg-type")] || -1
				})
			})
		},
		bindAreaEvent: function() {
			var e = this,
				t = e.doms;
			t.$linkBarrageArea.on("focus", function() {
				t.$remainTip.hide()
			})
		},
		bindListen: function() {
			var i = this,
				a = this.configs,
				n = i.linkRes;
			t.on("room.get.isBindPhone.status", function(e) {
				i.configs.isBindPhone = +e ? 1 : 0
			}), t.on("room.get.linkBarrage.status", function() {
				var t = e.Deferred();
				return n.linkSwitch ? a.isSending ? t.reject() : (a.isSending = 1, i.handleLinkBarrageData().done(function(e) {
					a.isSending = 0, t.resolve(e)
				}), t) : t.resolve(n)
			})
		}
	};
	return {
		init: function() {
			r.init()
		}
	}
}), define("douyu/page/room/normal/mod/chat-send", ["jquery", "shark/observer", "shark/util/flash/data/1.0", "shark/util/date/1.0/date", "douyu/context", "douyu/com/user", "douyu/page/room/base/api", "douyu/page/room/normal/mod/chat-msg-tmp", "shark/util/storage/1.0"], function(e, t, i, a, n, s, r, o, l) {
	var c = {
		currentVal: "",
		lastText: "",
		cdTime: 1,
		defval: "#000000",
		cursurPosition: 0,
		placeholder: {
			deft: "这里输入聊天内容",
			help: "试着输入“#帮助”，看看会发生什么吧",
			follow: "试着输入“#关注”吧，可以关注主播噢"
		},
		normalLimitStr: "",
		userRole: {},
		isSetFansSpeak: !1,
		hasFansMedal: !1,
		isMsgMute: !1,
		isNormalStatus: !1
	},
		d = {},
		u = {},
		f = {},
		p = {};
	return d.render = function() {
		var t, i = "Mac68K" == navigator.platform || "MacPPC" == navigator.platform || "Macintosh" == navigator.platform || "MacIntel" == navigator.platform;
		t = i ? '<a class="shie-pc-link" href="/client?platform=4" target="_blank" data-link="mac-client"><div class="shie-pc-client-icon"></div><span>MAC客户端</span></a>' : '<a class="shie-pc-link" href="/client?platform=3" target="_blank" data-link="pc-client"><div class="shie-pc-client-icon"></div><span>PC客户端</span></a>';
		var a = ['<div class="face-box" style="display:none;"></div>', '<div class="speak-up clearfix">', '<div class="expression fl">', '<a class="e-btn" href="javascript:;" title="表情"></a>', "</div>", '<div id="js-msg-barrage" class="unread-msgs fl">', '<a class="m-btn" href="javascript:;" title="发站内信"><i class="m-icon"></i></a>', '<i class="m-left-num hide"></i>', "</div>", '<div id="js-noble-speaker-btn" class="fl noble--broadcast-box hide"></div>', '<div class="fl noble--barrage-box status--nobel-disabled"></div>', '<div id="js-fans-barrage" class="fans-barrage fl">', '<a class="fans-barrage-btn" data-type="fans-barrage-btn" href="javascript:;" title="粉丝弹幕"><i class="fans-barrage-icon"></i></a>', "</div>", '<div id="js-super-msg" class="big-chat fl hide">', '<a class="big-chat-btn" data-type="super-msg-btn" href="javascript:;" title="超大弹幕"></a>', "</div>", '<div id="js-filter-keywords" class="filter-keywords fl ">', '<a class="filter-keywords-btn" data-type="filter-keywords-btn" href="javascript:;" title="过滤关键词"><i class="filter-keywords-icon"></i></a>', "</div>", '<div id="js-link-barrage" class="hyperlink-chat fl hide">', '<a class="hyperlink-chat-btn" href="javascript:;" title="超链弹幕">', '<i class="hyperlink-chat-icon"></i>', "</a>", "</div>", '<div class="shie-gift fr">', '<div class="shie-tips" data-shie="tips">', '<a class="shie-tips-close" href="javascript:;" data-shie="cls"></a>', '<span class="shie-tips-txt1">鲨鱼娘检测到您屏幕卡顿！</span>', '<span class="shie-tips-txt2">已为您屏蔽小礼物特效</span>', '<label class="shie-tips-label">', '<input class="shie-tips-label-input" type="checkbox" name="" data-input="tips">', '<span class="shie-tips-label-span">本周不再提示</span>', "</label>", '<span class="shie-tips-arrow shie-tips-arrow1"></span>', '<span class="shie-tips-arrow shie-tips-arrow2"></span>', "</div>", '<div id="js-shie-gift" class="shie shie-switch-open">', '<dl class="shie-site-list" id="shie-site-list">', '<dd class="shie-pc-client">' + t + "</dd>", '<dd class="shie-input" data-shield-type="allGift" data-shield-status="0">', '<div class="shie-checkbox-icon" data-shidld-style="cheacked"></div>', "<span>屏蔽全部礼物</span>", "</dd>", '<dd class="shie-input" data-shield-type="message" data-shield-status="0">', '<div class="shie-checkbox-icon" data-shidld-style="cheacked"></div>', "<span>屏蔽消息通知</span>", "</dd>", '<dd class="shie-input" data-shield-type="videoBroadcast" data-shield-status="0">', '<div class="shie-checkbox-icon" data-shidld-style="cheacked"></div>', "<span>屏蔽视频广播</span>", "</dd>", '<dd class="shie-input" data-shield-type="smallgift" data-shield-status="0">', '<div class="shie-checkbox-icon" data-shidld-style="cheacked"></div>', "<span>屏蔽小礼物</span>", "</dd>", '<dd class="shie-site-list-arrow shie-site-list-arrow1"></dd>', '<dd class="shie-site-list-arrow shie-site-list-arrow2"></dd>', "</dl>", '<div class="shie-switch">', '<span class="shie-input" id="shie-switch">', '<div class="shie-checkbox-icon"></div>', "<span>屏蔽全部特效</span>", "</span>", "</div>", "</div>", "</div>", "</div>", '<div id="js-send-msg" class="chat-feat clearfix">', '<textarea class="cs-textarea" name="" maxlength="50" placeholder="这里输入聊天内容" tabindex="1" data-type="cont"></textarea>', '<p class="login-inside" data-type="log"><a class="is-log" href="javascript:;" data-type="login">登录</a>发弹幕，参与主播互动</p>', '<div class="b-btn b-btn-gray" data-type="send">发送</div>', "</div>", '<div id="js-noble-speaker" class="chat--broadcast-box hide"></div>', '<div class="chat-bottom-ad hide" data-dysign="30011" ></div>'];
		e("#js-chat-speak").html(a.join(""))
	}, d.render(), d.init = function() {
		d.$target = e("#js-send-msg"), d.$content = d.$target.find('[data-type="cont"]'), d.$send = d.$target.find('[data-type="send"]'), d.$log = d.$target.find('[data-type="log"]'), d.changePlaceholder(), c.isLogin = s.check(), c.isLogin ? u.logStatus.normal() : u.logStatus.notLogin(), t.on("mod.chat.send", function(e) {
			var i = parseInt(e.npv, 10);
			c.isLogin && !i && (c.isNormalStatus = !0, u.logStatus.normal()), 1 === i && (u.logStatus.bindPhone(), t.trigger("room.get.isBindPhone.status", 0), d.$log.find(".is-log").on("mousedown", function() {
				t.trigger("dys", {
					key: "dys.room.barrage.bindphone"
				})
			}))
		}), t.on("mod.chat.msg.mute", function(e) {
			var t = d.$log.data("show");
			if (0 === t || 3 === t || 4 === t) {
				var i = 1e3 * e.met || 0,
					n = parseInt(e.mtype, 10) || 1;
				n > 0 && i > 0 ? (c.normalLimitStr = "您已被" + ["房间", "房间", "全站", "全站"][n - 1] + '禁言。<span class="is-mute-type">禁言类型：0' + n + "</span><br />解禁时间:" + a.format(new Date(i), "yyyy-MM-dd hh:mm:ss") + '<a class="is-mute" data-type="mute" href="/cms/gong/201601/06/2924.shtml" target="_blank">用户发言须知</a>', c.isMsgMute = !0, u.logStatus.normalLimit()) : c.isMsgMute = !1
			}
		}), t.on("mod.chat.msg.exp", function(e) {
			var t = d.$content[0],
				i = d.$content.attr("placeholder");
			t.value === i && (t.value = ""), t.value.length < t.maxLength && (t.value = t.value.substring(0, c.cursurPosition) + "[emot:" + e + "]" + t.value.substring(c.cursurPosition), t.focus())
		}), t.on("mod.chat.msg.color.set", function(e, t) {
			null === e ? "triggerClick" != t ? d.$content.removeAttr("style").focus() : d.$content.removeAttr("style") : "triggerClick" != t ? d.$content.css({
				color: e
			}).focus() : d.$content.css({
				color: e
			})
		}), t.on("mod.chat.msg.send.cd", function(e) {
			c.cdTime = e
		}), t.on("mod.chat.msg.color.vote", function(i) {
			var a, n;
			i && i.length > 0 && (e.map(i, function(t, i) {
				t.type && t.value && (a = t.type, n = t.value, t.select && 1 === +t.select && (c.defval = n, d.$content.css("color", n), e("#js-fans-barrage>a.fans-barrage-btn").css("background-color", n)))
			}), t.on("mod.chat.kpl.color", function() {
				r.exe("js_setBarrageColor", i)
			}))
		})
	}, d.changePlaceholder = function() {
		var e = c.placeholder.deft,
			t = Math.random();
		t > .5 && .75 >= t ? e = c.placeholder.help : t > .75 && 1 >= t && (e = c.placeholder.follow), d.$content.attr({
			placeholder: e
		})
	}, u.roomLinkCheck = function(t) {
		var i = /\[room\=([^\]]+)\]/gi,
			a = /\[room\=([a-z\d]+)\]/gi,
			n = t.match(i),
			s = 1;
		return n && e.each(n, function(e, t) {
			return a.test(t) ? void 0 : (s = 0, !1)
		}), s
	}, u.sendMsg = function() {
		var a, f = e.trim(d.$content.val()) || e.trim(c.currentVal),
			p = t.fire("mod.chat.msg.color.get"),
			m = p.color,
			h = p.pid,
			g = p.ifs,
			v = p.sMsg,
			y = p.nl > 0 ? 1 : 0,
			b = ("full" === t.fire("mod.video.state.get") ? 2 : 1, !1);
		if (!d.$send.hasClass("b-btn-gray")) return "" === f ? void d.$content.val("").focus() : ("#CJ" != f.substring(0, 3) && "#cj" != f.substring(0, 3) || (b = !0, f = f.substring(3, f.length)), s.check() ? void(t.fire("mod.chat.cmd.check", f) || t.fire("room.get.linkBarrage.status").done(function(s) {
			var p, k = s || {},
				w = {
					1: 1,
					2: 2,
					3: 3,
					4: 4
				};
			if (5 != n.get("sys.groupid") && n.get("sys.uid") != n.get("room.owner_uid") && c.lastText === f) return void t.trigger("mod.chat.msg.msg", o.sysMsg({
				msg: "请不要重复发言。"
			}));
			if (!u.roomLinkCheck(f)) return void t.trigger("mod.chat.msg.msg", o.sysMsg({
				msg: "您输入的代码中含有非法字符，请重新输入。"
			}));
			if ("" === f.replace(/\[emot:[A-Za-z0-9_]+\]/g, "") && (m = 0), a = [{
				name: "content",
				value: f.replace(/\\/g, "\\\\")
			}, {
				name: "col",
				value: m
			}, {
				name: "type",
				value: "chatmessage"
			}, {
				name: "dy",
				value: n.get("room.device_id")
			}, {
				name: "sender",
				value: n.get("sys.uid")
			}, {
				name: "pid",
				value: h
			}, {
				name: "ifs",
				value: g
			}, {
				name: "hg",
				value: v
			}, {
				name: "nc",
				value: y
			}, {
				name: "rev",
				value: +l.get("fansCrazyBarrage") ? 1 : 0
			}], b && a.push({
				name: "sdt",
				value: 101
			}), k.linkSwitch) {
				if (!k.canUse) return;
				p = k.linkValue.split("_"), t.trigger("dys", {
					key: "dys.room.linkBarrage.send",
					type: w[p[0]] || -1
				}), a.push({
					name: "lk",
					value: k.linkValue
				})
			}
			r.exe("js_sendmsg", i.encode(a)), c.lastText = f, d.$content.val("").focus(), c.currentVal = "", c.cdTime > 0 && u.interval(), t.trigger("activity.danmuh5.firstmsg");
			var _ = e('#js-color-barrage [data-type="cbt"]'),
				x = _.hasClass("c-btn-on") ? 1 : 2;
			t.trigger("dys", {
				key: "dys.room.barrage.send",
				type: x,
				code: 1 === x ? _.data("code") : void 0
			})
		})) : void s.show("login"))
	}, u.interval = function(e) {
		var t = d.$send.html(),
			i = e || c.cdTime,
			a = null,
			n = null;
		n = function() {
			0 >= i ? (d.$send.removeClass("b-btn-gray").html(t), clearInterval(a)) : (d.$send.addClass("b-btn-gray").html(i), i--)
		}, n(), a = setInterval(function() {
			n()
		}, 1e3)
	}, u.logStatus = {
		normal: function() {
			d.$log.removeClass("login-inside-nologbor login-inside-mute").hide().data("show", 0), d.$send.removeClass("b-btn-gray")
		},
		notLogin: function() {
			d.$log.removeClass("login-inside-mute").addClass("login-inside-nologbor").show().data("show", 1), d.$send.addClass("b-btn-gray")
		},
		bindPhone: function() {
			d.$log.removeClass("login-inside-mute").addClass("login-inside-nologbor").show().html('<a class="is-log" data-type="phobi" href="/member/cp#phone" target="_blank">验证手机号</a>即可发送弹幕！').data("show", 2), d.$send.addClass("b-btn-gray")
		},
		normalLimit: function() {
			c.normalLimitStr && (d.$log.addClass("login-inside-nologbor login-inside-mute").show().html(c.normalLimitStr).data("show", 3), d.$send.addClass("b-btn-gray"))
		},
		fansLimit: function() {
			d.$log.removeClass("login-inside-mute").addClass("login-inside-nologbor").html("想和主播聊天，先办卡吧！").show().data("show", 4), d.$send.addClass("b-btn-gray")
		}
	}, u.fansSpeakCheck = function() {
		var e = String(n.get("sys.uid")) === String(n.get("room.owner_uid")),
			t = 5 === parseInt(n.get("sys.groupid"), 10),
			i = 4 === parseInt(c.userRole.group, 10);
		return !c.isNormalStatus || e || t ? void 0 : c.isMsgMute ? void u.logStatus.normalLimit() : c.userRole.userid === String(n.get("sys.uid")) && i ? void(d.$send.hasClass("b-btn-gray") && u.logStatus.normal()) : void(c.isSetFansSpeak && !c.hasFansMedal ? u.logStatus.fansLimit() : u.logStatus.normal())
	}, f.init = function() {
		d.$log.on("click", '[data-type="login"]', function(e) {
			e.preventDefault(), s.show("login"), t.trigger("dys", {
				key: "dys.room.chat.login.click"
			})
		}), e("#js-chat-speak").on("click", '[data-link="mac-client"]', function() {
			t.trigger("dys", {
				key: "dys.room.clientDownload.click",
				d_type: 1
			})
		}).on("click", '[data-link="pc-client"]', function() {
			t.trigger("dys", {
				key: "dys.room.clientDownload.click",
				d_type: 2
			})
		}), d.$send.on("click", function(e) {
			e.preventDefault(), c.currentVal = d.$content.val(), u.sendMsg()
		}), d.$content.on("keydown click focus keyup", function(t) {
			var i = e("#js-fans-barrage>a.fans-barrage-btn");
			if ("chat-color" == i.attr("data-status") || (i = e("#js-color-barrage>a.c-btn")), e(this).css("color", i.css("color")), document.selection) {
				var a = document.selection.createRange(),
					n = document.body.createTextRange(),
					s = 0;
				for (n.moveToElementText(this); n.compareEndPoints("StartToStart", a) < 0; s++) n.moveStart("character", 1);
				c.cursurPosition = s
			} else c.cursurPosition = this.selectionStart
		}).on("keypress", function(e) {
			return 13 === e.which ? (c.currentVal = this.value, u.sendMsg(), !1) : void 0
		}).on("input propertychange", function() {
			this.value.length >= this.maxLength && (this.value = this.value.substr(0, this.maxLength))
		}).on("blur", function() {
			"" === e(this).val() && e(this).css("color", c.defval)
		}), "" === d.$content.val() && d.$content.css("color", c.defval)
	}, p.init = function() {
		r.reg("room_data_chatinit", function(e) {
			var a = i.decode(e).too(),
				s = t.fire("mod.center.userrole.get"),
				r = parseInt(a.maxl, 10);
			s.isAnchor() || s.isSuperAdmin() ? d.$content.prop({
				maxLength: 200
			}) : n.get("sys.uid") == a.uid && d.$content.prop({
				maxLength: r
			}), a.fcd && a.fcd > 0 && u.interval(parseInt(a.fcd / 1e3, 10)), c.cdTime = a.cd / 1e3
		}), r.reg("room_data_reg", function(e) {
			if (!t.fire("mod.chat.cmd.check", e)) {
				if (!s.check()) return s.show("reg"), void r.exe("js_sendhandler", [2, ""]);
				var a = [{
					name: "content",
					value: e.replace(/\\/g, "\\\\")
				}, {
					name: "sender",
					value: n.get("sys.uid")
				}];
				r.exe("js_sendmsg", i.encode(a)), d.$content.val(""), c.cdTime > 0 && u.interval(), t.trigger("activity.danmuh5.firstmsg"), r.exe("js_sendhandler", [0, c.cdTime])
			}
		}), t.on("mod.room.userrole.get", function(e) {
			c.userRole = e, u.fansSpeakCheck()
		}), t.on("mod.room.user.fansMedal.info", function(e) {
			c.hasFansMedal = parseInt(e.is_cbdg, 10) || 0, u.fansSpeakCheck()
		}), t.on("mod.anthor.setFansSpeak.get", function(e) {
			c.isSetFansSpeak = parseInt(e.soff, 10) || 0, u.fansSpeakCheck()
		}), r.reg("room_data_handler", function(e) {
			var t = i.decode(e).too();
			"speakOnlyFans" === t.type && (c.isSetFansSpeak = parseInt(t.soff, 10) || 0, u.fansSpeakCheck())
		})
	}, {
		init: function() {
			d.init(), f.init(), p.init()
		}
	}
}), define("douyu/page/room/normal/mod/chat-user-card", ["jquery", "shark/observer", "shark/util/cookie/1.0", "shark/util/lang/1.0", "shark/util/flash/data/1.0", "douyu/context", "douyu/com/user", "douyu/com/avatar", "douyu/page/room/base/api", "shark/util/template/1.0", "douyu/page/room/normal/mod/chat-user-manager", "douyu/page/room/normal/mod/get-medal-config"], function(e, t, i, a, n, s, r, o, l, c, d, u) {
	var f = {},
		p = ["9", "10", "11", "12", "15", "16", "17", "18", "26"],
		m = s.get("sys.yubaDomain") || "",
		h = null,
		g = null,
		v = !1,
		y = !1,
		b = null,
		k = null,
		w = {
			girlReqstu: !1
		},
		_ = 0,
		x = !0,
		C = 120,
		T = {
			init: function() {
				t.on("crazy.fans.config.data", function(e) {
					f = e
				});
				var i = s.get("sys.uid"),
					a = s.get("sys.groupid"),
					n = this;
				v = i == s.get("room.owner_uid"), y = 5 == a, h = e("#js-live-room-normal-right .chat"), n.bindEvent(), l.reg("room_data_setadm", function() {
					b && b.trigger("click")
				})
			},
			subPoint: function(e, t) {
				try {
					DYS.sub({
						action_code: e,
						ext: t || {}
					})
				} catch (i) {}
			},
			bindEvent: function() {
				var i = this,
					a = s.get("sys.uid"),
					n = {
						maxLevel: C
					};
				e(document).on("click", ".js-nick", function(r) {
					r.stopPropagation();
					var o = b = e(this),
						l = o.closest('.jschartli, [data-rel="user-info"]'),
						c = o.attr("rel") || 0,
						d = o.attr("clt") || 0,
						m = o.attr("gid") || 0,
						g = parseInt(o.attr("is-show-super-icon"), 10),
						v = l.data("level"),
						y = l.attr("data-anchor-level"),
						k = o.parents(".jschartli").find("[chatid]"),
						_ = k.attr("chatid"),
						x = o.data("invisiblenick") || o.text(),
						C = o.data("noble") || 0,
						T = o.data("invisible") || 0,
						S = a == c,
						I = o.data("ranktype"),
						j = l.attr("data-fansMedal-lev") || 0,
						$ = l.attr("data-fansMedal-nick") || 0,
						D = t.fire("mod.center.usergroup.get", c),
						L = e.inArray(d, p) >= 0 ? "" : o.attr("avatar"),
						R = "";
					if (t.trigger("douyu.avatar.url", L, "middle", function(e) {
						R = e
					}), i.destroy(), !a || "" == a || !D) return !1;
					if (x = x.replace(/[\:\：]$/, ""), n = e.extend(n, {
						nickname: x,
						encodeNickname: encodeURI(x),
						isMobileUser: 1 == d || 2 == d,
						isAnchor: s.get("room.owner_uid") == c,
						isThirdParty: e.inArray(d, p) >= 0,
						isRoomAdmin: 4 == D.rg,
						isSuperAdmin: 5 == m,
						levelClass: i.returnUlevelClass(v) + " " + i.imgSize(v) + " " + i.imgType(v) || "",
						level: parseInt(v, 10),
						ol: parseInt(y, 10),
						chatid: _,
						isShowSuperIcon: g,
						rel: c,
						clt: d,
						gid: m,
						avatar: R,
						girlPrivilege: 0,
						noble: parseInt(C, 10),
						invisible: T,
						isSelf: S,
						ranktype: I,
						nobleConfig: s.get("room.nobleConfig"),
						resourceUrl: s.get("sys.resource_url"),
						fansMedalLev: j,
						fansMedalNick: $,
						fansMedal: f || {},
						roomId: s.get("room.room_id"),
						returnMedalComponent: u.returnMedalComponent,
						followText: "关注",
						followStatus: 0
					}), i.renderReport({
						chatid: _,
						rel: c,
						clt: d,
						gid: m,
						data: n,
						nickname: x,
						avatar: L
					}), S || e.get("/wgapi/livenc/follow/query", {
						dstUid: c
					}, function(t) {
						if (0 === t.code && t.data) {
							var i = t.data[c] || 0,
								a = 1 === i ? "已关注" : "关注";
							e(".user-card-action [data-fuid=" + c + "]").data("follow", i).text(a), n.followText = a, n.followStatus = i
						}
					}), 0 === +C) {
						if (w.girlReqstu) return;
						return w.girlReqstu = !0, void e.ajax({
							url: "/member/female_privilege/get_privilege_status",
							dataType: "json",
							type: "GET",
							data: {
								uid: c
							}
						}).done(function(s) {
							w.girlReqstu = !1;
							var r = s.data;
							r && +r.is_receive && (e.extend(!0, n, {
								girlPrivilege: 1
							}), t.trigger("dys", {
								key: "dys.room.girl.show.card"
							})), i.render(h, n), a != c && a && "" != a || e(".user-card-action").remove(), i.countActionItem()
						})
					}
					i.render(h, n), a != c && a && "" != a || e(".user-card-action").remove(), i.countActionItem()
				}).on("click", ".chat-user-card-holder", function(e) {
					e.stopPropagation()
				}).on("click", "[data-type='closecard']", function() {
					i.destroy()
				}).on("click", function() {
					i.destroy()
				}).on("click", '[data-type="toreport"]', function(e) {
					e.stopPropagation(), i.showReport(), i.destroy()
				}).on("click", ".user-report-close", function() {
					i.destroyReport()
				}).on("click", '[data-type="sendletter"]', function(i) {
					var a = e(this),
						n = a.attr("rel");
					i.preventDefault(), i.stopPropagation(), t.trigger("mod.room.privateLetter.open", n);
					var s = a.closest("[data-noblelvl]").data("noblelvl") || 0;
					t.trigger("dys", {
						key: "dys.room.username.click",
						type: 3,
						r_type: 3,
						level: s
					})
				}).on("click", '[data-type="opennoble"]', function(a) {
					t.trigger("mod.normal.noble.buy"), i.destroy(), b = null;
					var n = e(this),
						s = n.closest("[data-noblelvl]").data("noblelvl") || 0;
					if (t.trigger("dys", {
						key: "dys.room.username.click",
						type: 4,
						r_type: 4,
						level: s
					}), 1 === n.data("mistery")) {
						var r = n.data("uid"),
							o = n.data("ranktype"),
							l = "";
						l = "all" === o ? "click_msg_sendlist_all_buynoble" : "click_msg_sendlist_wk_buynoble", i.subPoint(l, {
							sid: r
						})
					} else i.subPoint("click_usercard_open")
				}).on("click", ".js-card-follow", function(a) {
					var n = e(this),
						s = n.closest("[data-noblelvl]").data("noblelvl") || 0;
					t.trigger("dys", {
						key: "dys.room.username.click",
						type: 5,
						r_type: 5,
						level: s
					});
					var r = n.data("fuid"),
						o = n.data("follow") ? 0 : 1;
					i.followUser(r, o, this)
				})
			},
			followUser: function(t, i, a) {
				var n = 1 === i ? "关注" : "取消关注",
					s = i ? "/wgapi/livenc/follow/add" : "/wgapi/livenc/follow/cancel",
					r = {
						dstUid: t
					};
				this.getCSRFCookie(function(t, o) {
					r[t] = o, e.ajax({
						url: s,
						dataType: "json",
						type: "post",
						data: r,
						success: function(t) {
							0 === t.code ? (e(a).data("follow", i).text(1 == i ? "已关注" : "关注"), e.dialog.tips_black(n + "成功")) : e.dialog.tips_black(t.msg || n + "关注失败")
						},
						error: function() {
							e.dialog.tips_black("网络错误，稍后再试！")
						}
					})
				})
			},
			countActionItem: function() {
				var t = e(".girl--privilege .user-card-action .action-item"),
					i = 0;
				t.length && (t.each(function(t, a) {
					e(a).is(":visible") && i++
				}), i > 4 ? e(".chat-user-card-wrap.girl--privilege").css("background-size", "310px 213px") : e(".chat-user-card-wrap.girl--privilege").css("background-size", "310px 187px"))
			},
			showMassageTip: function() {
				e(".cuch-massage-tip").css("display", "block"), setTimeout(function() {
					e(".cuch-massage-tip").hide(), x = !0
				}, 2e3)
			},
			render: function(i, a) {
				var n, s, r = this,
					o = t.fire("mod.center.userrole.get");
				a.isNormalCard = o.isAnchor() || o.isSuperAdmin() || a.isSelf || !a.invisible, n = a.isNormalCard ? r.getCardTmpl() : r.getMysteryCardTmpl(), s = c.compile(n), g && g.remove(), g = e(s(a)), i.append(g), d.init(), g.on("click", "[data-yuba-jump]", this.jumpToYuba)
			},
			jumpToYuba: function() {
				var t = e(this).data("uid");
				m && T.jsJumpPage(m + "fe/uriredirect?page=userpage&id=" + t)
			},
			jsJumpPage: function(t, i) {
				var a = i || "_blank",
					n = document.createElement("a");
				n.setAttribute("href", t), n.setAttribute("target", a), document.body.appendChild(n), n.click(), e(n).remove()
			},
			getMysteryCardTmpl: function() {
				return ['<div class="chat-user-card-holder">', '<div class="status--mistery">', '<div class="noble--error">', '<a class="noble-error--close" href="javascript:;" data-type="closecard">×</a>', '<div class="nobel-error--main">', '<i class="nobel-error--icon"></i>', '<div class="error-main--content">', '<h3 class="content--title">我是神秘人，猜猜我是谁？</h3>', "<p>贡献榜隐身—国王以上贵族专属特权</p>", '<a class="btn" href="javascript:;" data-ranktype="<%= ranktype %>" data-mistery="1" data-type="opennoble" data-uid="<%= rel %>">开通贵族</a>', "</div>", "</div>", "</div>", "</div>", "</div>"].join("")
			},
			getCardTmpl: function() {
				return ['<% if (noble) {var nobleClass="status--noble";} %>', '<% if (invisible) {var invisibleClass="status--invisible";} %>', '<% if (girlPrivilege) {var girlClass = "girl--privilege";} %>', '<div class="chat-user-card-holder">', "<% if (nobleClass) { %>", '<div class="chat-user-card-wrap <%= nobleClass %> <%= invisibleClass %> lv--<%= noble %>">', "<% } else { %>", '<div class="chat-user-card-wrap <%= invisibleClass %> <%= girlClass %>">', "<% } %>", '<a class="card-close" href="javascript:;" data-type="closecard">×</a>', '<div class="chat-user-card">', '<div class="user-card-main clearfix">', '<div class="user-card-widget-tl"></div>', '<div class="user-card-widget-br"></div>', '<div class="user-card-avatar" data-card="avatar" data-yuba-jump="<%= isNormalCard ? 1 : 0 %>" data-uid="<%=rel%>">', '<img src="<%=avatar%>"/>', "<%if (!isNormalCard){%>", '<div class="invisible-mask">', '<div class="icon--invisible"></div>隐身', "</div>", "<%}%>", '<div class="user-card-avatar-cover" ></div>', "</div>", '<div class="user-card-title">', "<h1 ", "<%if (isSuperAdmin){%>", 'class="sa"', "<%}%>", '><span class="user-card-name" data-yuba-jump="<%= isNormalCard ? 1 : 0 %>" data-uid="<%=rel%>"><%=nickname%></span></h1>', '<strong class="user-card-badge">', "<span>", "<%if (isSuperAdmin && isShowSuperIcon){%>", '<img class="user-role" src="' + s.get("sys.web_url") + '/app/douyu/res/page/room-normal/super_admin.png?v=20170627">', "<%}else if(isRoomAdmin){%>", '<img class="user-role" src="' + s.get("sys.web_url") + '/app/douyu/res/page/room-normal/roomadmin.png?v=20170627">', "<%}%>", "<% if ( noble && nobleConfig[noble] ) { %>", '<img class="user-noble" src="<%= resourceUrl %><%= nobleConfig[noble].symbol.web_symbol_pic2 %>" title="<%= nobleConfig[noble].symbol.name %>" />', , "<% } %>", "<% if (fansMedalLev && fansMedalNick && !isSuperAdmin) { %>", "<%=# returnMedalComponent({roomId: roomId, medalLev: fansMedalLev, medalNick: fansMedalNick}) %>", "<% } %>", , "<%if (!isSuperAdmin&&!isThirdParty&&level){%>", "<% if(ol > 0){%>", '<span class="anchor-level-icon" data-anchor-levelimg="<%= ol %>">', "<%} else {%>", '<span class="user-level <%= levelClass %>  <%if(level<10){%> lve-icon-1to9 <%}%> ">', "</span>", "<%}%>", "<%}%>", "</span>", "<%if(isSuperAdmin && isShowSuperIcon){%>", "<strong>斗鱼官方管理员</strong>", "<%}%>", "</strong>", "</div>", "</div>", '<div class="user-card-action">', '<div class="user-card-action-inr" data-noblelvl="<%= noble %>">', "<%if(isSuperAdmin){%>", '<a class="action-item" target="_blank" href="https://kefu.douyu.com">联系客服</a>', '<a class="action-item" target="_blank" href="/member/message/release">意见反馈</a>', '<a class="action-item" target="_blank" href="http://weibo.com/u/3982726153">官方微博</a>', '<a class="action-item" target="_blank" href="http://qm.qq.com/cgi-bin/qm/qr?k=1RlH3lAF3a1ietQ3Luxd1DMOEouVyvJx">官方Q群</a>', "<%}else{%>", '<a class="action-item" data-type="toreport"', 'clt="<%=clt%>" rel="<%=rel%>" ', 'gid="<%=gid%>" chatid="<%=chatid%>" nickname="<%=nickname%>"', ">举报用户</a>", '<a class="action-item" data-type="shield" href="javascript:;">屏蔽用户</a>', '<a class="action-item" data-type="appoint" href="javascript:;">任命房管</a>', '<a class="action-item" data-type="mute" href="javascript:;">禁止发言</a>', '<a class="action-item" data-type="onekeyblack" href="javascript:;">一键封号</a>', "<%if(!isThirdParty){%>", '<a class="action-item" data-type="sendletter" href="/member/pm" rel="<%=rel%>" target="_blank"><span>发站内信</span></a>', "<%}%>", "<%if(!isSelf){%>", '<a class="action-item js-card-follow" ', ' href="javascript:;" ', ' data-fuid="<%=rel%>" ', ' style="width:48px" ', ' data-follow="<%=followStatus%>" >', "<span><%= followText %></span>", "</a>", "<%}%>", "<% if (girlPrivilege) { %>", '<a class="action-item font5 js-girl-right" data-type="girlPrivilege" href="javascript:;">小姐姐特权</a>', "<% } %>", "<%}%>", "<%if(noble){%>", '<a class="action-item" data-type="opennoble" href="javascript:;">成为贵族</a>', "<%}%>", '<a class="action-item" data-type="barrageRecord" data-avatar="<%=avatar%>" data-nickname="<%=nickname%>" href="javascript:;">弹幕记录</a>', "</div>", "</div>", "</div>", "</div>", '<span class="cuch-massage-tip">10级以上才可以发站内信噢</span>', "</div>"].join("")
			},
			returnUlevelClass: function(e) {
				var t = 120,
					i = "";
				return i = e ? a.string.format("{0}{1}", "level-", t + 1 > e ? e : t) : "level-next-1"
			},
			imgType: function(e, t) {
				var i = "";
				return i = e >= 70 ? "" : "level-bgpng", t && (i = "level-bgpng"), i
			},
			imgSize: function(e) {
				var t = "";
				return t = e >= 100 ? "level-size2" : " level-size1"
			},
			getReportTmpl: function() {
				return ['<div class="chat-user-card-holder">', '<div class="user-report-dialog"  data-type="user-manager-group"', 'clt="<%=clt%>" rel="<%=rel%>" avatar="<%=avatar%>"', 'gid="<%=gid%>" chatid="<%=chatid%>" nickname="<%=nickname%>" data-noblelvl="<%= data.noble %>"', ">", '<div class="user-report-dialog-title">', "举报用户", '<a class="user-report-close" href="javascript:;">×</a>', "</div>", '<div class="user-report-dialog-content">', '<span class="user-report-menu" >', '<a data-rept="2" data-type="report" href="javascript:;">举报头像</a>', '<a data-rept="0" data-type="report" href="javascript:;">举报弹幕</a>', '<a data-rept="1" data-type="report" href="javascript:;">举报昵称</a>', "</span>", "</div>", "</div>", "</div>"].join("")
			},
			renderReport: function(t) {
				var i = this;
				i.destroyReport();
				var a = i.getReportTmpl(),
					n = c.compile(a);
				k && k.remove(), k = e(n(t)), h.append(k)
			},
			destroyReport: function() {
				k && k.remove()
			},
			showReport: function() {
				k && k.addClass("active")
			},
			destroy: function() {
				g && (g.remove(), g.off("click", "[data-yuba-jump]", this.jumpToYuba))
			},
			getCSRFCookie: function(t) {
				var a = i.get(s.get("sys.tvk")),
					n = s.get("sys.tn"),
					r = e.isFunction(t) ? t : function() {};
				return a ? void r(n, a) : void e.ajax({
					url: "/curl/csrfApi/getCsrfCookie",
					type: "GET",
					dataType: "json",
					success: function(e) {
						0 === e.error && T.getCSRFCookie(r)
					}
				})
			}
		};
	return t.on("mod.userinfo.currentLevel", function(e) {
		_ = e
	}), {
		init: function() {
			T.init()
		}
	}
}), define("douyu/page/room/normal/mod/chat-msg-roll", ["jquery", "shark/observer"], function(e, t) {
	var i = {},
		a = {};
	return i.init = function() {
		i.$chatCont = e("#js-chat-cont"), i.$chatCls = i.$chatCont.find('[data-type="chat-cls"]'), i.$chatCont.find('[data-type="roll"]').find("span").text("解锁")
	}, a.init = function() {
		i.$chatCont.on({
			mouseenter: function() {
				i.$chatCls.removeClass("hide")
			},
			mouseleave: function() {
				i.$chatCls.addClass("hide")
			}
		}).on("click", '[data-type="roll"]', function() {
			var i = e(this),
				a = 0;
			i.hasClass("c-scr") ? (i.removeClass("c-scr").find("span").text("锁屏"), a = 2, t.trigger("mod.chat.locker.release")) : (i.addClass("c-scr").find("span").text("解锁"), a = 1), t.trigger("mod.chat.msg.setroll.chat", a), t.trigger("dys", {
				key: "dys.room.barrage.setting.scroll",
				stat: a
			})
		}).on("click", '[data-type="clear"]', function() {
			t.trigger("mod.chat.msg.clear.chat"), t.trigger("mod.chat.locker.release"), t.trigger("dys", {
				key: "dys.room.barrage.setting.clear"
			})
		})
	}, {
		init: function() {
			i.init(), a.init()
		}
	}
}), define("douyu/page/room/normal/mod/chat-gift", ["jquery", "shark/observer", "shark/util/flash/data/1.0", "douyu/context", "douyu/com/get-gift-configs", "douyu/page/room/base/api", "douyu/page/room/normal/mod/gift/constants", "douyu/page/room/normal/mod/gift/app"], function(e, t, i, a, n, s, r, o) {
	var l = {
		status: {
			isFirstEnter: 1,
			treasureInit: !0,
			isBannerInit: !0
		},
		init: function() {
			var e = a.get("sys.web_url") + "app/douyu/res/page/room-normal/gift/";
			this.config = {
				webUrl: e,
				userId: "" + a.get("sys.uid"),
				anchorId: "" + a.get("room.owner_uid"),
				giftHeights: [54, 76, 88],
				nobleHeights: {
					7: 78,
					1: 96,
					2: 106,
					3: 106,
					4: 106,
					5: 106,
					6: 106
				},
				chouqinConfig: {}
			}, this.bindEvents()
		},
		extendGiftConfig: function(t) {
			var i = this,
				a = i.config;
			a.giftConfigs = {}, e.extend(!0, a.giftConfigs, t, {
				"cq-1": {
					ef: 0,
					devote: 150,
					bimg: a.webUrl + "chouqin_1.gif?v=20160322",
					himg: "",
					name: "初级酬勤",
					stay_time: 1e4
				},
				"cq-2": {
					ef: 0,
					devote: 300,
					bimg: a.webUrl + "chouqin_2.gif?v=20160322",
					himg: "",
					name: "中级酬勤",
					stay_time: 2e4
				},
				"cq-3": {
					ef: 0,
					devote: 500,
					bimg: a.webUrl + "chouqin_3.gif?v=20160322",
					himg: "",
					name: "高级酬勤",
					stay_time: 3e4
				},
				older100Balls: {
					ef: 0,
					devote: 1,
					bimg: a.webUrl + "mobile-bg-100.png?v=20160322",
					himg: a.webUrl + "mobile-head-100.png?v=20160322",
					name: "鱼丸",
					stay_time: 1e3
				}
			})
		},
		bindEvents: function() {
			var e = this;
			s.reg("room_data_gift", function(t) {
				n.load().done(function(i) {
					e.extendGiftConfig(i), e.handleOldBall(t)
				})
			}), s.reg("room_data_handler", function(e) {
				var a = i.decode(e).too();
				"msrpn" === a.type && t.trigger(r.NOBLE_TREASURE_BOX, a)
			}), t.on("mod.chat.gift.call", function(t) {
				n.load().done(function(i) {
					e.extendGiftConfig(i), e.handleEnterRoom(t)
				})
			}), s.reg("room_data_giftaghl", function(a) {
				if (e.status.isBannerInit) {
					e.status.isBannerInit = !1;
					var s = i.decode(a).too();
					"aghl" == s.type && n.load().done(function(i) {
						if (e.extendGiftConfig(i), s.glist) {
							var a = e.getGiftBannerDatas(s.glist);
							t.trigger(r.GiFT_BANNER_LIST, a)
						}
					})
				}
			}), s.reg("room_data_giftbat1", function(t) {
				n.load().done(function(i) {
					e.extendGiftConfig(i), e.handleNormalGift(t)
				})
			}), s.reg("room_data_login", function(e) {
				var n = {},
					s = 0;
				(a.get("sys.uid") || a.get("sys.username")) && (n = i.decode(e).too(), "0" === n.ps && (s = 1), t.trigger(r.IS_LOGIN_CONTROLLER, s))
			}), s.reg("room_user_ban", function(e) {
				var a = i.decode(e).too();
				"ban_user" === a.type && a.uid && t.trigger(r.GIFT_SENDER_IS_BAN, a.uid)
			}), s.reg("room_data_handler", function(a) {
				var n, s = i.decode(a).too(),
					r = s.type,
					o = [],
					l = 0,
					c = {};
				switch (r) {
				case "tsboxb":
					t.trigger("room.gift.treasure.data.entry", s);
					break;
				case "tslist":
					if (!e.status.treasureInit) return;
					if (e.status.treasureInit = !1, !s.list) return;
					for (n = i.isArray(s.list) ? i.decode(s.list) : [{
						value: s.list
					}], l = 0; l < n.length; l++) c = n[l], c && c.value && (c = i.decode(c.value).too(), o.push(c));
					t.trigger("room.gift.treasure.data.entry", {
						type: s.type,
						list: o,
						startTime: s.tm || parseInt((new Date).getTime() / 1e3, 10)
					});
					break;
				case "tsgs":
					t.trigger("room.gift.treasure.data.draw", s)
				}
			})
		},
		handleChouqin: function(e) {
			var a = this.config.giftConfigs,
				n = i.decode(e).too(),
				s = i.decode(n.sui).too(),
				o = a["cq-" + n.lev],
				l = {
					uid: s.id,
					nn: s.nick,
					gfid: "cq-" + n.lev,
					gs: [8, 9, 10][n.lev - 1],
					hits: n.hits
				};
			t.fire("mod.chat.msg.shield").allGift && n.sid != this.config.userId || o && t.trigger(r.GET_GIFT_DATA, {
				giftData: l,
				giftConfig: o,
				giftType: "giftCQ"
			})
		},
		handleOldBall: function(e) {
			var a, n = this.config.giftConfigs,
				s = this,
				o = i.decode(e).too(),
				l = i.decode(o.sui).too(),
				c = n.older100Balls,
				d = {
					uid: l.id,
					nn: l.nick,
					gfid: "older100Balls",
					gs: 1,
					hits: o.hc
				};
			t.fire("mod.chat.msg.shield").allGift && l.id != s.config.userId || "donateres" === o.type && "0" === o.r && c && (t.trigger(r.GET_GIFT_DATA, {
				giftData: d,
				giftConfig: c
			}), a = s.giftBatterMsgShow({
				pushResult: o
			}), a || t.trigger("mod.chat.msg.gift", e))
		},
		handleEnterRoom: function(e) {
			var i = this;
			if ("memberinfores" === e.type) {
				if (t.trigger("mod.room.chat.gift.noble.info", {
					nl: parseInt(e.nl, 10) || 0,
					npl: parseInt(e.npl, 10) || 0,
					npts: parseInt(e.npts, 10) || 0,
					ncp: parseInt(e.ncp, 10) || 0,
					ih: parseInt(e.ih, 10) || 0,
					iha: parseInt(e.iha, 10) || 0,
					nhp: parseInt(e.nhp, 10) || 0,
					nets: parseInt(e.nets, 10) || 0
				}), !i.status.isFirstEnter) return;
				e.nblist && i.handleNobleBannerDatas(e.nblist), i.status.isFirstEnter = 0
			}
		},
		handleNobleBannerDatas: function(e) {
			var n = this,
				s = [],
				o = 0,
				l = a.get("room.nobleConfig");
			s = e.split("/|/"), o = s.length, l && t.fire("room.get.noble.effect.config").done(function(e) {
				var a = 0,
					c = null,
					d = [],
					u = null,
					f = null,
					p = 0;
				if (e) {
					for (; o > a; a++)"" !== s[a] && (c = i.decode(s[a]).too(), p = c.nl, p && (u = e[p], f = l[p], u && f && d.push({
						effectType: "noble",
						senderId: c.uid || "",
						giftId: c.nl,
						senderName: c.unk,
						giftName: f.noble_name,
						bannerStayTime: 1e3 * c.ltc || 0,
						styleNumber: c.nl,
						bannerBgImg: u.pc_bg,
						bannerGiftImg: u.pc_pic,
						bannerSenderNameColor: u.text_color1,
						bannerGiftNameColor: u.text_color2,
						contribution: u.display_rank || 0,
						bannerHeight: n.config.nobleHeights[p]
					})));
					t.trigger(r.GiFT_BANNER_LIST, d)
				}
			})
		},
		getGiftBannerDatas: function(e) {
			var t, n, s = this,
				r = [],
				o = 0,
				l = 0,
				c = null,
				d = [],
				u = this.config.giftConfigs,
				f = u.bimg,
				p = {};
			if (r = e.split("/|/"), o = r.length, f) {
				var m = f.room || {},
					h = f.tag || {},
					g = f["default"] || {},
					v = a.get("room.room_id"),
					y = a.get("room.cate_id");
				m[v] ? p = m[v] || {} : h[y] ? p = h[y] || {} : g && (p = g || {})
			}
			for (; o > l; l++) if ("" !== r[l] && (c = i.decode(r[l]).too(), c.gid && (t = u[c.gid]))) {
				var b;
				if (f && f.threshold) {
					var k = t.type;
					1 == k ? b = f.threshold.ywsw : 2 == k && (b = f.threshold.ycsw)
				}
				var w = c.gfcnt || 1,
					_ = t.pc * (w || 1) || 0,
					x = s.getPriceIndex(_, b) || 0,
					C = s.config.giftHeights[x];
				n = p.src || [], d.push({
					senderId: c.sid || "",
					giftId: c.gid,
					senderName: c.snk,
					giftName: t.name,
					hitTimes: c.hs || 1,
					bcnt: c.hs || 1,
					gfcnt: c.gfcnt || 1,
					bannerStayTime: 1e3 * c.bst || 0,
					styleNumber: c.gs || 0,
					bannerSrc: n,
					threshold: b,
					bannerBgImg: t.bimg,
					bannerGiftImg: t.himg,
					bannerGiftBorderColor: t.brgb,
					bannerSenderNameColor: t.urgb,
					bannerWordColor: t.drgb,
					bannerGiftNameColor: t.grgb,
					contribution: t.devote || 0,
					bannerHeight: C,
					nickNameColor: p.nc ? "#" + p.nc : "#ffffff",
					giftNameColor: p.gnc ? "#" + p.gnc : "#ffffff",
					otherColor: p.oc ? "#" + p.oc : "#ffffff",
					price: t.pc || 0
				})
			}
			return d
		},
		getPriceIndex: function(e, t) {
			var i = 0;
			if (t && t.length > 0) for (var a = 0; a < t.length; a++) parseInt(e, 10) >= parseInt(t[a], 10) && (i = a + 1);
			return i
		},
		getTreasureDatas: function(e) {
			var t, a = [],
				n = 0,
				s = [],
				r = 0;
			for (a = a.concat(e.list.split("/|/")), a = a.concat(e.listn.split("/|/")), a = a.concat(e.listt.split("/|/")), n = a.length; n > r; r++)"" !== a[r] && (t = i.decode(a[r]).too(), "6" !== t.rpt && "9" !== t.rpt && s.push(t));
			return s
		},
		handleNormalGift: function(a) {
			var n, s, o, l = this,
				c = this.config,
				d = c.userId,
				u = c.giftConfigs,
				f = i.decode(a).too(),
				p = f.type,
				m = -1,
				h = c.anchorId;
			if (p) {
				if (d === h) {
					if ("dgb" === p) return
				} else if ("bgd" === p) return;
				if (f.gfid && (f.sid !== d && f.uid !== d || t.trigger("mod.gift.exp.up", {
					gid: f.gfid,
					silver: f.sb
				})), !f.dw || "dgn" !== p && "dgb" !== p && "bgd" !== p || t.trigger("mod.titleinfo.change", {
					weight: f.dw
				}), "dsgr" === p) {
					if ("0" === f.r) t.trigger("mod.userinfo.change", {
						current: {
							silver: f.sb
						}
					}), t.trigger("room.giftprop.send.success.land", f.gfid);
					else {
						if ("283" === f.r) return void t.trigger("mod.gift.yw.res", a);
						if (f.errstr && f.errstr.length > 0) return void e.dialog.tips_black(f.errstr, 1.5)
					}
					t.trigger("mod.gift.yw.res", a)
				}
				if ("ggbb" === p && (t.trigger(r.GIFT_GET_LUCYKING, {
					giftData: f
				}), t.trigger("mod.chat.msg.gift", a, u)), f.gfid && (n = u[f.gfid], s = u.bimg || {}, n)) {
					switch (m = n.ef, p) {
					case "dgb":
					case "bgd":
					case "donateres":
						f.uid === d && t.trigger("mod.gift.send.batter.update", {
							giftId: f.gfid,
							giftBatterTime: n.hit_interval
						}), 3 === m || 4 === m || 5 === m ? 1 === +f.imd && t.trigger(r.GET_GIFT_DATA, {
							giftData: f,
							giftConfig: n,
							bimg: s
						}) : t.trigger(r.GET_GIFT_DATA, {
							giftData: f,
							giftConfig: n,
							bimg: s
						})
					}
					if (3 === m || 4 === m || 5 === m) {
						if (1 === +f.imd) {
							if (o = l.giftBatterMsgShow({
								pushResult: f
							})) return;
							t.trigger("mod.chat.msg.gift", a, u)
						}
					} else {
						if (o = l.giftBatterMsgShow({
							pushResult: f
						})) return;
						t.trigger("mod.chat.msg.gift", a, u)
					}
				}
			}
		},
		giftBatterMsgShow: function(e) {
			var t, i = this.config,
				a = i.giftConfigs,
				n = e.pushResult,
				s = a[n.gfid];
			if (!s) return !1;
			var r = n.gfcnt || 1;
			if (t = s.devote / 10 * r, 1 >= t) {
				if (!n.hits || n.hits <= 1) return !1;
				if (n.gfcnt > 1) {
					if (n.bcnt > 0 && n.bcnt % 10 === 0 || 1 == n.bcnt) return !1
				} else if (n.hits > 1 && n.hits % 10 === 0) return !1;
				return !0
			}
			return !1
		}
	};
	return {
		init: function() {
			l.init()
		}
	}
}), define("douyu/page/room/normal/mod/chat", ["jquery", "shark/observer", "douyu/page/room/base/api", "douyu/page/room/normal/mod/chat-fans", "douyu/page/room/normal/mod/chat-exp", "douyu/page/room/normal/mod/chat-color", "douyu/page/room/normal/mod/chat-shield", "douyu/page/room/normal/mod/chat-msg", "douyu/page/room/normal/mod/chat-cmd", "douyu/page/room/normal/mod/chat-link-barrage", "douyu/page/room/normal/mod/chat-send", "douyu/page/room/normal/mod/chat-user-card", "douyu/page/room/normal/mod/chat-msg-roll", "douyu/page/room/normal/mod/chat-gift"], function(e, t, i, a, n, s, r, o, l, c, d, u, f, p) {
	var m = {
		blackList: []
	};
	return t.on("mod.chat.blackList.set", function(e) {
		void 0 !== e && m.blackList.push(String(e))
	}), t.on("mod.chat.blackList.get", function(t) {
		return {
			list: m.blackList,
			index: void 0 === t ? 0 : e.inArray(String(t), m.blackList),
			length: m.blackList.length
		}
	}), t.on("mod.chat.blackList.del", function(t) {
		void 0 !== t && m.blackList.splice(e.inArray(t, m.blackList), 1)
	}), {
		init: function() {
			a.init(), n.init(), s.init(), r.init(), o.init(), l.init(), c.init(), d.init(), u.init(), f.init(), p.init()
		}
	}
}), define("douyu/page/room/normal/mod/fans-medal-set2", ["jquery", "shark/class", "shark/observer", "shark/util/lang/1.0", "shark/util/cookie/1.0", "shark/util/storage/1.0", "shark/util/flash/data/1.0", "shark/util/template/2.0", "douyu/context", "douyu/com/user", "douyu/page/room/base/api", "douyu/page/room/normal/mod/get-medal-config", "douyu/com/room-gift-tmp"], function(e, t, i, a, n, s, r, o, l, c, d, u, f) {
	var p = {},
		m = {
			isPaladinWeek: l.get("colligate.activitySwitch.rangePromotion"),
			dropingDialogFlag: "dropingDialogShow",
			dropingListFlag: "dropingMedalList",
			medalListPushState: 0,
			dropingDialogSwitch: 0,
			newDropingMedal: [],
			filterDropingMedal: [],
			dropingFansMedal: [],
			fansRequestState: 0,
			fansListDataState: 0,
			fansFirstPayTask: 71,
			searchProgress: 0,
			storageExpired: 2592e3,
			defaultAvatar: {
				left: l.get("sys.web_url") + "/app/douyu/res/page/room-normal/fans/dialog_img_2.png",
				center: l.get("sys.web_url") + "/app/douyu/res/page/room-normal/fans/dialog_img_1.png",
				right: l.get("sys.web_url") + "/app/douyu/res/page/room-normal/fans/dialog_img_3.png"
			},
			fansSpecialUrl: "http://www.douyu.com/t/fans",
			personMedalUrl: "/member/cp/getFansBadgeList",
			firstRechargeUrl: "/task/firstpaytask/" + l.get("room.room_id"),
			medalLevel: [1, 6, 11, 16, 21, 26, 30],
			fansNick: "粉丝",
			removeMedalID: "",
			ruPos: "",
			opearMedalType: "",
			levelMap: {
				packName: "弱鸡",
				key: ["粉丝等级", "粉丝礼包", "每日亲密上限", "每日亲密度衰减"],
				list: [
					[1, 10, 500, 25],
					[2, 10, 500, 25],
					[3, 10, 500, 25],
					[4, 15, 500, 25],
					[5, 15, 500, 25],
					[6, 15, 1e3, 50],
					[7, 20, 1e3, 50],
					[8, 25, 1e3, 50],
					[9, 30, 1e3, 50],
					[10, 35, 1500, 75],
					[11, 40, 1500, 75],
					[12, 45, 1500, 75],
					[13, 50, 1500, 75],
					[14, 50, 1500, 75],
					[15, 50, 2e3, 100],
					[16, 60, 2e3, 100],
					[17, 60, 2e3, 100],
					[18, 60, 2e3, 100],
					[19, 70, 2e3, 100],
					[20, 70, 2500, 125],
					[21, 70, 2500, 125],
					[22, 80, 2500, 125],
					[23, 80, 2500, 125],
					[24, 80, 2500, 125],
					[25, 90, 2700, 135],
					[26, 90, 3e3, 240],
					[27, 90, 3500, 280],
					[28, 100, 4e3, 320],
					[29, 100, 4500, 360],
					[30, 100, 5e3, 400]
				]
			},
			medalNumLimit: 20,
			anchorMedalSwitch: l.get("room.is_set_fans_badge"),
			userMsgStatus: "",
			tipsTimer: "",
			tipsAutoTimer: "",
			medalListData: "",
			fansRankData: "",
			curMedalInfo: {},
			medalInfoStatus: 1,
			medalListStatus: 1,
			medalIntroductionStatus: 1,
			hoverEnterStatus: 0,
			fansRechargeStorage: "fansRechargeRemain",
			dpType: {
				medalEnter: "medalEnter",
				fansIntroduction: "fansIntroduction",
				medalListEnter: "medalListEnter",
				medalListSel: "medalListSel",
				myMedalEnter: "myMedalEnter"
			},
			roomId: l.get("room.room_id"),
			medalEnterStatus: {
				close: "medal-disable-btn",
				none: "medal-none-btn",
				notWear: "medal-not-btn",
				yesWear: "medal-yes-btn"
			},
			types: {
				fansRank: "frank",
				medalList: "blst",
				medalOpera: "obreq",
				medalGet: "gbi",
				medalUpdate: "synfim",
				medalUpdateCur: "synfimd",
				medalUpgrade: "blab",
				medalRankPos: "ru",
				medalOperaError: "obres",
				fansGift: "gg",
				firstFansGift: "frs",
				firstFansMsg: "frb"
			},
			urls: {
				searchAnchorInfo: "/fansbadge/fansbadge/getAnchorInfo"
			}
		},
		h = {
			eventDefault: function(e) {
				return e.stopPropagation(), e.preventDefault(), !1
			},
			returnType: function(e) {
				for (var t = [null, void 0], i = 0; i < t.length; i++) if (e == t[i]) return e;
				return Object.prototype.toString.call(e).slice(8, -1).toLowerCase()
			},
			medalLevel: function(e) {
				for (var t = 0, i = m.medalLevel.length, a = 0; i > t; t++) if (e < m.medalLevel[t]) {
					a = m.medalLevel[t - 1];
					break
				}
				return a ? a : m.medalLevel[m.medalLevel.length - 1]
			},
			getRestTime: function(e) {
				var t, i;
				return e = e ? parseInt(e, 10) : 0, t = new Date, t.setDate(t.getDate() + e), t.setHours(24), t.setMinutes(0), t.setSeconds(0), i = t.getTime() - (new Date).getTime()
			}
		},
		g = {
			init: function() {
				var t = this;
				i.on("crazy.fans.config.data", function(e) {
					p = e
				}), this.doms = {
					$container: e("#container"),
					$chatContent: e("#js-chat-cont"),
					$giftContent: e("#gift-content"),
					$sendMsgWarp: e("#js-send-msg"),
					$roomVideoWarp: e("#js-room-video")
				}, this.renderHtml = {
					medalContainerTemp: t.medalContainerRender(),
					medalEnterTemp: t.medalEnterRender(),
					medalContentWarpTemp: t.medalContentWarpRender(),
					medalContentTemp: t.medalContentRender(),
					medalTipTemp: t.medalTipRender(),
					medalMsgTemp: t.medalMsgRender(),
					medalListTemp: t.medalListRender(),
					fansGiftPackTemp: t.fansGiftPackRender(),
					firstRechargeMsgTemp: t.firstRechargeMsgRender(),
					firstRechargeTemp: t.firstRechargeRender(),
					firstRechargeFulfillTemp: t.firstRechargeFulfillRender(),
					fansRechargeEnterTemp: t.fansRechargeEnterRender(),
					dropingMedalsTemp: t.dropingMedalsRender()
				}, this.userInfo = {
					uid: l.get("sys.uid")
				}, m.dropingDialogFlag = m.dropingDialogFlag + "_" + this.userInfo.uid, m.dropingListFlag = m.dropingListFlag + "_" + this.userInfo.uid, this.fansRechargeLoginCheck(), this.medalLevMap(), this.medalSwitchCheck(), this.pushBind(), this.eventBind()
			},
			medalContainerRender: function() {
				var e, t;
				return e = a.string.join("{{ if !userCheck}}", '<div class="fans-entrance status-fansnologin" data-flag="medal-entrance-warp">', "{{ /if }}", "{{ if userCheck }}", '<div class="fans-entrance" data-flag="medal-entrance-warp">', "{{ /if }}", "</div>"), t = o.compile(e)
			},
			medalEnterRender: function() {
				var e, t;
				return e = a.string.join('{{ if status == "medal-yes-btn" }}', '<a class="entrance-btn" data-medal-id="{{ medalData.rid }}" data-action="medal-enter-btn" data-flag="{{ status }}" data-ui-level="{{ medalData.bl }}">', '<i class="entrance-btn-icon"></i>', "{{# returnMedalComponent({roomId: medalData.rid, medalLev: medalData.bl, medalNick: medalData.bnn}, medalData.vipfan, 3) }}", "</a>", "{{ /if }}", '{{ if status == "medal-disable-btn" || status == "medal-none-btn" || status == "medal-not-btn" }}', '<a class="entrance-btn status-nowear" data-action="medal-enter-btn" data-flag="{{ status }}">', '<i class="entrance-btn-icon"></i>', '{{ if status == "medal-disable-btn" || status == "medal-none-btn" }}', '<span class="fans-badge-icon fans-badge-unavailable">', '<span class="fans-icon-name"><i>未拥有</i></span>', "</span>", "{{ /if }}", '{{ if status == "medal-not-btn" }}', '<span class="fans-badge-icon fans-badge-unavailable">', '<span class="fans-icon-name"><i>未佩戴</i></span>', "</span>", "{{ /if }}", "</a>", "{{ /if }}"), t = o.compile(e)
			},
			medalContentWarpRender: function() {
				var e, t;
				return e = a.string.join("{{ if data.wf == 1 }}", '<div class="entrance-content status-nomedal fans-badge-second" style="display: none;" data-flag="medal-info-warp">', "{{ /if }}", "{{ if data.wf == 2 }}", '<div class="entrance-content fans-badge-second" style="display: none;" data-flag="medal-info-warp">', "{{ /if }}", '<div class="entrance-title"><span></span></div>', '<i class="arrow-icon"><i></i></i>', "</div>"), t = o.compile(e)
			},
			medalContentRender: function() {
				var e, t;
				return e = a.string.join('<div class="entrance-current" data-flag="medal-info-content">', '<div class="current-box">', '<div class="entrance-current-title"><a data-flag="fans-info-more" target="_blank" href="{{ fansSpecialUrl }}">了解粉丝体系</a><span>当前房间徽章</span></div>', "{{ if fansSwitch }}", "<!-- 主播已开通-已拥有 当前房间徽章 begin -->", "{{ if curMedalStatus }}", '<div class="fans-has-badge" data-tag="fans-medal-item" data-medal-index="{{ curMedalIndex }}" data-flag="medal-take-on" data-medal-id="{{ medalInfo.rid }}" style="display: block;">', "{{ if data.wf == 2 && roomId == data.list[0].rid }}", '<label class="radiobox is-checked">', '<input data-check="1" type="radio" name="fans-badge" checked />', "{{ /if }}", "{{ if data.wf == 1 || roomId != data.list[0].rid }}", '<label class="radiobox">', '<input data-check="0" type="radio" name="fans-badge" />', "{{ /if }}", '<i class="radio-icon"></i>', "{{# returnMedalComponent({roomId: medalInfo.rid, medalLev: medalInfo.bl, medalNick: medalInfo.bnn}, medalInfo.vipfan, 1) }}", '<span class="name" title="{{ medalInfo.anchorNick }}">{{ medalInfo.anchorNick }}</span>', "</label>", "</div>", "<!-- 主播已开通-已拥有-用户未佩戴 begin -->", "{{ if medalInfo.afim <= 0 }}", '<div class="medal-desc" style="display: block;">', "<ul>", "<li>Lv{{ medalInfo.bl }}:", '<div class="progress-barbox">', '<span class="progress-bar">', "{{ if medalInfo.bl < maxLev }}", '<em style="width:{{ (medalInfo.fim)/(medalInfo.nfim) * 100 }}%;"></em>', "{{ /if }}", "{{ if medalInfo.bl >= maxLev }}", '<em style="width:100%;"></em>', "{{ /if }}", "</span>", '<span data-flag="medal-lev-number" class="progress-num">', "{{ if medalInfo.bl < maxLev }}", "{{ medalInfo.fim }}/{{ medalInfo.nfim }}", "{{ /if  }}", "{{ if medalInfo.bl >= maxLev }}", "Max", "{{ /if }}", "</span>", "</div>", "</li>", '<li class="today-intimate">今日亲密度: {{ medalInfo.afim }}</li>', "</ul>", "<p>连续7天不送礼物，亲密度会下降，下降到0时您将失去该徽章</p>", "</div>", "{{ /if }}", "<!-- 主播已开通-已拥有-用户未佩戴 end -->", "<!-- 主播已开通-已拥有-用户已佩戴 begin -->", "{{ if medalInfo.afim > 0 }}", '<div class="medal-desc" style="display: block;">', "<ul>", "<li> Lv{{ medalInfo.bl }}:", '<div class="progress-barbox">', '<span class="progress-bar">', "{{ if medalInfo.bl < maxLev }}", '<em style="width:{{ (medalInfo.fim)/(medalInfo.nfim) * 100 }}%;"></em>', "{{ /if }}", "{{ if medalInfo.bl >= maxLev }}", '<em style="width:100%;"></em>', "{{ /if }}", "</span>", '<span data-flag="medal-lev-number" class="progress-num">', "{{ if medalInfo.bl < maxLev }}", "{{ medalInfo.fim }}/{{ medalInfo.nfim }}", "{{ /if  }}", "{{ if medalInfo.bl >= maxLev }}", "Max", "{{ /if  }}", "</span>", "</div>", "</li>", '<li class="intimate">', '<i class="intimate-icon">', "</i>", "<em>+{{ medalInfo.afim }}</em>", "</li>", '<li>粉丝等级排名: <span data-flag="medal-rank">', "{{ if medalInfo.pos <= 500 }}", "{{ if medalInfo.pos > 0 }}", "{{ medalInfo.pos }}", "{{ else }}", "--", "{{ /if }}", "{{ /if }}", "{{ if medalInfo.pos > 500 }}", "500+", "{{ /if }}", "</span></li>", '<li data-flag="medal-inti-limit">今日亲密度上限: {{ medalInfo.mafim }}</li>', "</ul>", "</div>", "{{ /if }}", "<!-- 主播已开通-已拥有-用户已佩戴 end -->", "{{ /if }}", "<!-- 主播已开通-已拥有 当前房间徽章 end -->", "<!-- 主播已开通-未拥有 当前房间徽章 begin -->", "{{ if !curMedalStatus }}", '<div class="fans-has-badge clearfix" style="display: block;">', '<span class="fans-badge-icon fans-badge-unavailable" data-ui-level="1">', '<span class="fans-icon-name"><i>{{ fansNick }}</i></span>', "</span>", '<span class="anchor-nobadge-tips">未拥有该主播的徽章</span>', "{{ if firstRecharge == 1 }}", '<a href="{{ firstRechargeUrl }}" target="_blank" class="fans-firstpay-entrance"></a>', "{{ /if }}", '<p class="fans-nobadge-tips">给主播送礼物达6鱼翅，就可获得专属徽章噢~</p>', "</div>", "{{ /if }}", "<!-- 主播已开通-未拥有 当前房间徽章--更新    end -->", "{{ /if }}", "{{ if !fansSwitch }}", "<!-- 主播未开通粉丝勋章 begin -->", '<div class="fans-has-badge" style="display: block;">', '<span class="fans-badge-icon fans-badge-unavailable" data-ui-level="1">', '<span class="fans-icon-name"><i>粉丝</i></span>', "</span>", '<span class="anchor-nobadge-tips">主播未开通粉丝徽章</span>', "</div>", "<!-- 主播未开通粉丝勋章 end -->", "{{ /if }}", "</div>", "</div>"), t = o.compile(e)
			},
			medalTipRender: function() {
				var e, t;
				return e = a.string.join('<div class="entrance-tipswrap" data-action="medal-tip-warp" data-tip-type="{{ type }}">', '{{ if type == "medalDisable" }}', '<i class="arrow-icon"></i>', "<p>主播还未开通粉丝徽章", '<a data-flag="fans-info-more" target="_blank" href="{{ fansSpecialUrl }}"> 了解更多&gt;&gt;</a>', "</p>", "{{ /if }}", '{{ if type == "medalUpper" }}', '<i class="arrow-icon"></i>', '<p>您的徽章已达到上限20个。　<a target="_blank" href="/member/cp/getFansBadgeList">点击设置&gt;&gt;</a></p>', "{{ /if }}", '{{ if type == "medalRemain" }}', '<i class="arrow-icon"></i>', "<p>当天累计送主播价值6个鱼翅的礼物即可获得Ta的粉丝徽章，并获取粉丝专属礼包。　", '<a data-flag="fans-info-more" target="_blank" href="{{ fansSpecialUrl }}">了解更多&gt;&gt;</a>', "</p>", "{{ /if }}", '{{ if type == "ownerRoomMedalRemain" }}', '<i class="arrow-icon"></i>', "<p>", '<a href="javascript:;" data-flag="medal-get-use" data-medal-rid="{{ curMedalInfo.rid }}" class="adornbtn">立即佩戴</a>', '<span class="adorn-msg">您已拥有该主播徽章</span>', "{{# returnMedalComponent({roomId: curMedalInfo.rid, medalLev: curMedalInfo.bl, medalNick: curMedalInfo.bnn}, curMedalInfo.vipfan, 1) }}", "</p>", "{{ /if }}", '{{ if type == "getOtherMedal" }}', '<i class="arrow-icon"></i>', "<p>恭喜您获得粉丝徽章！</p>", "{{ /if }}", "</div>"), t = o.compile(e)
			},
			medalMsgRender: function() {
				var e, t;
				return e = a.string.join('<div class="entrance-noticewrap" data-msg-type="{{ type }}">', '<i class="arrow-icon"></i>', '<a class="notice-closebtn" href="javascript:;" data-flag="medal-close-msg"></a>', '{{ if type == "expUpper" }}', '<div class="notice-content full-value">', '<span class="notice-icon"></span>', '<div class="notice-box">', "<p>亲，真给力，已刷满本日亲密度!</p>", "</div>", "</div>", "{{ /if }}", '{{ if type == "medalUpgrade" }}', '<div class="notice-content upgrade">', '<span class="notice-icon"></span>', '<div class="notice-box">', "<p>恭喜你又升一级，离主播铁粉更近一步!</p>", "</div>", "</div>", "{{ /if }}", '{{ if type == "medalUpgradeFull" }}', '<div class="notice-content upgrade">', '<span class="notice-icon"></span>', '<div class="notice-box">', "<p>恭喜你升级且刷满了今天的亲密度!</p>", "</div>", "</div>", "{{ /if }}", '{{ if type == "getFirstMedal" }}', '<div class="notice-content get-medal">', '<span class="notice-icon"></span>', '<div class="notice-box">', "<dl>", "<dt>恭喜您获得：", "{{# returnMedalComponent({roomId: getMedalData.rid, medalLev: getMedalData.bl, medalNick: getMedalData.bnn}) }}", "</dt>", "<dd>每天送礼物会提升等级和获得丰厚的礼包！</dd>", '<dd class="wear"><a data-tag="msg-tip-btn" data-flag="medal-get-use" data-medal-rid="{{ getMedalData.rid }}" href="javascript:;" class="fans-btn">立即佩戴</a></dd>', "</dl>", "</div>", "</div>", "{{ /if }}", "</div>"), t = o.compile(e)
			},
			medalListRender: function() {
				var e, t;
				return e = a.string.join('<div class="entrance-select" data-flag="medal-list-warp">', '<div class="entrance-select-title"><a data-flag="look-my-medal" target="_blank" href="{{ personMedalUrl }}">查看全部徽章</a><span>其他徽章</span></div>', "{{ each medalList.list as item index }}", "{{ if index <= medalNumMax }}", "{{ if item.rid != roomId}}", '<div class="fans-has-badge fans-hover-badge" data-tag="fans-medal-item" data-medal-index="{{ index }}" data-flag="medal-take-on" data-medal-id="{{ item.rid }}">', "{{ if medalList.wf == 2 }}", "{{ if index == 0 }}", '<label class="radiobox is-checked">', '<input type="radio" data-check="1" name="fans-badge" checked />', "{{ /if }}", "{{ if index != 0 }}", '<label class="radiobox">', '<input type="radio" data-check="0" name="fans-badge" />', "{{ /if }}", "{{ /if }}", "{{ if medalList.wf == 1 }}", '<label class="radiobox">', '<input type="radio" data-check="0" name="fans-badge" />', "{{ /if }}", '<i class="radio-icon"></i>', '<a target="_blank" href="javascript:;" class="fans-online-icon" style="display: none;"><i></i><em>查询中</em></a>', "{{# returnMedalComponent({roomId: item.rid, medalLev: item.bl, medalNick: item.bnn}, item.vipfan, 1) }}", '<span class="name" title="{{ item.anchorNick }}">{{ item.anchorNick }}</span>', "{{ if medalList.wf == 2 && index == 0 }}", "{{ if item.afim >= 0 }}", '<span class="intimate" style="display:inline-block;"><i class="intimate-icon"></i><em>+{{ item.afim }}</em></span>', "{{ /if }}", "{{ if item.afim < 0 }}", '<span class="intimate is-down" style="display:inline-block;"><i class="intimate-icon"></i><em>{{ item.afim }}</em></span>', "{{ /if }}", "{{ /if }}", "{{ if medalList.wf != 2 || index != 0 }}", "{{ if item.afim >= 0 }}", '<span class="intimate"><i class="intimate-icon"></i><em>+{{ item.afim }}</em></span>', "{{ /if }}", "{{ if item.afim < 0 }}", '<span class="intimate is-down"><i class="intimate-icon"></i><em>{{ item.afim }}</em></span>', "{{ /if }}", "{{ /if }}", "</label>", "</div>", "{{ /if }}", "{{ /if }}", "{{ /each }}", '<div class="fans-has-badge nowear-badge" data-tag="fans-medal-item" data-flag="medal-take-off">', "{{ if medalList.wf == 2 }}", '<label class="radiobox">', '<input type="radio" data-check="0" name="fans-badge" />', "{{ /if }}", "{{ if medalList.wf != 2 }}", '<label class="radiobox is-checked">', '<input type="radio" data-check="1" name="fans-badge" checked />', "{{ /if }}", '<i class="radio-icon"></i>', '<span class="name">不佩戴徽章</span>', "</label>", "</div>"), t = o.compile(e)
			},
			fansGiftPackRender: function() {
				var e, t;
				return e = a.string.join('<div class="fans-barrage-gift">', '<span class="barrage-offline-close" data-tag="fans-gift-close">×</span>', '<div class="fans-barrage-gift-wrap">', '<div class="fans-barrage-gift-title">', '<div class="fans-barrage-gift-level">', '<span class="fans-barrage-gift-leveltxt">根据您的最高粉丝等级</span>', "{{# returnMedalComponent({roomId: fansGiftData.gbr, medalLev: fansGiftData.gbl, medalNick: fansGiftData.gbnn}) }}", "</div>", '<span class="fans-barrage-gift-txt">恭喜您！您将获得：</span>', "</div>", '<div class="fans-lightstick">', '<div class="fans-lightstick-pic">', '<img src="{{ fansGiftData.gicon }}">', '<span class="fans-lightstick-icon">今日</span>', "</div>", '<span class="fans-lightstick-num">{{ fansGiftData.gname }}*{{ fansGiftData.gn }}</span>', "</div>", '<div class="fans-barrage-gift-warning clearfix">', '<a class="fans-barrage-get fr" data-tag="fans-backpack-open" href="javascript:;">知道了</a>', '<span class="fl">粉丝专属礼物仅限当日使用哟~</span>', "</div>", "</div>", '<span class="fans-barrage-arrow"></span>', '<span class="fans-barrage-arrow fans-barrage-arrow-out"></span>', "</div>"), t = o.compile(e)
			},
			firstRechargeMsgRender: function() {
				var e, t;
				return e = a.string.join('<li class="jschartli chartli normal-notice-new">', '<i class="sys-icon"></i>', '<p class="text-cont">', "恭喜", '<span class="firstpay-user nick-new">{{ nn }}</span>', '将<span class="highLight">第一次</span>充值献给了本房间主播，并获得了', '<span class="highLight">首充奖励</span>', "</p>", "</li>"), t = o.compile(e)
			},
			firstRechargeRender: function() {
				var e, t;
				return e = a.string.join('<div class="firstpay-entrance">', '<a class="firstpay-btn" target="_blank" href="{{ firstRechargeUrl }}"></a>', '<div class="firstpay-tipswrap">', '<i class="arrow-icon"></i>', '<div class="firstpay-tips">', '<p class="firstpay-tip1">', "在本直播间<em>首次充值6元</em>即可免费获得两大徽章", "</p>", '<span class="firstpay-tip2">', "<em>粉丝徽章</em>+<em>首充徽章</em>", "</span>", "</div>", "</div>", "</div>"), t = o.compile(e)
			},
			firstRechargeFulfillRender: function() {
				var e, t;
				return e = a.string.join('<div class="firstpay-success">', '<a href="javascript:;" class="fisrtpay-close"></a>', '<div class="firstpay-desc">', "<p>恭喜你！成功将第一次充值献给了主播</p>", '<p class="firstpay-anchor">"{{ fansGiftData.onn }}"</p>', "</div>", '<div class="firstpay-award">', '<div class="firstpay-award-title">', "<span>获得奖励</span>", "</div>", '<div class="firstpay-award-content">', '<div class="clearfix">', "{{ if fansGiftData.isSetFansMedal }}", '<div class="firstpay-award-fans">', "<span>专属粉丝徽章：</span>", "{{# returnMedalComponent({roomId: fansGiftData.gbr, medalLev: fansGiftData.gbl, medalNick: fansGiftData.gbnn}) }}", "</div>", '<div class="firstpay-award-pay">', "<span>专享首充徽章：</span>", '<span class="firstpay-award-icon"></span>', "</div>", "{{ else }}", '<div class="firstpay-award-pay active">', "<span>专享首充徽章：</span>", '<span class="firstpay-award-icon"></span>', "</div>", "{{ /if }}", "</div>", "{{if fansGiftData.isSetFansMedal }}", '<a href="javascript:;" data-medal-rid="{{ fansGiftData.gbr }}" class="firstpay-award-btn">立即佩戴</a>', "{{ else }}", '<a href="javascript:;" data-medal-rid="{{ fansGiftData.gbr }}" class="firstpay-sure-btn">确定</a>', "{{ /if }}", "</div>", "</div>", "</div>"), t = o.compile(e)
			},
			fansRechargeEnterRender: function() {
				var e, t;
				return e = a.string.join('<div class="firstpay-warp">', '<div class="firstpay-enter">  ', "</div>", '<div class="firstpay-modal hide">', '<a class="firstpay-modal-close" href="javascript:;"></a>', '<div class="firstpay-txt">', '<span class="firstpay-txt1">献出你的“第一次”充值给主播</span>', '<span class="firstpay-txt2">立即获得：</span>', "</div>", '<div class="firstpay-rewards clearfix">', '<div class="firstpay-rewards-sub fl">', '<span class="firstpay-rewards-icon"></span>', '<span class="firstpay-rewards-name">首充专属徽章</span>', '<span class="firstpay-rewards-intro">（有效期7天）</span>', "</div>", '<div class="firstpay-rewards-sub fr">', '<span class="firstpay-rewards-fansicon">', '{{# returnMedalComponent({roomId: roomId, medalLev: 1, medalNick: fansNick || "粉丝"}) }}', "</span>", '<span class="firstpay-rewards-name">本房间粉丝徽章</span>', "</div>", "</div>", '<div class="firstpay-submit-wrap">', '<a class="firstpay-submit" target="_blank" href="{{ fansRechargeUrl }}">立即充值</a>', "</div>", '<i class="firstpay-modal-arrow"></i>', "</div>", "</div>"), t = o.compile(e)
			},
			dropingMedalsRender: function() {
				var e, t;
				return e = a.string.join("{{ if newMedalState }}", '<div class="fans-medal-droping-warp new-fans-medal-remain">', "{{ else }}", '<div class="fans-medal-droping-warp">', "{{ /if }}", '<i class="fans-droping-close"></i>', '<div class="fans-droping-top">', '<div class="fans-droping-switch">', '<i class="fans-droping-switch-icon"></i>', "<span>不再提示</span>", "</div>", '<div class="fans-droping-info">', "{{ if newMedalState }}", '<div class="fans-droping-desc">', "<h3>好心疼~您今天<span>又有{{ newMedalList.length }}枚徽章亲密度下降了</span>哟~</h3>", "</div>", "{{ else }}", '<p class="fans-droping-pic"></p>', '<div class="fans-droping-desc">', "<h3>好心疼~</h3>", "<h3>你与<span><em>{{ oldMedalList.length }}</em>位主播</span>的亲密度<span>正在下降~</span></h3>", "<h5>亲密度下降到0时，将会失去主播粉丝徽章</h5>", "</div>", "{{ /if }}", "</div>", "</div>", '<div class="fans-droping-content">', "{{ if newMedalState }}", '<ul class="fans-droping-list">', "{{ each newMedalList as item index }}", "{{ if ((index == newMedalList.length-1) && (oldMedalList.length <= 0)) }}", '<li class="fans-droping-list-item no-border" data-bid="{{ item.rid }}">', "{{ else }}", '<li class="fans-droping-list-item" data-bid="{{ item.rid }}">', "{{ /if }}", '<div class="fans-medal-info">', '<div class="fans-medal-icon-warp">', '<p class="fans-medal">', "{{# returnMedalComponent({roomId: item.rid, medalLev: item.bl, medalNick: item.bnn}, item.vipfan, 1) }}", "</p>", '<p class="fans-intimate">', "<i></i>", "<span>{{ item.afim }}</span>", "</p>", "</div>", '<p class="fans-medal-score">', "亲密度剩余：<span>{{ item.fim }}</span>", "</p>", "</div>", '<a href="/{{ item.rid }}" target="_blank" class="fans-droping-go-room">去直播间</a>', "</li>", "{{ /each }}", "</ul>", "{{ if oldMedalList.length > 0 }}", '<h3 class="fans-new-droping-title">以下徽章的亲密度正在下降，赶紧送礼物吧~</h3>', "{{ /if }}", "{{ /if }}", '<ul class="fans-droping-list">', "{{ each oldMedalList as item index }}", "{{ if (index == (oldMedalList.length - 1)) }}", '<li class="fans-droping-list-item no-border" data-bid="{{ item.rid }}">', "{{ else }}", '<li class="fans-droping-list-item" data-bid="{{ item.rid }}">', "{{ /if }}", '<div class="fans-medal-info">', '<div class="fans-medal-icon-warp">', '<p class="fans-medal">', "{{# returnMedalComponent({roomId: item.rid, medalLev: item.bl, medalNick: item.bnn}, item.vipfan, 1) }}", "</p>", '<p class="fans-intimate">', "<i></i>", "<span>{{ item.afim }}</span>", "</p>", "</div>", '<p class="fans-medal-score">', "亲密度剩余：<span>{{ item.fim }}</span>", "</p>", "</div>", '<a href="/{{ item.rid }}" target="_blank" class="fans-droping-go-room">去直播间</a>', "</li>", "{{ /each }}", "</ul>", "</div>", "</div>"), t = o.compile(e)
			},
			medalSwitchCheck: function() {
				var e, t = this;
				if (m.anchorMedalSwitch) {
					if (!c.check()) return;
					e = m.medalEnterStatus.none
				} else e = m.medalEnterStatus.close;
				t.medalEnterAppend({
					status: e,
					userCheck: "notLogin"
				})
			},
			medalTipMsgConfig: function(e) {
				var t, i, a, n = this.doms,
					s = this.renderHtml,
					r = n.$medalContentWarp;
				if ("hide" === e.status) return clearTimeout(m.tipsTimer), void(m.tipsTimer = setTimeout(function() {
					r.find("[data-" + e.remainType + "-type=" + e.type + "]").remove()
				}, 150));
				switch (e.remainType) {
				case "tip":
					if (t = r.find("[data-tip-type=" + e.type + "]"), t && t.length > 0) return;
					a = e.medalInfo, r.append(s.medalTipTemp({
						type: e.type,
						curMedalInfo: a,
						fansMedal: p || {},
						returnMedalComponent: u.returnMedalComponent,
						fansSpecialUrl: m.fansSpecialUrl
					})), r.find("[data-tip-type=" + e.type + "]").show();
					break;
				case "msg":
					if (i = r.find("[data-msg-type=" + e.type + "]"), i && i.length > 0) return;
					r.append(s.medalMsgTemp({
						type: e.type,
						getMedalData: "getFirstMedal" === e.type ? e.getMedalData : "",
						fansMedal: p || {},
						returnMedalComponent: u.returnMedalComponent,
						fansSpecialUrl: m.fansSpecialUrl
					})), r.find("[data-msg-type=" + e.type + "]").show()
				}
				e.timer && setTimeout(function() {
					r.find("[data-" + e.remainType + "-type=" + e.type + "]").remove()
				}, 4e3)
			},
			medalLevMap: function() {
				for (var e = 0, t = m.levelMap.list; e < t.length; e++) t[e].push(h.medalLevel(t[e][0]))
			},
			firstRechargeMsgHtml: function(e) {
				var t = this.renderHtml;
				return t.firstRechargeMsgTemp(e)
			},
			firstRechargeEnterAppend: function() {
				var t, i = this.doms,
					a = this.renderHtml;
				i.$firstRechargeBtn && i.$firstRechargeBtn.length || (t = a.firstRechargeTemp({
					firstRechargeUrl: m.firstRechargeUrl
				}), i.$sendMsgWarp.addClass("chat-fans").append(t), i.$firstRechargeBtn = e(".firstpay-entrance"))
			},
			medalEnterAppend: function(t) {
				var i, a, n = this.doms,
					s = this.renderHtml;
				n.$medalEnterBtn && n.$medalEnterBtn.length > 0 && n.$medalEnterBtn.remove(), t.status == m.medalEnterStatus.yesWear && (i = m.medalListData.list[0], a = h.medalLevel(i.bl)), n.$medalContentWarp && n.$medalContentWarp.length > 0 || (n.$sendMsgWarp.addClass("chat-fans").append(s.medalContainerTemp({
					userCheck: c.check()
				})), n.$medalContentWarp = e('[data-flag="medal-entrance-warp"]')), n.$medalContentWarp.append(s.medalEnterTemp({
					status: t.status,
					medalData: i,
					madelLev: a,
					fansMedal: p || {},
					returnMedalComponent: u.returnMedalComponent
				})), n.$medalEnterBtn = e('[data-action="medal-enter-btn"]')
			},
			medalContentWarpAppend: function(t) {
				var i = this.doms,
					a = this.renderHtml;
				i.$medalInfoWarp && i.$medalInfoWarp.length > 0 || (i.$medalContentWarp.append(a.medalContentWarpTemp({
					data: m.medalListData
				})), i.$medalInfoWarp = e('[data-flag="medal-info-warp"]'))
			},
			medalContentAppend: function(t) {
				var i, a, n = this,
					s = this.doms,
					r = this.renderHtml,
					t = t || {};
				if (t && "hide" === t.status) {
					if (clearTimeout(m.tipsTimer), !s.$medalInfoWarp) return;
					return void(m.tipsTimer = setTimeout(function() {
						s.$medalInfoWarp.hide()
					}, 150))
				}
				if (t && "update" === t.status) {
					if (!s.$medalInfoWarp) return;
					s.$medalInfoWarp.is(":hidden") ? m.medalInfoStatus = 0 : m.medalInfoStatus = 1, s.$medalInfoWarp.remove(), s.$medalInfoWarp = e('[data-flag="medal-info-warp"]')
				}
				s.$medalInfoWarp && s.$medalInfoWarp.length > 0 ? s.$medalInfoWarp.show() : (n.medalContentWarpAppend(), i = n.searchMedalIndex(), a = "number" === h.returnType(i) ? 1 : 0, s.$medalInfoWarp.append(r.medalContentTemp({
					fansSwitch: m.anchorMedalSwitch,
					fansNick: m.fansNick,
					data: m.medalListData,
					roomId: m.roomId,
					maxLev: m.medalLevel[m.medalLevel.length - 1],
					curMedalStatus: a,
					curMedalIndex: i,
					medalInfo: m.medalListData.list[i],
					fansMedal: p || {},
					returnMedalComponent: u.returnMedalComponent,
					fansSpecialUrl: m.fansSpecialUrl,
					firstRecharge: m.medalListData.frq,
					firstRechargeUrl: m.firstRechargeUrl
				})), s.$medalInfoContent = e('[data-flag="medal-info-content"]'), n.medalListAppend(t))
			},
			medalListAppend: function(t) {
				var i, a, n = this,
					s = this.doms,
					r = this.renderHtml;
				t && "hide" === t.status || (i = n.searchMedalIndex(), a = "number" === h.returnType(i) && 5 > i ? 5 : 4, s.$medalInfoContent.after(r.medalListTemp({
					personMedalUrl: m.personMedalUrl,
					medalList: m.medalListData,
					roomId: m.roomId,
					medalNumMax: a,
					fansMedal: p || {},
					returnMedalComponent: u.returnMedalComponent
				})), s.$medalListWarp = e('[data-flag="medal-list-warp"]'), 2 == m.medalListData.wf && n.anchorRoomStatus(), 1 === m.medalInfoStatus && n.hoverEnterStatus && s.$medalInfoWarp.show())
			},
			fansGiftPackAppend: function(t) {
				var i, a = this;
				i = a.renderHtml.fansGiftPackTemp({
					fansMedal: p || {},
					returnMedalComponent: u.returnMedalComponent,
					fansGiftData: t
				}), e("#js-stats-and-actions .uinfo-ywyc").append(i), e("#js-stats-and-actions .uinfo-ywyc").find(".fans-barrage-gift").show()
			},
			firstRechargeFulFillAppend: function(e) {
				var t, i = this.doms,
					a = this.renderHtml,
					n = e || {};
				i.$firstRechargeTip && i.$firstRechargeTip.length && i.$firstRechargeTip.remove(), t = a.firstRechargeFulfillTemp({
					fansGiftData: {
						oid: n.oid,
						onn: n.onn,
						gbnn: n.bnn,
						gbl: n.bl,
						gbr: m.roomId,
						isSetFansMedal: m.anchorMedalSwitch
					},
					fansMedal: p || {},
					returnMedalComponent: u.returnMedalComponent
				}), i.$roomVideoWarp.append(t), i.$firstRechargeTip = i.$roomVideoWarp.find(".firstpay-success")
			},
			fansRechargeEnterAppend: function(e) {
				var t, i = this,
					a = this.doms; + m.isPaladinWeek || f.render().done(function() {
					a.$fansRechatEnter && a.$fansRechatEnter.length || (t = i.renderHtml.fansRechargeEnterTemp({
						fansRechargeUrl: m.firstRechargeUrl,
						fansNick: m.fansNick,
						roomId: m.roomId,
						fansMedal: p || {},
						returnMedalComponent: u.returnMedalComponent
					}), a.$giftContent.find(".g-list"), a.$giftContent.prepend(t), a.$fansRechatEnter = a.$giftContent.find(".firstpay-warp"), a.$fansRechatRemain = a.$giftContent.find(".firstpay-modal"), s.get(m.fansRechargeStorage) || (a.$fansRechatRemain.removeClass("hide"), s.set(m.fansRechargeStorage, 1, m.storageExpired)))
				})
			},
			fansRechargeLoginCheck: function() {
				var e = this,
					t = m.medalListData || {},
					i = c.check();
				i ? m.anchorMedalSwitch && 1 == t.frq && e.fansRechargeEnterAppend() : e.fansRechargeEnterAppend()
			},
			fansNickUpdate: function(e) {
				var t = this.doms;
				t.$fansRechatEnter && t.$fansRechatEnter.length && t.$fansRechatEnter.find(".fans-icon-name i").text(e)
			},
			anchorRoomStatusView: function(e) {
				var t = this.doms,
					i = t.$medalListWarp.find('.fans-has-badge[data-medal-index="0"] .fans-online-icon');
				e.is_live ? i.removeClass("status-disable").prop("href", "/" + m.medalListData.list[0].rid).find("em").text("直播中") : i.addClass("status-disable").prop("href", "/" + m.medalListData.list[0].rid).find("em").text("未开播"), i.fadeIn()
			},
			anchorRoomStatus: function() {
				var t = this,
					i = m.medalListData,
					a = m.medalListData.list[0];
				a && a.anchorUid && a.anchorNick ? t.anchorRoomStatusView(a) : e.ajax({
					url: m.urls.searchAnchorInfo,
					dataType: "json",
					data: {
						rid: i.list[0].rid,
						auth: i.list[0].hc
					}
				}).done(function(e) {
					t.anchorRoomStatusView(e)
				}).then(function() {})
			},
			searchMedalIndex: function(t) {
				var i, a, n = 0,
					s = m.medalListData.list;
				if (e.isArray(s)) {
					for (a = t ? t : m.roomId; n < s.length; n++) if (a == s[n].rid) {
						i = n;
						break
					}
					return i
				}
			},
			medalLevDeal: function(t) {
				var i = 0,
					a = t.list;
				if (e.isArray(a)) for (; i < a.length; i++) a[i].medalLev = h.medalLevel(a[i].bl)
			},
			medalAnchorInfoSearch: function() {
				var t, i = this,
					a = m.medalListData;
				m.isReqingAnchorInfoList = 1, t = a.list.length >= 8 ? 8 : a.list.length, e.ajax({
					url: m.urls.searchAnchorInfo,
					dataType: "json",
					data: {
						rid: a.list[m.searchProgress].rid,
						auth: a.list[m.searchProgress].hc
					}
				}).done(function(e) {
					var n = a.list[m.searchProgress];
					m.searchProgress++, n.anchorUid = e.owner_uid, n.anchorNick = e.nn, n.anchorPic = e.avatar, n.is_live = e.is_live, m.searchProgress >= t ? (m.fansListDataState = 1, m.isReqingAnchorInfoList = 0, m.searchProgress = 0, i.medalListPushCall()) : i.medalAnchorInfoSearch()
				}).fail(function() {
					m.searchProgress++
				})
			},
			dropingMdealAppend: function() {
				var t, i = this,
					a = i.doms,
					n = i.renderHtml,
					r = m.dropingFansMedal,
					o = s.get(m.dropingDialogFlag),
					l = 0;
				!o && r && r.length > 0 && (m.newDropingMedal && m.newDropingMedal.length && (l = 1), t = n.dropingMedalsTemp({
					fansMedal: p || {},
					returnMedalComponent: u.returnMedalComponent,
					newMedalState: l,
					oldMedalList: l ? m.filterDropingMedal : r,
					newMedalList: m.newDropingMedal
				}), a.$dropingMedalsWarp && a.$dropingMedalsWarp.length && a.$dropingMedalsWarp.remove(), a.$chatContent.append(t), a.$dropingMedalsWarp = e(".fans-medal-droping-warp"), e(".fans-droping-content").mCustomScrollbar("destroy").mCustomScrollbar())
			},
			dropingMdealCheck: function(t) {
				var i, a = m.dropingFansMedal,
					n = t,
					r = 0;
				if (a && a.length > 0) for (i = e(".fans-droping-content"); r < a.length; r++) a[r].rid == n && (a.splice(r, 1), r--, i && i.length && (a.length <= 0 ? e(".fans-medal-droping-warp").remove() : (e('.fans-droping-list-item[data-bid="' + n + '"]').remove(), e(".fans-droping-desc").find("em").text(a.length), e(".fans-droping-content").mCustomScrollbar("destroy").mCustomScrollbar())), a.length > 0 ? s.set(m.dropingListFlag, a, m.storageExpired) : s.remove(m.dropingListFlag))
			},
			dropingMedalPush: function(e) {
				var t = e;
				t && (t.rid == l.get("room.room_id") && d.exe("js_fans_change", 1), t.afim < 0 && m.dropingFansMedal.push(t))
			},
			newDropingMedalCheck: function() {
				var t, i, a = this,
					n = m.dropingFansMedal,
					r = s.get(m.dropingListFlag),
					o = s.get(m.dropingDialogFlag),
					l = [],
					c = 0;
				if (!o) {
					if (n.length) if ("array" === h.returnType(r)) {
						for (l = e.extend(!0, [], n); c < n.length; c++) if (t = n[c]) {
							i = !1;
							for (var d = 0; d < r.length; d++) t.rid == r[d].rid && (i = !0);
							if (!i) {
								for (var u = 0; u < l.length; u++) l[u].rid == t.rid && l.splice(u, 1);
								m.newDropingMedal.push(t)
							}
						}
						m.filterDropingMedal = l, m.newDropingMedal && m.newDropingMedal.length && a.dropingMdealAppend()
					} else a.dropingMdealAppend();
					s.set(m.dropingListFlag, n, m.storageExpired)
				}
			},
			dropingMedalSort: function() {
				var e, t, i = this,
					a = m.dropingFansMedal,
					n = 0,
					r = 0;
				if (a && a.length > 0) {
					for (; n < a.length; n++) {
						for (e = a[n], t = n, r = n + 1; r < a.length; r++) e.fim > a[r].fim && (e = a[r], t = r);
						a.splice(n, 0, e), a.splice(t + 1, 1)
					}
					i.newDropingMedalCheck()
				} else s.remove(m.dropingListFlag)
			},
			medalListPush: function(t) {
				var i, a = this,
					n = (this.doms, t);
				if (m.medalListData = n, "object" === h.returnType(m.medalListData)) {
					i = m.medalListData.wf, m.fansRequestState = 0, m.fansListDataState = 0, m.dropingFansMedal = [], m.newDropingMedal = [], m.isHandleList || (m.medalListData.list = r.isArray(m.medalListData.list) ? r.decode(m.medalListData.list) : [{
						value: t.list
					}], m.isHandleList = 1), 0 != i && e.isArray(m.medalListData.list) || (m.medalListData.list = []);
					for (var s = 0; s < m.medalListData.list.length; s++) {
						var o = m.medalListData.list[s];
						o && o.value && (o = r.decode(o.value).too(), o.fim = Math.round(o.fim / 10) / 10, o.nfim = Math.round(o.nfim / 10) / 10, o.afim = Math.round(o.afim / 10) / 10, o.mafim = Math.round(o.mafim / 10) / 10, m.medalListData.list[s] = o), a.dropingMedalPush(o)
					}
					m.medalListPushState = 1, a.dropingMedalSort(), a.medalListPushCall()
				}
			},
			medalFirstListAppend: function() {
				var e, t = this;
				"object" === h.returnType(m.medalListData) && (m.fansRequestState || (m.fansRequestState = 1, e = m.medalListData.wf, m.fansListDataState || m.isReqingAnchorInfoList || (1 != e && 2 != e || m.fansListDataState ? t.medalListPushCall() : t.medalAnchorInfoSearch())))
			},
			ownerRoomMedalStauts: function() {
				var e = this,
					t = e.searchMedalIndex(),
					i = m.medalListData;
				"number" !== h.returnType(t) || 0 === t && 1 != i.wf || e.medalTipMsgConfig({
					medalInfo: i.list[t],
					remainType: "tip",
					type: "ownerRoomMedalRemain",
					status: "show",
					timer: !0
				})
			},
			medalListPushCall: function() {
				var e, t = this,
					i = this.doms,
					a = m.medalListData.wf;
				0 == a ? m.anchorMedalSwitch ? (e = m.medalEnterStatus.none, s.get("medalRemainTip") || (t.medalTipMsgConfig({
					remainType: "tip",
					type: "medalRemain",
					status: "show",
					timer: !0
				}), s.set("medalRemainTip", 1, 31536e3))) : (e = m.medalEnterStatus.close, s.get("medalNotOpenTip") || (t.medalTipMsgConfig({
					remainType: "tip",
					type: "medalDisable",
					status: "show",
					timer: !0
				}), s.set("medalNotOpenTip", 1, 31536e3))) : 1 == a ? (e = m.medalEnterStatus.notWear, t.medalLevDeal(m.medalListData)) : 2 == a && (e = m.medalEnterStatus.yesWear, t.medalLevDeal(m.medalListData)), t.medalViewUpdateAgent({
					type: "firstRender",
					enterStatus: e
				}), 1 != a && 2 != a || m.fansListDataState || (i.$sendMsgWarp.find('[data-action="medal-tip-warp"]').remove(), t.ownerRoomMedalStauts())
			},
			medalUpdatePush: function(e, t) {
				var a, n, r, o, l, c, d = this,
					u = e;
				m.medalListData && ("fansDay" == t && u && u.brid ? (c = u.brid, a = d.searchMedalIndex(u.brid)) : (c = m.roomId, a = d.searchMedalIndex()), n = m.medalListData.list[a], "object" === h.returnType(n) && (r = n.bl, n.bl = u.bl, n.fim = Math.round(u.fim / 10) / 10, n.nfim = Math.round(u.nfim / 10) / 10, n.afim = Math.round(u.afim / 10) / 10, n.mafim = Math.round(u.mafim / 10) / 10, d.medalLevDeal(m.medalListData), n.afim >= 0 && d.dropingMdealCheck(c), l = "fansDay" == t && u && u.brid ? d.medalStatusSearch(u.brid) || {} : d.medalStatusSearch() || {}, n.afim >= n.mafim ? u.bl > r ? (o = "medalUpgradeFull", s.get("medalExpUpper_" + m.roomId) || (s.set("medalExpUpper_" + m.roomId, 1, h.getRestTime() / 1e3), d.medalTipMsgConfig({
					getMedalData: n,
					remainType: "msg",
					type: o,
					status: "show",
					timer: !0
				}), i.trigger("dys", {
					key: "dys.room.fansbadge.medalUpgrade.show",
					bdg_id: l.bdg_id,
					cbdg_id: l.cbdg_id,
					level: n.bl,
					qinmi: n.fim,
					rank: n.pos
				}), i.trigger("dys", {
					key: "dys.room.fansbadge.coreLimit.show",
					bdg_id: l.bdg_id,
					cbdg_id: l.cbdg_id,
					level: n.bl,
					qinmi: n.fim,
					rank: n.pos
				}))) : (o = "expUpper", s.get("medalExpUpper_" + m.roomId) || (s.set("medalExpUpper_" + m.roomId, 1, h.getRestTime() / 1e3), d.medalTipMsgConfig({
					getMedalData: n,
					remainType: "msg",
					type: o,
					status: "show",
					timer: !0
				}), i.trigger("dys", {
					key: "dys.room.fansbadge.coreLimit.show",
					bdg_id: l.bdg_id,
					cbdg_id: l.cbdg_id,
					level: n.bl,
					qinmi: n.fim,
					rank: n.pos
				}))) : u.bl > r && (d.medalTipMsgConfig({
					remainType: "msg",
					type: "medalUpgrade",
					status: "show",
					timer: !0
				}), i.trigger("dys", {
					key: "dys.room.fansbadge.medalUpgrade.show",
					bdg_id: l.bdg_id,
					cbdg_id: l.cbdg_id,
					level: n.bl,
					qinmi: n.fim,
					rank: n.pos
				})), (m.anchorMedalSwitch || "fansDay" == t) && (2 == m.medalListData.wf ? d.medalViewUpdateAgent({
					enterStatus: m.medalEnterStatus.yesWear
				}) : d.medalViewUpdateAgent({
					enterStatus: m.medalEnterStatus.notWear
				}))))
			},
			medalGetPush: function(t) {
				var a, n, s = this,
					r = this.doms,
					o = m.medalListData;
				m.anchorMedalSwitch = 1, m.medalListData.frq = 0, i.trigger("fans.medal.switch.set"), r.$fansRechatEnter && r.$fansRechatEnter.length && r.$fansRechatEnter.addClass("hide"), "object" !== h.returnType(o) && (o = {
					type: m.types.medalList,
					wf: 1,
					list: []
				}, s.medalViewUpdateAgent({
					enterStatus: m.medalEnterStatus.notWear
				})), n = s.searchMedalIndex(), 0 == o.wf && (o.wf = 1, s.medalEnterAppend({
					status: m.medalEnterStatus.notWear
				})), "number" === h.returnType(n) && 0 !== n && o.list.splice(n, 1), a = t, a.rid = m.roomId, a.fim = Math.round(a.fim / 10) / 10, a.nfim = Math.round(a.nfim / 10) / 10, a.afim = Math.round(a.afim / 10) / 10, a.mafim = Math.round(a.mafim / 10) / 10, a.medalLev = h.medalLevel(a.bl), e.ajax({
					url: m.urls.searchAnchorInfo,
					dataType: "json",
					data: {
						rid: m.roomId,
						auth: a.hc
					}
				}).done(function(e) {
					var n;
					a.pos = m.ruPos ? m.ruPos : "-", a.anchorUid = e.owner_uid, a.anchorNick = e.nn, a.anchorPic = e.avatar, 2 == o.wf ? o.list.splice(1, 0, a) : o.list.unshift(a), s.medalContentAppend({
						status: "update"
					}), n = s.medalStatusSearch(), i.trigger("mod.room.user.fansMedal.info", n), i.trigger("mod.room.user.fansMedal.setcurrroom", n), m.medalListData.list.length < m.medalNumLimit ? m.medalListData.list.length > 1 ? s.medalTipMsgConfig({
						remainType: "tip",
						type: "getOtherMedal",
						status: "show",
						timer: !0
					}) : s.medalTipMsgConfig({
						getMedalData: t,
						remainType: "msg",
						type: "getFirstMedal",
						status: "show"
					}) : (r.$sendMsgWarp.find('[data-flag="medal-entrance-warp"]').addClass("status-full"), s.medalTipMsgConfig({
						remainType: "tip",
						type: "medalUpper",
						status: "show",
						timer: !0
					}))
				}).then(function() {})
			},
			fansFirstPayStatus: function() {
				var e = m.medalListData.frq;
				m.anchorMedalSwitch && l.get("sys.uid") != l.get("room.owner_uid") && 1 == e || i.trigger("mod.task.config.hide", m.fansFirstPayTask)
			},
			medalViewUpdateAgent: function(e) {
				var t, i = this,
					a = m.medalListData.frq;
				l.get("sys.uid") == l.get("room.owner_uid") && (m.medalListData.frq = 0, a = 0), i.fansFirstPayStatus(), i.medalEnterAppend({
					status: e.enterStatus,
					firstRecharge: a
				}), i.fansRechargeLoginCheck(), m.fansListDataState && e.enterStatus != m.medalEnterStatus.none && e.enterStatus != m.medalEnterStatus.close && (t = "firstRender" == e.type ? "" : "update", i.medalContentAppend({
					status: t,
					firstRecharge: a
				}))
			},
			medalListDataUpdate: function(e) {
				var t, i, a = this,
					n = e,
					s = m.medalListData;
				switch (parseInt(n.ot, 10)) {
				case 1:
					t = a.searchMedalIndex(e.rid), s.wf = 2, i = s.list.splice(t, 1), s.list.unshift(i[0]), a.medalViewUpdateAgent({
						enterStatus: m.medalEnterStatus.yesWear
					});
					break;
				case 2:
					s.wf = 1, a.medalViewUpdateAgent({
						enterStatus: m.medalEnterStatus.notWear
					});
					break;
				case 3:
					t = a.searchMedalIndex(e.rid)
				}
			},
			medalStatusSearch: function() {
				var e, t = this,
					i = {},
					a = m.medalListData;
				return m.medalListPushState ? 1 == a.wf || 2 == a.wf ? (e = t.searchMedalIndex(), i.is_bdg = 1, "number" === h.returnType(e) ? (i.is_cbdg = 1, i.cbdg_id = m.roomId) : (i.is_cbdg = 0, i.cbdg_id = ""), 2 == a.wf ? i.bdg_id = a.list[0].rid : i.bdg_id = "") : (i.is_bdg = 0, i.is_cbdg = 0, i.bdg_id = "", i.cbdg_id = "") : i = {
					is_bdg: "",
					is_cbdg: "",
					bdg_id: "",
					cbdg_id: ""
				}, i
			},
			dpDealAgent: function(e) {
				var t, a, n = this,
					s = n.medalStatusSearch();
				switch (e.type) {
				case m.dpType.medalEnter:
					t = "dys.room.fansbadge.medalEnter.click";
					break;
				case m.dpType.fansIntroduction:
					t = "dys.room.fansbadge.introduction.click";
					break;
				case m.dpType.medalListEnter:
					t = "dys.room.fansbadge.medalListEnter.click";
					break;
				case m.dpType.medalListSel:
					t = "dys.room.fansbadge.medalListSel.click";
					break;
				case m.dpType.myMedalEnter:
					t = "dys.room.fansbadge.myMedal.click"
				}
				e.type === m.dpType.medalListSel && (a = e.selMedalRid), i.trigger("dys", {
					key: t,
					is_bdg: s.is_bdg,
					is_cbdg: s.is_cbdg,
					bdg_id: s.bdg_id,
					cbdg_id: s.cbdg_id,
					nbdg_id: a
				})
			},
			pushBind: function() {
				var t, a, n = this,
					o = m.types;
				d.reg("room_data_handler", function(u) {
					var f, p = r.decode(u).too();
					switch (p.type) {
					case o.fansRank:
						m.fansNick = p.bnn || "粉丝", n.fansNickUpdate(m.fansNick), i.trigger("room.act.data.fansday06.rank.fans.nickName", m.fansNick);
						break;
					case o.medalList:
						if (!c.check()) return;
						if (1 == m.isReqingAnchorInfoList) return;
						m.isHandleList = 0, n.medalListPush(p), n.initMedalData = p, f = n.medalStatusSearch(), i.trigger("mod.room.user.fansMedal.info", f), i.trigger("mod.room.user.fansMedal.setcurrroom", f);
						break;
					case o.medalGet:
						if (!c.check()) return;
						d.exe("js_fans_change", 1), n.medalGetPush(p);
						break;
					case o.medalOpera:
						if (!c.check()) return;
						n.medalListDataUpdate(p);
						break;
					case o.medalUpdate:
						if (!c.check()) return;
						n.updateMedalData = p, n.medalUpdatePush(p);
						break;
					case o.medalUpdateCur:
						if (!c.check()) return;
						n.medalUpdatePush(p, "fansDay");
						break;
					case o.medalRankPos:
						if (!c.check()) return;
						m.ruPos = p.pos, a = n.searchMedalIndex(), "number" === h.returnType(a) && (m.medalListData.list[a].pos = p.pos, n.medalContentAppend({
							status: "update"
						}));
						break;
					case o.medalOperaError:
						if (!c.check()) return;
						if ("503101" == p.result) {
							if (m.removeMedalID = p.rid, t = n.searchMedalIndex(p.rid), "number" !== h.returnType(t)) return;
							m.medalListData.list.splice(t, 1), m.medalListData.list.length <= 0 ? m.medalListData.wf = 0 : m.medalListData.wf = 1, n.medalViewUpdateAgent({
								enterStatus: m.medalListData.wf ? m.medalEnterStatus.notWear : m.medalEnterStatus.none
							}), 2 != p.ot && e.dialog.tips_black("您没有此徽章")
						} else 0 == p.result && n.medalListDataUpdate({
							rid: p.rid,
							ot: m.opearMedalType
						});
						break;
					case o.fansGift:
						s.set("fansGiftPush_" + l.get("sys.uid"), p, h.getRestTime() / 1e3);
						break;
					case o.firstFansGift:
						m.medalListData.frq = 0, n.firstRechargeFulFillAppend(p)
					}
				}), d.reg("room_frbInfo", function(e) {
					var t = r.decode(e).too();
					t.type == m.types.firstFansMsg && i.trigger("mod.chat.msg.msg", n.firstRechargeMsgHtml(t))
				}), i.on("crazy.fans.config.data.back", function() {
					n.medalConfigUpdate()
				}), i.on("room.activity.get.fans.id", function() {
					return n.medalStatusSearch().bdg_id
				})
			},
			medalConfigUpdate: function() {
				this.initMedalData ? this.medalListPush(this.initMedalData) : this.updateMedalData && this.medalUpdatePush(this.updateMedalData)
			},
			eventBind: function() {
				var t = this,
					a = this.doms;
				i.on("fans.gift.backpack.show", function(e) {
					var i = e;
					i && (t.fansGiftPackAppend(i), s.remove("fansGiftPush_" + l.get("sys.uid")))
				}), a.$sendMsgWarp.on("mouseenter", '[data-action="medal-enter-btn"]', function(i) {
					var a = e(this).attr("data-flag");
					switch (h.eventDefault(i), t.hoverEnterStatus = 1, clearTimeout(m.tipsTimer), a) {
					case m.medalEnterStatus.close:
						t.medalTipMsgConfig({
							remainType: "tip",
							type: "medalDisable",
							status: "show"
						});
						break;
					case m.medalEnterStatus.none:
						t.medalTipMsgConfig({
							remainType: "tip",
							type: "medalRemain",
							status: "show"
						});
						break;
					case m.medalEnterStatus.notWear:
						m.fansListDataState ? t.medalContentAppend() : t.medalFirstListAppend();
						break;
					case m.medalEnterStatus.yesWear:
						m.fansListDataState ? t.medalContentAppend() : t.medalFirstListAppend()
					}
				}).on("click", '[data-action="medal-enter-btn"]', function(e) {
					h.eventDefault(e), a.$sendMsgWarp.find('[data-flag="medal-entrance-warp"]').removeClass("status-full"), t.dpDealAgent({
						type: m.dpType.medalEnter
					})
				}).on("mouseleave", '[data-action="medal-enter-btn"]', function(i) {
					var a = e(this).attr("data-flag");
					switch (h.eventDefault(i), t.hoverEnterStatus = 0, a) {
					case m.medalEnterStatus.close:
						t.medalTipMsgConfig({
							remainType: "tip",
							type: "medalDisable",
							status: "hide"
						});
						break;
					case m.medalEnterStatus.none:
						t.medalTipMsgConfig({
							remainType: "tip",
							type: "medalRemain",
							status: "hide"
						});
						break;
					case m.medalEnterStatus.notWear:
						t.medalContentAppend({
							status: "hide"
						});
						break;
					case m.medalEnterStatus.yesWear:
						t.medalContentAppend({
							status: "hide"
						})
					}
				}).on("mouseenter", '[data-action="medal-tip-warp"]', function(e) {
					h.eventDefault(e), clearTimeout(m.tipsTimer)
				}).on("mouseleave", '[data-action="medal-tip-warp"]', function(i) {
					var a = e(this).attr("data-tip-type");
					h.eventDefault(i), t.medalTipMsgConfig({
						remainType: "tip",
						type: a,
						status: "hide"
					})
				}).on("mouseenter", '[data-flag="medal-info-warp"]', function(e) {
					h.eventDefault(e), t.hoverEnterStatus = 1, clearTimeout(m.tipsTimer)
				}).on("mouseleave", '[data-flag="medal-info-warp"]', function(e) {
					h.eventDefault(e), t.hoverEnterStatus = 0, t.medalContentAppend({
						status: "hide"
					})
				}).on("click", '[data-tag="fans-medal-item"] .radiobox', function(a) {
					var n = e(this),
						s = n.closest('[data-tag="fans-medal-item"]'),
						o = s.attr("data-flag"),
						l = parseInt(s.attr("data-medal-index"), 10),
						c = {};
					n.find("input").is(":checked") || (n.find("input").prop("checked", !0), "medal-take-on" == o && (m.opearMedalType = 1, c = {
						ot: 1,
						rid: m.medalListData.list[l].rid
					}), "medal-take-off" == o && (m.opearMedalType = 2, c = {
						ot: 2,
						rid: ""
					}), i.trigger("mod.room.user.fansMedal.setcurrroom", {
						bdg_id: c.rid
					}), d.exe("js_medal_opera", r.encode([{
						name: "type",
						value: m.types.medalOpera
					}, {
						name: "ot",
						value: c.ot
					}, {
						name: "rid",
						value: c.rid
					}])), t.dpDealAgent({
						type: m.dpType.medalListSel,
						selMedalRid: s.attr("data-medal-id")
					}))
				}).on("click", '[data-flag="medal-close-msg"]', function(i) {
					var a;
					h.eventDefault(i), a = e(this).parent().attr("data-msg-type"), t.medalTipMsgConfig({
						remainType: "msg",
						type: a,
						status: "hide"
					})
				}).on("click", '[data-flag="medal-get-use"]', function(t) {
					h.eventDefault(t);
					var i = e(this);
					m.opearMedalType = 1, d.exe("js_medal_opera", r.encode([{
						name: "type",
						value: m.types.medalOpera
					}, {
						name: "ot",
						value: 1
					}, {
						name: "rid",
						value: i.attr("data-medal-rid")
					}])), "msg-tip-btn" == i.attr("data-tag") && i.closest(".entrance-noticewrap").remove()
				}).on("click", '[data-flag="look-my-medal"]', function() {
					t.dpDealAgent({
						type: m.dpType.myMedalEnter
					})
				}).on("click", '[data-flag="fans-info-more"]', function() {
					t.dpDealAgent({
						type: m.dpType.fansIntroduction
					})
				}).on("click", ".fans-firstpay-entrance", function() {
					DYS.sub({
						action_code: "click_msg_firstpay",
						ext: {
							is_bdg: 1
						}
					})
				}).on("click", ".firstpay-entrance", function() {
					DYS.sub({
						action_code: "click_msg_firstpay",
						ext: {
							is_bdg: 0
						}
					})
				}), e('#container [data-flag="fans-badge-close"]').on("click", function(t) {
					h.eventDefault(t), e('[data-flag="fans-badge-lead"]').remove()
				}), e("#js-stats-and-actions").on("click", '[data-tag="fans-gift-close"]', function() {
					var t = e("#js-stats-and-actions").find(".fans-barrage-gift");
					return t.fadeOut(100, function() {
						t.remove()
					}), !1
				}).on("click", '[data-tag="fans-backpack-open"]', function() {
					e("#js-stats-and-actions .backpack-btn").trigger("click")
				}), a.$roomVideoWarp.on("click", ".fisrtpay-close", function() {
					return a.$roomVideoWarp.find(".firstpay-success").remove(), !1
				}).on("click", ".firstpay-sure-btn", function() {
					return a.$roomVideoWarp.find(".firstpay-success").remove(), !1
				}).on("click", ".firstpay-award-btn", function() {
					var i = a.$roomVideoWarp.find(".firstpay-success"),
						n = e(this).attr("data-medal-rid"),
						s = a.$sendMsgWarp.find(".entrance-noticewrap").attr("data-msg-type");
					return i.fadeOut(500, function() {
						i.remove()
					}), m.opearMedalType = 1, d.exe("js_medal_opera", r.encode([{
						name: "type",
						value: m.types.medalOpera
					}, {
						name: "ot",
						value: 1
					}, {
						name: "rid",
						value: n
					}])), s && s.length && t.medalTipMsgConfig({
						remainType: "msg",
						type: s,
						status: "hide"
					}), DYS.sub({
						action_code: "click_msg_firstpay_sel",
						ext: {
							bdg_id: n
						}
					}), !1
				}), a.$giftContent.on("click", ".firstpay-enter", function() {
					return a.$fansRechatRemain.hasClass("hide") ? a.$fansRechatRemain.removeClass("hide") : a.$fansRechatRemain.addClass("hide"), !1
				}).on("click", ".firstpay-modal-close", function() {
					return a.$fansRechatRemain.addClass("hide"), !1
				}).on("click", ".firstpay-submit", function() {
					return c.check() ? void 0 : (c.show("login"), !1)
				}), a.$container.on("click", ".fans-guide-close,.fans-guide-button", function() {
					return a.$container.find(".fans-remain-modal-wrap").remove(), !1
				}), a.$chatContent.on("click", ".fans-droping-close", function() {
					return a.$chatContent.find(".fans-medal-droping-warp").remove(), t.dropingDialogSwitch && e.dialog.tips_black("可在个人中心-我的头衔-粉丝徽章开启提醒"), !1
				}).on("click", ".fans-droping-switch", function() {
					var i = s.get(m.dropingDialogFlag);
					i ? (e(this).removeClass("close-remain"), t.dropingDialogSwitch = 0, s.set(m.dropingDialogFlag, 0, m.storageExpired)) : (e(this).addClass("close-remain"), t.dropingDialogSwitch = 1, s.set(m.dropingDialogFlag, 1, m.storageExpired))
				})
			},
			dialogEventBind: function() {
				var t = this.doms;
				e('[data-flag="fans-dialog-closebtn"]').on("click", function(e) {
					h.eventDefault(e), t.$fansIntroductionWarp.hide()
				}), t.$fansIntroductionWarp.on("click", '[data-flag="fans-tab-item"]', function(i) {
					switch (h.eventDefault(i), e(this).index()) {
					case 0:
						t.$fansIntroductionWarp.find('[data-flag="fans-tab-warp"]').addClass("what-is-fans");
						break;
					case 2:
						t.$fansIntroductionWarp.find('[data-flag="fans-tab-warp"]').addClass("how-tobe-fans");
						break;
					default:
						t.$fansIntroductionWarp.find('[data-flag="fans-tab-warp"]').removeClass("what-is-fans how-tobe-fans")
					}
					t.$fansIntroductionWarp.find('[data-flag="fans-tab-item"] a, [data-flag="tans-tab-content"]').removeClass("status-cur"), e(this).find("a").addClass("status-cur"), t.$fansIntroductionWarp.find('[data-flag="tans-tab-content"]').eq(e(this).index()).addClass("status-cur")
				})
			}
		};
	return g
}), define("douyu/com/kill-ie", ["jquery", "shark/util/template/1.0", "shark/util/storage/1.0", "douyu/context"], function(e, t, i, a) {
	var n = "dialogIe7",
		s = navigator.appVersion,
		r = {
			isIe6: -1 != s.search(/MSIE 6/i),
			isIe7: -1 != s.search(/MSIE 7/i),
			isIe8: -1 != s.search(/MSIE 8/i)
		},
		o = {
			init: function() {
				(r.isIe8 || r.isIe7 || r.isIe6) && (this.render(), this.show())
			},
			render: function() {
				var t = a.get("sys.web_url") + "app/douyu/res/com/kill-ie/chrome_pic.png?20160824",
					i = a.get("sys.web_url") + "app/douyu/res/com/kill-ie/firefox_pic.png?20160824",
					n = a.get("sys.web_url") + "app/douyu/res/com/kill-ie/downApp_sq.png?20160824",
					s = a.get("sys.web_url") + "app/douyu/res/com/kill-ie/down_btn.png?20160819",
					r = ['<div id="diaIe7" class="dia-ie7-wp">', '<span class="dia-ie7-mask"></span>', '<div class="dia-ie7-container">', '<a class="dia-ie7-cls" href="javascript:;" title="关闭"></a>', '<div class="dia-ie7-hd">', '<p class="dih-tit">温馨提示</p>', '<p class="dih-p">您当前浏览器版本过低，存在安全风险，建议您升级浏览器</p>', "</div>", '<div class="dia-ie7-browser">', '<a class="dib-lk chrome-lk" href="https://www.google.cn/intl/zh-CN/chrome/browser/desktop/" target="_blank" title="下载谷歌浏览器">', '<img src="' + t + '">', "</a>", '<a class="dib-lk firefox-lk" href="https://www.mozilla.org/zh-CN/firefox/new/" target="_blank" title="下载火狐浏览器">', '<img src="' + i + '">', "</a>", "</div>", '<div class="dia-ie7-down">', '<img class="did-sq" src="' + n + '">', '<p class="did-p">下载斗鱼APP，随时随地看直播</p>', '<a class="did-lk" href="http://www.douyu.com/client" target="_blank">', '<img src="' + s + '">', "</a>", "</div>", "</div>", "</div>"].join("");
				e("body").append(r), this.bindEvt()
			},
			show: function() {
				e(".dia-ie7-wp").show()
			},
			hide: function() {
				e(".dia-ie7-wp").hide()
			},
			bindEvt: function() {
				var t = this;
				e(".dia-ie7-cls").on("click", function() {
					t.hide()
				})
			}
		},
		l = function() {
			var e = new Date,
				t = new Date;
			return t.setHours(24), t.setMinutes(0), t.setSeconds(0), (t - e) / 1e3
		},
		c = function(e) {
			if (e) o.init();
			else {
				var t;
				if (t = i.get(n), t && 1 === t.flag) return;
				i.set(n, {
					flag: 1
				}, l()), o.init()
			}
		};
	return {
		init: c
	}
}), define("douyu/page/room/normal/mod/baidu-hm", ["jquery", "douyu/page/room/base/api"], function(e, t) {
	function i() {
		a || (setTimeout(function() {
			var e = document.createElement("script");
			e.src = "//hm.baidu.com/hm.js?e99aee90ec1b2106afe7ec3b199020a7";
			var t = document.getElementsByTagName("script")[0];
			t.parentNode.insertBefore(e, t)
		}, 0), a = 1)
	}
	var a = 0;
	return {
		init: function() {
			t.reg("room_data_info", function() {
				i()
			})
		}
	}
}), define("douyu/com/zoom-dp", ["jquery", "shark/observer"], function(e, t) {
	function i(e) {
		DYS.sub(e)
	}
	var a = {
		"dys.com.zoom.pop.show": function(e) {
			i({
				action_code: "show_live_pagescal"
			})
		},
		"dys.com.zoom.pop.close": function(e) {
			i({
				action_code: "click_live_pagescal_close"
			})
		},
		"dys.com.zoom.pop.zoomtip": function(e) {
			i({
				action_code: "click_live_pagescal_no"
			})
		}
	};
	for (var n in a)!
	function(e) {
		var i = a[e];
		t.on(e, function(e) {
			i.call(this, e)
		})
	}(n);
	return {
		init: function(e) {
			DYS.sub.setPageCode(e)
		}
	}
}), define("douyu/com/zoom", ["jquery", "shark/observer", "shark/util/cookie/1.0", "shark/util/storage/1.0", "douyu/context", "douyu/com/zoom-dp"], function(e, t, i, a, n, s) {
	var r = {
		storageName: "zoomtip",
		storageVal: "1",
		storageTime: 604800,
		isPop: !1,
		init: function() {
			this.handleCookie(), this.pop(), t.on("mod.layout.screen.change", function(e) {
				r.detect() && r.pop()
			})
		},
		handleCookie: function() {
			i.get(this.storageName) && (i.remove(this.storageName), a.set(this.storageName, this.storageVal, this.storageTime))
		},
		detect: function() {
			return this.ua = navigator.userAgent.toLowerCase(), -1 == this.ua.indexOf("windows") ? !1 : !a.get(this.storageName)
		},
		cal: function() {
			var e = 0,
				t = window.screen;
			return void 0 !== window.devicePixelRatio ? e = window.devicePixelRatio : ~this.ua.indexOf("msie") ? t.deviceXDPI && t.logicalXDPI && (e = t.deviceXDPI / t.logicalXDPI) : void 0 !== window.outerWidth && void 0 !== window.innerWidth && (e = window.outerWidth / window.innerWidth), e && (e = Math.round(100 * e)), 99 !== e && 101 !== e || (e = 100), e
		},
		resize: function() {
			var t = this.cal();
			if (this.isPop && t && 100 == t) return void this.close();
			var i = 540,
				a = 432,
				n = 100 * i / t,
				s = 100 * a / t;
			e(".pop-zoom-container").css({
				width: n + "px",
				height: s + "px",
				marginLeft: -n / 2 + "px",
				marginTop: -s / 2 + "px"
			})
		},
		pop: function() {
			var i = this.cal();
			if (!a.get(this.storageName) && !this.isPop && 100 !== i) {
				var s = n.get("sys.web_url") + "app/douyu/res/com/sg-zoom-error.png?20160823",
					r = ['<div class="pop-zoom-container">', '<div class="pop-zoom">', '<img class="pop-zoom-bg" src="', s, '">', '<div class="pop-zoom-close">close</div>', '<div class="pop-zoom-hide"></div>', "</div>", "</div>"].join("");
				e("body").append(r), this.bindEvt(), this.isPop = !this.isPop, t.trigger("dys.com.zoom.pop.show")
			}
			this.resize()
		},
		close: function() {
			e(".pop-zoom-container").remove(), this.isPop = !this.isPop, t.trigger("dys.com.zoom.pop.close")
		},
		bindEvt: function() {
			var i = this;
			e(".pop-zoom-close").on("click", function() {
				i.close()
			}), e(".pop-zoom-hide").on("click", function() {
				a.set(i.storageName, i.storageVal, i.storageTime), t.trigger("dys.com.zoom.pop.zoomtip"), i.close()
			})
		}
	},
		o = function() {
			r.detect() && r.init()
		};
	e(o)
}), define("douyu/page/room/normal/mod/page-full", ["jquery", "shark/class", "shark/observer", "shark/util/lang/1.0", "shark/util/storage/1.0", "shark/util/template/1.0", "douyu/context", "douyu/page/room/base/api"], function(e, t, i, a, n, s, r, o) {
	var l = {
		localstorage: "pageFullSibarState",
		localstorageGuide: "pageFullIsGuideLayerShowed",
		expireTime: 31536e4,
		siberShowTime: 2e3,
		guideLayerTime: 5100,
		guideLayerIETime: 6200,
		state: {
			open: "open",
			close: "close"
		}
	},
		c = t({
			init: function(t) {
				this.config = e.extend(!0, {}, {
					hideChatGiftClassName: "hide-chatgift-area",
					sideBarTimer: null,
					uid: r.get("sys.uid") ? r.get("sys.uid") : ""
				}, t), this.getDoms(), this.render(), this.addEvent()
			},
			getDoms: function() {
				var t = e("body");
				this.doms = {
					$body: t,
					$fullpageOperate: e(".fullpage-operate")
				}
			},
			render: function() {
				var e = this.doms;
				navigator.userAgent.indexOf("MSIE") > 0 && e.$fullpageOperate.find(".toggle-chatgift-area").addClass("ie-bg"), "undefined" == typeof $ROOM.isActive && e.$body.addClass("layout-newfullpage")
			},
			setVideoSidebarState: function() {
				var e = this,
					t = (e.doms, e.config),
					a = e.getState(t.uid);
				"full" === i.fire("mod.video.state.get") && e[a === l.state.close ? "close" : "open"]()
			},
			toggle: function() {
				var e = this,
					t = e.doms,
					a = e.config,
					n = (t.$body, "full" === i.fire("mod.video.state.get"));
				n && a.state === l.state.open ? e.close() : e.open(), i.trigger("mod.video.state.change", n), e.processSideBar()
			},
			open: function() {
				var t = this,
					i = t.doms,
					s = t.config,
					r = i.$body,
					c = e(".toggle-chatgift-area"),
					d = c.find(".toggle-chatgift-btn"),
					u = a.string.format("点击{0}右侧和底部菜单", d.data("closetitle")),
					f = {};
				s.state = l.state.open, s.uid && (f = t.getState(), f[s.uid] = s.state, n.set(l.localstorage, JSON.stringify(f), l.expireTime)), r.removeClass(s.hideChatGiftClassName), d.attr({
					title: u
				}), o.exe("js_page_fullscreen_state", 0), t.point(2)
			},
			close: function() {
				var t = this,
					i = t.doms,
					s = t.config,
					r = i.$body,
					c = e(".toggle-chatgift-area"),
					d = c.find(".toggle-chatgift-btn"),
					u = a.string.format("点击{0}右侧和底部菜单", d.data("opentitle")),
					f = {};
				s.state = l.state.close, s.uid && (f = t.getState(), f[s.uid] = s.state, n.set(l.localstorage, JSON.stringify(f), l.expireTime)), r.addClass(s.hideChatGiftClassName), d.attr({
					title: u
				}), o.exe("js_page_fullscreen_state", 1), t.point(1)
			},
			point: function(e) {
				try {
					DYS.sub({
						action_code: "click_wfmsg_hide",
						ext: {
							stat: e
						}
					})
				} catch (t) {}
			},
			getGuideLayerState: function() {
				var e = this,
					t = (e.config, e.doms, l.localstorageGuide),
					i = n.get(t) ? n.get(t) : !1,
					a = Boolean(i);
				return a
			},
			guideLayerShow: function() {
				var t, i, n, o = this;
				t = a.string.join('<div class="guide-layer">', '<img src="<%= url %>"/>', "</div>"), i = s.compile(t), n = i({
					url: a.string.format("{0}app/douyu/res/page/room-normal/fullpage-guide-layer.gif?v={1}", r.get("sys.web_url"), (new Date).getTime())
				}), o.$guideLayerview = e(n), o.doms.$fullpageOperate.find(".toggle-chatgift-area").append(o.$guideLayerview), o.$guideLayerview.show()
			},
			guideLayerHide: function() {
				var t = e(".guide-layer");
				0 != t.length && (t.hide(), t.remove())
			},
			guideLayerDestory: function() {
				clearTimeout(this.config.sideBarTimer), this.config.sideBarTimer = null, this.guideLayerHide()
			},
			getState: function(t) {
				var i = this,
					a = i.config,
					s = (i.doms, l.localstorage),
					r = n.get(s) ? n.get(s) : "{ }",
					o = JSON.parse(r);
				return "undefined" == typeof t ? o : "" === t ? a.state : e.isEmptyObject(o) ? a.state : o[t]
			},
			processSideBar: function() {
				var e = this,
					t = this.doms,
					a = t.$body,
					s = a.find(".toggle-chatgift-slider"),
					r = a.find(".toggle-chatgift-area"),
					o = r.find(".toggle-chatgift-btn"),
					c = !1,
					d = l.siberShowTime;
				"full" === i.fire("mod.video.state.get") ? (e.sideBarShow(o, s), c = e.getGuideLayerState(), c || (e.guideLayerShow(), n.set(l.localstorageGuide, !0, l.expireTime), d = navigator.userAgent.indexOf("MSIE") > 0 || navigator.userAgent.indexOf("Trident") > 0 || navigator.userAgent.indexOf("Edge") > 0 ? l.guideLayerIETime : l.guideLayerTime), e.config.sideBarTimer = window.setTimeout(function() {
					e.sideBarHide(o, s), e.guideLayerDestory()
				}, d)) : (e.sideBarHide(o, s), e.guideLayerDestory())
			},
			sideBarShow: function(e, t) {
				e.addClass("show active"), t.show().addClass("active")
			},
			sideBarHide: function(e, t) {
				e.removeClass("show active"), t.hide().removeClass("active")
			},
			addEvent: function() {
				var t = this,
					a = this.doms,
					n = a.$body,
					s = n.find(".toggle-chatgift-slider"),
					r = n.find(".toggle-chatgift-area"),
					o = r.find(".toggle-chatgift-btn");
				r.on("mouseenter", function(t) {
					var i = e(this),
						a = i.data("timer");
					a && clearTimeout(a), a = setTimeout(function() {
						o.addClass("show"), s.show()
					}, 0), i.data("timer", a)
				}).on("mouseleave", function(i) {
					if (!t.config.sideBarTimer) {
						var a = e(this),
							n = a.data("timer");
						n = window.setTimeout(function() {
							o.removeClass("show"), s.hide()
						}, 500), a.data("timer", n)
					}
				}), o.on("mouseenter", function() {
					o.addClass("active"), s.show().addClass("active")
				}).on("mouseleave", function() {
					t.config.sideBarTimer || (o.removeClass("active"), s.removeClass("active"))
				}).on("click", function() {
					o.addClass("active"), s.show().addClass("active"), t.toggle()
				}), i.on("mod.normal.pagefull.videoSidebarStateInit", function(e) {
					t.setVideoSidebarState()
				}), i.on("mod.normal.pagefull.videoSidebar.toggle", function(e) {
					t.processSideBar()
				})
			}
		}),
		d = {
			init: function(e) {
				return new c(e)
			}
		};
	return d
}), define("douyu/page/room/normal/mod/freetime", ["jquery", "douyu/page/room/base/api", "shark/util/flash/data/1.0", "shark/util/storage/1.0"], function(e, t, i, a) {
	var n, s = {
		interval: 86400,
		screenState: 0,
		rushHour: [{
			start: 20,
			end: 23,
			interval: 2400
		}],
		listenInterval: 3e4
	},
		r = 0,
		o = "freetimed",
		l = !1,
		c = !1,
		d = +new Date,
		u = function(e) {
			-1 !== window.location.href.indexOf("freetime_debug") && (window.FreeTime = n, window.console && console.log && console.log(e, " FreeTime ", new Date))
		};
	return n = {
		init: function(e) {
			t.reg("room_data_idle", function(e) {
				n.startListening()
			}), t.reg("room_data_idle_dp", function(e) {
				var t = i.decode(e).too(),
					a = n.dpData(t.stage, t);
				n.dp(a), u("flash打点"), 3 === parseInt(t.stage) && (u("点击继续观看"), n.startListening()), 4 === parseInt(t.stage) && (u("倒计时结束,停止监听"), n.stopListening())
			}), t.reg("room_screenChange", function(e) {
				var t = i.decode(e).too();
				s.screenState = parseInt(t.state, 10) || 0, 0 === s.screenState ? n.startListening() : n.stopListening()
			})
		},
		startListening: function() {
			c = !1, l = !0, d = +new Date, n.startMoveInterval(), e(document).on("mousemove.freetime", function(e) {
				n.moveMouse(e), n.startMoveInterval(), u("用户移动鼠标")
			}), u("监听开始")
		},
		stopListening: function() {
			c = !1, l = !1, d = +new Date, n.stopMoveInterval(), e(document).off("mousemove.freetime"), u("监听关闭")
		},
		startMoveInterval: function() {
			var e = a.get(o);
			return e ? !1 : (clearTimeout(r), void(r = setTimeout(function() {
				var e = new Date,
					t = n.getIdleInterval(e.getHours());
				e.getTime() - d > 1e3 * t && c === !1 && n.handleTimeUp(), n.startMoveInterval(), u("用户长时间无操作监听")
			}, s.listenInterval)))
		},
		stopMoveInterval: function() {
			clearTimeout(r)
		},
		moveMouse: function(e) {
			d = +new Date, c === !0 && n.hideHandle()
		},
		handleTimeUp: function() {
			n.showHandle(), n.dpOverTime()
		},
		getIdleInterval: function(t) {
			var i = t || (new Date).getHours(),
				a = s.interval;
			return e.each(s.rushHour, function(e, t) {
				return i >= t.start && i < t.end ? (a = t.interval, !1) : void 0
			}), a
		},
		addIdleInterval: function(e) {
			s.rushHour.push(e)
		},
		__setDebug: function(e, t) {
			var i = (new Date).getHours();
			s.rushHour.push({
				start: i,
				end: i + 2,
				interval: +e || 10
			}), s.listenInterval = 1e3 * (+t || 12)
		},
		showHandle: function() {
			c = !0, t.exe("js_UserNoHandle"), a.set(o, !0, n.getRestTime() / 1e3), u("计时结束,显示遮罩,关闭直播流!")
		},
		showFlowHandle: function() {
			c = !0, t.exe("js_UserNoFlowHandle"), u("遮罩不关流!")
		},
		hideHandle: function() {
			c = !1, t.exe("js_UserHaveHandle"), u("移除遮罩!")
		},
		getRestTime: function(e) {
			var t, i;
			return e = e ? parseInt(e, 10) : 0, t = new Date, t.setDate(t.getDate() + e), t.setHours(24), t.setMinutes(0), t.setSeconds(0), i = t.getTime() - (new Date).getTime()
		},
		dp: function(e) {
			try {
				DYS.sub(e)
			} catch (t) {}
		},
		dpOverTime: function() {
			var e = n.dpData(1);
			e.ot = n.getNowUnixTime(), n.dp(e)
		},
		dpData: function(e, t) {
			var i = {},
				a = "";
			try {
				switch (parseInt(e, 10)) {
				case 1:
					a = "show_idlelive_adjust_remind";
					break;
				case 2:
					a = "show_idlelive_adjust_recover";
					break;
				case 3:
					a = "click_idlelive_adjust_continue";
					break;
				case 4:
					a = "show_idlelive_adjust_close"
				}
				i = {
					action_code: a
				}, t && t.pt && (i.pt = t.pt), t && t.ot && (i.ot = t.ot), t && t.e && (i.ext = t.e)
			} catch (n) {}
			return i
		},
		getNowUnixTime: function() {
			return Math.round((new Date).getTime() / 1e3)
		}
	}
}), define("douyu/page/room/normal/mod/cover-title-remind", ["jquery", "shark/util/flash/data/1.0", "douyu/context", "douyu/page/room/base/api"], function(e, t, i, a) {
	var n = {
		showMark: 0,
		init: function() {
			var n = this,
				s = i.get("room.owner_uid"),
				r = i.get("sys.uid");
			n.box = e("#js-room-video"), s == r && a.reg("room_data_handler", function(e) {
				var a = t.decode(e).too();
				"tcremind" == a.type && a.rid == i.get("room.room_id") && n.showRemind(a.tc, a.msg)
			})
		},
		showRemind: function(t, i) {
			var a = this;
			a.remindBox ? (a.remindBox.empty(), clearTimeout(a.timeTicket)) : (a.remindBox = e('<div class="background-control-box"></div>'), a.box.append(a.remindBox));
			var n = +t,
				s = n ? a.titleTpl(i) : a.coverTpl(i);
			a.remindBox.append(s), a.remindBox.show(), n ? a.setTimeClose(5) : a.setTimeClose(15), a.bindEvent()
		},
		bindEvent: function() {
			var e = this;
			e.remindBox.on("click", "[data-close]", function() {
				e.hideRemind()
			})
		},
		setTimeClose: function(e) {
			var t = this;
			t.timeTicket = setTimeout(function() {
				t.hideRemind()
			}, 1e3 * e)
		},
		hideRemind: function() {
			clearTimeout(this.timeTicket), this.remindBox.hide()
		},
		coverTpl: function(e) {
			return ['<a href="javascript:void(0);" data-close class="background-control-close"></a>', "<h2>上传封面</h2>", "<p>", e || "为了更好提升您的热度已为您更换封面，<br>下次请记得上传优质封面～", "</p>"].join("")
		},
		titleTpl: function(e) {
			return ['<a href="javascript:void(0);" data-close class="background-control-close"></a>', "<h2>修改标题</h2>", "<p>", e || "为了规范您的标题已为您修改标题，<br>下次请记得编辑优质合格标题帮您提升热度哦～", "</p>"].join("")
		}
	};
	return {
		init: function() {
			n.init()
		}
	}
}), define("douyu/page/room/normal/mod/charge", ["jquery", "shark/class", "shark/observer", "douyu/context", "douyu/com/user", "douyu/page/room/base/api", "shark/util/cookie/1.0", "shark/util/storage/1.0", "shark/util/flash/data/1.0", "shark/util/template/1.0"], function(e, t, i, a, n, s, r, o, l, c) {
	function d(e, t) {
		var i = "",
			a = e.getFullYear(),
			n = e.getMonth() + 1,
			s = e.getDate(),
			r = e.getHours(),
			o = e.getMinutes(),
			l = e.getSeconds();
		return n = n > 9 ? n : "0" + n, s = s > 9 ? s : "0" + s, r = r > 9 ? r : "0" + r, o = o > 9 ? o : "0" + o, l = l > 9 ? l : "0" + l, !e || isNaN(e) ? i : (t = t.replace("YYYY", a), t = t.replace("MM", n), t = t.replace("DD", s), t = t.replace("hh", r), t = t.replace("mm", o), t = t.replace("ss", l), i = t)
	}
	var u = window.$ROOM,
		f = window.$SYS,
		p = f.groupid,
		m = p >= 5,
		h = u.owner_uid == f.uid,
		g = "liveNotify",
		v = 0,
		y = Number.prototype.toFixed,
		b = a.get("room.eticket"),
		k = {},
		w = {};
	w.processArrData = function(t) {
		var i, a, n = [];
		if (!t) return n;
		i = t.split("/");
		for (var s = 0, r = i.length; r > s; s++) a = l.decode(i[s]).too(), e.isPlainObject(a) && !e.isEmptyObject(a) && n.push(a);
		return n
	};
	var _ = {
		init: function(e) {
			var t = this;
			this.reset(), C.init(), s.reg("room_data_buytickets", function(e) {
				t.buyTickets(e)
			}), s.reg("room_data_chargelive", function(e) {
				return e ? void t.chargeLive(e) : !1
			}), s.reg("room_data_endchargelive", function(e) {
				t.endChargeLive(e)
			}), s.reg("room_data_endtrysee", function(e) {
				t.changeTxt(e.flash_is_yuanhua), x.endtrysee(e)
			}), s.reg("room_data_cden", function(e) {
				var t = l.decode(e).too(); !! t.enter;
				t.coll = w.processArrData(t.coll), C.freeChatColor(t)
			}), s.reg("room_data_nstip", function(e) {
				C.findTicktUserEnter(e)
			}), s.reg("room_data_nstip2", function(e) {
				C.findTicktUserEnter(e)
			}), i.on("mod.charge.tickets.buy", function(e) {
				t.buyTickets(e)
			})
		},
		reset: function() {
			u = window.$ROOM, f = window.$SYS, p = f.groupid, m = p >= 5, h = u.owner_uid == f.uid, g = "liveNotify", v = 0, y = Number.prototype.toFixed, b = a.get("room.eticket")
		},
		changeTxt: function(e) {
			k = e ? {
				0: {
					txt: "",
					btntxt: "直播"
				},
				1: {
					txt: "原画",
					btntxt: "原画"
				},
				2: {
					txt: "原画",
					btntxt: "原画"
				}
			} : {
				0: {
					txt: "",
					btntxt: "直播"
				},
				1: {
					txt: "超清",
					btntxt: "超清"
				},
				2: {
					txt: "超清",
					btntxt: "超清"
				}
			}
		},
		chargeLive: function(t) {
			b = t.data.payment_mode, this.changeTxt(t.flash_is_yuanhua);
			if (110017 == t.error) return e.dialog.tips_black(t.msg), !1;
			if (0 != t.error && 110006 != t.error) return !1;
			if (!n.check()) return "0" == b ? !1 : "1" != b && "2" != b || "0" != t.error ? !1 : (x.showTimeUserTipForCryptonym(t), !1);
			f = window.$SYS, p = f.groupid, m = p >= 5, h = u.owner_uid == f.uid;
			var i = t.data;
			s.exe("js_exitFullScreen");
			var r = parseInt(1e3 * i.start_time),
				l = parseInt(1e3 * i.end_time),
				c = parseInt(i.expire_time),
				d = parseInt(i.trail_seconds),
				k = d / 60,
				w = i.is_pay,
				_ = 0,
				C = parseInt(i.price) / 100;
			if (C != parseInt(C) && (C = y.call(C, 1)), h) {
				var T = new Date(r);
				if (T.setHours(24), T.setMinutes(0), T.setSeconds(0), _ = T.getTime() - (new Date).getTime(), 0 > _ && (o.set(g, a.get("sys.uid"), _ / 1e3), o.set("eticket", b, _ / 1e3)), a.get("sys.uid") == o.get(g) && o.get("eticket") == b) return !1;
				o.set(g, a.get("sys.uid"), _ / 1e3), o.set("eticket", b, _ / 1e3), x.showTimeAnchorTip(k)
			} else if (!m) {
				new Date(r), new Date(l);
				v = 1 === a.get("room.show_status"), c > 0 && v && !w && x.showTimeUserTip(t, k)
			}
		},
		endChargeLive: function(t) {
			b = t, h ? (s.exe("js_exitFullScreen"), x.endShowTimeAnchorTip()) : m || "1" != b && "2" != b || (e(".room-charge-loginTitle-panel").size() > 0 && e(".room-charge-loginTitle-panel").hide(), e(".room-charge-userTip-panel").size() > 0 && e(".room-charge-userTip-panel").hide(), e(".room-charge-buyTip-panel").size() && e(".room-charge-buyTip-panel").hide()), o.remove(g)
		},
		buyTickets: function(t) {
			if (!t) return !1;
			if (-1 == t.error) return e.dialog.tips_black(t.msg), !1;
			b = t.data.payment_mode, this.changeTxt(t.flash_is_yuanhua), s.exe("js_exitFullScreen");
			var i = null,
				a = 0,
				r = 0;
			if (i = t.data, !n.check()) return n.show("login"), !1;
			if (!i.need_pay) return !1;
			if (r = parseFloat(e('[data-login-user="gold"]').eq(0).text()), isNaN(r)) return e.dialog.tips_black("正在获取余额，请稍后再试！"), !1;
			a = parseInt(i.price) / 100, a != parseInt(a) && (a = y.call(a, 1));
			var o = d(new Date(parseInt(1e3 * i.show_start)), "YYYY/MM/DD/ hh:mm"),
				l = d(new Date(parseInt(1e3 * i.show_end)), "YYYY/MM/DD/ hh:mm");
			h || m || (r >= a ? x.buyTicket(i, a, r, o, l) : x.ticketRecharge(i, a, r, o, l))
		}
	},
		x = {
			userLogin: function() {
				if ("1" == b || "2" == b) {
					var t = k[b].txt,
						i = e([' <div class="room-charge-loginTitle-panel">', '<a data-role="confirm" class="room-charge-login-close" href="javascript:;"></a>', '<div class="room-charge-login-info">', '<div>本场<span class="color-org">' + t + "</span>画质需购买门票哦</div>", '<div><span class="color-org">请登录购买</span></div></div>', '<div class="room-charge-loginTitle-btnGroup"><a class="login-btn" href="javascript:;"></a>', '<a class="register-btn" href="javascript:;"></a></div></div>'].join(""));
					e(".room-charge-loginTitle-panel").remove(), e("body").append(i), i.on("click", '[data-role="confirm"]', function() {
						i.hide()
					}), i.on("click", ".login-btn", function() {
						i.hide(), n.show("login")
					}), i.on("click", ".register-btn", function() {
						i.hide(), n.show("register")
					})
				}
			},
			showTimeAnchorTip: function(t) {
				var i = "0" == b ? "" : "清晰度",
					a = e(["<div class='room-charge-anchorTip-panel'>", '<a data-role="confirm" class="room-charge-anchorTip-close" href="javascript:;"></a>', '<div class="room-charge-anchorTip-info">', "<div>" + i + '<span class="color-pink">付费</span>时间<span class="color-pink">已开始</span></div>', '<div><span class="small-font">用户可试看' + t + "分钟，试看结束后将需要付费</span></div></div>", '<div class="room-charge-anchorTip-btnGroup"><a class="ok-btn" href="javascript:;"></a></div>', "</div>"].join(""));
				e(".room-charge-anchorTip-panel").remove();
				try {
					DYS.submit({
						point_id: "5.16.1.0"
					})
				} catch (n) {}
				e("body").append(a), a.on("click", ".room-charge-anchorTip-close,.ok-btn", function() {
					a.hide()
				})
			},
			endShowTimeAnchorTip: function() {
				var t = "0" == b ? "" : "清晰度",
					i = e(["<div class='room-charge-anchorTip-panel'>", '<a data-role="confirm" class="room-charge-anchorTip-close" href="javascript:;"></a>', '<div class="room-charge-anchorTip-info">', "<div>" + t + '<span class="color-pink">付费</span>时间<span class="color-pink">已结束</span>', '，请<span class="color-pink">关闭直播</span>！</div>', "<div>否则付费时长将一直持续。</div></div>", '<div class="room-charge-anchorTip-btnGroup"><a class="ok-btn" href="javascript:;"></a></div>', "</div>"].join(""));
				e(".room-charge-anchorTip-panel").remove();
				try {
					DYS.submit({
						point_id: "5.16.6.0"
					})
				} catch (a) {}
				e("body").append(i), i.on("click", ".room-charge-anchorTip-close,.ok-btn", function() {
					i.hide()
				})
			},
			privilegeHtml: function(e) {
				for (var t = "", i = e ? e.split("|") : [], a = 0; a < i.length; a++) t += 0 == a ? '<div class="ticket-privilege-title">' + i[a] + "</div>" : '<div class="ticket-privilege-des privilege-' + a + '"><i class="ticket-point"></i><span>' + i[a] + "</span></div>";
				return t
			},
			showTimeUserTip: function(t, i) {
				var a = "0" == b ? "" : k[b].txt,
					n = ["<div class='room-charge-userTip-panel '>", '<a data-role="confirm" class="room-charge-userTip-close" href="javascript:;"></a>', '<div class="room-charge-userTip-info">', "试看" + i + '分钟<span class="note-big">' + a + "</span>", "</div>", '<div class="ticket-privilege"></div>', '<div class="room-charge-userTip-btnGroup"><a class="buy-btn" href="javascript:;">朕要看' + k[b].btntxt + "</a></div>", "</div>"].join("");
				try {
					DYS.submit({
						point_id: "5.16.4.0"
					})
				} catch (s) {}
				var r = e(n);
				r.find(".ticket-privilege").append(this.privilegeHtml(t.data.ticket_note)), "0" == b && r.find(".room-charge-userTip-info").html("本场直播需要购买门票"), e(".room-charge-userTip-panel").remove(), e("#js-room-video").append(r), r.on("click", ".room-charge-userTip-close", function() {
					r.hide()
				}).on("click", ".buy-btn", function() {
					try {
						DYS.submit({
							point_id: "5.16.12.0"
						})
					} catch (e) {}
					r.hide(), _.buyTickets(t)
				})
			},
			showTimeUserTipForCryptonym: function(t) {
				var i = k[b].txt,
					a = ["<div class='room-charge-userTip-panel'>", '<a data-role="confirm" class="room-charge-userTip-close" href="javascript:;"></a>', '<div class="room-charge-userTip-info">', '购买门票尊享<span class="note-big">' + i + "</span>", "</div>", '<div class="ticket-privilege"></div>', '<div class="room-charge-userTip-btnGroup"><a class="buy-btn" href="javascript:;">朕要看' + k[b].btntxt + "</a></div>", "</div>"].join(""),
					n = e(a);
				n.find(".ticket-privilege").append(this.privilegeHtml(t.data.ticket_note)), e(".room-charge-userTip-panel").remove();
				try {
					DYS.submit({
						point_id: "5.16.4.0"
					})
				} catch (s) {}
				e("#js-room-video").append(n), n.on("click", ".room-charge-userTip-close", function() {
					n.hide()
				}).on("click", ".buy-btn", function() {
					try {
						DYS.submit({
							point_id: "5.16.12.0"
						})
					} catch (e) {}
					n.hide(), _.buyTickets(t)
				})
			},
			endtrysee: function(t) {
				if (!t) return !1;
				if (h || m) return !1;
				if (b = t.data.payment_mode, s.exe("js_exitFullScreen"), "1" == b || "2" == b) {
					var i = ["<div class='room-charge-userTip-panel room-charge-userTip-ets-panel'>", '<a data-role="confirm" class="room-charge-userTip-close" href="javascript:;"></a>', '<div class="room-charge-userTip-info">', '&nbsp;&nbsp;&nbsp;&nbsp;试看<span class="note-big">已结束</span>', "</div>", '<div class="ticket-privilege"></div>', '<div class="room-charge-userTip-btnGroup"><a class="buy-btn" href="javascript:;">朕要看' + k[b].btntxt + "</a></div>", "</div>"].join(""),
						a = e(i);
					a.find(".ticket-privilege").append(this.privilegeHtml(t.data.ticket_note)), e(".room-charge-userTip-panel").remove();
					try {
						DYS.submit({
							point_id: "5.16.7.0"
						})
					} catch (n) {}
					e("#js-room-video").append(a), a.on("click", ".room-charge-userTip-close", function() {
						a.hide()
					}).on("click", ".buy-btn", function() {
						try {
							DYS.submit({
								point_id: "5.16.13.0"
							})
						} catch (e) {}
						a.hide(), _.buyTickets(t)
					})
				} else "0" == b && e(".room-charge-userTip-panel").remove()
			},
			buyTicket: function(t, n, r, o, l) {
				var c = this,
					d = t.ticket_name ? t.ticket_name : "门票名称",
					f = t.ticket_privilege ? '<img src="' + $SYS.resource_url + t.ticket_privilege + '"/>' : "",
					p = [' <div class="room-charge-buyTip-panel">', '<div class="room-charge-buyTip-headbg">', '<a href="javascript:;" class="room-charge-buyTip-close"></a>', '<div class="room-charge-buyTip-des">', '<div class="etickt-name">' + d + "</div>", '<div class="etickt-price"><span class="color-org">' + n + "</span>鱼翅</div>", '<div class="etickt-time">' + o + "-" + l + "</div>", "<div></div>", "</div>", "</div>", '<div class="room-charge-buyTip-weal">' + f + "</div>", '<div class="room-charge-buyTip-footer">', '<div class="room-charge-buyTip-check">鱼翅余额为' + r + "，将扣除您" + n + "鱼翅，确认购买吗？</div>", '<a class="buy-btn js-buy-btn" herf="javasript:;">购买</a>', "</div>", "</div>"].join(""),
					m = e(p);
				m.find("room-charge-buyTip-weal"), e(".room-charge-buyTip-panel").remove(), e("body").append(m), m.on("click", ".room-charge-buyTip-close", function() {
					m.hide()
				});
				try {
					DYS.submit({
						point_id: "5.16.14.0"
					})
				} catch (h) {}
				m.on("click", ".js-buy-btn", function() {
					try {
						DYS.submit({
							point_id: "5.16.8.0"
						})
					} catch (r) {}
					e.ajax({
						url: "/room/eticket/deal_eticket",
						dataType: "json",
						type: "post",
						data: {
							ticket_id: t.ticket_id,
							room_id: u.room_id,
							dy: a.get("room.device_id")
						}
					}).then(function(t) {
						var a = t.msg;
						switch (parseInt(t.code, 10)) {
						case 0:
							try {
								DYS.submit({
									point_id: "5.16.18.0"
								})
							} catch (r) {}
							e.dialog.tips_black("购买成功"), m.hide(), e(".room-charge-userTip-panel").size() > 0 && e(".room-charge-userTip-panel").hide(), i.trigger("mod.userinfo.change", {
								current: {
									gold: a.balance / 100
								}
							}), s.exe("js_buytickets_success");
							break;
						case 12:
							var o = parseInt(a.balance, 10),
								l = parseInt(a.noble_balance, 10),
								d = (o - l) / 100,
								u = parseInt(a.noble_ingf, 10);
							l && !u && c.ticketRecharge2(n, 0 > d ? 0 : d), u && e('[data-login-content="yes"] .y3').hide();
							break;
						default:
							e.dialog.tips_black(a)
						}
					})
				})
			},
			ticketRecharge: function(t, i, a, n, s) {
				var r = t.ticket_name ? t.ticket_name : "门票名称",
					o = t.ticket_privilege ? '<img src="' + $SYS.resource_url + t.ticket_privilege + '"/>' : "",
					l = [' <div class="room-charge-buyTip-panel">', '<div class="room-charge-buyTip-headbg">', '<a href="javascript:;" class="room-charge-buyTip-close"></a>', '<div class="room-charge-buyTip-des">', '<div class="etickt-name">' + r + "</div>", '<div class="etickt-price"><span class="color-org">' + i + "</span>鱼翅</div>", '<div class="etickt-time">' + n.replace(" ", "") + "-" + s.replace(" ", "") + "</div>", "<div></div>", "</div>", "</div>", '<div class="room-charge-buyTip-weal">' + o + "</div>", '<div class="room-charge-buyTip-footer">', '<div class="room-charge-buyTip-check">鱼翅余额为' + a + "，您的鱼翅不足，请先充值</div>", '<a class="buy-btn js-recharge-btn" herf="javasript:;">充值</a>', "</div>", "</div>"].join(""),
					c = e(l);
				e(".room-charge-buyTip-panel").remove(), e("body").append(c);
				try {
					DYS.submit({
						point_id: "5.16.15.0"
					})
				} catch (d) {}
				c.on("click", ".room-charge-buyTip-close", function() {
					c.hide()
				}), c.on("click", ".js-recharge-btn", function() {
					c.hide();
					try {
						DYS.storage.save("_dypay_fp", 5)
					} catch (e) {}
					try {
						DYS.submit({
							point_id: "5.16.9.0"
						})
					} catch (e) {}
					window.open("/web_game/welcome/18")
				})
			},
			ticketRecharge2: function(t, i) {
				var a = ['<div class="room-charge-buyTip-panel spend--artdialog--fail">', '<div class="room-charge-buyTip-headbg">', '<a href="javascript:;" data-buyTip="cancel" class="room-charge-buyTip-close"></a>', '<h2 class="spend--fail--title">购买失败</h2>', "</div>", '<div class="room-charge-buyTip-weal">', "<h4>门票价格: <%= price %>元</h4>", '<p><a href="javascript:;">贵族鱼翅不能用于购买门票！</a>除去贵族鱼翅后，您的账户剩余<%= balance %>鱼翅，不足以支付门票！</p>', "</div>", '<div class="room-charge-buyTip-footer">', '<p class="spend--fail--btnbox">', '<a href="javascript:;" data-buyTip="recharge" class="myvipbtn orangebtn">获取鱼翅</a>', '<a href="javascript:;" data-buyTip="cancel" class="myvipbtn graybtn">取消</a> ', "</p>", "</div>", "</div>"].join(""),
					n = c.compile(a),
					s = n({
						price: t,
						balance: i
					}),
					r = e(s);
				e(".room-charge-buyTip-panel").remove(), e("body").append(r), r.on("click", '[data-buyTip="recharge"]', function() {
					window.open("/web_game/welcome/18"), r.remove()
				}), r.on("click", '[data-buyTip="cancel"]', function() {
					r.remove()
				})
			}
		},
		C = {
			$view: e("#js-chat-cont"),
			init: function() {
				this.$view.append("<div class='liveTicket'></div>")
			},
			freeChatColor: function(e) {
				for (var t = !0, a = 0; a < e.coll.length; a++) 0 == e.coll[a].free && (t = !1);
				e.coll.length || (t = !1), i.trigger("mod.chat.msg.color.free", {
					corlorArr: e.coll,
					freeAll: t,
					eid: e.eid
				})
			},
			findTicktUserEnter: function(e) {
				var t = l.decode(e).too();
				if (t.el = w.processArrData(t.el), $ROOM.effectInfo) {
					for (var i = 0; i < t.el.length; i++) if ("1500000092" === t.el[i].eid || "1500000094" === t.el[i].eid) return;
					for (var a = 0; a < t.el.length; a++) 2 == t.el[a].etp && 1 == t.el[a].ef && this.showUEnterTip(t, t.el[a].eid)
				}
			},
			showUEnterTip: function(e, t) {
				if ("uenter" === e.type) {
					var i = $SYS.res_url + "douyu/images/defaultAvatar.png?v=20160525";
					void 0 !== e.ic && "" !== e.ic && (i = $SYS.avatar_url + "upload/" + e.ic + "_middle.jpg");
					var a = {
						uid: void 0 !== e.uid ? parseInt(e.uid, 10) : 0,
						uname: void 0 !== e.nn ? e.nn : "",
						icon: $ROOM.effectInfo[t] ? $ROOM.effectInfo[t].icon : "",
						ic: i,
						txt: $ROOM.effectInfo[t] ? $ROOM.effectInfo[t].txt : ""
					};
					this.makeTip(a)
				}
			},
			makeTip: function(t) {
				var i, a;
				t = e.extend(!0, {
					Character: t.txt.replace("{uname}", '<span class="username" title="' + t.uname + '">' + t.uname + "</span>").replace("|", "<br/>")
				}, t), i = ['<div class="ticket-uEnterTip-item">', '<img class="ticket-uEnter-tx" src="' + t.ic + '" />', '<div class="ticket-uEnter-tx-shade"></div>', '<div class="ticket-uEnterTip-info">', '<span class="place"></span><p class="describe" ></p>', "</div>", '<img class="ticket-uEnter-ticket-icon" src="' + $SYS.resource_url + t.icon + '" />', "</div>"].join(""), a = e(i), a.find(".describe").append(t.Character), this.$view.find(".liveTicket").append(a), a.animate({
					bottom: 0
				}, 1e3), setTimeout(function() {
					a.fadeOut(1e3, function() {
						a.remove()
					})
				}, 3e3)
			}
		};
	return _
}), define("douyu/page/room/normal/mod/anchor-white-list", ["jquery", "shark/class", "shark/observer", "shark/util/lang/1.0", "shark/util/cookie/1.0", "shark/util/template/1.0", "douyu/context"], function(e, t, i, a, n, s, r) {
	var o = t({
		init: function(t) {
			this.$body = e("body"), this.$anchorInfo = e("#anchor-info"), this.$headline = this.$anchorInfo.find(".relate-text .headline"), this.config = e.extend(!0, {}, {
				diyNum: parseInt(this.$body.data("diy"), 10) || 0,
				isRender: !1,
				whListDialogData: {}
			}, t), this.interFace()
		},
		interFace: function() {
			var t = this;
			i.on("mod.anchorwhitelist.getAnchorWhList", function(e) {
				t.config.isRender || (t.requestWhiteListInfo({
					room_id: r.get("room.room_id")
				}, t.renderWhListIdentify), t.config.isRender = !0)
			}), i.on("mod.anchorwhitelist.dialogshow", function(a) {
				if (e.isPlainObject(a) && e.isPlainObject(a.anchorwhitelistData) || (a = {
					anchorwhitelistData: {
						isShowDialog: !1,
						flag: ""
					}
				}), t.config.isLocked = t.config.isLocked && a.anchorwhitelistData.config.isLocked, !t.config.isLocked) {
					var n = e.extend(!0, {}, {
						is_loose: "no_loose"
					}, {
						uid: a.anchorwhitelistData.userid,
						room_id: a.anchorwhitelistData.roomid
					});
					t.config.whListDialogData = a, t.config.isLocked = !0, t.requestWhiteListInfo(n, t.renderWhListDialog), i.on("mod.anchorwhitelist.lock.change", function(e) {
						a.anchorwhitelistData.config.isLocked = e
					})
				}
			}), i.on("mod.anchorwhitelist.sendEmail", function(i) {
				var a = i.uid ? i.uid : "",
					s = i.operate_type ? i.operate_type : "";
				i && "" !== a && "" !== s && t.getCSRFCookie(n, function(t) {
					i[t.name] = t.val, e.ajax({
						url: "/room/anchor_whitelist/notifyanchor",
						type: "POST",
						dataType: "json",
						data: i,
						error: function() {},
						success: function(e) {}
					})
				})
			})
		},
		requestWhiteListInfo: function(t, i) {
			var a = this;
			i = e.isFunction(i) ? i : function() {}, a.config.isLocked = !0, 5 === parseInt(r.get("sys.groupid"), 10) ? this.getCSRFCookie(n, function(n) {
				var s = e.extend(!0, {}, t);
				s[n.name] = n.val, e.ajax({
					url: "/room/anchor_whitelist/getwhitelistinfo",
					type: "POST",
					data: s,
					error: function(e) {
						i.call(a, e)
					},
					success: function(e) {
						e && (e = "string" == typeof e ? JSON.parse(e) : e, i.call(a, e))
					}
				})
			}) : i.call(a)
		},
		renderWhListIdentify: function(e) {
			if (e && e.isWhitelist && e.show_whitelist_mark) {
				var t, i, n, r = e.showMsg ? e.showMsg : "";
				1 === this.config.diyNum && this.$body.addClass("diy-room"), t = a.string.join('<div class="anchor-white-list fl"  >', '<a data-anchor-whlist="btn" class="whl-btn"></a>', '<div data-anchor-whlist="tips" class="whl-tip">', '<i class="arrow-icon"></i>', '<div class="whl-text" >', r, "</div>", "</div>", "</div>"), i = s.compile(t), n = i({
					showMsg: r
				}), this.$headline.append(n), this.bindEvent()
			}
		},
		renderWhListDialog: function(t) {
			var a = this,
				n = a.config.whListDialogData,
				s = n.anchorwhitelistData;
			t && t.isWhitelist && s.isShowDialog ? e.dialog({
				title: "白名单主播提醒",
				content: a.achorWhListDialogTpl(t),
				okVal: "确定",
				ok: function() {
					a.config.isLocked = !0, i.trigger(s.flag, n)
				},
				cancelVal: "取消",
				lock: !0,
				cancel: function() {
					a.config.isLocked = !1, i.trigger("mod.anchorwhitelist.lock.change", !1)
				}
			}) : i.trigger(s.flag, n)
		},
		achorWhListDialogTpl: function(e) {
			var t, i, n, r = e.showMsg ? e.showMsg : "";
			return t = a.string.join('<form id="anchorWhiteListForm" name="" method="post"  target="submit-frame" enctype="multipart/form-data">', '<div class="anchor-whlist-operation-content">', '<div class="wrap clearfix">', '<div class="roomid">主播房间号</div>', '<div class="anchor-white-list">', '<a data-anchor-whlist="btn" class="whl-btn"></a>', "</div>", "</div>", '<div class="wrap clearfix">', '<div class="con2" style="">', r, "</div>", "</div>", '<div class="wrap clearfix">', '<div class="con3">请确认是否继续处理！</div>', "</div>", "</div>", "</form>"), i = s.compile(t), n = i({
				showMsg: r
			}), this.$body.append('<iframe width="0" height="0" id="r_mana_iframe" name="submit-frame" style="position: absolute;top:-9999px;left:-9999px;"></iframe>'), n
		},
		bindEvent: function() {
			var t = this,
				i = !1,
				a = null;
			this.$anchorInfo.on("mouseenter mouseleave", ".anchor-white-list", function(n) {
				switch (String(n.type)) {
				case "mouseenter":
					i = !0, e(n.currentTarget).addClass("on");
					break;
				case "mouseleave":
					i = !1, e(n.currentTarget).removeClass("on")
				}
				a && clearTimeout(a), a = setTimeout(function() {
					t.$body[i ? "addClass" : "removeClass"]("body-show-white-list"), clearTimeout(a)
				}, 100)
			})
		},
		getCSRFCookie: function(t, i) {
			var a = this,
				n = t.get(r.get("sys.tvk")),
				s = r.get("sys.tn");
			return i = e.isFunction(i) ? i : function() {}, n ? void i({
				name: s,
				val: n
			}) : void e.ajax({
				url: "/curl/csrfApi/getCsrfCookie",
				type: "GET",
				dataType: "json",
				success: function(e) {
					0 === e.error && a.getCSRFCookie(t, i)
				}
			})
		},
		curStrByLen: function(e, t) {
			for (var i, a = 0, n = e.length, s = "", r = 0; n > r; r++) if (i = e.charAt(r), a++, escape(i).length > 4 && a++, s = s.concat(i), a >= t) return s.concat("...");
			return t > a ? e : void 0
		}
	});
	return {
		init: function(e) {
			new o(e)
		}
	}
}), define("douyu/com/ajax", ["jquery"], function(e) {
	var t = {},
		i = function(i) {
			var a = e.extend({}, i),
				n = null,
				s = null,
				r = null,
				o = e.Deferred(),
				l = null,
				c = a.url;
			return c ? (a.type = a.type || "get", "GET" === a.type.toUpperCase() && a.data && (c = -1 === c.indexOf("?") ? c + "?" + e.param(a.data) : c + "&" + e.param(a.data)), n = t[c] || {}, s = n.promise, r = n.expires, l = (new Date).getTime(), s && (!r || r > l) ? s : (a.expires && (r = l + 1e3 * a.expires), a = e.extend(i, {
				success: function(e) {
					o.resolve(e)
				},
				error: function(e) {
					o.reject(e)
				}
			}), s = e.ajax(a), n.promise = s, n.expires = r, t[c] = n, o.promise(s))) : !1
		};
	return i
}), define("douyu/page/room/normal/mod/weibo", ["jquery", "shark/observer", "douyu/page/room/base/api", "douyu/com/user", "shark/util/storage/1.0", "shark/util/flash/data/1.0", "douyu/context", "shark/util/template/2.0", "douyu/com/ajax", "douyu/com/get-gift-configs"], function(e, t, i, a, n, s, r, o, l, c) {
	var d = {},
		u = {};
	d.templateSettings = {
		evaluate: /%([\s\S]+?)%/g,
		interpolate: /%=([\s\S]+?)%/g,
		escape: /%-([\s\S]+?)%/g
	}, d.template = function(t, i, a) {
		var n = /\\|'|\r|\n|\u2028|\u2029/g,
			s = function(e) {
				return "\\" + escapes[e]
			};
		!i && a && (i = a), i = e.extend({}, i, d.templateSettings);
		var r = RegExp([(i.escape || noMatch).source, (i.interpolate || noMatch).source, (i.evaluate || noMatch).source].join("|") + "|$", "g"),
			o = 0,
			l = "__p+='";
		t.replace(r, function(e, i, a, r, c) {
			return l += t.slice(o, c).replace(n, s), o = c + e.length, i ? l += "'+\n((__t=(" + i + "))==null?'':_.escape(__t))+\n'" : a ? l += "'+\n((__t=(" + a + "))==null?'':__t)+\n'" : r && (l += "';\n" + r + "\n__p+='"), e
		}), l += "';\n", i.variable || (l = "with(obj||{}){\n" + l + "}\n"), l = "var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n" + l + "return __p;\n";
		try {
			var c = new Function(i.variable || "obj", "_", l)
		} catch (u) {
			throw u
		}
		var f = function(e) {
				return c.call(this, e)
			},
			p = i.variable || "obj";
		return f.source = "function(" + p + "){\n" + l + "}", f
	};
	var f = (e(document), 0),
		p = 0,
		m = (new Date).getTime(),
		h = (String.prototype.toString, !1),
		g = null,
		v = {
			1: {
				name: "观看时长",
				storagename: "plogin",
				val: 0,
				tmpl: "<div class='room-wbshare wbshare-login'></div>",
				btnid: "wb-sh-login-btn"
			},
			2: {
				name: "鱼丸暴击",
				storagename: "pcritical",
				val: 0,
				style: 0,
				tmpl: "<div class='room-wbshare wbshare-critical'></div>",
				btnid: "wb-sh-crit-btn"
			},
			3: {
				name: "高级酬勤",
				lev: 3,
				storagename: "padvcq",
				val: 0,
				tmpl: "<div class='room-wbshare wbshare-advcq'></div>",
				btnid: "wb-sh-advcq-btn"
			},
			4: {
				name: "中级酬勤",
				lev: 2,
				storagename: "pmidcq",
				val: 0,
				tmpl: "<div class='room-wbshare wbshare-midcq'></div>",
				btnid: "wb-sh-midcq-btn"
			},
			5: {
				name: "初级酬勤",
				lev: 1,
				storagename: "pjuncq",
				val: 0,
				tmpl: "<div class='room-wbshare wbshare-juncq'></div>",
				btnid: "wb-sh-juncq-btn"
			},
			6: {
				name: "火箭",
				storagename: "procket",
				val: 0,
				style: 6,
				effect: "1",
				tmpl: "<div class='room-wbshare wbshare-rocket'></div>",
				btnid: "wb-sh-rock-btn"
			},
			7: {
				name: "飞机",
				storagename: "pplane",
				val: 0,
				style: 5,
				effect: "2",
				tmpl: "<div class='room-wbshare wbshare-plane'></div>",
				btnid: "wb-sh-plan-btn"
			},
			8: {
				name: "666",
				storagename: "pliu",
				val: 0,
				style: 4,
				effect: "0",
				tmpl: "<div class='room-wbshare wbshare-liu'></div>",
				btnid: "wb-sh-liu-btn"
			},
			9: {
				name: "赞",
				storagename: "pzan",
				val: 0,
				style: 3,
				effect: "0",
				tmpl: "<div class='room-wbshare wbshare-zan'></div>",
				btnid: "wb-sh-zan-btn"
			},
			10: {
				name: "520",
				storagename: "pwel",
				val: 0,
				style: 2,
				effect: "0",
				tmpl: "<div class='room-wbshare wbshare-wel'></div>",
				btnid: "wb-sh-wel-btn"
			},
			11: {
				name: "100鱼丸",
				storagename: "phyw",
				val: 0,
				style: 1,
				effect: "0",
				tmpl: "<div class='room-wbshare wbshare-hyw'></div>",
				btnid: "wb-sh-hyw-btn"
			},
			12: {
				name: "游艇",
				storagename: "ship",
				val: 0,
				style: 6,
				effect: "5",
				tmpl: "<div class='room-wbshare wbshare-ship'></div>",
				btnid: "wb-sh-ship-btn"
			},
			13: {
				name: "跑车",
				storagename: "car",
				val: 0,
				style: 6,
				effect: "4",
				tmpl: "<div class='room-wbshare wbshare-car'></div>",
				btnid: "wb-sh-car-btn"
			},
			14: {
				name: "香吻",
				storagename: "kiss",
				val: 0,
				style: 5,
				effect: "3",
				tmpl: "<div class='room-wbshare wbshare-kiss'></div>",
				btnid: "wb-sh-kiss-btn"
			}
		},
		y = null,
		b = "share",
		k = null,
		w = {
			init: function() {
				var i = this;
				k = e("#js-stats-and-actions"), t.on("mod.center.userrole.ready", function(e) {
					if (!h) {
						h = 1;
						var t = a.check();
						t && i.getServerInfo()
					}
				})
			},
			getServerInfo: function() {
				var e = this;
				l({
					url: "/wb_share/config",
					type: "get",
					cache: !0,
					dataType: "json"
				}).then(function(t) {
					if (t && 0 == t.error) {
						var i = t.data;
						e.setData(i);
						var a = parseInt(i.switch_on);
						if (!i.events) return !1;
						a && (m = 1e3 * i.system_time, f = parseInt(i.probability), p = i.experience, e.ready())
					}
				})
			},
			getStorage: function(e) {
				return n.get(b + e)
			},
			setStorage: function(e, t, i) {
				n.set(b + e, t, i)
			},
			triggered: function(e) {
				var t = this,
					i = v[e];
				return r.get("sys.uid") == t.getStorage(i.storagename)
			},
			loginAction: function(e) {
				var t = this,
					i = null,
					a = 0,
					n = (v[e], t.getEvent(e));
				t.getRestTime(m);
				i = setInterval(function() {
					a = a ? a : 0, a++;
					var s = parseInt(n.count);
					if (isNaN(s) || !s) return !1;
					if (a / 60 % n.count == 0) {
						var r = 100 * Math.random();
						f > r && (clearInterval(i), i = null, t.render(e))
					}
				}, 1e3)
			},
			giftAction: function(e, t) {
				var i = this,
					a = (v[e], i.getEvent(e)),
					n = parseInt(a.count),
					s = parseInt(t.hits),
					r = 100 * Math.random(),
					o = a.probability || f;
				if (s = s ? s : 1, t.ur && "" != t.ur);
				else if (n > s) return !1;
				o > r && i.render(e, t)
			},
			render: function(i, a) {
				var n = this;
				c.getGift().done(function(s) {
					u = s || {};
					var r = n.getModule(i, a),
						l = o.compile(n.getContainer(i), {
							openTag: "{{",
							closeTag: "}}"
						}),
						c = l(r),
						d = e(r.wrap);
					d.html(c), k.append(d), n.bindEvent(i, d, r), t.trigger("dys", {
						key: "dys.room.wbshare.show"
					})
				})
			},
			bindEvent: function(i, a, n) {
				var s = this,
					o = v[i],
					l = !1,
					c = 0;
				a.on("click.wbshare", ".wbshare-close", function() {
					s.closeTip(a), t.trigger("dys", {
						key: "dys.room.wbshare.close"
					})
				}).on("change.wbshare", "[type='checkbox']", function() {
					var i = e(this);
					i.is(":checked") ? o.val = i.val() : o.val = 0, c = s.getRestTime((new Date).getTime(), o.val), s.setStorage(o.storagename, r.get("sys.uid"), c / 1e3), t.trigger("dys", {
						key: "dys.room.wbshare.nomore"
					})
				}).on("mousedown", "button", function() {
					return l ? !1 : (l = !0, window.open(s.getShareLink(n)), e(this).closest(".room-wbshare").hide(), void t.trigger("dys", {
						key: "dys.room.wbshare.btn.click"
					}))
				}), c = s.getRestTime((new Date).getTime(), 6), s.setStorage(o.storagename, r.get("sys.uid"), c / 1e3), e.extend(n, {
					callback: function() {
						a.fadeOut(1e3), s.getReward()
					}
				})
			},
			getModule: function(t, i) {
				var a = this,
					n = v[t],
					s = a.getEvent(t),
					o = null,
					l = [],
					c = 0,
					d = n.style,
					f = n.effect,
					m = u,
					h = "",
					y = 1,
					b = "",
					y = 0,
					k = "";
				if (d) for (var w in m) {
					var _ = m[w] || {};
					if (f) {
						if (_.style == d && _.ef == f) {
							h = _.name;
							break
						}
					} else if (_.style == d) {
						h = _.name;
						break
					}
				} else h = n.name;
				if (i) if (i.ur && "" != i.ur) y = i.sil, b = s.git_content;
				else {
					var x = i.hits ? i.hits : 1;
					b = 1 == x ? s.tip_content : s.git_content, y = x
				} else b = s.git_content, y = s.count;
				return o = {
					giftName: h,
					giftCount: y,
					roomName: r.get("room.room_name"),
					anchorName: r.get("room.owner_name"),
					roomId: r.get("room.room_id"),
					url: window.location.href
				}, g = e.extend(null, o), l = s.article, c = l.length ? parseInt(Math.random() * l.length) : 0, k = a.helperTmpl(l[c], o), e.extend(o, {
					cq: n.lev,
					btnid: n.btnid,
					tips: a.helperTmpl(b, o),
					wrap: n.tmpl,
					template: k,
					exp: s.experience || p
				}), o
			},
			getContainer: function() {
				var e = ["<a class='wbshare-close' href='javascript:;'></a>", "<div class='wbshare-title'><i></i></div>", "<div class='wbshare-body'>", "<h2 class='wbshare-content'>", "{{if cq}}", "<i></i>", "{{/if}}", "{{tips}}", "</h2>", "<p><!--分享即可获得<em>{{exp}}</em>经验值（每天一次）-->&nbsp;</p>", "<div class='wbshare-btn-grp'>", "<button id='{{btnid}}' type='button' class='wbshare-btn'><i></i><span>微博分享</span></button>", "<label><input value='6' type='checkbox'><span>不再提醒</span></label>", "</div>", "</div>"];
				return e.join("")
			},
			clone: function(e, t) {
				e = e ? e : {}, t || (t = e);
				for (var i in t) e[i] = t[i];
				return e
			},
			helperTmpl: function(e, t) {
				var i, a = "";
				if (d) {
					var n = this.clone(d.templateSettings);
					d.templateSettings = {
						evaluate: /%([\s\S]+?)%/g,
						interpolate: /%([\s\S]+?)%/g,
						escape: /%-([\s\S]+?)%/g
					}, i = d.template(e), a = i(t), d.templateSettings = n
				}
				return a
			},
			closeTip: function(e) {
				e.remove()
			},
			getRestTime: function(e, t) {
				t = parseInt(t), t = t ? t : 0;
				var i = new Date(e);
				i.setDate(i.getDate() + t), i.setHours(24), i.setMinutes(0), i.setSeconds(0);
				var a = i.getTime() - (new Date).getTime();
				return a
			},
			ready: function() {
				var e = this;
				e.dispatch("1"), i.reg("room_data_giftbat1", function(t) {
					var i = s.decode(t).too();
					"dgb" === i.type && i.uid == r.get("sys.uid") && c.getGift().done(function(t) {
						u = t || {};
						for (var a in v) {
							var n = v[a],
								s = u[i.gfid] || {};
							if (n.effect) {
								if (n.effect == s.ef && n.style == i.gs) {
									e.dispatch(a, i);
									break
								}
							} else if (n.style == i.gs) {
								e.dispatch(a, i);
								break
							}
						}
					})
				}), t.on("mod.chat.msg.res.olyw.luckburst", function(t) {
					var i = s.decode(t).too();
					if (i.uid == r.get("sys.uid")) {
						if (!i.ur) return "";
						e.dispatch("2", i)
					}
				}), t.on("mod.chat.msg.res.cq", function(t) {
					var i = s.decode(t).too(),
						a = s.decode(i.sui).too();
					if (a.id == r.get("sys.uid")) for (var n in v) {
						var o = v[n];
						if (o.lev == i.lev) {
							e.dispatch(n, i);
							break
						}
					}
				})
			},
			getEvent: function(e) {
				for (var t = this.getData(), i = t.events, a = {}, n = 0, s = i.length; s > n; n++) if (i[n].type == e) {
					a = i[n];
					break
				}
				return a
			},
			dispatch: function(e, i) {
				if (t.fire("mod.room.normal.gift.freegift.show") !== !0) {
					var a = this;
					if (a.triggered(e)) return !1;
					switch (e) {
					case "1":
						a.loginAction(e);
						break;
					case "2":
						a.giftAction(e, i);
						break;
					case "3":
					case "4":
					case "5":
					case "6":
					case "7":
					case "8":
					case "9":
					case "10":
					case "11":
					case "12":
					case "13":
					case "14":
						a.giftAction(e, i)
					}
				}
			},
			setData: function(e) {
				y = e || {}
			},
			getData: function() {
				return y
			},
			share: function(e) {
				var t = WB2.oauthData;
				if (t && t.expires_in > 0);
				else try {
					WB2.logout()
				} catch (i) {}
				WB2.anyWhere(function(t) {
					t.widget.publish({
						id: e.btnid,
						default_text: e.template,
						callback: function(t) {
							e.callback && e.callback.call(t)
						}
					})
				})
			},
			getShareLink: function(e) {
				var t = "http://service.weibo.com/share/share.php??url=" + encodeURIComponent(location.href) + "&title=" + encodeURIComponent(e.template) + "&data_track_clickback=true&pic=" + encodeURIComponent($ROOM.room_pic) + "&appkey=979098171&ralateuid=3982726153";
				return t
			},
			getReward: function() {
				var i = this,
					a = e.extend({
						uid: r.get("sys.uid"),
						nickname: r.get("sys.nickname")
					}, g);
				return i.getStorage("rewarded") ? (a.exp = 0, t.trigger("mod.weibo.share", a), !1) : (e.ajax({
					url: "/member/wb_share/nc_reward",
					dataType: "json",
					success: function(e) {
						0 == e.error && (t.trigger("mod.userinfo.change", {
							change: {
								exp: p
							}
						}), a.exp = p, t.trigger("mod.weibo.share", a), i.setStorage("rewarded", !0, i.getRestTime((new Date).getTime()) / 1e3))
					}
				}), void t.trigger("dys", {
					key: "dys.room.wbshare.success"
				}))
			}
		};
	w.init()
}), define("douyu/page/room/normal/mod/private-letter", ["jquery", "douyu/context", "shark/util/storage/1.0", "shark/observer", "douyu/com/user"], function(e, t, i, a, n) {
	var s = {
		visibile: !1,
		sdkLoaded: !1,
		frameWrapperLoaded: !1,
		createPrivateLetter: function() {
			this.frameWrapperLoaded = !0, this.$privateMsg = e(".web-message-wrapper"), this.$wrapper = e(".message-frame-wrapper"), this.$loading = this.$privateMsg.find(".loading-msg")
		},
		init: function() {
			var e = this;
			e.frameWrapperLoaded === !1 && (e.createPrivateLetter(), e.bindEvent())
		},
		bindEvent: function() {
			var t = this,
				i = e("#js-msg-barrage");
			window.closeMsg = t.closeMsg, window.updateUnreadMsg = t.updateUnreadMsg, i.on("click", function(e) {
				e.stopPropagation();
				var i = n.check();
				return i ? void t.openPrivateMsgBox() : (n.show("login"), !1)
			}), e("#container").on("click", function() {
				t.closePrivateMsgBox()
			}), a.on("mod.room.privateLetter.open", function(e) {
				var i = e || null;
				t.openPrivateMsgBox(i)
			}), a.on("com.private.letter.create", function() {
				t.createPrivateLetter(), window.embedMsg.init({
					target: s.$wrapper[0],
					onMessage: function(e) {
						var t = parseInt(e, 10) || 0;
						a.trigger("com.private.letter.msg", t)
					},
					onLoad: function() {
						a.trigger("com.private.letter.loaded")
					},
					initShowState: !1
				}), s.$wrapper.removeClass("hide").show()
			}), a.on("com.private.letter.loaded", function() {
				s.$loading.remove(), s.sdkLoaded === !1 && (s.sdkLoaded = !0, s.visibile === !0 && window.embedMsg && window.embedMsg.beforeShow())
			})
		},
		closeMsg: function() {
			s.closePrivateMsgBox()
		},
		updateUnreadMsg: function(e) {
			i.set("userletnum" + t.get("sys.uid"), e)
		},
		closePrivateMsgBox: function() {
			window.embedMsg && window.embedMsg.afterClose(), this.$privateMsg.hide(), this.visibile = !1
		},
		openPrivateMsgBox: function(e) {
			this.sdkLoaded === !0 && window.embedMsg && window.embedMsg.beforeShow(), e && window.embedMsg && window.embedMsg.showChatDetail(e), this.$privateMsg.show(), this.visibile = !0
		}
	};
	return {
		init: function() {
			s.init()
		}
	}
}), define("douyu/page/room/normal/mod/noble-speaker", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "shark/util/storage/1.0", "shark/util/flash/data/1.0", "shark/util/date/1.0/date", "douyu/context", "douyu/com/exjsonp", "douyu/com/user", "douyu/page/room/base/api"], function(e, t, i, a, n, s, r, o, l, c, d) {
	var u = {},
		f = {
			confPath: o.get("sys.webconfUrl") + "/resource/common/noble/setNobleHorn.json",
			data: {},
			flags: {
				getHorn: 0,
				getInfo: 0,
				isCounting: 0,
				isUserLoged: c.check(),
				isShowCd: 0,
				isInCheck: 0
			},
			tipTimer: null,
			btnTipTimer: null,
			timer: null,
			init: function() {
				var t, i = this;
				this.config = {
					mod: 0,
					area: o.get("room.second_lvl_name"),
					maxLen: 20,
					leadStoreName: "speakerbtnshowlead"
				}, t = this.config, this.renders = {
					renderSpeaker: this.renderSpeakerFn(),
					renderSpeakerCounter: this.renderSpeakerCounterFn()
				}, this.nobleSpeaker = e("#js-noble-speaker"), this.speakerBtn = e("#js-noble-speaker-btn"), this.renderSpeakerBtn(), i.speakerBtn.removeClass("hide"), this.renderSpeaker(), o.get("room.cate_id") ? this.bindEvents(1) : (this.noAreaRender(), this.bindEvents()), l.load(i.confPath, "setNobleHorn", function(e) {
					u.cd = e && e.cd, i.config.cd = u.cd
				}, function(e) {
					u.cd = 3, i.config.cd = u.cd
				})
			},
			renderSpeakerBtn: function() {
				var e = ['<div data-selector="noble--broadcast-toggle" class="noble--broadcast-toggle">', '<i class="icon--broadcast-toggle"></i>', '<div data-selector="horn-btn-tip" class="horn-btn-tip"></div>'].join("");
				this.speakerBtn.append(e)
			},
			renderSpeakerFn: function() {
				var e = i.string.join('<div class="nobel--error-box">', '<div class="error--mask"></div>', '<div class="error--main">', '<a data-btn="closespeaker" class="broadcast--close" href="javascript:;">×</a>', '<div data-selector="noble-error-content" class="error--content"></div>', '<div class="error--holder"></div>', "</div>", "</div>", '<div class="broadcast-box--main">', '<a data-btn="closespeaker" class="broadcast--close" href="javascript:;">×</a>', '<div class="broadcast--title">', "<h4>", '<i class="icon--broadcast"></i> ', '<span class="title--main">分区喇叭</span>', "</h4>", '<div class="title--main-sub">', '<div class="main-sub--row">', '<span class="main-sub--main">{{ if area }}{{ area }}区可见{{ /if }}</span>', '<span data-selector="noblemsgtip" class="broadcast--status"></span>', "</div>", "</div>", "</div>", '<div class="broadcast--main">', '<div data-selector="forbid-speaker-mask" class="broadcast--text status--forbidden">', '<textarea data-selector="cate-speaker-msg" placeholder="输入喇叭内容" maxlength="{{ maxLen }}"></textarea>', "<i>", '<em data-selector="noble-words-count">{{ maxLen }}</em>字', "</i>", '<div data-selector="forbidden" class="broadcast--forbidden"></div>', "</div>", '<div class="broadcast--tool-bar">', '<span data-selector="speaker-count" class="tool-bar--info">', "剩余 <em>0</em> 个，", '<a data-buy="speaker" class="btn--buy" href="javascript:;">开通贵族</a> 可获得喇叭', "</span>", ' <a data-selector="send-noble-btn" class="btn--send" disabled="disabled" href="javascript:;">', "发送", "</a>", "</div>", "</div>", "</div>");
				return a.compile(e)
			},
			renderSpeaker: function(e) {
				var t = this.config;
				this.nobleSpeaker.append(this.renders.renderSpeaker({
					area: t.area,
					maxLen: t.maxLen
				}))
			},
			renderSpeakerCounterFn: function() {
				var e = ["剩余 ", "<em>{{ speakerCount || 0 }}</em>", " 个", '，<a data-buy="speaker" class="btn--buy" href="javascript:;">', '<div class="dy--tips status--hover-show">', '<div class="tips--trans-outer">', '<div class="tips--trans-inner">', "</div>", "</div>", '<div class="tips--main">', '<div class="tips--content">', "{{ if isNoble >= 3 || protectedLvl >= 3 }}", "分区喇叭与贵族鱼翅返还时间相同", "{{ else }}", "分区喇叭为伯爵以上贵族专属特权", "{{ /if }}", "</div>", "</div>", "</div>", "{{ if inProtected }}", "{{ if protectedLvl < 3 }}", "升级", "{{ else }}", "续费", "{{ /if }}", "{{ else }}", "开通", "{{ /if }}", "贵族</a>", " 可获得喇叭"].join("");
				return a.compile(e)
			},
			renderSpeakerCounter: function() {
				var e = this.data;
				this.nobleSpeaker.find('[data-selector="speaker-count"]').html(this.renders.renderSpeakerCounter(e)), 0 === e.speakerCount && this.setDisabled()
			},
			noAreaRender: function() {
				var e = this.nobleSpeaker,
					t = ['<span class="broadcast--status status--success status--failed status--checking">', ' <i class="icon--broadcast-status"></i> ', " 无法获取分区喇叭不可用 ", "</span>"].join("");
				e.find('[data-selector="noblemsgtip"]').addClass("status--failed").html(t), this.nobleSpeaker.find('[data-selector="forbid-speaker-mask"]').addClass("status--forbidden"), this.setDisabled()
			},
			hideMask: function() {
				this.nobleSpeaker.find('[data-selector="forbid-speaker-mask"]').removeClass("status--forbidden")
			},
			showMask: function() {
				this.nobleSpeaker.find('[data-selector="forbid-speaker-mask"]').addClass("status--forbidden")
			},
			setEnabled: function() {
				this.nobleSpeaker.find('[data-selector="send-noble-btn"]').removeAttr("disabled")
			},
			setDisabled: function() {
				this.nobleSpeaker.find('[data-selector="send-noble-btn"]').attr("disabled", !0)
			},
			setWordsCount: function(e) {
				this.nobleSpeaker.find('[data-selector="noble-words-count"]').text(e)
			},
			countDown: function() {
				var t = this.config.cd,
					i = this.nobleSpeaker.find('[data-selector="send-noble-btn"]');
				i.attr("disabled", !0), this.config.cd--, this.flags.isCounting = 1, t > 0 ? i.text(t) : (this.config.cd = u.cd, clearInterval(this.timer), this.flags.isCounting = 0, i.text("发送"), this.hideMask(), "" !== e.trim(this.nobleSpeaker.find('[data-selector="cate-speaker-msg"]').val()) && i.removeAttr("disabled"))
			},
			stopCounting: function() {
				clearInterval(this.timer), this.hideMask()
			},
			bindEvents: function(a) {
				var l = this,
					u = l.config,
					f = e(document.body),
					p = l.nobleSpeaker,
					m = l.speakerBtn,
					h = "",
					g = l.flags;
				m.on("click", '[data-selector="noble--broadcast-toggle"]', function() {
					return g.isUserLoged ? (p.removeClass("hide"), m.removeClass("status-new"), m.find('[data-selector="noble-btn-error"]').remove(), n.set(u.leadStoreName, 1), void t.trigger("dys", {
						key: "dys.room.msg.hornbtn.click"
					})) : void c.show("login")
				}).on("click", '[data-selector="noble-error--close"]', function() {
					m.find('[data-selector="noble-btn-error"]').remove()
				}), f.on("click", '[data-selector="not-noble-tip-btn"]', function() {
					e(this).text().indexOf("开通") > -1 ? t.trigger("mod.normal.noble.buy", {
						level: 3
					}) : t.trigger("mod.normal.noble.buy"), f.removeClass("has--mask"), e(this).closest('[data-selector="not-noble-tip"]').remove()
				}).on("click", '[data-selector="not-noble-tip-close"]', function() {
					f.removeClass("has--mask"), e(this).closest('[data-selector="not-noble-tip"]').remove()
				}), p.on("click", '[data-btn="closespeaker"]', function() {
					p.addClass("hide")
				}).on("click", '[data-buy="speaker"]', function() {
					var i = e(this).text(),
						a = i.indexOf("开通") > -1 || i.indexOf("升级") > -1,
						n = i.indexOf("续费") > -1;
					a ? t.trigger("dys", {
						key: "dys.room.msg.hornbtn.opennoble",
						level: l.data.isNoble || 0
					}) : n && t.trigger("dys", {
						key: "dys.room.msg.hornbtn.renewnoble",
						level: l.data.isNoble || 0
					}), a || n && l.data.isNoble < 3 ? t.trigger("mod.normal.noble.buy", {
						level: 3
					}) : t.trigger("mod.normal.noble.buy")
				}), a && (p.on("keydown", '[data-selector="cate-speaker-msg"]', function(t) {
					13 === t.which && (t.preventDefault(), e(this).blur(), p.find('[data-selector="send-noble-btn"]').trigger("click"), p.find('[data-selector="cate-speaker-msg"]').blur())
				}).on("input keyup paste change", '[data-selector="cate-speaker-msg"]', function() {
					var e = this.getAttribute("maxlength");
					this.value.length >= e && (this.value = this.value.substr(0, e)), !this.value.length || g.isCounting ? l.setDisabled() : l.setEnabled(), l.setWordsCount(e - this.value.length)
				}).on("click", '[data-selector="send-noble-btn"]', function() {
					var t, a = {},
						n = l.data.speakerCount,
						r = "开通",
						v = "",
						y = l.data,
						b = p.find('[data-selector="cate-speaker-msg"]');
					return g.isUserLoged ? g.isMute || e(this).attr("disabled") ? !1 : n ? (v = e.trim(b.val()), "" === v ? !1 : (1 === u.mod ? (b.attr("disabled", !0).addClass("speaker-msg-disabled").blur(), p.find('[data-selector="send-noble-btn"]').attr("disabled", !0).text("审核中"), p.find('[data-selector="noblemsgtip"]').removeClass("status--success status--failed status--checking").addClass("status--checking").html("2-3分钟后完成审核"), clearTimeout(l.btnTipTimer), t = m.find('[data-selector="horn-btn-tip"]'), t.html('<div class="horn-btn-tip-txt">审核成功后，将直接发送</div>').fadeIn(), l.btnTipTimer = setTimeout(function() {
						t.fadeOut(function() {
							e(this).html("")
						})
					}, 5e3), p.addClass("hide")) : (b.blur().val(""), l.setWordsCount(u.maxLen), l.showMask(), l.countDown(), l.timer = setInterval(function() {
						l.countDown()
					}, 1e3)), a = [{
						name: "type",
						value: "cthnreq"
					}, {
						name: "chatmsg",
						value: v
					}, {
						name: "cid",
						value: o.get("room.cate_id")
					}, {
						name: "pid",
						value: l.data.pid
					}, {
						name: "rid",
						value: o.get("room.room_id")
					}, {
						name: "uid",
						value: o.get("sys.uid")
					}, {
						name: "cl",
						value: 2
					}], void d.exe("js_send_cate_msg", s.encode(a)))) : (y.inProtected && (r = "续费", y.isNoble < 3 && (r = "升级")), h = i.string.join('<div data-selector="not-noble-tip" class="broadcast-auth-failed-panel">', '<div class="panel-mask"></div>', '<div class="noble--error">', '<a data-selector="not-noble-tip-close" class="noble-error--close" href="javascript:;">×</a>', '<div class="nobel-error--main">', '<i class="nobel-error--icon"></i>', '<div class="error-main--content">', '<h3 class="content--title">承包整个区，大声说出爱</h3>', "<p>", "分区喇叭--伯爵以上贵族专属特权", "</p>", '<a data-selector="not-noble-tip-btn" class="btn" href="javascript:;">' + r + "贵族</a>", "</div>", "</div>", "</div>", "</div>"), f.append(h).addClass("has--mask"), l.setDisabled(), !1) : (c.show("login"), !1)
				}), d.reg("room_data_handler", function(t) {
					var i, a = s.decode(t).too(),
						n = '<i class="icon--broadcast-status"></i>',
						r = "";
					if ("cthnres" === a.type) {
						switch ("" + a.result) {
						case "5820":
							n += " 系统维护，发送失败", r = "status--failed", g.isCounting = 1, g.isShowCd = 0, l.showMask(), l.setDisabled(), e.dialog.tips_black("分区喇叭暂停服务，月底恢复"), l.setWholeEnabled();
							break;
						case "356":
							g.isShowCd = 1, n += " 发送内容包含敏感词汇", r = "status--failed", l.setWholeEnabled();
							break;
						case "0":
							g.isShowCd = 1, n += " 发送成功", r = "status--success", l.setWholeEnabled(1);
							break;
						default:
							g.isShowCd = 1, n += " 发送失败", r = "status--failed", l.setWholeEnabled()
						}
						i = p.find('[data-selector="noblemsgtip"]').removeClass("status--success status--failed status--checking").addClass(r).html(n), clearTimeout(l.tipTimer), g.isShowCd && (l.tipTimer = setTimeout(function() {
							i.html("").removeClass("status--success status--failed status--checking")
						}, 3e3))
					}
					if ("cdcp" === a.type && "hpid" in a && (l.data.speakerCount = parseInt(a.hcnt, 10), l.data.pid = parseInt(a.hpid, 10), l.flags.getHorn = 1, l.update()), "cthnsn" === a.type) {
						var o = m.find('[data-selector="horn-btn-tip"]'),
							c = p.find('[data-selector="cate-speaker-msg"]'),
							d = p.find('[data-selector="send-noble-btn"]');
						"1" === a.hm && (u.mod = 1, d.text("提交")), "1" === a.hs ? (c.val(a.hc || "").trigger("keyup").attr("disabled", !0).addClass("speaker-msg-disabled"), d.attr("disabled", !0).text("审核中"), g.isInCheck = 1) : "2" === a.hs && (c.val(a.hc || "").prop("disabled", !1).trigger("keyup"), d.prop("disabled", !1).text("提交"), clearTimeout(l.btnTipTimer), o.html('<div class="horn-btn-tip-txt">您发起的分区喇叭审核未通过，<span class="horn-view-chatletter">点击查看</span></div>').fadeIn(), l.btnTipTimer = setTimeout(function() {
							o.fadeOut(function() {
								e(this).html("")
							})
						}, 5e3), p.find('[data-selector="noblemsgtip"]').removeClass("status--success status--failed status--checking").addClass("status--failed").html("审核未通过，请重新输入"))
					}
				}), c.check() && (t.on("mod.noble.info.get", function(t) {
					var i;
					"memberinfores" === t.type && (i = e.extend({
						nl: 0,
						npl: 0,
						npts: 0
					}, t), l.data.isNoble = parseInt(i.nl, 10), l.data.protectedLvl = i.npl && parseInt(i.npl, 10) || 0, l.data.inProtected = i.npts && parseInt(i.npts, 10) || l.data.isNoble, l.flags.getInfo = 1, l.update())
				}), t.on("mod.chat.msg.mute", function(e) {
					var t = 1e3 * e.met || 0,
						i = parseInt(e.mtype, 10) || 1,
						a = "";
					i > 2 && t > 0 && (a = ["您已被" + ["房间", "房间", "全站", "全站"][i - 1] + "禁言。<span>禁言类型：0" + i + "</span>", "<div>", "解禁时间：" + r.format(new Date(t), "yyyy-MM-dd hh:mm:ss"), ' <a href="/cms/gong/201601/06/2924.shtml" target="_blank">用户发言须知</a>', "</div>"].join(""), p.find('[data-selector="forbid-speaker-mask"]').addClass("status--forbidden").find('[data-selector="forbidden"]').html(a), l.setDisabled(), l.flags.isMute = 1)
				})))
			},
			update: function() {
				this.updateBtn(), this.updateSpeaker()
			},
			setWholeEnabled: function(e) {
				var t = this.nobleSpeaker;
				if (1 === this.config.mod) {
					var i = t.find('[data-selector="cate-speaker-msg"]'),
						a = t.find('[data-selector="send-noble-btn"]');
					a.prop("disabled", !1).text("提交"), e && i.val(""), i.prop("disabled", !1).trigger("keyup")
				}
			},
			updateSpeaker: function() {
				var t = this.data,
					i = this.flags;
				"" !== e.trim(this.nobleSpeaker.find('[data-selector="cate-speaker-msg"]').val());
				0 == t.speakerCount ? this.hideMask() : t.speakerCount > 0 ? (this.hideMask(), i.isCounting || i.isInCheck || this.setEnabled()) : (this.showMask(), this.setDisabled()), i.isMute && (this.showMask(), this.setDisabled()), this.renderSpeakerCounter()
			},
			updateBtn: function() {
				var e = "",
					t = this.config;
				c.check() && this.data.speakerCount > 0 && !n.get(t.leadStoreName) && (e = ['<div data-selector="noble-btn-error" class="noble--error">', '<a data-selector="noble-error--close" class="noble-error--close" href="javascript:;">×</a>', '<div data-selector="noble-speaker-btn-arrow" class="noble-error--tran-outer">', '<div class="noble-error--tran-inner">', "</div>", "</div>", '<div class="nobel-error--main">', '<div class="error-main--content">', '<h3 class="content--title">', "您有<em>" + this.data.speakerCount + "</em>个分区喇叭，快来发送广播吧", "</h3>", "</div>", "</div>", "</div>"].join(""), this.speakerBtn.append(e), this.setLeadTipArrow(), n.set(t.leadStoreName, 1))
			},
			setLeadTipArrow: function() {
				var t = this.speakerBtn,
					i = e("#js-chat-speak").offset().left,
					a = t.offset().left;
				t.find('[data-selector="noble-speaker-btn-arrow"]').css({
					marginLeft: 0,
					left: a - i - 10
				})
			}
		};
	return {
		init: function() {
			f.init()
		}
	}
}), define("douyu/page/room/normal/mod/chat-noble-enter", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/flash/data/1.0", "douyu/context", "douyu/com/user", "douyu/com/avatar", "douyu/com/exjsonp", "douyu/page/room/base/api", "shark/util/template/1.0", "shark/util/timeline/1.0", "douyu/page/room/normal/mod/gift/constants"], function(e, t, i, a, n, s, r, o, l, c, d, u) {
	var f = $COLLIGATE.userLevelSwitch > 0 ? 1 : 0,
		p = n.get("sys.web_url"),
		m = p + "/app/douyu/res/com/defaultAvatar.png",
		h = n.get("sys.avatar_url"),
		g = n.get("room.nobleConfig") || {},
		v = n.get("sys.resource_url"),
		y = n.get("room.room_id"),
		b = n.get("sys.webconfUrl"),
		k = [],
		w = {
			configs: {
				urls: {
					nobleEffect: "/resource/noble/openeffect/web.json"
				},
				nobleEffectData: ""
			},
			init: function() {
				this.bindEvt()
			},
			handleAvatar: function(e) {
				var t = m;
				return e && (t = i.string.format("{0}upload/{1}_middle.jpg", h, e)), t
			},
			OpenNobleTpl: function() {
				return ['<div class="giftbatter-box giftbatter-noble-notify">', '<ul class="c-list">', '<li class="status-low-open chartli open-level<%= nl %> normal-notice-new">', '<i class="sys-icon"></i>', '<p class="text-cont">', '<span class="user-level-info">', '<span class="user-noble-lv">', '<img src="<%= resourceUrl %><%= nobleConfig[nl].symbol.web_symbol_pic1 %>" title="<%= nobleConfig[nl].symbol.name %>">', "</span>", '<a href="javascript:;" class="nick-new"><%= nickname %></a>', '<%if(anchorName!=="") {%>', '<span class="open-noble-desc">在</span><span class="nick-new"><%=anchorName%></span><span class="open-noble-desc">直播间</span>', "<%}%>", "<%if(isSend===true) {%>", '<span class="open-noble-desc">给</span><span class="nick-new"><%=reciver%></span>', "<%}%>", '<span class="open-noble-desc">', "<%if(isRenew) {%>", "续费了", "<%} else {%>", "开通了", "<%}%>", '<em class="noble-name"><%= nobleConfig[nl].noble_name %></em>', "</span>", "</span>", "</p>", "</li>", "</ul>", "</div>"].join("")
			},
			lianMaiTpl: function() {
				return ['<div class="dialog-privilege-microphone dialog-nobility-center">', '<a class="dialog-cls" href="javascript:;" title="关闭">&times;</a>', '<h2 class="dialog-title">发弹幕很累？连麦互动一下</h2>', '<span class="dialog-sp">连麦—贵族专属特权</span>', '<a class="dialog-openN" href="javascript:;" title="开通贵族">开通贵族</a>', "</div>"].join("")
			},
			handleLianMai: function() {
				var i = this,
					a = (n.get("sys.uid"), e(i.lianMaiTpl()));
				e("body").append(a), i.$noble = e(".dialog-privilege-microphone"), i.$noble.on("click", ".dialog-openN", function(e) {
					return i.$noble.remove(), t.trigger("mod.normal.noble.buy"), !1
				}), i.$noble.on("click", ".dialog-cls", function(e) {
					return i.$noble.remove(), !1
				})
			},
			handleLowEnter: function(e) {
				var t = "",
					a = e.level >= 70 ? "" : "level-bgpng",
					n = e.level >= 100 ? "level-size2" : " level-size1";
				return t = i.string.join('<li class="jschartli status-low-enter enter-level<%= data.nl %>">', '<p class="text-cont">', '<span class="user-level-info">', "<% if(nobleConfig[data.nl]) { %>", '<span class="user-noble-lv">', '<img src="<%= resourceUrl %><%= nobleConfig[data.nl].symbol.web_symbol_pic1 %>" title="<%= nobleConfig[data.nl].symbol.name %>">', "</span>", "<% } %>", "<% if(data.ol > 0) { %>", '<a class="chat-icon-pad anchor-level-icon" data-anchor-levelimg="<%=data.ol%>" title="主播等级：<%= data.ol %>">', "</a>", "<%} else if (isShowUserLevel) { %>", '<a class="chat-icon-pad user-level<% if ( data.level < 10 ) { %> lve-icon-1to9 <% } %> <%= data.uli %> <%= imgType %> <%= imgSize %> " title="用户等级：<%= data.level %>">', "</a>", "<%}%>", '<a href="javascript:;" data-rel="user-info" class="nick-new js-nick" is-show-super-icon="<%= data.sahf%>" avatar="<%= data.ic %>" rel="<%= data.uid %>" gid="<%= data.pg %>" data-level="<%= data.level %>" data-noble="<%= data.nl %>"><%= data.nn %></a>', "<strong>欢迎来到本直播间</strong>", "</span>", "</p>", "</li>"), render = c.compile(t), html = render({
					data: e,
					webUrl: p,
					nobleConfig: g,
					resourceUrl: v,
					imgType: a,
					imgSize: n,
					isShowUserLevel: f
				}), {
					mark: !1,
					html: html
				}
			},
			handleHightEnter: function(t) {
				var a, s, r = this,
					o = "",
					l = null,
					d = [1500000263, 1500000264, 1500000265];
				if (t.el) for (var u = 0, f = t.el.length; f > u; u++) {
					if (1500000123 === parseInt(t.el[u].eid, 10)) {
						a = 1500000123;
						break
					}
					for (var p = 0, m = d.length; m > p; p++) if (parseInt(t.el[u].eid, 10) === d[p]) {
						s = p + 1;
						break
					}
				}
				o = i.string.join("<% if (sharkKingCode) {%>", '<div class="status--enter enter-level<%= data.nl %>">', '<div class="sharkbaby-noble-con"></div>', '<img class="noble-placeholder-img" src="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-vbg<%= data.nl %>.png?20170110">', '<object autoplay="autoplay" data="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-video<%= data.nl %>.swf?20170110">', '<param name="wmode" value="transparent">', '<embed src="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-video<%= data.nl %>.swf?20170110" wmode="transparent">', "</object>", '<video autoplay="autoplay" loop="loop">', '<source src="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-video<%= data.nl %>.mp4?20170111" type="video/mp4">', "</video>", '<div class="chat-user-card">', '<div class="user-card-main clearfix">', '<div class="card--invisible-main ">', '<div class="enter-user-icon">', '<div class="enter-user-bd"></div>', '<img src="<%= handleAvatar(data.ic) %>">', "</div>", "<h2><%= data.nn %></h2>", "<p>欢迎<%= nobleName %>光临直播间</p>", "</div>", "</div>", "</div>", "</div>", "<% } else { %>", '<div class="status--enter enter-level<%= data.nl %>">', "<% if (worldEnter) {%>", '<div class="worldEnter-noble-con worldEnter-noble-con<%= worldEnter %>"></div>', "<% } %>", '<img class="noble-placeholder-img" src="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-vbg<%= data.nl %>.png?20170110">', '<object autoplay="autoplay" data="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-video<%= data.nl %>.swf?20170110">', '<param name="wmode" value="transparent">', '<embed src="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-video<%= data.nl %>.swf?20170110" wmode="transparent">', "</object>", '<video autoplay="autoplay" loop="loop">', '<source src="<%= webUrl %>app/douyu/res/page/room-normal/vip/status-enter-video<%= data.nl %>.mp4?20170111" type="video/mp4">', "</video>", '<div class="chat-user-card">', '<div class="user-card-main clearfix">', '<div class="card--invisible-main ">', '<div class="enter-user-icon">', '<div class="enter-user-bd"></div>', '<img src="<%= handleAvatar(data.ic) %>">', "</div>", "<h2><%= data.nn %></h2>", "<p>欢迎<%= nobleName %>光临直播间</p>", "</div>", "</div>", "</div>", "</div>", "<% } %>"), render = c.compile(o), $nobleEnter = e(render({
					data: t,
					sharkKingCode: a,
					handleAvatar: r.handleAvatar,
					webUrl: n.get("sys.web_url"),
					nobleName: g[t.nl] ? g[t.nl].noble_name : "",
					worldEnter: s
				})), r.$container.append($nobleEnter), l = $nobleEnter.find(".chat-user-card"), l.css({
					opacity: .9
				});
				e('[data-type="chat-cont"]').height(), (new Date).getTime();
				$nobleEnter.animate({
					bottom: 0
				}, 500, function() {
					l.css({
						opacity: 1
					}), setTimeout(function() {
						$nobleEnter.remove(), k.splice(0, 1), k.length && r.handleHightEnter(k[0])
					}, 5e3)
				})
			},
			handleOpenNoble: function(t) {
				var i = this.OpenNobleTpl(),
					a = c.compile(i),
					n = e(a({
						nickname: t.gvnk ? t.gvnk : t.unk,
						anchorName: t.donk || "",
						webUrl: p,
						nl: t.nl,
						level: t.lv,
						nobleConfig: g,
						resourceUrl: v,
						isRenew: t.isRenew,
						isSend: !! t.gvnk,
						reciver: t.unk
					}));
				e("#js-chat-cont").append(n), setTimeout(function() {
					n.remove()
				}, 15e3)
			},
			getNobleEffectConfig: function(t, i) {
				var a, n = this,
					s = n.configs,
					r = e.Deferred();
				return s.nobleEffectData ? "getAll" == i ? r.resolve(s.nobleEffectData) : (a = s.nobleEffectData[t], a ? r.resolve(a) : r.reject()) : (o.load(b + s.urls.nobleEffect, "nobleOpenEffect", function(e) {
					return e ? (s.nobleEffectData = e, "getAll" == i ? r.resolve(s.nobleEffectData) : (a = e[t], a ? r.resolve(a) : r.reject())) : r.reject()
				}), r)
			},
			getNobleEffctConfig: function(e) {
				var t, i = {
					is_special: "is_special",
					bimg: "pc_bg",
					himg: "pc_pic",
					stay_time: "stay_milli_sec",
					nobleFlash: "spl_pc_flash",
					nobleBg: "spl_pc_bg",
					devote: "display_rank",
					nobleLev: "noble_lev",
					name: "noble_name",
					ef: "ef",
					type: "noble_type"
				},
					a = {};
				for (t in i) a[t] = e[i[t]];
				return a
			},
			getNobleEffctPushData: function(e) {
				var t, i = {
					gfid: "noble_id",
					gs: "gs",
					hits: "hits",
					nn: "unk",
					uid: "uid",
					effectType: "noble_type",
					openNobleAvatar: "uic"
				},
					a = {};
				for (t in i) a[t] = e[i[t]];
				return a
			},
			nobleEffectHandle: function(e) {
				var i = this,
					a = {
						giftConfig: i.getNobleEffctConfig(e.giftConfig),
						giftData: i.getNobleEffctPushData(e.giftData)
					};
				t.trigger(u.OPEN_NOBLE_PUSH, a)
			},
			openNobleEffect: function(e) {
				var i, a = this,
					n = g[e.nl];
				n && a.getNobleEffectConfig(e.nl).done(function(s) {
					s && (s.noble_name = n.noble_name, s.noble_lev = e.nl, s.ef = 111111, s.noble_type = "noble", e.noble_id = "noble_" + e.nl, e.noble_type = "noble", e.gs = e.nl, t.trigger("douyu.avatar.url", e.uic, "middle", function(t) {
						e.uic = t, i = {
							giftConfig: s,
							giftData: e
						}, a.nobleEffectHandle(i)
					}))
				})
			},
			bindEvt: function() {
				var i = this;
				this.$container = e(".giftbatter-noble-enter"), l.reg("room_data_openNoble", function() {
					i.handleLianMai()
				}), l.reg("room_data_handler", function(e) {
					var e = a.decode(e).too();
					switch (e.type) {
					case "anbc":
						e.drid == y && i.openNobleEffect(e);
						break;
					case "rnewbc":
						e.isRenew = !0, e.drid == y && i.handleOpenNoble(e)
					}
				}), t.on("mod.chat.noble.enter", function(e) {
					var t = {};
					return e.nl <= 3 || 7 === parseInt(e.nl, 10) ? t = i.handleLowEnter(e) : (k.length ? k.push(e) : (k.push(e), i.handleHightEnter(e)), t = {
						mark: !0,
						html: ""
					}), t
				}), t.on("room.get.noble.effect.config", function() {
					var t = e.Deferred();
					return i.getNobleEffectConfig(0, "getAll").done(function(e) {
						return t.resolve(e)
					}), t
				})
			}
		};
	return w
}), define("douyu/page/room/normal/mod/girl-privilege", ["jquery", "shark/util/lang/1.0", "shark/util/template/1.0", "douyu/context", "shark/observer", "shark/util/storage/1.0", "douyu/com/exjsonp", "shark/util/cookie/1.0"], function(e, t, i, a, n, s, r, o) {
	var l = $COLLIGATE.userLevelSwitch > 0 ? 1 : 0,
		c = ({
			urls: {
				girl: "/member/cp/cp_rpc_ajax",
				cap: a.get("sys.webconfUrl").replace(/^http(s?):/, "").replace(/\/$/g, "") + "/resource/common/female_privilege.json"
			}
		}, {
			btnAction: "jump",
			btnText: "立即认证",
			text: "实名认证为女性的用户可领取特权"
		}),
		d = {
			btnAction: "close",
			btnText: "朕知道了",
			text: "您的实名认证结果为男性，只能欣赏而不可拥有小姐姐特权~"
		},
		u = {
			btnAction: "receive",
			btnText: "领取特权",
			text: "您已通过实名认证且认证为女性，可以领取特权~"
		},
		f = {
			btnAction: "close",
			btnText: "我知道了",
			text: "目前只支持大陆身份证实名认证为女性的用户才能领取特权"
		},
		p = {
			slogan: "您已享有小姐姐特权",
			desc: "快去直播间看看吧！"
		},
		m = {
			slogan: "领取成功！",
			desc: "您已享有小姐姐特权，快去直播间看看吧！"
		},
		h = {
			pagefrom: "",
			APIs: {
				userinfo: "/member/female_privilege/get_privilege_info",
				changeIdent: "/member/cp/changeIdent",
				hidebanner: "/member/female_privilege/hide_banner",
				receivePrivilege: "/member/female_privilege/receive_privilege",
				getCsrfCookie: "/curl/csrfApi/getCsrfCookie"
			},
			_getCsrfCookie: function(t) {
				var i = this,
					a = o.get($SYS.tvk);
				if (!a) return void e.ajax({
					url: i.APIs.getCsrfCookie,
					type: "GET",
					dataType: "json",
					success: function(e) {
						0 === e.error && i._getCsrfCookie(t)
					}
				});
				var n = $SYS.tn;
				t && t({
					name: n,
					val: a
				})
			},
			najax: function(t) {
				this._getCsrfCookie(function(i) {
					t.data[i.name] = i.val, e.ajax(t)
				})
			},
			init: function(e) {
				this.pagefrom = e || "", this.hasSisterDialog() ? this.showPopup() : this.getUserStatus(), DYS.sub({
					action_code: "init_page_lsis"
				})
			},
			hasSisterDialog: function() {
				return e(".widget-sisterdialog-container").length > 0
			},
			getUserStatus: function() {
				var t = this;
				t.najax({
					type: "GET",
					url: t.APIs.userinfo,
					dataType: "json",
					data: {},
					success: function(i) {
						if (0 == i.error) {
							var a = i.data.female_privilege,
								n = i.data.ident_sex;
							t.render(), t.renderStatus(a, n), t.bindEvent()
						} else e.dialog.tips_black(i.msg)
					}
				})
			},
			render: function() {
				var t = ['<div class="widget-sisterdialog-container">', '<div class="widget-content">', '<div class="body">', '<ul class="tequan-list">', '<li><i class="tequan-icon icona"></i><span>闪亮头衔惊艳昵称</span></li>', '<li><i class="tequan-icon iconc"></i><span>萌系可爱个人名片</span></li>', "</ul>", '<div class="tequan-append"></div>', "</div>", '<div class="close"></div>', '<div class="nomore">不再显示此特权banner</div>', "</div>", '<div class="widget-mask"></div>', "</div>"];
				e("body").append(t.join(""))
			},
			renderStatus: function(t, i) {
				var a = {};
				if (this.pagefrom && e(".nomore").hide(), 1 == t) a = p, this.appendSuccess(a);
				else switch (i) {
				case 0:
					a = c, "identselect" == this.pagefrom && (a.btnAction = "close"), this.appendNormal(a);
					break;
				case 1:
					a = d, this.appendNormal(a);
					break;
				case 2:
					a = u, this.appendNormal(a);
					break;
				case 3:
					a = f, this.appendNormal(a)
				}
			},
			bindEvent: function() {
				var t = this;
				e(".widget-sisterdialog-container").on("click", ".close", function() {
					t.hidePopup()
				}).on("click", ".nomore", function() {
					t.hidePopup(), t.hideBanner(), DYS.sub({
						action_code: "click_lsis_no"
					})
				}).on("click", ".button", function() {
					t.buttonAction(e(this))
				})
			},
			buttonAction: function(e) {
				var t = e.attr("data-type");
				switch (t) {
				case "jump":
					this.jumpToIdent();
					break;
				case "close":
					this.hidePopup(), DYS.sub({
						action_code: "click_lsis_known"
					});
					break;
				case "receive":
					this.receivePriv()
				}
			},
			appendNormal: function(t) {
				var i = ['<div class="normal">', '<div class="line"></div>', '<div class="text">' + t.text + "</div>", '<div class="button" data-type=' + t.btnAction + ">" + t.btnText + "</div>", "</div>"];
				e(".tequan-append").html(i.join(""))
			},
			appendSuccess: function(t) {
				var i = ['<div class="success">', '<p class="slogan">' + t.slogan + "</p>", '<p class="desc">' + t.desc + "</p>", "</div>"];
				e(".tequan-append").html(i.join("")), e(".tequan-list li").each(function() {
					e(this).addClass("active")
				})
			},
			showPopup: function() {
				e(".widget-sisterdialog-container").show()
			},
			hidePopup: function() {
				e(".widget-sisterdialog-container").hide()
			},
			hideBanner: function() {
				var t = this;
				t.najax({
					type: "POST",
					url: t.APIs.hidebanner,
					data: {},
					dataType: "json",
					success: function(e) {},
					error: function() {}
				}), e("#sister-right").hide()
			},
			jumpToIdent: function() {
				var e = this;
				DYS.sub({
					action_code: "click_lsis_realverify"
				}), window.location.href = e.APIs.changeIdent
			},
			receivePriv: function() {
				var t = this;
				t.najax({
					type: "POST",
					url: t.APIs.receivePrivilege,
					data: {},
					dataType: "json",
					success: function(i) {
						if (0 == i.error) {
							var a = m;
							t.appendSuccess(a), t.pagefrom || (e(".is-dy-sister").removeClass("hide"), e(".not-dy-sister").addClass("hide"))
						} else e.dialog.tips_black(i.msg)
					},
					error: function() {
						e.dialog.tips_black("领取失败")
					}
				}), DYS.sub({
					action_code: "click_lsis_get"
				})
			}
		},
		g = {
			init: function() {
				this.bindApi()
			},
			bindApi: function() {
				var t = this;
				n.on("mod.userenter.get.girl", function(e) {
					return t.enterWel(e)
				}), e("#js-live-room-normal-right").on("click", ".js-girl-right", function() {
					h.init("liveroom"), e(this).hasClass("js-show-girl") ? n.trigger("dys", {
						key: "dys.room.girl.right.click"
					}) : n.trigger("dys", {
						key: "dys.room.girl.show.detail"
					})
				})
			},
			enterWel: function(e) {
				var a, n = e.level >= 70 ? "" : "level-bgpng",
					s = e.level >= 100 ? "level-size2" : " level-size1";
				if (g.girlEnterRender) a = g.girlEnterRender;
				else {
					var r = t.string.join('<li class="jschartli girl-offline">', '<p class="text-cont girl-cont">', "<% if(data.ol > 0) { %>", '<a class="chat-icon-pad anchor-level-icon" data-anchor-levelimg="<%= data.ol %>" title="主播等级：<%= data.ol %>">', "</a>", "<%} else if (isShowUserLevel) { %>", '<a class="chat-icon-pad user-level<% if ( data.level < 10 ) { %> lve-icon-1to9 <% } %> <%= data.uli %> <%= imgType %> <%= imgSize %> " title="用户等级：<%= data.level %>">', "</a>", "<%}%>", '<a href="javascript:;" data-rel="user-info" class="hy-name js-nick" is-show-super-icon="<%= data.sahf%>" avatar="<%= data.ic %>" rel="<%= data.uid %>" gid="<%= data.pg %>" data-level="<%= data.level %>" data-noble="<%= data.nl %>"><%= data.nn %></a>', "<span>欢迎来到本直播间</span>", "</p>", "</li>");
					a = i.compile(r), g.girlEnterRender = a
				}
				var o = a({
					data: e,
					imgType: n,
					imgSize: s,
					isShowUserLevel: l
				});
				return {
					mark: !1,
					html: o
				}
			}
		};
	return {
		init: function() {
			g.init()
		}
	}
}), define("douyu/page/room/normal/mod/level120-enter", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "douyu/context", "douyu/com/exjsonp"], function(e, t, i, a, n, s) {
	var r = n.get("sys.webconfUrl"),
		o = n.get("sys.avatar_url"),
		l = n.get("sys.ceph_url"),
		c = window.location.protocol + "//" + window.location.host + "/",
		d = {
			width: 336,
			config: [],
			configUrl: r + "resource/common/privilege/custom_effect2.json",
			callbackName: "customEffectConfig",
			defaultAvatar: r + "/app/douyu/res/com/defaultAvatar.png",
			direc: "",
			tempArr: [],
			timer: null,
			flag: !0
		},
		u = {
			init: function() {
				var t = this;
				t.$view = e("#js-chat-cont"), t.target = null, s.load(d.configUrl, d.callbackName, function(e) {
					d.config = e.concat()
				}, function(e) {
					d.config = []
				})
			},
			render: function(e) {
				var t, n, s, r = this;
				t = i.string.join('<div class="giftbatter-normal-config-enter" data-type-welcome="level120Box" style="height:{{ data.bg_height }}px;">', '<div class="normal-config-enter-status--enter" data-type-welcome="level120">', '<img class="normal-config-enter-flashbg" src="{{ url + data.web_img }}">', '<object autoplay="autoplay">', '<embed type="application/x-shockwave-flash" src="{{ mainUrl + data.web_img_swf }}" wmode="transparent">', "</object>", '<div class="normal-config-enter-user-icon" style="top:{{ data.img_height }}px">', '<img class="normal-config-enter-user-avatar" src="{{ handleAvatar(data.ic) }}">', "</div>", '<div class="normal-config-enter-user-intro" style="color:{{ data.font_color }};top: {{ data.font_height }}px">', '<span class="normal-config-enter-user-intro-con"><span class="normal-config-enter-user-intro-text1">{{ data.text1 }}</span>', '<span class="normal-config-enter-user-name" style="color:{{ data.name_color }}";>{{ data.nn }}</span>', '<span class="normal-config-enter-user-intro-text2">{{ data.text2 }}</span></span>', "</div>", "</div>", "</div>"), n = a.compile(t), s = n({
					data: e,
					url: l,
					handleAvatar: r.handleAvatar,
					mainUrl: c
				}), r.$view.append(s), r.target = r.$view.find('[data-type-welcome="level120"]'), r.layout(r.target, e)
			},
			layout: function(e, t) {
				var i = ["bottom", "top", "left", "right"],
					a = i[t.occurrence_mode - 1];
				3 == t.occurrence_mode && 4 == t.occurrence_mode ? e.css(a, -d.width + "px") : e.css(a, -t.bg_height + "px"), d.direc = a
			},
			show: function() {
				var t = this,
					i = {},
					a = {};
				d.tempArr.length && d.flag && (i = d.tempArr[0], d.flag = !1, t.render(i), a[d.direc] = 0, t.target.show().animate(a, 1e3), d.timer = setTimeout(function() {
					t.target.fadeOut(1e3, function() {
						d.flag = !0, e(this).closest('[data-type-welcome="level120Box"]').remove(), d.tempArr.shift(), t.show()
					})
				}, 4e3))
			},
			handleAvatar: function(e) {
				var t = d.defaultAvatar;
				return e && (t = i.string.format("{0}upload/{1}_middle.jpg", o, e)), t
			},
			handleData: function(t) {
				var i = this,
					a = {};
				return d.config.length && (a = i.matchEid(t.ceid, d.config), a.ic = t.ic, a.nn = t.nn), e.isEmptyObject(a) ? !1 : (d.tempArr.push(a), a)
			},
			matchEid: function(e, t) {
				for (var i = [], a = t.length - 1; a >= 0; a--) if (e == t[a].ceid) return i = t[a].welcome_content.split("%username%"), t[a].text1 = i[0], 2 === i.length ? t[a].text2 = i[1] : t[a].text2 = "", t[a];
				return !1
			},
			imgLoad: function(e, t) {
				var i = !0,
					a = null,
					n = new Image,
					s = new Image;
				return s.complete ? void t() : (a = setTimeout(function() {
					i && (i = !1, t())
				}, 500), s.onload = function() {
					i && (clearTimeout(a), s.onload = null, i = !1, t())
				}, n.src = e.web_img, void(s.src = e.web_img_swf))
			}
		};
	return t.on("mod.chat.level120.enter", function(e) {
		var t = u.handleData(e);
		return t ? (u.imgLoad(t, function() {
			u.show(t)
		}), {
			mark: !0
		}) : {
			mark: !1,
			html: ""
		}
	}), {
		init: function() {
			u.init()
		}
	}
}), define("douyu/page/room/normal/mod/noble-overtime-tips", ["jquery", "shark/observer", "shark/util/storage/1.0", "shark/util/lang/1.0", "shark/util/template/1.0", "douyu/page/room/base/api", "douyu/com/exjsonp"], function(e, t, i, a, n, s, r) {
	var o = {},
		l = {
			init: function(t) {
				return this.svgEnable = !(!window.navigator.msPointerEnabled && !window.navigator.pointerEnabled), this.isIE = navigator.userAgent.indexOf("MSIE") > -1, this.id = "grayscale" + (Math.random() + "").slice(2, 8), this.svg = ['<svg version="1.1" xmlns="http://www.w3.org/2000/svg" style="position:absolute;left:-1000px;top:-1000px;">', '<filter id="' + this.id + '">', '<feColorMatrix type="matrix" values="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"/>', "</filter>", "</svg>"].join(""), e("body").append(this.svg), this.render(t)
			},
			render: function(t) {
				var i;
				this.svgEnable ? (i = e(t), i.length > 0 && "img" !== i[0].nodeName.toLowerCase() && (i = e(t).find("img")), e(i).each(function(t, i) {
					var a = i.width || 0,
						n = i.height || 0,
						s = '<svg width="' + a + '" height="' + n + '"><image xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="' + i.src + '" x="0" y="0" width="' + a + '" height="' + n + '" filter="url(#' + this.id + ')"></image></svg>';
					e(i).replaceWith(s)
				})) : (e(t).css({
					"-webkit-filter": "grayscale(100%)",
					"-moz-filter": "grayscale(100%)",
					"-ms-filter": "grayscale(100%)",
					"-o-filter": "grayscale(100%)",
					filter: "grayscale(100%)"
				}), this.isIE && e(t).css("filter", "gray"))
			}
		};
	return o = {
		init: function() {
			this.config = {
				nobleInfoUrl: "/noble/confignw",
				containsDom: ".chat",
				showTipsTimes: 0
			}, this.regNobleInfo(), this.bindEvt()
		},
		bindEvt: function() {
			e(this.config.containsDom).on("click", '[noble-overtime="close"]', function() {
				var t = e(".noble-renewal-fee");
				t.remove()
			}).on("click", '[noble-overtime="renew"]', function() {
				var i = e(".noble-renewal-fee");
				return i.remove(), t.trigger("mod.normal.noble.buy"), !1
			})
		},
		renderChatTips: function(t) {
			var s, r, o, c, d = i.get("nobleOverTips") || "",
				u = parseInt(d.split("-")[0], 10) || 0,
				f = (new Date).getTime();
			s = a.string.join('<div class="noble-renewal-fee">', '<div class="close" noble-overtime="close"></div>', '<div class="noble-fee-id">', '<div class="noble-id-icon">', '<img src="<%= nobleInfo.icon %>">', "</div>", '<h3 class="noble-fee-txt">您的<%= nobleInfo.nobleName %>身份已过期</h3>', "<% if (nobleInfo.nobleGold > 0) { %>", '<span class="noble-account"><em class="noble-account-em"><%= nobleInfo.nobleGold %>贵族鱼翅</em>已被冻结</span>', "<% } %>", "</div>", '<div class="noble-expired-desc">', '<span><%= nobleInfo.endTime %>日0点前续费贵族可解冻贵族鱼翅，</span><span>享续费价格<em class="noble-expired-strong">节省<%= nobleInfo.savePrices %>元</em> </span>', "</div>", '<a class="noble-renewal-btn" href="javascript:;" noble-overtime="renew">续费贵族</a>', "</div>"), o = n.compile(s), r = o({
				nobleInfo: t
			}), e(this.config.containsDom).append(r), l.init(".noble-renewal-fee .noble-fee-id img"), 0 === u ? i.set("nobleOverTips", f + 6048e5 + "-1", 1296e3) : i.set("nobleOverTips", f + 6048e5 + "-2", 1296e3), c = setTimeout(function() {
				e(".noble-renewal-fee").remove(), clearTimeout(c)
			}, 2e4)
		},
		delTime: function(e) {
			var t, i, a, n;
			return e ? (n = new Date(1e3 * e), t = n.getFullYear(), i = n.getMonth() + 1 < 10 ? "0" + (n.getMonth() + 1) : n.getMonth() + 1, a = n.getDate() + "", t + "-" + i + "-" + a) : 0
		},
		handleData: function(e, t) {
			var i = {};
			i.nobleGold = t.ngb / 100, i.endTime = this.delTime(t.npts), i.nobleName = e.noble_name, i.icon = $SYS.resource_url + e.symbol.web_symbol_pic3 || $SYS.web_url + "app/douyu/res/page/room-normal/noble/noble-icon.png?20170914", i.savePrices = parseInt((e.first_open_price - e.first_remand_gold) / 100, 10), this.renderChatTips(i)
		},
		getCurNobleInfo: function(e, t) {
			var i = null,
				a = 0;
			for (a; a < e.length; a++) parseInt(e[a].level, 10) === +t && (i = e[a]);
			return i
		},
		getNobleConfig: function(t, i) {
			var a = this,
				n = {};
			0 >= t || e.ajax({
				url: a.config.nobleInfoUrl,
				type: "GET",
				dataType: "json",
				success: function(e) {
					0 === parseInt(e.error, 10) && (n = a.getCurNobleInfo(e.data, t) || {}, a.handleData(n, i))
				}
			})
		},
		regMsg: function(e) {
			var t = parseInt((new Date).getTime() / 1e3, 10),
				a = e.nets || 0,
				n = parseInt(e.nl, 10) || parseInt(e.npl, 10) || 0,
				s = i.get("nobleOverTips") || "",
				r = parseInt(s.split("-")[1], 10) || 0,
				o = parseInt(s.split("-")[0], 10) || 0;
			a > 0 && i.remove("nobleOverTips"), r >= 2 || o > 1e3 * t || !e.nl && e.npl && this.getNobleConfig(n, e)
		},
		regNobleInfo: function() {
			var e = this;
			t.on("mod.noble.info.get", function(t) {
				"memberinfores" === t.type && e.regMsg(t)
			})
		}
	}, {
		init: function() {
			o.init()
		}
	}
}), define("douyu/page/room/normal/mod/broadcast", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/storage/1.0", "shark/util/flash/data/1.0", "shark/util/template/2.0", "douyu/context", "douyu/com/sign", "douyu/com/exjsonp", "douyu/page/room/base/api", "shark/lib/json2"], function(e, t, i, a, n, s, r, o, l, c) {
	var d = {
		urls: {
			config: r.get("sys.webconfUrl") + "resource/common/broadcast/broadcastJsonp.json"
		},
		adQueue: [],
		flags: {
			configLoaded: 0,
			detailLoaded: 0,
			signLoaded: 0,
			isShow: 0,
			pageLoaded: 1
		},
		storeNames: {
			configData: "broadcastconfig",
			broadcasts: "broadcasts",
			broadcastlimit: "broadcastlimit"
		},
		timers: {
			delayTime: null,
			displayTime: null
		},
		data: {
			currentData: null,
			roomId: r.get("room.room_id")
		},
		config: {},
		init: function() {
			var i = this;
			this.doms = {
				sysBroadcast: e("#js-chat-notice")
			}, this.renders = {
				renderAd: this.renderAdFn(),
				renderNotify: this.renderNotifyFn(),
				renderImg: this.renderImgFn()
			}, l.load(i.urls.config, "setSysBroadcastConf", function(e) {
				i.config = e, a.set(i.storeNames.configData, e), t.trigger("mod.broadcast.config.loaded")
			}, function() {
				i.config = a.get(i.storeNames.configData), i.config && t.trigger("mod.broadcast.config.loaded")
			}), i.bindEvents()
		},
		renderAdFn: function() {
			var e = i.string.join('<div class="chat-sysbroadcast-ad {{ if !data.link }} chat-sysbroadcast-ad-nolink{{ /if }}" {{if data.posid }} data-dysign={{data.posid}} {{/if}}>', '<div class="chat-sysbroadcast-header clearfix">', '<a data-sysbroadcast="btn-close" class="chat-sysbroadcast-close" href="javascript:;" title="关闭">关闭</a>', "</div>", '<div class="chat-sysbroadcast-body clearfix  {{if data.posid }} dysign-text-dot {{/if}}">', "{{ if data.link }}", '<a href="{{ data.link }}" data-sysbroadcast="cont" class="chat-sysbroadcast-cont" target="_blank" title="{{ data.c }}">', "{{ data.c }}", "</a>", '<a href="{{ data.link }}" data-sysbroadcast="godetail" class="chat-sysbroadcast-godetail fr" target="_blank" title="查看详情">查看详情</a>', "{{ else }}", '<div data-sysbroadcast="cont" class="chat-sysbroadcast-cont" target="_blank" title="{{ data.c }}">', "{{ data.c }}", "</div>", "{{ /if }}", "</div>", "</div>"),
				t = s.compile(e);
			return t
		},
		renderNotifyFn: function() {
			var e = i.string.join('<div class="chat-sysbroadcast">', '<div class="chat-sysbroadcast-header clearfix">', '<a data-sysbroadcast="btn-close" class="chat-sysbroadcast-close" href="javascript:;" title="关闭">关闭</a>', "</div>", '<div class="chat-sysbroadcast-body clearfix">', "{{ if data.link }}", '<a href="{{ data.link }}" data-sysbroadcast="cont" class="chat-sysbroadcast-cont" target="_blank" title="{{ data.c }}">', "{{ data.c }}", "</a>", "{{ else }}", '<div data-sysbroadcast="cont" class="chat-sysbroadcast-cont" title="{{ data.c }}">', "{{ data.c }}", "</div>", "{{ /if }}", "</div>", "</div>"),
				t = s.compile(e);
			return t
		},
		renderImgFn: function() {
			var e = i.string.join('<div class="chat-sysbroadcast-imgad" {{if data.posid }} data-dysign={{data.posid}} {{/if}}>', "{{ if data.link }}", '<a href="{{ data.link }}" data-sysbroadcast="cont" class="chat-sysbroadcast-cont" target="_blank">', '<img style="width: 335px; height: 116px;" src="{{ data.wis }}" title="{{ data.c }}" />', "</a>", "{{ else }}", '<div data-sysbroadcast="cont" class="chat-sysbroadcast-cont">', '<img style="width: 335px; height: 116px;" src="{{ data.wis }}" title="{{ data.c }}" />', "</div>", "{{ /if }}", "{{ if data.mtype == 1 }}", '<div class="chat-sysbroadcast-ad-flag">广告</div>', "{{ /if }}", '<a data-sysbroadcast="btn-close" class="chat-sysbroadcast-close" href="javascript:;" title="关闭">关闭</a>', "</div>"),
				t = s.compile(e);
			return t
		},
		bindEvents: function() {
			var e = this,
				i = e.doms.sysBroadcast;
			t.on("mod.broadcast.config.loaded", function() {
				e.flags.configLoaded = 1, e.check() && (e.flags.signLoaded ? e.adQueue.push(1) : e.setBroadcast())
			}), c.reg("room_data_brocast", function(t) {
				var i = n.decode(t).too();
				window.removeSign || "rsm" == i.type && (e.data.currentData = i, e.flags.detailLoaded = 1, e.check() && (e.flags.signLoaded ? e.adQueue.push(1) : e.setBroadcast()))
			}), i.on("click", '[data-sysbroadcast="btn-close"]', function() {
				var i = e.data.currentData;
				e.hideBroadcast(), i && t.trigger("dys", {
					key: "dys.room.sysbroadcast.close",
					radio_type: parseInt(i.mtype, 10) + 1,
					radio_id: i.id
				})
			}), i.on("click", 'a[data-sysbroadcast="cont"], [data-sysbroadcast="godetail"]', function() {
				var i = e.data.currentData;
				i && t.trigger("dys", {
					key: "dys.room.sysbroadcast.click",
					radio_type: parseInt(i.mtype, 10) + 1,
					radio_id: i.id,
					jurl: 1 == i.jmptp ? "" : i.weburl,
					rid: 1 == i.jmptp ? i.weburl : 0
				})
			})
		},
		check: function() {
			return this.flags.configLoaded && this.flags.detailLoaded
		},
		setBroadcast: function() {
			var e, t, i, n = this,
				s = n.data.roomId,
				r = n.storeNames.broadcasts,
				o = n.storeNames.broadcastlimit,
				l = n.config,
				c = n.timers,
				d = n.renders,
				u = n.data.currentData,
				f = u && u.id,
				p = u && u.t,
				m = (new Date).getTime();
			if (f && u.clitp % 2 == 1 && (2 == p || 3 == p || 4 == p || 5 == p)) {
				if (f && (f = parseInt(u.id, 10)), 0 != l.frequency.time && 0 != l.frequency.count || a.remove(o), i = a.get(o), i || (i = {}), i.showedTimes || (i.showedTimes = 0, i.firstTime = (new Date).getTime()), 0 != l.frequency.time && 0 != l.frequency.count) if (i.firstTime + 6e4 * l.frequency.time > m) {
					if (i.showedTimes >= l.frequency.count) return
				} else i = {
					showedTimes: 0,
					firstTime: (new Date).getTime()
				};
				e = a.get(r), e || (e = {}), n.flags.pageLoaded && (n.flags.pageLoaded = 0, e[s] = null, delete e[s]), t = e && e[s], t && l.sort[u.t] < l.sort[t.t] || (n.currentRender = function() {
					return ""
				}, 1 == u.jmptp ? u.link = "/" + u.weburl : u.link = u.weburl, u.wis ? (u.wis = l.broadcast_img_prefix + u.wis, n.currentRender = d.renderImg) : 1 == u.mtype ? n.currentRender = d.renderAd : n.currentRender = d.renderNotify, clearTimeout(c.displayTime), n.flags.isShow && n.hideBroadcast(), 0 != l.delay ? c.delayTime = setTimeout(function() {
					n.render(), clearTimeout(c.delayTime)
				}, 1e3 * parseInt(l.delay, 10)) : n.render(), i.showedTimes++, e[s] = u, a.set(o, i), a.set(r, e, 31536e3))
			}
		},
		render: function() {
			var t = this.data.currentData,
				i = "";
			i = e.trim(this.currentRender({
				data: t
			})), i && (this.doms.sysBroadcast.html(i), this.showBroadcast())
		},
		showBroadcast: function() {
			var e = this,
				i = e.timers,
				a = e.data.currentData,
				n = e.doms.sysBroadcast;
			t.trigger("dys", {
				key: "dys.room.sysbroadcast.show",
				radio_type: parseInt(a.mtype, 10) + 1,
				radio_id: a.id
			}), n.removeClass("hide").animate({
				bottom: 90,
				opacity: 1
			}), n.find('[data-sysbroadcast="cont"]').animate({
				height: "auto"
			}, function() {
				e.flags.isShow = 1, "0" != a.distm && (i.displayTime = setTimeout(function() {
					e.hideBroadcast()
				}, 1e3 * a.distm || 1500))
			})
		},
		hideBroadcast: function() {
			var e = this,
				t = e.doms.sysBroadcast,
				i = e.timers;
			clearTimeout(i.displayTime), t.animate({
				bottom: 3,
				opacity: 0
			}).find('[data-sysbroadcast="cont"]').animate({
				height: 0
			}, function() {
				e.flags.isShow = 0, u.canShowBroadcast()
			})
		}
	},
		u = {
			flag: !1,
			id: 10014,
			init: function() {
				var e = this;
				t.on("direction.sign." + e.id, function(t) {
					parseInt(t.posid, 10) === e.id && (d.flags.signLoaded = 1, u.render(t))
				}), this.addEvent()
			},
			render: function(t) {
				var i = this.buildComData(t),
					a = "",
					n = t.srcid ? d.renders.renderImg : d.renders.renderAd,
					s = t.ec || {},
					r = s.cd;
				if (s.text && (i.c = s.text), this.isSignGapExpired(r)) {
					if (a = e.trim(n({
						data: i
					})), !a) return void this.canShowBroadcast();
					d.doms.sysBroadcast.html(a), this.showSign(t), o.exposure()
				}
			},
			showSign: function(e) {
				var t = this,
					i = d.doms.sysBroadcast;
				i.removeClass("hide").animate({
					bottom: 90,
					opacity: 1
				}), i.find('[data-sysbroadcast="cont"]').animate({
					height: "auto"
				}, function() {
					t.displayTime = setTimeout(function() {
						t.hideSign()
					}, 1e3 * e.ec.showtime || 15e3)
				})
			},
			hideSign: function() {
				var e = this,
					t = d.doms.sysBroadcast;
				clearTimeout(e.displayTime), t.animate({
					bottom: 3,
					opacity: 0
				}).find('[data-sysbroadcast="cont"]').animate({
					height: 0
				}, function() {
					e.canShowBroadcast()
				})
			},
			canShowBroadcast: function() {
				d.flags.signLoaded = 0, d.adQueue.length > 0 && (d.adQueue.pop(), d.setBroadcast())
			},
			isSignGapExpired: function(e) {
				var t = Number(e),
					i = "sign_last_show",
					n = a.get(i);
				if (isNaN(t) || void 0 === e || null === n) return a.set(i, +new Date), !0;
				var s = +new Date - n,
					r = 1e3 * t;
				return s > r ? (a.set(i, +new Date), !0) : !1
			},
			buildComData: function(e) {
				var t = {};
				return t.link = o.helper.innerLink(e), t.wis = e.srcid, t.c = e.adtitle, t.mtype = e.priority, t.posid = e.posid, t
			},
			addEvent: function() {
				e("#mainbody").on("click", ".dysign-text-dot a", function(e) {
					t.trigger("mod.sign.dot", 10014)
				})
			}
		};
	return {
		init: function() {
			d.init()
		},
		signInit: function() {
			u.init()
		}
	}
}), define("douyu/page/room/normal/mod/super-recommended", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/cookie/1.0", "shark/util/storage/1.0", "shark/util/template/2.0", "douyu/context", "douyu/com/imgp", "douyu/com/sign"], function(e, t, i, a, n, s, r, o, l) {
	var c = {
		getDayDiff: function() {
			var e = new Date,
				t = e.getFullYear() + "/" + (e.getMonth() + 1) + "/" + e.getDate(),
				i = new Date(t);
			i.setDate(i.getDate() + 1);
			var a = ((i.getTime() - e.getTime()) / 1e3).toFixed(0);
			return parseInt(a)
		},
		getRandomNum: function(e, t) {
			var i = t - e,
				a = Math.random();
			return e + Math.round(a * i)
		}
	},
		d = {
			locstorage: {
				locname: "showsuperrmd" + (a.get("uid") || "no"),
				showsuper: 1,
				storagetime: 86400
			},
			tipstorage: {
				locname: "showtiprmd" + (a.get("uid") || "no"),
				showtip: 1,
				storagetime: 259200,
				storagetime2: c.getDayDiff()
			},
			listdata: [],
			ywlistdata: [],
			showtime: 0,
			tiptime: 18e4,
			showflag: 0,
			togglefirst: 1,
			dataflag: {
				rightPop: 0,
				ywPop: 1
			}
		},
		u = {
			$win: e(window)
		},
		f = {},
		p = {},
		m = {};
	return d.getdata = function(t) {
		var i = $ROOM.room_id,
			a = $ROOM.cate_id,
			n = "/roomrecomm/getrecommand";
		e.ajax(n, {
			data: {
				roomid: i,
				cateid: a
			},
			type: "get",
			dataType: "json",
			timeout: 3e3,
			success: function(e) {
				0 == e.error && (d.ywlistdata = e.data.fish)
			}
		})
	}, d.getAdData = function(t) {
		var i = "30041,30042,30043,30044",
			a = "/lapi/sign/signapi/getinfo",
			n = l.helper.buildSignApi(i);
		$SYS && $SYS.sign_newver && (a = "/lapi/sign/web/getinfo"), e.ajax(a, {
			data: n,
			type: "POST",
			dataType: "json",
			timeout: 3e3,
			success: function(e) {
				0 == e.error && (d.listdata = e.data, d.locstorage.showsuper && d.listdata.length >= 4 && (l.helper.pushPageAdvar(e.data), setTimeout(function() {
					u.init(), f.init()
				}, d.showtime)))
			}
		})
	}, d.init = function() {
		var t = n.get(d.locstorage.locname),
			i = n.get(d.tipstorage.locname);
		d.locstorage.showsuper = e.isNumeric(t) ? parseInt(t) : 1, d.tipstorage.showsuper = e.isNumeric(i) ? parseInt(i) : 1;
		var a = c.getRandomNum(25, 35);
		setTimeout(function() {
			d.getdata(d.dataflag.rightPop), d.getAdData(d.dataflag.rightPop)
		}, 1e3 * a)
	}, d.ywinit = function() {
		d.ywlistdata.length >= 2 && (p.init(), m.init())
	}, u.init = function() {
		u.$body = e("body"), u.$body.append(i.string.join('<div class="js-live-room-recommend" id="js-live-room-recommend">', '<b class="super-rmd-bg tggcontrol"></b>', '<b class="super-rmd-title tggcontrol"></b>', '<div class="title tggcontrol">', '<img src="' + $SYS.web_url + 'app/douyu/res/page/room-normal/super-rmd/sg-rgrmd-top.png" />', "</div>", '<div class="list">', "</div>", '<div class="footer super-notshow" data-flag="1"><img src="' + $SYS.web_url + 'app/douyu/res/page/room-normal/super-rmd/rgrmd-foot.png" /></div>', "</div>")), u.$recommend = e("#js-live-room-recommend"), u.$list = u.$recommend.find(".list"), u.$tggcontrol = u.$recommend.find(".tggcontrol"), u.$notshow = u.$recommend.find(".super-notshow"), u.$footer = u.$recommend.find(".footer"), u.mainObj.fitSize(), u.mainObj.renderData(), u.mainObj.keaiShow(1)
	}, u.mainObj = {
		getTemplate: function() {
			return '{{each items as value i}}<div class="list-item js-monitor-sign" title="{{value.ec.desc}}" data-dysign="{{value.posid}}" data-dysign-mid="{{value.mid}}" data-dysign-gid="{{value.gid}}">{{if value.type === "img" || value.ec.innerlink !== "1"}}<a target="_blank" href="{{value.link}}">{{/if}}<div class="room-img">{{if value.type === "img"}}<img data-original="{{value.srcid}}" src="' + $SYS.web_url + 'app/douyu/res/page/list-item-def-thumb.gif" title="{{value.ec.desc}}"><div class="room-img-bg"></div>{{else}}<object type="application/x-shockwave-flash" data="{{value.srcid}}" width="100%" height="100%"></object>{{/if}}{{if value.priority === "1"}}<i class="sign-spec"></i>{{/if}}</div><div class="room-info" ><div class="room-type-name">{{value.ec.name}}</div><div class="room-title">{{value.ec.desc}}</div></div>{{if value.type === "img" || value.ec.innerlink !== "1"}}</a>{{/if}}</div>{{/each}}'
		},
		renderData: function() {
			var e = d.listdata.splice(0, 4);
			for (var t in e) e[t].srcid && -1 !== e[t].srcid.indexOf("swf") ? e[t].type = "swf" : e[t].type = "img", e[t].srcid = l.helper.innerPath(e[t].srcid);
			var i = s.compile(u.mainObj.getTemplate()),
				a = i({
					items: e
				});
			u.$list.append(a), o.build()
		},
		toggle: function() {
			if (0 == d.showflag && d.togglefirst && window.DYS && l.exposure(), d.togglefirst = 0, d.showflag) {
				u.$recommend.removeClass("active").css({
					right: "-" + (u.$list.width() + 6) + "px"
				}), d.showflag = 0, u.mainObj.keaiShow(1);
				var e = u.$footer.attr("data-flag");
				1 != e && u.mainObj.notShow()
			} else u.$recommend.addClass("active").css({
				right: "0px"
			}), setTimeout(function() {
				u.$recommend.trigger("scroll")
			}, 600), d.showflag = 1, u.mainObj.keaiShow(0)
		},
		keaiShow: function(e) {
			e ? (setTimeout(function() {
				u.$recommend.find(".super-rmd-title").stop().animate({
					left: "-66px"
				}, 600)
			}, 300), setTimeout(function() {
				u.$recommend.find(".super-rmd-bg").stop().animate({
					height: "99px",
					top: "-10px"
				}, 1e3)
			}, 600)) : (u.$recommend.find(".super-rmd-bg").stop().css({
				height: "0px",
				top: "65px"
			}), u.$recommend.find(".super-rmd-title").stop().css("left", "0px"))
		},
		fitSize: function() {
			var e = u.$win.height(),
				t = 565,
				i = (e - t) / 2;
			78 > i && (i = 78), 565 > e ? u.$recommend.css({
				top: "0px",
				display: "block"
			}) : u.$recommend.css({
				top: i.toFixed(0) + "px",
				display: "block"
			})
		},
		notShow: function() {
			n.set(d.locstorage.locname, 0, d.locstorage.storagetime), u.$recommend.hide()
		}
	}, u.tipObj = {
		showTip: function() {
			d.tipstorage.showsuper && setTimeout(function() {
				d.showflag || (u.$tip.show(), u.$tip.find("button").click(function() {
					u.mainObj.toggle(), t.trigger("dys", {
						key: "dys.room.superrecommand.read"
					})
				}), u.$tip.find("a.rmd-tip-notshow").click(function(e) {
					u.$tip.hide(), e.stopPropagation(), e.preventDefault(), t.trigger("dys", {
						key: "dys.room.superrecommand.nomoreshow.click"
					})
				}), u.$tip.find(".rmd-tip-close").click(function(e) {
					u.$tip.hide()
				}), n.set(d.tipstorage.locname, 0, d.tipstorage.storagetime), d.tipstorage.showsuper = 0, t.trigger("dys", {
					key: "dys.room.superrecommand.show"
				}))
			}, d.tiptime)
		},
		hideTip: function() {
			d.tipstorage.showsuper || (u.$tip.hide(), n.set(d.tipstorage.locname, 0, d.tipstorage.storagetime2), d.tipstorage.showsuper = 0)
		}
	}, f.init = function() {
		u.$tggcontrol.click(function() {
			u.mainObj.toggle()
		}), u.$notshow.click(function(e) {
			var t = u.$footer.attr("data-flag");
			1 == t ? (u.$footer.attr("data-flag", 0), u.$footer.find("img").attr("src", $SYS.web_url + "app/douyu/res/page/room-normal/super-rmd/rgrmd-foot-select.png")) : (u.$footer.attr("data-flag", 1), u.$footer.find("img").attr("src", $SYS.web_url + "app/douyu/res/page/room-normal/super-rmd/rgrmd-foot.png"))
		}), window.DYS && u.$list.find(".list-item").each(function(i) {
			var a = this;
			e(a).click(function(n) {
				var s = ($ROOM.room_id, e(a).find("a").attr("data-roomid"));
				e(a).find("a");
				t.trigger("dys", {
					key: "dys.room.recommand.click",
					rid: s,
					pg: 1,
					pos: i + 1
				})
			})
		}), u.$win.resize(function() {
			u.mainObj.fitSize()
		}), e("#js-live-room-recommend").on("click", ".js-monitor-sign a", function() {
			var i = e(this).closest(".js-monitor-sign").data("dysign");
			t.trigger("mod.sign.dot", i)
		})
	}, p.init = function() {
		var a = i.string.join('<div class="rmd-rooms">', '<div class="rmd-rooms-title"></div>', '<ul class="rmd-rooms-list clearfix">', "</ul>", "</div>");
		if (p.$ywrmdroom = e("#js-yw-rmd-rooms"), p.$ywrmdroom.find(".rmd-rooms").length <= 0 && p.$ywrmdroom.html(a), p.$ywrmdlist = e("#js-yw-rmd-rooms").find("ul.rmd-rooms-list"), p.mainObj.renderData(), window.DYS) {
			$ROOM.room_id;
			p.$ywrmdlist.find("li").each(function(i) {
				var a = this,
					n = e(a).find("a").attr("data-roomid"),
					s = e(a).attr("data-cateid"),
					r = e(a).find("a");
				t.trigger("dys", {
					key: "dys.room.recommand.show",
					rid: n,
					rt: r.data("rt"),
					sub_rt: r.data("sbrt"),
					tid: s,
					pg: 1,
					pos: i + 1
				})
			})
		}
	}, p.mainObj = {
		getTemplate: function() {
			return '{{each items as value i}}<li title="{{value.title}}"><a target="_blank" href="/{{value.roomid}}" data-rt="{{value.ranktype}}" data-sbrt="{{value.recomType}}" data-cateid="{{value.cateid}}" data-roomid="{{value.roomid}}"><div class="rmd-room"><div class="rmd-room-img"><b></b><img  data-original="{{value.roompic}}" src="' + $SYS.web_url + 'app/douyu/res/page/list-item-def-thumb.gif" title="{{value.title}}"></div><div class="rmd-room-title" >{{value.title}}</div></div></a></li>{{/each}}'
		},
		renderData: function() {
			var e = d.ywlistdata.slice(0, 2),
				t = s.compile(p.mainObj.getTemplate()),
				i = t({
					items: e
				});
			p.$ywrmdroom.parent(".yw-collect-box").addClass("ywrmd"), p.$ywrmdlist.html(i), o.build()
		},
		rmdRefresh: function() {
			e("#js-yw-rmd-rooms").find(".rmd-rooms").length <= 0 && d.ywlistdata.length >= 2 && (p.init(), m.init())
		}
	}, m.init = function() {
		window.DYS && p.$ywrmdlist.find("a").each(function(i) {
			var a = this;
			e(a).click(function(n) {
				var s = ($ROOM.room_id, e(a).attr("data-roomid")),
					r = e(a).attr("data-cateid"),
					o = e(a);
				t.trigger("dys", {
					key: "dys.room.recommand.click",
					rid: s,
					rt: o.data("rt"),
					sub_rt: o.data("sbrt"),
					tid: r,
					pg: 1,
					pos: i + 1
				})
			})
		})
	}, {
		init: function() {
			d.init()
		},
		ywinit: function() {
			d.ywinit()
		},
		ywRmdRefresh: function() {
			p.mainObj.rmdRefresh()
		}
	}
}), define("douyu/page/room/normal/mod/bonus", ["jquery", "douyu/page/room/base/api", "shark/util/flash/data/1.0", "shark/observer", "shark/util/template/1.0", "douyu/com/user", "douyu/context", "shark/ext/swfobject", "shark/util/storage/1.0", "douyu/page/room/normal/mod/chat-msg-tmp"], function(e, t, i, a, n, s, r, o, l, c) {
	var d = e("#js-color-barrage"),
		u = null,
		f = e("#js-chat-cont"),
		p = null,
		m = "bonus-swf",
		h = 0,
		g = 9,
		v = 180,
		y = null,
		b = null,
		k = !1,
		w = "bonusId",
		_ = "/member/cp",
		x = !1,
		C = {
			init: function(n) {
				var s = this;
				n && (x = n, f = e("#js-live-room-normal-right"), f.addClass("diy-bonus"), a.on("mod.chat.gift.layout", function() {
					s.updateStatus(), p && p.css({
						bottom: e("#js-chat-speak").outerHeight()
					})
				})), a.on("mod.chat.bonus.call", function(e) {
					s.dispatch(e)
				}), t.reg("room_data_sabonus", function(e) {
					s.dispatch(e)
				}), t.reg("room_data_sabonusget", function(e) {
					var t, n = i.decode(e).too();
					return "ggbr" === n.type && s.updateBonus(n), "ggbb" === n.type && (t = c.peck(e), n.did != r.get("sys.uid") && a.fire("mod.chat.msg.shield").message) ? !1 : void(t && a.trigger("mod.chat.msg.msg", t))
				}), t.reg("room_data_login", function(e) {
					if (null != r.get("sys.uid") || null != r.get("sys.username")) {
						var t = i.decode(e).too();
						0 == t.ps && 0 == t.es ? _ = "/member/cp" : 0 == t.es ? _ = "/member/cp/changeEmail" : 0 == t.ps ? _ = "/member/cp/cpBindPhone" : k = !0
					}
				})
			},
			updateStatus: function() {
				f.addClass("diy-bonus-no-notice"), p && p.find(".bonus-outer,#bonus-video").removeAttr("style")
			},
			render: function(t) {
				var i = this,
					n = parseInt(t.stl, 10),
					s = "",
					r = null;
				return s = l.get(w), t.rpid == s ? !1 : -v >= n ? !1 : (0 == d.next(".bonus-handle").size() && (u = e(i.getHandleTmpl()), d.after(u)), 0 == f.find(".bonus-box").size() && (p = e(i.getBonusboxTmpl()), f.append(p), a.trigger("mod.chat.gift.layout")), b = p.find(".bonus-holder"), i.bindEvent(), setTimeout(function() {
					i.wait(t)
				}, h), void(r = setInterval(function() {
					n--, -v >= n && (clearInterval(r), i.destroy())
				}, 1e3)))
			},
			wait: function(t) {
				var i = this,
					a = 1e3 * parseInt(t.stl, 10),
					n = Math.random() * g * 1e3;
				b.html(i.getWaitTmpl()), a - h >= 1e3 * -v ? e('[data-loading="bonus"]').stop().animate({
					width: "100%"
				}, {
					duration: n,
					queue: !0,
					complete: function() {
						i.count(t)
					}
				}) : i.destroy()
			},
			count: function(t) {
				var i = this,
					a = null,
					n = parseInt(t.stl, 10);
				u.removeClass("status-wait").addClass("status-count"), b.html(i.getCountTmpl()), a = e("[data-count='bonus']"), y && clearInterval(y), n >= 0 ? (a.text(i.dateFormat(n, "mm:ss")), y = setInterval(function() {
					n--, 0 >= n ? (clearInterval(y), y = null, i.ready(t)) : a.text(i.dateFormat(n, "mm:ss"))
				}, 1e3)) : i.ready(t)
			},
			ready: function(e) {
				var t = this,
					i = n.compile(t.getReadyTmpl());
				b.off("click.bonusHolder"), p.removeClass("bonus-complete"), b.html(i(e)), u.removeClass("status-count").addClass("status-ready"), b.off("click.bonus").on("click.bonus", ".bonus-action", function() {
					t.checkUser() && t.getBonus(e)
				})
			},
			checkUser: function() {
				var t = !0;
				if (!s.check()) return s.show("login"), t = !1;
				if (!k) {
					var i = e(".bind-miss-panel");
					i.show(), i.find(".bind-miss-close").off("click.bonus").on("click.bonus", function() {
						i.hide()
					}).end().find(".txt-ar a").off("click.bonus").on("click.bonus", function() {
						window.open(_)
					}), t = !1
				}
				return t
			},
			getBonus: function(e) {
				var a = b.find("[data-pid]"),
					n = i.encode([{
						name: "type",
						value: "ggbq"
					}, {
						name: "rpid",
						value: a.data("pid")
					}, {
						name: "rid",
						value: $ROOM.room_id
					}, {
						name: "rpt",
						value: 3
					}]);
				t.exe("js_GetHongbao", n)
			},
			updateBonus: function(e) {
				var t = this,
					i = null,
					s = parseInt(e.sl, 10);
				return l.set(w, e.rpid, v), (i = s ? n.compile(t.getSuccessTmpl()) : n.compile(t.getFailureTmpl())) ? (p.addClass("bonus-complete"), b.html(i(e)), u.removeClass("status-ready").addClass("status-opened"), a.trigger("mod.userinfo.change", {
					change: {
						silver: s
					}
				}), p.on("click", ".bonus-close", function() {
					t.destroy()
				}), void DYS.submit({
					point_id: "5.14.1.0",
					ext: {
						yw: s ? s : 0
					}
				})) : !1
			},
			getHandleTmpl: function() {
				return ['<div class="bonus-handle status-wait fl">', '<a href="javascript:;" class="status-bar status-wait"></a>', '<a href="javascript:;" class="status-bar status-count" data-count="bonus"></a>', '<a href="javascript:;" class="status-bar status-ready"><i></i></a>', '<a href="javascript:;" class="status-bar status-opened"></a>', "</div>"].join("")
			},
			getBonusboxTmpl: function() {
				return ['<div class="bonus-effect">', '<div id="bonus-swf"></div>', '<div class="bonus-outer"><div class="bonus-box">', '<a class="bonus-close" href="javascript:;"></a>', '<div class="bonus-holder"></div>', '</div><div class="bonus-backend"></div><div class="bonus-front"></div>', "</div></div>"].join("")
			},
			getWaitTmpl: function() {
				return ['<i class="icon-bonus-wait"></i>', '<div class="bonus-bar">', '<span data-loading="bonus" class="loading-bar-big">', "<strong></strong><b></b><em></em>", '<span class="lts"></span><span class="rts"></span>', "</span>", "</div>红包加载中..."].join("")
			},
			getCountTmpl: function() {
				return ['<i class="icon-bonus-count"></i>', '<div class="count-panel">', "<h3>红包发放剩余时间</h3>", '<span data-count="bonus"></span>', "</div>"].join("")
			},
			getReadyTmpl: function() {
				return ['<i class="icon-bonus-ready"></i>', "<div>", '<div class="bind-miss-panel">', '<a class="bind-miss-close" href="javascript:;"></a>', "<div><em>绑定手机和邮箱后</em>才可以领取红包哦</div>", '<div class="txt-ar"><a href="javascript:;">立即绑定</a></div>', "</div>", '<a href="javascript:;" data-pid="<%=rpid%>" class="bonus-action"></a>', "</div>"].join("")
			},
			getSuccessTmpl: function() {
				return ['<h3 class="success-title">恭喜您领取到了</h3>', '<div class="bonus-tip">', '<span class="yw-count"><%=sl%></span>个鱼丸', "</div>", '<i class="icon-bonus-success"></i>', "<em>鱼丸已打入您的账户</em>"].join("")
			},
			getFailureTmpl: function() {
				return ['<h3 class="failure-title">手慢了</h3>', "<span>红包已被领完</span>", '<i class="icon-bonus-failure"></i>'].join("")
			},
			dateFormat: function(e, t) {
				var i = "";
				if (!e || isNaN(e)) return i;
				var a = parseInt(e, 10),
					n = parseInt(a % 60),
					s = parseInt(a / 60 % 60),
					r = parseInt(a / 3600 % 60),
					o = parseInt(a / 216e3 % 24);
				return o = o > 9 ? o : "0" + o, r = r > 9 ? r : "0" + r, s = s > 9 ? s : "0" + s, n = n > 9 ? n : "0" + n, t = t.replace("DD", o), t = t.replace("hh", r), t = t.replace("mm", s), t = t.replace("ss", n), i = t
			},
			bonusToggle: function() {
				p.toggle(), u.toggle(), DYS.submit({
					point_id: "5.14.2.0",
					ext: {
						tg: p.is(":visible") ? 1 : 0
					}
				})
			},
			bindEvent: function() {
				var t = this;
				u.off("click.bonus").on("click.bonus", function() {
					t.bonusToggle()
				}), p.off("click.bonus").on("click.bonus", ".bonus-close", function() {
					e(this);
					t.bonusToggle()
				}), b.off("click.bonusHolder").on("click.bonusHolder", function() {
					var t = e(this).find(".tip_notime");
					t.size() < 1 ? e(this).append("<div class='tip_notime'>还未到领取时间，请耐心等待哦</div>").find(".tip_notime").show(100).delay(2e3).hide(100) : "none" == t.css("display") && t.show(100).delay(2e3).hide(100)
				})
			},
			destroy: function() {
				y && clearInterval(y), u && u.off("click.bonus").remove(), p && p.off("click.bonus").remove()
			},
			animate: function() {
				var t = {},
					i = {},
					a = null,
					n = {};
				i.quality = "high", i.bgcolor = "#000", i.allowscriptaccess = "always", i.allowfullscreen = "true", i.allowFullScreenInteractive = "true", i.wmode = "transparent", n.id = "bonus-video", n.name = "bonus-video", n.align = "middle", n.autoplay = !0, n.loop = !1, o.embedSWF(r.get("sys.res_url") + "douyu/images/bonus/bonus.swf?20160602", m, "325", "475", "11", "", t, i, n), a = e("#" + n.id), p.find(".bonus-outer").hide().delay(h).show(0, function() {
					a.remove()
				}), a.on("mousedown contextmenu", function(e) {
					return !1
				})
			},
			getBonusInfo: function(e) {
				var t = null,
					a = [];
				if (e.list && "" != e.list) {
					a = e.list.split("/|/");
					for (var n = 0, s = a.length; s > n; n++) if ("" != s[n]) {
						var r = i.decode(a[n]).too();
						if ("3" == r.rpt) {
							t = r;
							break
						}
					}
				}
				return t
			},
			dispatch: function(e) {
				var t = i.decode(e).too(),
					a = null,
					n = this;
				switch (t.type) {
				case "ccrp":
					h = 7e3, n.destroy(), n.render(t), n.animate();
					break;
				case "memberinfores":
					n.destroy(), h = 0, a = n.getBonusInfo(t), a && n.render(a)
				}
			}
		};
	return {
		init: function(e) {
			C.init(e)
		}
	}
}), define("douyu/page/room/normal/mod/layertip", ["jquery", "shark/observer", "shark/util/storage/1.0", "douyu/context"], function(e, t, i, a) {
	var n = {
		expiresdays: 6,
		storageValue: !0,
		tipConfig: ["followAnchor", "paytask"],
		tipShow: !0
	},
		s = {
			init: function() {
				this.listen()
			},
			render: function(e, t) {
				e && t && (this.removeTip(t), e.append(t), this.showTip(t))
			},
			handleTip: function(e) {
				var t = this,
					i = e.$el,
					a = e.$tip,
					n = e.closeEleClassName,
					s = e.handleFn;
				t.render(i, a), t.bindCloseEvent(a, n), s()
			},
			removeTip: function(e) {
				e && e.length > 0 && e.remove()
			},
			showTip: function(e) {
				e && e.fadeIn()
			},
			hideTip: function(e) {
				e && e.fadeOut()
			},
			getRestTime: function(e, t) {
				var i = new Date(e),
					a = 0;
				return t = parseInt(t), t = t ? t : 0, i.setDate(i.getDate() + t), i.setHours(24), i.setMinutes(0), i.setSeconds(0), a = i.getTime() - (new Date).getTime()
			},
			getStorage: function(e) {
				return i.get(e)
			},
			setStorage: function(e, t, a) {
				i.set(e, t, a)
			},
			bindCloseEvent: function(e, t) {
				var i = this;
				e && t && e.on("click", t, function() {
					i.hideTip(e)
				})
			},
			isInConfig: function(e) {
				var t = n.tipConfig,
					i = !1,
					a = 0,
					s = t.length;
				for (a = 0; s > a; a++) t[a] === e && (i = !0);
				return i
			},
			listen: function() {
				var i = this;
				t.on("mod.layer.tips.render", function(t) {
					var a = t.storagename,
						s = e.isFunction(t.handleFn) ? t.handleFn : function() {},
						r = i.getRestTime((new Date).getTime(), n.expiresdays),
						o = t.$tip,
						l = t.$el,
						c = t.storageValue || n.storageValue,
						d = {
							$el: l,
							$tip: o,
							closeEleClassName: t.closeEleClassName || "",
							handleFn: s
						};
					if (o && l && n.tipShow) {
						if (a && i.getStorage(a)) return;
						a && !i.getStorage(a) ? (i.handleTip(d), i.isInConfig(a) && (n.tipShow = !1), i.setStorage(a, c, r / 1e3)) : a || i.handleTip(d)
					}
				}), t.on("mod.layer.tips.hide", function(e) {
					var t = e.$tip;
					t && i.hideTip(t)
				})
			}
		};
	e(function() {
		s.init()
	})
}), define("douyu/page/room/normal/mod/room-menu-startup", ["jquery", "shark/class", "shark/observer", "shark/util/template/1.0", "shark/util/lang/1.0", "shark/util/cookie/1.0", "douyu/context"], function(e, t, i, a, n, s, r) {
	var o = t({
		init: function(t) {
			this.$target = e("#J_anchorandsupermenu"), this.menuContainerRender(), this.$anchorMenuBox = this.$target.find(".live-group-box"), this.anchorMenuRender(), require.use(["douyu/page/room/normal/mod/menu"], function() {
				i.trigger("mod.normal.menu.starup.ready")
			})
		},
		anchorMenuRender: function() {
			var e = this.makeAnchorMenuHtml();
			this.$anchorMenuBox.append(e)
		},
		makeAnchorMenuHtml: function() {
			var e = $COLLIGATE.show_ban_keywords,
				t = $ROOM.room_label_right_flag,
				i = n.string.join("<li>", '<div class="btn-in-btns btn-plug-flow hide" data-live-group="pushflow">', '<span class="group-btn-icon"></span>', "<span>推流码</span>", "</div>", "</li>", "<li>", '<a href="javascript:;" class="btn-in-btns btn-anchor-score hide" data-live-group="anchorScore">', '<span class="group-btn-icon"></span>', "<span>主播积分<em></em></span>", "</a>", '<div class="group-btns-pop anchor-score-pop pop-left" data-live-group="anchorTips">', '<span class="group-pop-arrow1"></span>', '<span class="group-pop-arrow2"></span>', '<a href="javascript:;" class="pop-close-btn"></a>', '<div class="btn-pop-info">', '<h3>请遵守<span class="highlight-orange">直播规范</span></h3>', "<p>创建良好网络环境</p>", "</div>", "</div>", "</li>", "<li>", '<div class="btn-in-btns btn-room-report hide" data-live-group="room-report">', '<span class="group-btn-icon"></span>', "<span>直播间报备</span>", "</div>", "</li>", "<li>", '<div class="btn-in-btns btn-issue-state hide" data-live-group="publish">', '<span class="group-btn-icon"></span>', "<span>发布动态</span>", "</div>", '<div class="group-btns-pop issue-state-pop hide" data-live-group="publishtip">', '<span class="group-pop-arrow1"></span>', '<span class="group-pop-arrow2"></span>', '<a href="javascript:;" class="pop-close-btn"></a>', '<div class="btn-pop-info">', '<h3>在此<span class="highlight-orange">发布动态</span></h3>', "<p>向水友分享新鲜事</p>", "</div>", "</div>", "</li>", '<li class="even-wheat-pk-btn">', '<div class="btn-in-btns even-wheat-pk hide" data-live-group="evenWheatPK">', '<span class="group-btn-icon"><em class="even-wheat-news"></em></span>', "<span>PK邀请</span>", "</div>", "</li>", '<li class="draw-pop-tips-btn">', '<div class="btn-in-btns btn-draw hide" data-live-group="draw">', '<span class="group-btn-icon"></span>', "<span>抽奖</span>", "</div>", '<div class="draw-pop pop-right hide" data-live-group="drawTips">', '<div class="draw-pop-circle"></div>', '<div class="draw-pop-btn"></div>', '<div class="pop-close-btn"></div>', "</div>", '<div class="draw-pop-rebate pop-right hide" data-live-group="drawTips-rebate">', '<div class="draw-pop-close"></div>', "</div>", "</li>", "<li>", '<div class="btn-in-btns btn-charge-task hide" data-live-group="energy-charge-btn">', '<span class="group-btn-icon"></span>', "<span>充能任务</span>", "</div>", '<div class="group-btns-pop charge-task-pop pop-right hide" data-energy-charge="energy-charge-tips">', '<span class="group-pop-arrow1"></span>', '<span class="group-pop-arrow2"></span>', '<a href="javascript:;" class="charge-pop-close" data-energy-charge="popTips-close">x</a>', '<div class="charge-pop-title"></div>', '<div class="charge-pop-left"></div>', '<div class="charge-pop-diver"></div>', '<div class="charge-pop-right">', '<div class="charge-pop-content">', "<span>亲密任务</span>上线了！<br>", "这一次让你的表演<br>", "<span>有价可循！</span>", "</div>", '<div class="charge-pop-start js-charge-pop-start"></div>', "</div>", "</div>", "</li>", "<li>", '<div class="btn-in-btns btn-cps hide" data-live-group="cps-btn">', '<span class="group-btn-icon"></span>', "<span>手游推广计划</span>", "</div>", '<div class="group-btns-pop cps-pop pop-right hide" data-cps="cps-tips" style="display: block;">', '<span class="group-pop-arrow1"></span>', '<span class="group-pop-arrow2"></span>', '<a href="javascript:;" class="pop-close-btn" data-cps="popTips-close"></a>', '<div class="btn-pop-info">', '<h3><span class="highlight-orange">手游推广计划</span></h3>', "<p>海量优质手游合作项目，分享游戏分成收益，将自身流量稳定变现</p>", "</div>", "</div>", "</li>", "<li>", '<div class="btn-in-btns btn-won-moment hide"><span class="group-btn-icon"></span><span>精彩时刻</span> <em>Shift+C</em> </div>', "</li>", "<li>", '<div class="btn-in-btns btn-play-remind hide" data-live-group="broadcast">', '<span class="group-btn-icon"></span>', "<span>开播提醒</span>", "</div>", "</li>", "<li>", '<div class="btn-in-btns btn-bid-extend cur hide" data-live-group="anchorPrice">', '<span class="group-btn-icon"><em class="bid-extend-news"></em></span>', "<span>推广直播间</span>", "</div>", "</li>", "<li>", '<div class="btn-in-btns btn-play-swicth hide" data-live-group="liveswitch">', '<span class="group-btn-icon"></span>', "<span>直播开关</span>", "</div>", "</li>", "<li>", '<a class="btn-in-btns btn-guild-entry hide" data-live-group="guildEntry" href="https://mp.douyu.com/club/home" target="_blank">', '<span class="group-btn-icon"></span>', "<span>加入公会</span>", "</a>", "</li>", "<li>", '<div class="btn-in-btns btn-group-more" data-live-group="more">', '<span class="group-btn-icon"></span>', "<span>更多</span>", "</div>", '<div class="group-btns-pop sheild-keyword-pop" data-live-group="keyTips">', '<span class="group-pop-arrow1"></span>', '<span class="group-pop-arrow2"></span>', '<a href="javascript:;" class="pop-close-btn"></a>', '<div class="btn-pop-info">', "<p>快来试试！可以设置</p>", '<p><span class="highlight-orange">关键词屏蔽</span><span>啦！</span></p>', "</div>", "</div>", '<dl class="btn-more-drop" data-live-group="more-menu">', '<dd class="more-drop-arrow">', '<i class="more-drop-arrow1"></i>', '<i class="more-drop-arrow2"></i>', "</dd>", "<dd>", '<div class="btn-in-btns btn-sheild-keyword hide" data-is-show="<%= showBanKeywords %>" data-live-group="keyShield">', '<span class="group-btn-icon"></span>', "<span>关键词屏蔽</span>", "</div>", "</dd>", "<dd>", '<div title="用户观看视频需要输入密码才能观看" class="btn-in-btns btn-set-password hide" data-live-group="password">', '<span class="group-btn-icon"></span>', "<span>设置直播密码</span>", "</div>", "</dd>", "<dd>", '<div class="btn-in-btns btn-tag-blacklist hide" data-is-show="<%= showTagBlacklist %>" data-live-group="tagBlacklist">', '<span class="group-btn-icon"></span>', "<span>标签黑名单</span>", "</div>", "</dd>", "<dd>", '<div class="btn-in-btns btn-auto-contribute hide" data-live-group="autorec">', '<span class="group-btn-icon"></span>', "<span>自动投稿</span>", "</div>", '<div class="group-btns-pop auto-contribute-pop hide" data-live-group="autorectip">', '<span class="group-pop-arrow1"></span>', '<span class="group-pop-arrow2"></span>', '<a href="javascript:;" class="pop-close-btn"></a>', '<div class="btn-pop-info">', '<p><span class="highlight-orange2">开启自动投稿</span>后，您的直播录像会发布到斗鱼视频。人气涨涨涨收入翻翻翻，就趁现在！</p>', "</div>", "</div>", "</dd>", "</dl>", "</li>"),
				s = a.compile(i),
				r = s({
					showBanKeywords: e,
					showTagBlacklist: t
				});
			return r
		},
		menuContainerRender: function() {
			var e = this.$target,
				t = this.makeMenuContainerHtml();
			e.html(t)
		},
		makeMenuContainerHtml: function() {
			var e, t = "Mac68K" == navigator.platform || "MacPPC" == navigator.platform || "Macintosh" == navigator.platform || "MacIntel" == navigator.platform;
			e = t ? '<div class="pc-client-guide-wrap hide mac-client-guide-wrap" id="pc-client-guide"><a href="/client?platform=4" target="_blank"><div class="pc-client-version">NEW</div><div class="pc-client-main"></div></a></div>' : '<div class="pc-client-guide-wrap hide" id="pc-client-guide"><a href="/client?platform=3" target="_blank"><div class="pc-client-version">NEW</div><div class="pc-client-main"></div><p class="pc-client-text">主播定制已上线</p></a></div>';
			var i = ['<ul class="live-group-box">', '<li class="room-control-box">', '<div class="btn-in-btns btn-room-control hide" data-live-group="super-btn">', '<span class="group-btn-icon"></span>', "<span>房间管理<em></em></span>", '<dl class="room-control-drop" data-live-group="super-list">', "</dl>", "</div>", "</li>", "</ul>" + e].join("");
			return i
		}
	});
	return {
		init: function(e) {
			return new o(e)
		}
	}
}), define("douyu/page/room/normal/mod/receive-info", ["jquery", "shark/observer", "shark/util/template/2.0", "shark/util/lang/1.0", "shark/util/cookie/1.0", "douyu/context"], function(e, t, i, a, n, s) {
	var r = "手动填写",
		o = {
			dys: function(e) {
				t.trigger("dys", e)
			}
		},
		l = {
			_data_: {
				allData: {},
				allProv: [],
				regionIds: [],
				regionArea: []
			},
			flag: {
				select_flag: 0
			},
			doms: {},
			init: function(e) {
				var t = this;
				this.flag.select_flag || (this.hasBoxReady() ? this.show2hide() : this.getRegionInfo(function(i) {
					t.inputToSelect(e), t.render(), t.bindEvent()
				}))
			},
			hasBoxReady: function() {
				return e(".regioninfo-box").find(".area-info").length > 0
			},
			show2hide: function() {
				"block" == e(".regioninfo-box").css("display") ? this.toggleBox(!1) : this.toggleBox(!0)
			},
			getRegionInfo: function(t) {
				var i = this,
					a = s.get("sys.web_url");
				i.flag.select_flag = 1, e.ajax({
					url: a + "/app/douyu/js/page/room/normal/mod/provincelist.json",
					type: "GET",
					dataType: "json",
					success: function(e) {
						i.flag.select_flag = 0, i._data_.allData = e.region, t(e.region)
					},
					error: function() {
						i.flag.select_flag = 0
					}
				})
			},
			render: function() {
				var t = e(".regioninfo-box"),
					n = a.string.join('<div class="area-info">', '<ul class="nav">', '<li data-type="1" class="active">请选择</li>', '<li data-type="2">请选择</li>', '<li data-type="3">请选择</li>', "</ul>", '<div class="content">', '<div data-node="province" data-type="1" class="space active"></div>', '<div data-node="city"data-type="2" class="space"></div>', '<div data-node="country"data-type="3" class="space"></div>', "</div>", "</div>"),
					s = i.compile(n);
				t.append(s()), this.toggleBox(!0), this.domReadyFunc(), this.renderProv(), this.renderCity(), this.renderCont()
			},
			domReadyFunc: function() {
				this.doms.$el = e(".regioninfo-box"), this.doms.$province = this.doms.$el.find('[data-node="province"]'), this.doms.$citynode = this.doms.$el.find('[data-node="city"]'), this.doms.$country = this.doms.$el.find('[data-node="country"]'), this.doms.$content = this.doms.$el.find(".area-info .content"), this.doms.$areainfo = this.doms.$el.find(".area-info")
			},
			renderProv: function() {
				var e = this,
					t = e._data_.regionIds[0],
					n = e._data_.allProv.length > 0 ? e._data_.allProv : e.selectProvis(),
					s = a.string.join("{{ each data as item index }}", "{{ if item.provid == idx }}", '<span data-id="{{index}}" data-provid="{{item.provid}}" class="choose">{{item.proval}}</span>', "{{ /if }}", "{{ if item.provid != idx }}", '<span data-id="{{index}}" data-provid="{{item.provid}}">{{item.proval}}</span>', "{{ /if }}", "{{ /each }}"),
					r = i.compile(s);
				this.doms.$province.html(r({
					data: n,
					idx: t
				})), this.doms.$content.mCustomScrollbar("destroy").mCustomScrollbar()
			},
			renderCity: function() {
				var e = this,
					t = e._data_.regionIds[1],
					n = e._data_.regionIds[0],
					s = e.selectCitys(n),
					r = a.string.join("{{ each data as item index }}", "{{ if item.cityid == idx }}", '<span data-id="{{index}}" data-cityid="{{item.cityid}}" data-parent="{{item.parentId}}" class="choose">{{item.cityval}}</span>', "{{ /if }}", "{{ if item.cityid != idx }}", '<span data-id="{{index}}" data-cityid="{{item.cityid}}" data-parent="{{item.parentId}}">{{item.cityval}}</span>', "{{ /if }}", "{{ /each }}"),
					o = i.compile(r);
				this.doms.$citynode.html(o({
					data: s,
					idx: t
				})), this.doms.$content.mCustomScrollbar("destroy").mCustomScrollbar()
			},
			renderCont: function(e, t) {
				var n = this,
					s = n._data_.regionIds[2],
					r = n._data_.regionIds[1],
					o = n._data_.regionIds[0],
					l = n.selectCountrys(o, r),
					c = a.string.join("{{ each data as item index }}", "{{ if item.counid == idx }}", '<span data-id="{{index}}" data-counid="{{item.counid}}" data-parent="{{item.parentId}}" class="choose">{{item.counval}}</span>', "{{ /if }}", "{{ if item.counid != idx }}", '<span data-id="{{index}}" data-counid="{{item.counid}}" data-parent="{{item.parentId}}">{{item.counval}}</span>', "{{ /if }}", "{{ /each }}"),
					d = i.compile(c);
				this.doms.$country.html(d({
					data: l,
					idx: s
				})), this.doms.$content.mCustomScrollbar("destroy").mCustomScrollbar()
			},
			bindEvent: function() {
				var t = this;
				t.doms.$el.on("click", "[data-provid]", function(i) {
					i.stopPropagation();
					var a = e(this).attr("data-provid"),
						n = e(this).text(),
						s = e(this).attr("data-id");
					return t._data_.regionIds[0] = a, t._data_.regionArea[0] = n, 0 == a ? (t.toggleBox(!1), t._data_.regionIds[0] = 0, t._data_.regionArea[0] = n, t._data_.regionIds[1] = 0, t._data_.regionArea[1] = "", t._data_.regionIds[2] = 0, t._data_.regionArea[2] = "", void t.selectToInput()) : (t.setAreaChoose(t.doms.$province, s), t.setTabName(1, n), t.changeTabs(2), void t.renderCity())
				}).on("click", "[data-cityid]", function(i) {
					i.stopPropagation();
					var a = e(this).attr("data-parent"),
						n = e(this).attr("data-cityid"),
						s = e(this).text(),
						r = e(this).attr("data-id");
					t._data_.regionIds[1] = n, t._data_.regionArea[1] = s, t.setAreaChoose(t.doms.$citynode, r), t.setTabName(2, s), t.changeTabs(3), t.renderCont(a, n)
				}).on("click", "[data-counid]", function(i) {
					i.stopPropagation();
					var a = e(this).attr("data-counid"),
						n = e(this).text(),
						s = e(this).attr("data-id");
					t._data_.regionIds[2] = a, t._data_.regionArea[2] = n, t.setAreaChoose(t.doms.$country, s), t.toggleBox(!1), t.selectToInput()
				}).on("click", ".nav li", function(i) {
					i.stopPropagation();
					var a = e(this).attr("data-type");
					t.changeTabs(a)
				})
			},
			toggleBox: function(t) {
				1 == t ? e(".regioninfo-box").show() : e(".regioninfo-box").hide()
			},
			selectToInput: function() {
				var e = this;
				if (0 == e._data_.regionIds[0]) var t = "0/0/0",
					i = "其他";
				else {
					var t = e._data_.regionIds.join("/"),
						i = e._data_.regionArea.join("/");
					i.indexOf(r) > 0 ? i = i.substring(0, i.length - 5) : ""
				}
				c.setUserArea(t, i)
			},
			inputToSelect: function(e) {
				var t = this;
				e.id && (t._data_.regionIds = e.id.split("/"), t._data_.regionArea = e.value.split("/"))
			},
			changeTabs: function(e) {
				this.doms.$areainfo.find(".nav li").removeClass("active"), this.doms.$areainfo.find(".nav li[data-type=" + e + "]").addClass("active"), this.doms.$areainfo.find(".content [data-type]").removeClass("active"), this.doms.$areainfo.find(".content [data-type=" + e + "]").addClass("active")
			},
			setAreaChoose: function(e, t) {
				e.find("span").removeClass("choose"), e.find("span[data-id=" + t + "]").addClass("choose")
			},
			setTabName: function(e, t) {
				this.doms.$areainfo.find(".nav li[data-type=" + e + "]").text(t)
			},
			selectProvis: function() {
				function e(e, t) {
					return e.provid - t.provid
				}
				for (var t = this._data_.allData, i = [], a = [], n = [], s = 0; s < t.length; s++) 1 == t[s].parentId ? a.push({
					provid: t[s].value,
					proval: t[s].label
				}) : 0 == t[s].parentId ? n.push({
					provid: t[s].value,
					proval: t[s].label
				}) : i.push({
					provid: t[s].value,
					proval: t[s].label
				});
				return i.sort(e), a.sort(e), this._data_.allProv = i.concat(a).concat(n), this._data_.allProv
			},
			selectCitys: function(e) {
				for (var t = this._data_.allData, i = [], a = 0; a < t.length; a++) if (t[a].value == e) for (var n = t[a].children ? t[a].children : [], s = 0; s < n.length; s++) i.push({
					cityid: n[s].value,
					cityval: n[s].label,
					parentId: n[s].parentId
				});
				return i
			},
			selectCountrys: function(e, t) {
				for (var i = this._data_.allData, a = [], n = 0; n < i.length; n++) if (i[n].value == e) for (var s = i[n].children, o = 0; o < s.length; o++) if (s[o].value == t) for (var l = s[o].children.length > 0 && s[o].children[0].value ? s[o].children : [{
					value: 0,
					label: r,
					parentId: t
				}], c = 0; c < l.length; c++) a.push({
					counid: l[c].value,
					counval: l[c].label,
					parentId: l[c].parentId
				});
				return a
			}
		},
		c = {
			API: {
				getAddress: "/member/lottery/get_receiver_address_info",
				sendAddress: "/member/lottery/send_receiver_address",
				getCsrfCookie: "/curl/csrfApi/getCsrfCookie"
			},
			tab_type: 1,
			doms: {},
			init: function(e) {
				var t = this;
				this.getBoxInfo(e.id, function(i) {
					t.render({
						id: e.id,
						prize: e.prize,
						data: i
					}), t.bindEvent()
				})
			},
			hasReciveInfoReady: function() {
				return e(".receinfo-box-wrapper").length > 0
			},
			getBoxInfo: function(t, i) {
				e.ajax({
					url: this.API.getAddress,
					data: {
						activity_id: t
					},
					type: "GET",
					dataType: "json",
					success: function(e) {
						if (0 == e.error) {
							var t = {
								reality_addr_info: {},
								virtual_addr_info: {}
							};
							e.data.reality_addr_info && (t.reality_addr_info = e.data.reality_addr_info), e.data.virtual_addr_info && (t.virtual_addr_info = e.data.virtual_addr_info), i && i(t)
						}
					}
				})
			},
			render: function(t) {
				this.hasReciveInfoReady() || e("body").append('<div class="receinfo-box-wrapper"></div>');
				var n = a.string.join('<div class="box-container">', '<div class="header">', '<p class="text">收货信息：</p>', '<p class="jiangpin" data-id="{{id}}">奖品：<span>{{prize}}</span></p>', '<div class="header-icon"></div>', '<div class="close-icon"></div>', "</div>", '<div class="body">', '<div class="title">选择您的奖品类型</div>', '<div class="tab-info">', '<ul class="nav">', '<li class="shiwu active" data-type="1"></li>', '<li class="xuni" data-type="2"></li>', "</ul>", '<div class="content">', '<div data-type="1" class="space active" data-addrid="{{data.reality_addr_info.addr_id}}">', '<div class="line">', "<span>*收货人：</span>", '<div class="right-bl"><input type="text" maxlength="32" name="username" value="{{data.reality_addr_info.name}}" /></div>', "</div>", '<div class="line">', "<span>*所在地区：</span>", '<div class="right-bl"><div class="select-area" name="userarea" data-regionid="{{data.reality_addr_info.region_id}}" data-val="{{data.reality_addr_info.area}}">{{data.reality_addr_info.area}}</div></div>', "</div>", '<div class="line">', "<span>*详细地址：</span>", '<div class="right-bl"><textarea class="area1" name="useraddr">{{data.reality_addr_info.addr}}</textarea></div>', "</div>", '<div class="line">', "<span>*联系电话：</span>", '<div class="right-bl"><input type="text" maxlength="15" name="userphone" value="{{data.reality_addr_info.mobile}}" /></div>', "</div>", "{{ if data.reality_addr_info.display_identity }}", '<div class="line">', "<span>*身份证号：</span>", '<div class="right-bl"><input type="text" maxlength="18" name="userid" value="{{data.reality_addr_info.identity_card}}" /></div>', "</div>", "{{ /if }}", "</div>", '<div data-type="2" class="space" data-addrid="{{data.virtual_addr_info.addr_id}}">', '<div class="line">', "<span>*收货信息：</span>", "{{ if (data.virtual_addr_info.addr) }}", '<div class="right-bl"><textarea class="area2" name="virtualaddr">{{data.virtual_addr_info.addr}}</textarea></div>', "{{ else }}", '<div class="right-bl"><textarea class="area2 default" name="virtualaddr" data-type="default">请按照直播中要求的方式，填写收货信息，如游戏账号、支付宝账号等</textarea></div>', "{{ /if }}", "<p>*账号相关请谨慎填写，谨防诈骗</p>", "</div>", "{{ if data.virtual_addr_info.display_identity }}", '<div class="line mar-bot">', "<span>*身份证号：</span>", '<div class="right-bl"><input type="text" maxlength="18" name="virtualid" value="{{data.virtual_addr_info.identity_card}}" /></div>', "</div>", "{{ /if }}", "</div>", "</div>", "</div>", "</div>", '<div class="footer">', "<p>*您也可以在中奖私信中填写收货信息，7天内未填写<br/>收货信息且未发送给主播将视为放弃奖品。</p>", "{{ if data.reality_addr_info.display_identity }}", '<div class="button" data-node="submitForm">发送收货信息</div>', "{{ else }}", '<div class="button" data-node="submitForm">发送给主播</div>', "{{ /if }}", "</div>", '<div class="regioninfo-box"></div>', "</div>"),
					s = i.compile(n);
				e(".receinfo-box-wrapper").html(s(t)), this.tab_type = 1, this.toggleReciveInfo(!0), this.domReadyFunc()
			},
			toggleReciveInfo: function(t) {
				1 == t ? e(".receinfo-box-wrapper").show() : e(".receinfo-box-wrapper").hide()
			},
			domReadyFunc: function() {
				this.doms.$el = e(".receinfo-box-wrapper"), this.doms.$tabinfo = this.doms.$el.find(".tab-info"), this.doms.$submit = this.doms.$el.find('[data-node="submitForm"]'), this.doms.$username = this.doms.$el.find('[name="username"]'), this.doms.$userarea = this.doms.$el.find('[name="userarea"]'), this.doms.$useraddr = this.doms.$el.find('[name="useraddr"]'), this.doms.$userphone = this.doms.$el.find('[name="userphone"]'), this.doms.$userID = this.doms.$el.find('[name="userid"]'), this.doms.$virtualaddr = this.doms.$el.find('[name="virtualaddr"]'), this.doms.$virtualID = this.doms.$el.find('[name="virtualid"]'), this.doms.$jiangpin = this.doms.$el.find(".jiangpin"), this.doms.$selsectArea = this.doms.$el.find(".select-area")
			},
			changeTabs: function(e) {
				this.doms.$tabinfo.find(".nav li").removeClass("active"), this.doms.$tabinfo.find(".nav li[data-type=" + e + "]").addClass("active"), this.doms.$tabinfo.find(".content [data-type]").removeClass("active"), this.doms.$tabinfo.find(".content [data-type=" + e + "]").addClass("active")
			},
			changeBtnStatus: function(e) {
				var t = "发送中...",
					i = "发送给主播",
					a = "";
				1 == e ? (a = t, this.doms.$submit.addClass("disable")) : (a = i, this.doms.$submit.removeClass("disable")), this.doms.$submit.text(a)
			},
			checkForms: function() {
				var t = this,
					i = (e(".receinfo-box-wrapper"), this.doms.$username.val()),
					a = this.doms.$userarea.attr("data-val"),
					n = this.doms.$useraddr.val(),
					s = this.doms.$userphone.val(),
					r = this.doms.$userID.val(),
					o = this.doms.$userarea.attr("data-regionid"),
					l = this.doms.$virtualaddr.val(),
					c = this.doms.$virtualID.val(),
					d = this.doms.$tabinfo.find(".content [data-type=1]").attr("data-addrid"),
					u = this.doms.$tabinfo.find(".content [data-type=2]").attr("data-addrid"),
					f = this.doms.$jiangpin.attr("data-id"),
					p = {},
					m = /^1[3|4|5|7|8][0-9]{9}$/,
					h = /^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/,
					g = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
				if (1 == this.tab_type) {
					if ("" == i) return t.showToast("请填写收货人"), !1;
					if ("" == o) return t.showToast("请选择所在地区"), !1;
					if ("" == n) return t.showToast("请输入详细地址"), !1;
					if (!("" != s && m.test(s) || "" != s && h.test(s))) return t.showToast("请输入正确的联系电话"), !1;
					if (this.doms.$userID.length > 0 && ("" == r || !g.test(r))) return t.showToast("请输入正确的身份证号"), !1;
					p = {
						addr_id: d || 0,
						activity_id: f || 0,
						type: this.tab_type,
						name: i,
						area: a,
						region_id: o,
						addr: n,
						mobile: s,
						identity_card: r
					}
				} else {
					if ("" == l) return t.showToast("请输入收货信息"), !1;
					if (this.doms.$virtualaddr.hasClass("default")) return t.showToast("请输入收货信息"), !1;
					if (this.doms.$virtualID.length > 0 && ("" == c || !g.test(c))) return t.showToast("请输入正确的身份证号"), !1;
					p = {
						addr_id: u || 0,
						activity_id: f || 0,
						type: this.tab_type,
						name: "",
						area: "",
						region_id: "",
						addr: l,
						mobile: "",
						identity_card: c
					}
				}
				return p
			},
			showToast: function(t) {
				e.dialog.tips_black(t)
			},
			_getCsrfCookie: function(t) {
				var i = this,
					a = n.get($SYS.tvk);
				if (!a) return void e.ajax({
					url: i.API.getCsrfCookie,
					type: "GET",
					dataType: "json",
					success: function(e) {
						0 === e.error && i._getCsrfCookie(t)
					}
				});
				var s = $SYS.tn;
				t && t({
					name: s,
					val: a
				})
			},
			najax: function(t) {
				this._getCsrfCookie(function(i) {
					t.data[i.name] = i.val, e.ajax(t)
				})
			},
			bindEvent: function() {
				var t = this;
				t.doms.$el.off("click"), t.doms.$el.off("change"), t.doms.$el.off("keydown"), t.doms.$el.off("keyup"), t.doms.$el.off("focus"), t.doms.$el.on("click", ".tab-info .nav li", function(i) {
					var a = e(this).attr("data-type");
					t.tab_type = a, t.changeTabs(a), 1 != a && l.toggleBox(!1)
				}).on("click", '[data-node="submitForm"]', function() {
					if (!t.doms.$submit.hasClass("disable")) {
						var e = t.checkForms();
						e && (t.changeBtnStatus(!0), t.najax({
							url: t.API.sendAddress,
							type: "POST",
							dataType: "json",
							data: e,
							success: function(e) {
								t.changeBtnStatus(!1), 0 == e.error ? (t.toggleReciveInfo(!1), t.showToast("发送成功！")) : t.showToast(e.msg)
							},
							error: function(e) {
								t.changeBtnStatus(!1), t.showToast("网络错误")
							}
						}), o.dys({
							key: "dys.room.draw.lottery.recinf.senda.click",
							mat: 1 == t.tab_type ? 1 : 0,
							fic: 2 == t.tab_type ? 1 : 0
						}))
					}
				}).on("change keydown keyup", '[name="useraddr"]', function() {
					var t = e(this).val(),
						i = 100;
					t.length > i && e(this).val(t.substring(0, i))
				}).on("change keydown keyup", '[name="virtualaddr"]', function() {
					var t = e(this).val(),
						i = 100;
					t.length > i && e(this).val(t.substring(0, i))
				}).on("click", '[name="userarea"]', function(t) {
					t.stopPropagation();
					var i = e(this).attr("data-regionid"),
						a = e(this).attr("data-val");
					l.init({
						id: i,
						value: a
					})
				}).on("click", ".close-icon", function() {
					t.toggleReciveInfo(!1)
				}).on("focus", '[data-type="default"]', function() {
					e(this).val(""), e(this).attr("data-type", ""), e(this).removeClass("default")
				})
			},
			setUserArea: function(e, t) {
				this.doms.$selsectArea.attr("data-val", t), this.doms.$selsectArea.attr("data-regionid", e), this.doms.$selsectArea.text(t)
			},
			listen: function() {
				function e(e) {
					if (!(e.origin.indexOf("msg") < 0)) {
						var i = e.data ? e.data : "{}",
							a = JSON.parse(i);
						"triggerReceiptInfo" == a.type && t.init({
							id: a.data.dataActivityId || 0,
							prize: a.data.dataPrizeName || 0
						})
					}
				}
				var t = this;
				window.attachEvent ? window.attachEvent("onmessage", e) : window.addEventListener && window.addEventListener("message", e, !1)
			}
		};
	return {
		init: function(e) {
			c.init({
				id: e.id || 0,
				prize: e.prize || 0
			})
		},
		listen: function() {
			c.listen()
		}
	}
}), define("douyu/page/room/normal/mod/draw", ["jquery", "shark/observer", "shark/util/cookie/1.0", "shark/util/flash/data/1.0", "shark/util/template/2.0", "shark/util/storage/1.0", "douyu/context", "douyu/page/room/base/api", "shark/util/lang/1.0", "douyu/com/user", "douyu/com/get-gift-configs", "douyu/page/room/normal/mod/receive-info", "douyu/com/room-gift-tmp", "douyu/com/exjsonp"], function(e, t, i, a, n, s, r, o, l, c, d, u, f, p) {
	var m = {
		urls: {
			endDrawAds: r.get("sys.webconfUrl") + "resource/common/interact.json",
			luckEnter: "/member/lottery/get_open_status",
			officeGift: "/member/lottery/get_official_prize",
			saveDrawInfo: "/member/lottery/save_activity_info",
			startLuckDraw: "/member/lottery/start_activity",
			nowLuckDrawInfo: "/member/lottery/activity_info",
			getActInfo: "/member/lottery/get_room_status",
			resetDraw: "/member/lottery/reset_activity",
			getGiftList: "/member/lottery/get_room_gift_list",
			endLuckDraw: "/member/lottery/end_activity",
			rebateConfig: "/lapi/interact/lotteryRebate/getConfig",
			openRebateBox: "/member/lottery_rebate/open_box"
		},
		luckStatus: "start",
		doms: {},
		giftConfigData: {},
		delayGiftQueue: !0,
		rebateQueueFlag: !1,
		drawIsStarting: !1,
		flashDrawBtnIsClose: {},
		hasJoinDrawCache: {},
		dataCache: {}
	},
		h = {
			getLength: function(e) {
				for (var t = 0, i = e.length, a = -1, n = 0; i > n; n++) a = e.charCodeAt(n), t += a >= 0 && 128 >= a ? 1 : 2;
				return t
			},
			cutString: function(e, t) {
				var i = 0,
					a = 0,
					n = new String;
				a = e.length;
				for (var s = 0; a > s; s++) {
					var r = e.charAt(s);
					if (i++, escape(r).length > 4 && i++, n = n.concat(r), i >= t) return n = n.concat("...")
				}
				return t > i ? e : void 0
			}
		},
		g = {
			crsf: "/curl/csrfApi/getCsrfCookie",
			getCSRFCookie: function(t) {
				var a = this,
					n = i.get(r.get("sys.tvk"));
				return n ? void(t && t({
					name: $SYS.tn,
					value: n
				})) : void e.ajax({
					url: a.crsf,
					type: "GET",
					dataType: "json",
					success: function(e) {
						0 === +e.error && a.getCSRFCookie(t)
					}
				})
			},
			dys: function(e) {
				t.trigger("dys", e)
			},
			userLevelClass: function(e) {
				var t = 120,
					i = "",
					a = +e;
				return a ? a >= 100 ? (i = "level-" + (t > a ? a : t), i += " level-size2") : i += a >= 70 ? "level-" + a + " level-size1" : a >= 10 ? "level-" + a + " level-bgpng level-size1" : "lve-icon-1to9 level-" + a + " level-bgpng level-size1" : i = "level-next-1", i
			},
			timeFormate: function(e) {
				if (!e) return !1;
				var t, i = +e,
					a = i % 60;
				t = parseInt(i / 60, 10);
				var n = t % 60;
				t = parseInt(t / 60, 10);
				var s = ("" + t).slice(-2);
				return [+s ? s + "小时" : "", n ? n + "分" : "", a + "秒"].join("")
			},
			getRebateTime: function(e, t) {
				return e = new Date(1e3 * e), t = new Date(1e3 * t), e.getMonth() + 1 + "." + e.getDate() + "-" + (t.getMonth() + 1) + "." + t.getDate()
			},
			numberFormat: function(e) {
				var t, i = +e;
				return t = 1e4 > i ? i : 1e6 > i ? Math.floor(i / 100) / 100 + "万" : 1e7 > i ? Math.floor(i / 1e3) / 10 + "万" : Math.floor(i / 1e4) + "万"
			},
			isAnchor: function() {
				if (void 0 != m.dataCache.isAnchor) return m.dataCache.isAnchor;
				var e = +r.get("sys.uid"),
					t = +r.get("room.owner_uid");
				return m.dataCache.isAnchor = e === t, m.dataCache.isAnchor
			},
			resolveUserList: function(t) {
				var i, a = this,
					n = [],
					s = !1,
					o = !1,
					l = +r.get("sys.uid"),
					c = +r.get("room.owner_uid"),
					d = t.list.length,
					u = -1;
				l === c && (s = !0);
				var f = {};
				if (t.rebateInfo && t.rebateInfoEnd) {
					for (var p = t.rebateInfo, m = t.rebateInfoEnd, h = 338, g = 0; g < p.box_info.length; g++) {
						var v = 0 == g ? 0 : p.box_info[g - 1].lucky_value,
							y = p.box_info[g].lucky_value;
						if (m.cost >= v && m.cost < y) {
							h = g * h / 4 + h / 4 * (m.cost - v) / (y - v);
							break
						}
					}
					f = {
						rebate_rule_img: p.web_rules_img,
						rebate_time: this.getRebateTime(p.start_time, p.end_time),
						rebate_cost: m.cost,
						rebate_loading: h + "px",
						rebate_notice: m.lucky_notice
					};
					for (var g = 0; g < p.box_info.length; g++) {
						var i = p.box_info[g];
						i.box_status = "un-open", m.cost >= i.lucky_value && (i.box_status = "can-open");
						for (var b = 0; b < m.box_received.length; b++) i.box_id == m.box_received[b].box_id && (i.box_status = "has-open")
					}
					f.rebate_box = p.box_info
				}
				var k = {},
					w = -1,
					_ = t.adListIndex;
				if (_) for (var g in _) _[g] >= 0 && (w = _[g]);
				var x = t.adListContent.ad_list ? t.adListContent.ad_list : {};
				if (x && w > -1) for (var g in x) x[g] && x[g].length > 0 && (k = {
					win: x[g][w].win_pic,
					win_text: x[g][w].win_text,
					lose: x[g][w].lose_pic,
					lose_text: x[g][w].lose_text
				});
				if (!d) return s && this.sendNotice("end", {
					list: n,
					giftName: t.prize,
					length: d
				}), e.extend(f, {
					list: [],
					isAnchor: s,
					isNoBodyLuck: !0,
					drawad: k,
					activityId: t.activityId
				});
				for (var g = 0; d > g; g++) {
					i = t.list[g], +i.uid === l && (o = !0, u = g);
					var C = this.getUserStarNickName(i.nickname, s, +i.uid === l);
					n.push({
						uid: i.uid,
						nickname: C,
						level: i.level,
						ulevelc: a.userLevelClass(i.level)
					})
				}
				return this.sendNotice("end", {
					list: d > 10 ? n.slice(0, 10) : n,
					giftName: t.prize,
					length: d > 10 ? 10 : d,
					number: d
				}), e.extend(f, {
					list: n,
					isAnchor: s,
					isLuck: o,
					join: this.numberFormat(t.join),
					name: t.name,
					gift: this.numberFormat(t.gift),
					number: d,
					prize: t.prize,
					offimg: t.img,
					index: u,
					joinTime: this.timeFormate(t.time),
					fansCount: this.numberFormat(t.fans),
					followCount: this.numberFormat(t.follow),
					lotteryRange: +t.lotteryRange,
					activityId: t.activityId,
					activityType: t.activityType,
					prizeType: t.prizeType,
					drawad: k,
					joinType: t.joinType
				})
			},
			sendNotice: function(e, i) {
				var a = r.get("sys.web_url");
				if (!this.wordRender) {
					var s = l.string.join('<li class="jschartli normal-notice-new">', '<i class="sys-icon"></i>', '<p class="text-cont">', '{{ if (type === "start") }}', "为了回馈广大水友，", '<span class="nick-new">{{ giftObj.anchorName }}</span> ', "发起抽奖活动，快来参加啦！", "{{ else }}", "{{ if (giftObj.length) }}", "恭喜 ", "{{ each giftObj.list }}", '<span class="nick-new" data-uid="{{ $value.uid }}" title="{{ $value.nickname }}">{{ $value.nickname }}</span>', "{{ if ($index < (giftObj.length - 1)) }}", "、", "{{ /if }}", "{{ /each }}", "{{ if (giftObj.number > 10) }}", "等{{ giftObj.number }}人", "{{ /if }}", ' 获得<span class="hy-org">{{ giftObj.giftName }}</span>！', "{{ else }}", "当前没有一个人满足抽奖条件", "{{ /if }}", "{{ /if }}", "</p>", "</li>"),
						o = n.compile(s);
					this.wordRender = o
				}
				var c = this.wordRender({
					type: e,
					webUrl: a,
					giftObj: i
				});
				t.trigger("mod.chat.msg.msg", c)
			},
			countBalance: function(t, i) {
				var a, n, s, r = m.giftConfigData;
				for (var o in r) a = +o, a === t && (s = r[o]);
				var l = e("#js-stats-and-actions");
				return n = 1 === +s.type ? +l.find('[data-login-user="silver"]').text() : 100 * +l.find('[data-login-user="gold"]').text(), n < s.pc * i
			},
			getAdsFromActivity: function(e) {
				p.load(m.urls.endDrawAds, "interact", e, e, "", !0)
			},
			getUserStarNickName: function(e, t, i) {
				if (t || i) return e;
				var a = e,
					n = e.length,
					s = "";
				if (5 > n) {
					for (var r = 1; n > r; r++) s += "*";
					a = a.substring(0, 1) + s
				} else a = a.substring(0, 1) + "***" + a.substring(4, n);
				return a
			},
			isWinner: function(t) {
				var i = !1;
				if (e.isArray(t) && t.length > 0) {
					var a = +r.get("sys.uid");
					e.each(t, function(e, t) {
						return a === +t.uid ? (i = !0, !1) : void 0
					})
				}
				return i
			},
			hasJoinDraw: function(t) {
				if (m.hasJoinDrawCache[t]) return !0;
				var i = s.get("drawJoinArray"),
					a = !1;
				if (i) {
					var n = JSON.parse(i),
						r = (new Date).getTime(),
						o = [],
						l = !1;
					e.each(n, function(e, i) {
						r - i.timestap < 6048e5 ? (o.push(i), +t === +i.activityId && (a = !0, m.hasJoinDrawCache[t] = !0)) : l = !0
					}), l && s.set("drawJoinArray", JSON.stringify(o))
				}
				return a
			}
		},
		v = {
			vars: {
				luckType: "normal",
				commandType: "word",
				giftTipsTk: null,
				officialType: null,
				$giftLi: null,
				normalMax: null,
				lightMin: null,
				lightMax: null,
				pointGift: {
					giftID: null,
					giftNUM: null,
					giftPRICE: null
				},
				rebateTipIndex: 0
			},
			flag: {
				showFlag: !1,
				ifOfficial: !0,
				ifChangeGift: !0
			},
			doms: {},
			render: {
				box: function(e) {
					e.officialDefaultPic = v.getOfficialDefaultPic();
					var t = l.string.join('<div class="draw-gift-box draw-gift-box-400" style="display:block;">', '<div class="draw-gift-title">', '<div class="draw-title-txt"></div>', '<a href="javascript:;" class="draw-gift-close js-luck-draw-close"></a>', "{{ if (!is_close_gift) }}", '<div class="draw-list-tab">', '<span class="js-luck-word-tab active">口令抽奖<i></i></span>', '<span class="js-luck-light-tab" >爆灯抽奖<i></i></span>', "</div>", "{{ /if }}", "</div>", "{{ if (is_close_gift) }}", '<div class="draw-gift-content">', "{{ else }}", '<div class="draw-gift-content draw-gift-content-35">', "{{ /if }}", '<div class="draw-gift-info">', '<i class="draw-confetti"></i>', '<i class="draw-standard"></i>', '<div class="draw-gift-tab">', "{{ if (is_open_general) }}", '<span class="js-luck-normal-enter active">自定义奖品</span>', "{{ /if }}", "{{ if (is_open_official) }}", "{{ if (is_open_general) }}", '<i></i><span class="js-luck-office-enter">官方奖品</span>', "{{ else }}", '<span class="js-luck-office-enter active">官方奖品</span>', "{{ /if }}", "{{ /if }}", "</div>", "{{ if (is_open_general) }}", '<div class="js-luck-normal-sec">', "<!-- 普通抽奖 -->", '<div class="draw-gift-field">', "<label>奖品：</label>", '<input class="js-luck-draw-normal-gift js-normal-input" type="text" maxlength="40" placeholder="如“雷蛇鼠标”（奖品需主播自行寄送）">', '<div class="draw-pergift-tips js-draw-gift-tips">', "<i></i>", '<div class="draw-pergift-tips-con">', "热门奖品：现金红包、鱼翅、贵族、房管、iPad、手机、电脑<br>", "其它奖品：键盘、鼠标、Q币、点券、激活码、皮肤、游戏礼包", "</div>", "</div>", "</div>", "<!-- 提示文字 -->", '<div class="draw-gift-field">', "<label>数量：</label>", '<label class="draw-award-unit">个</label>', '<input class="js-luck-draw-normal-num js-number-input js-normal-input" data-max-num="10" type="text" placeholder="不超过10个">', "</div>", "</div>", "{{ /if }}", "{{ if (is_open_official) }}", "{{ if (is_open_general) }}", '<div class="js-luck-office-sec hide">', "{{ else }}", '<div class="js-luck-office-sec">', "{{ /if }}", "<!-- 官方抽奖 -->", '<div class="award-pic">', "{{ if (offGift.prize_img) }}", '<img class="js-luck-offgift-img" src="{{ offGift.prize_img }}">', "{{ else }}", '<img class="js-luck-offgift-img" src="{{ officialDefaultPic }}">', "{{ /if }}", "</div>", '<div class="official-award">', '<span class="official-award-name js-luck-offgift-name"  data-luck-offgift-id="{{ offGift.official_prize_id }}">{{ offGift.prize_name }}</span>', '<label class="draw-award-unit">个</label>', '<input class="js-luck-draw-official js-number-input js-normal-input" data-max-num="99" data-giftname="{{ offGift.prize_name }}" data-giftnum="{{ offGift.prize_left_num }}" type="text" placeholder="个数不能超过99个">', '<span class="official-award-num">您还可发起<em class="js-luck-offgift-num">{{ offGift.prize_left_num }}</em>个奖品的抽奖</span>', "</div>", "</div>", "{{ /if }}", '<div class="draw-gift-field js-luck-shibboleth-tab">', '<a href="javascript:;" class="gift-command-btn js-luck-word-enter changeHover active" >文字口令</a>', "{{ if (!is_close_gift) }}", '<a href="javascript:;" class="gift-command-btn js-luck-gift-enter changeHover">礼物口令</a>', "{{ /if }}", "</div>", "<!-- 文字口令 -->", '<div class="draw-gift-field draw-text-command js-luck-word-command">', "<label>设置口令：</label>", '<input class="js-luck-draw-wordc js-normal-input" maxlength="10" type="text" placeholder="水友需刷出你指定的口令才可抽奖">', "</div>", "<!-- 礼物口令 -->", '<div class="draw-gift-command draw-gift-field js-luck-gift-command hide">', '<label>个</label><input type="text" class="gift-command-num js-luck-draw-giftc-num js-number-input js-normal-input" data-max-num="{{ lottery_setting.gift_num_max }}" maxlength="3" placeholder="1~{{ lottery_setting.gift_num_max }}之间" >', '<div class="gift-command-box">', "{{ if (giftList[0]) }}", '<input type="text" class="gift-command-type js-luck-gift-now js-luck-gift-change" data-id="{{ giftList[0].gift_id }}" readonly value="{{ giftList[0].gift_name }}">', "{{ else }}", '<input type="text" class="gift-command-type js-luck-gift-now js-luck-gift-change" data-id="" readonly value="">', "{{ /if }}", '<div class="command-arrow-box js-luck-gift-change">', '<span class="js-luck-gift-change"></span>', "</div>", '<div class="gift-value-box js-luck-gift-change">500鱼翅</div>', '<ul class="command-type-list js-luck-gift-list">', "{{ each giftList }}", '<li class="{{ $index === 0 ? "active" : "" }}" data-id="{{ $value.gift_id }}" data-name="{{ $value.gift_name }}" data-val="{{ $value.gift_price }}">{{ $value.gift_name }}<span class="gift-value">{{ $value.gift_price }}</span></li>', "{{ /each }}", "</ul> ", "</div>", "</div>", "<!-- 爆灯抽奖 -->", '<div class="js-luck-light-gift-command hide">', '<h3 class="light-tips-h3">设置爆灯礼物和总数</h3>', '<div class="draw-gift-command draw-gift-field">', '<label>个</label><input type="text" class="gift-command-num js-luck-draw-giftc-num js-number-input js-normal-input" data-max-num="{{ lottery_setting.boom_gift_num_max }}"  placeholder="{{ lottery_setting.boom_gift_num_min }}~{{ lottery_setting.boom_gift_num_max }}">', '<div class="gift-command-box">', "{{ if (giftList[0]) }}", '<input type="text" class="gift-command-type js-luck-gift-now js-luck-gift-change" data-id="{{ giftList[0].gift_id }}" readonly value="{{ giftList[0].gift_name }}">', "{{ else }}", '<input type="text" class="gift-command-type js-luck-gift-now js-luck-gift-change" data-id="" readonly value="">', "{{ /if }}", '<div class="command-arrow-box js-luck-gift-change">', '<span class="js-luck-gift-change"></span>', "</div>", '<div class="gift-value-box js-luck-gift-change">500鱼翅</div>', '<ul class="command-type-list js-luck-gift-list">', "{{ each giftList }}", '<li class="{{ $index === 0 ? "active" : "" }}" data-id="{{ $value.gift_id }}" data-name="{{ $value.gift_name }}" data-val="{{ $value.gift_price }}">{{ $value.gift_name }}<span class="gift-value">{{ $value.gift_price }}</span></li>', "{{ /each }}", "</ul> ", "</div>", "</div>", "</div>", "<!-- 抽奖条件限制 -->", '<div class="draw-limit-rules-box">', '<div class="draw-limit-rules">', '<label class="js-limit-rules-change"">条件设置：</label>', '<input type="text" class="draw-limit-rules-input js-limit-rules-change" readonly>', '<div class="command-arrow-box js-limit-rules-change">', '<span class="js-limit-rules-change"></span>', "</div>", '<div class="draw-limit-value-box js-limit-rules-change"><span class="js-limit-rules-change js-limit-scope" data-val="0">全部水友</span><span class="js-limit-time-box">，<span class="js-limit-rules-change js-limit-time" data-val="300">5</span>分钟</span></div>', '<ul class="limit-type-list js-limit-rules-list">', "<li>", "<h1>抽奖范围</h1>", '<div class="scope-first-row"><span class="item first-item" data-name="全部水友" data-val="0">全部水友</span><span class="item second-item" data-name="关注我的水友" data-val="1">关注我的水友</span></div>', "{{ if (isSetFansBadge) }}", '<div><span class="item first-item" data-name="我的粉丝团水友" data-val="2">我的粉丝团水友</span><span class="item second-item" data-name="关注我且加入粉丝团" data-val="3">关注我且加入粉丝团</span></div>', "{{ /if }}", "</li>", '<li class="js-limit-time-row">', "<h1>时间</h1>", '<div class="first-time-row"><span class="col" data-val="60" data-minute="1">1分钟</span><span class="col" data-val="120" data-minute="2">2分钟</span><span class="col" data-val="180" data-minute="3">3分钟</span><span class="col" data-val="240" data-minute="4">4分钟</span><span class="col cur" data-val="300" data-minute="5">5分钟</span></div>', '<div><span class="col" data-val="360" data-minute="6">6分钟</span><span class="col" data-val="420" data-minute="7">7分钟</span><span class="col" data-val="480" data-minute="8">8分钟</span><span class="col" data-val="540" data-minute="9">9分钟</span><span class="col" data-val="600" data-minute="10">10分钟</span></div>', "</li>", "</ul> ", "</div>", "</div>", "<!-- 审核已通过增加样式pass-attention -->", '<span class="submit-attention js-luck-status-check"></span>', "<!-- 按钮置灰增加样式 inreview -->", '<a class="draw-submit-btn js-luck-draw-start" href="javascript:;">提交</a>', '<a class="draw-reset-btn js-luck-draw-reset" href="javascript:;">重置</a>', "<!-- 置灰增加样式  unavailable -->", '<div class="draw-gift-field draw-document-box js-luck-draw-prot">', '<a href="/cms/gong/201705/11/5315.shtml" target="_blank" class="draw-document-info js-luck-prot-read">《抽奖互动规范》</a>', '<a href="javascript:void(0);" class="draw-document-info js-play-rules">《玩法说明》</a>', "</div>", "</div>", "</div>", "{{ if (rebateSwitch) }}", '<div id="draw-rebate-anchor-banner"></div>', "{{ /if }}", "</div>"),
						i = n.compile(t);
					return i(e)
				},
				luck: function(e) {
					var t = l.string.join("{{ if (!isAnchor && rebate_box) }}", '<div id="draw-rebate-scroll">', '<span id="draw-rebate-scroll-bg-l"></span><span id="draw-rebate-scroll-bg-r"></span>', '<ul id="draw-rebate-scroll-wrap">', '<li class="draw-rebate-scroll" data-index="1"></li>', '<li class="draw-rebate-scroll" data-index="2"></li>', "</ul>", "</div>", '<div class="draw-rebate-box" data-activity-id="{{activityId}}">', '<p class="draw-rebate-time"><span id="draw-rule-click"></span></p>', '<div class="draw-loading-wrap">', '<div class="draw-loading" style="height:{{rebate_loading}}"></div>', "</div>", '<ul class="draw-box-wrap">', '<li class="draw-box {{rebate_box[3].box_status}}" data-index="3">', "<div></div>", "<span>{{rebate_box[3].lucky_value}}</span>", "<p></p>", "</li>", '<li class="draw-box {{rebate_box[2].box_status}}" data-index="2">', "<div></div>", "<span>{{rebate_box[2].lucky_value}}</span>", "<p></p>", "</li>", '<li class="draw-box {{rebate_box[1].box_status}}" data-index="1">', "<div></div>", "<span>{{rebate_box[1].lucky_value}}</span>", "<p></p>", "</li>", '<li class="draw-box {{rebate_box[0].box_status}}" data-index="0">', "<div></div>", "<span>{{rebate_box[0].lucky_value}}</span>", "<p></p>", "</li>", '<div class="draw-rebate-quick-post">', '<p class="draw-rebate-quick-content"><span id="draw-rqp-name"></span>（最高可得<span class="draw-rebate-light"><b id="draw-rqp-max"></b>鱼翅！</span>）</p>', '<p class="draw-rebate-post-num">已赠送<span class="draw-rebate-light"><b id="draw-rqp-now"></b></span>/<b class="draw-rqp-full"></b>鱼翅礼物</p>', '<span class="draw-rebate-post-now unable"></span>', "</div>", "</ul>", '<p class="draw-rebate-total">已送<span>{{rebate_cost}}鱼翅</span></p>', '<div class="draw-rebate-rule-wrap">', '<img class="draw-rebate-rule" src="{{rebate_rule_img}}" />', '<a class="close-draw-rebate-rule"></a>', "</div>", '<div class="draw-rebate-dialog"></div>', "</div>", "{{ /if }}"),
						i = l.string.join("{{ if (list && list.length) }}", "{{ if (isAnchor) }}", "{{ if (lotteryRange === 3) }}", '<div class="draw-gift-box draw-end js-draw-end draw-gift-box-lotteryRange3">', "{{ else }}", '<div class="draw-gift-box draw-end js-draw-end">', "{{ /if }}", "{{ else }}", "{{ if (isLuck) }}", "{{ if (rebate_box) }}", '<div class="draw-gift-box draw-win js-draw-end draw-is-rebate">', "{{ else }}", '<div class="draw-gift-box draw-win js-draw-end">', "{{ /if }}", "{{ else }}", "{{ if (rebate_box) }}", '<div class="draw-gift-box draw-regret js-draw-end draw-is-rebate">', "{{ else }}", '<div class="draw-gift-box draw-regret js-draw-end">', "{{ /if }}", "{{ /if }}", "{{ /if }}", '<div class="draw-gift-title">', '<div class="draw-title-txt"></div>', '<a href="javascript:;" class="draw-gift-close js-luck-end-close"></a>', "</div>", "{{ if (lotteryRange === 3) }}", '<div class="draw-scope3 draw-gift-content">', "{{ else }}", '<div class="draw-gift-content">', "{{ /if }}", "{{ if (activityType == 2) }}", '<div class="draw-end-info draw-official-win">', "{{ else }}", '<div class="draw-end-info">', "{{ /if }}", "{{ if (isAnchor) }}", "<!-- 活动结束 -->", '<div class="draw-info-text">', '<div class="drawTime">抽奖用时：<span>{{ joinTime }}</span></div>', "{{ if (lotteryRange === 0) }}", '<div class="draw-info clearfix lotteryrange0">', '<div class="draw-info-item">', '<div class="draw-info-item-num">{{ join }}</div>', '<div class="draw-info-item-text">参与人数</div>', "</div>", '<div class="draw-info-item">', '<div class="draw-info-item-num">{{ gift }}</div>', '<div class="draw-info-item-text">{{ name }}</div>', "</div>", '<div class="divisionLine"></div>', "</div>", "{{ else if (lotteryRange === 1) }}", '<div class="draw-info clearfix lotteryrange1">', '<div class="draw-info-item">', '<div class="draw-info-item-num">{{ join }}</div>', '<div class="draw-info-item-text">参与人数</div>', "</div>", '<div class="draw-info-item">', '<div class="draw-info-item-num">{{ gift }}</div>', '<div class="draw-info-item-text">{{ name }}</div>', "</div>", '<div class="draw-info-item">', '<div class="draw-info-item-num">{{ followCount }}</div>', '<div class="draw-info-item-text">新增关注</div>', "</div>", "</div>", "{{ else if (lotteryRange === 2) }}", '<div class="draw-info clearfix lotteryrange2">', '<div class="draw-info-item">', '<div class="draw-info-item-num">{{ join }}</div>', '<div class="draw-info-item-text">参与人数</div>', "</div>", '<div class="draw-info-item">', '<div class="draw-info-item-num">{{ gift }}</div>', '<div class="draw-info-item-text">{{ name }}</div>', "</div>", '<div class="draw-info-item">', '<div class="draw-info-item-num">{{ fansCount }}</div>', '<div class="draw-info-item-text">新增粉丝</div>', "</div>", "</div>", "{{ else }}", '<div class="draw-info clearfix lotteryrange3">', '<div class="draw-info-item">', '<div class="draw-info-item-num">{{ join }}</div>', '<div class="draw-info-item-text">参与人数</div>', "</div>", '<div class="draw-info-item">', '<div class="draw-info-item-num">{{ gift }}</div>', '<div class="draw-info-item-text">{{ name }}</div>', "</div>", '<div class="draw-info-item">', '<div class="draw-info-item-num">{{ fansCount }}</div>', '<div class="draw-info-item-text">新增粉丝</div>', "</div>", '<div class="draw-info-item">', '<div class="draw-info-item-num">{{ followCount }}</div>', '<div class="draw-info-item-text">新增关注</div>', "</div>", '<div class="divisionLine"></div>', "</div>", "{{ /if }}", "</div>", "{{ else }}", "{{ if (isLuck) }}", "<!-- 中奖啦 -->", '<div class="draw-info-text">', "<h2>恭喜您中奖啦！</h2>", "{{ if (offimg) }}", '<div class="congratulation-img">', '<img src="{{ offimg }}">', "</div>", "{{ /if }}", '<div class="winner-award-name" title="{{ prize }}">{{ prize }}</div>', "{{ if (activityType == 2) }}", "{{ if (prizeType == 4) }}", '<p id="winner-award-info">斗鱼抽奖已私信你，请快去<a class="winner-award-info">填写收货信息</a>吧~</p>', "{{ else }}", "<p>中奖通知已发至您的私信，请注意查收~</p>", "{{ /if }}", "{{ else }}", '<p id="winner-award-info">主播已私信你，请快去<a class="winner-award-info">填写收货信息</a>吧~</p>', "{{ /if }}", "</div>", "{{ else }}", "<!-- 很遗憾 -->", '<div class="draw-info-text">', "<span>抱歉！你与奖品擦肩而过~</span>", "</div>", "{{ /if }}", "{{ /if }}", "<!-- 获奖名单 -->", '<div class="award-winner-list">', '<div class="winner-list-title-first">中奖名单<span class="more-dot"></span></div>', '<div class="winner-list-title-v3"></div>', '<div class="winner-list-content js-luck-end-list">', "{{ each list }}", '<li class="winner-list-item">', '<a class="chat-icon-pad user-level {{ $value.ulevelc }}" data-uid="{{ $value.uid }}" title="用户等级：{{ $value.level }}"></a>', "{{ if (isLuck && $index === index) }}", '<span title="{{ $value.nickname }}" class="draw-luck-name">{{ $value.nickname }}</span>', "{{ else }}", '<span title="{{ $value.nickname }}">{{ $value.nickname }}</span>', "{{ /if }}", "</li>", "{{ /each }}", "</div>", '<div class="winner-list-bottom"></div>', "{{ if (isAnchor) }}", "{{ if (activityType == 2) }}", '<div class="winner-list-tellfans">请及时告知中奖用户查看官方私信，注意查收~</div>', "{{ else }}", '<div class="winner-list-tellfans">已通过您的账号向中奖水友发送消息，快及时联系他们寄送奖品哦~<a href="/room/my/lottery_history" target="_blank">抽奖记录</a></div>', "{{ /if }}", "{{ /if }}", "</div>", "</div>", "</div>", t, "</div>", "{{ else }}", '<div class="draw-gift-box draw-end-nobody js-draw-end">', '<div class="draw-gift-title">', '<div class="draw-title-txt"></div>', '<a href="javascript:;" class="draw-gift-close js-luck-end-close"></a>', "</div>", '<div class="draw-gift-content">', '<div class="draw-end-info">', '<div class="draw-info-text">', "<h3>当前没有一个人满足抽奖条件</h3>", "</div>", "</div>", "</div>", t, "</div>", "{{ /if }}"),
						a = n.compile(i);
					return a(e)
				},
				check: function(e) {
					var t = l.string.join('<div class="group-btns-pop draw-tips">', '<span class="group-pop-arrow1"></span>', '<span class="group-pop-arrow2"></span>', "{{ if (type) }}", '<p>你发布的抽奖<span class="draw-pass">已通过</span>审核 <span class="draw-pass js-draw-start">开启抽奖</span></p>', "{{ else }}", '<p>你发布的抽奖<span class="draw-not-pass">未通过</span>审核</p>', "{{ /if }}", "</div>"),
						i = n.compile(t);
					return i({
						type: e
					})
				},
				close: function() {
					var e = l.string.join('<div class="group-btns-pop draw-tips">', '<span class="group-pop-arrow1"></span>', '<span class="group-pop-arrow2"></span>', "<p>审核完成后，我们将及时通知您</p>", "</div>"),
						t = n.compile(e);
					return t()
				}
			},
			init: function() {
				var e = this;
				e.initData(), e.checkDrawBtns(), u.listen()
			},
			initData: function() {
				var t = this.vars,
					i = this.doms;
				i.$container = e("body"), t.room_id = r.get("room.room_id"), t.category_id = r.get("room.cate_id"), t.uid = r.get("sys.uid"), t.luckStatus = "start", t.normalGift = ""
			},
			checkDrawBtns: function() {
				var t = this,
					i = +r.get("sys.uid"),
					a = +r.get("room.owner_uid");
				return i !== a ? void v.sendAjax(m.urls.rebateConfig, {}, function(e, t) {
					var i = t || {};
					m.rebateInfo = i.data
				}) : void t.getLuckEnter(function(i) {
					i.is_open && v.sendAjax(m.urls.rebateConfig, {}, function(a, n) {
						var r = n || {};
						m.rebateInfo = r.data, t.vars.normalMax = i.lottery_setting.gift_num_max, t.vars.lightMax = i.lottery_setting.boom_gift_num_max, t.vars.lightMin = i.lottery_setting.boom_gift_num_min, t.luckDrawInfo = i, t.showDrawBtn();
						var o = s.get("luckDrawTipsShow") || 0,
							l = s.get("luckDrawRebateTipsShow") || 0;
						if (1 > l && m.rebateInfo && 1 == m.rebateInfo["switch"].web) {
							var c = e(".live-group-btns").find('[data-live-group="drawTips-rebate"]');
							return c.removeClass("hide").show(), c.on("click", ".draw-pop-close", function() {
								c.hide()
							}), o++, s.set("luckDrawTipsShow", o), l++, void s.set("luckDrawRebateTipsShow", l)
						}
						if (3 > o) {
							var d = e(".live-group-btns").find('[data-live-group="drawTips"]');
							d.removeClass("hide").show(), d.on("click", ".pop-close-btn", function() {
								d.hide()
							}), d.on("click", ".draw-pop-btn", function() {
								d.hide(), t.flag.showFlag || (t.checkFirst(), g.dys({
									key: "dys.room.draw.lottery.car.click"
								}))
							}), d.on("click", ".draw-pop-circle", function() {
								d.hide(), t.flag.showFlag || (t.checkFirst(), g.dys({
									key: "dys.room.draw.btn.click"
								}))
							}), o++, s.set("luckDrawTipsShow", o)
						}
					})
				})
			},
			showLuckDraw: function(t) {
				var i = this,
					a = i.doms,
					n = i.vars;
				if (!i.flag.showFlag) if (i.doms.$box) i.removeLastDialog(), i.luckDrawInfo.is_open_official && i.getOfficeGift(!0, function(e) {
					0 == e.join_type ? n.officialType = "Nochange" : 1 == e.join_type ? n.officialType = "command" : 2 == e.join_type ? n.officialType = "gift" : 3 == e.join_type && (n.officialType = "light");
					var t = a.offgift;
					t.$name.text(e.prize_name), t.$num.text(e.prize_left_num), t.$img.attr("src", e.prize_img ? e.prize_img : i.getOfficialDefaultPic())
				}), a.$giftList.hide(), i.hideLimitList(), i.doms.$box.show(), t(!0);
				else {
					var s = i.luckDrawInfo;
					s.is_open_official && !s.is_open_general && (n.luckType = "official"), i.getOfficeGift(s.is_open_official, function(o) {
						0 == o.join_type ? n.officialType = "Nochange" : 1 == o.join_type ? n.officialType = "command" : 2 == o.join_type ? n.officialType = "gift" : 3 == o.join_type && (n.officialType = "light"), i.getGiftList(function(l) {
							if (0 == l.length) return t();
							n.pointGift.giftID = l[0].gift_id, n.pointGift.giftNUM = l[0].gift_name, n.pointGift.giftPRICE = l[0].gift_price;
							var c = e.extend(s, {
								giftList: l
							}, {
								offGift: o
							}, {
								isSetFansBadge: r.get("room.is_set_fans_badge")
							}, {
								rebateSwitch: m.rebateInfo["switch"].web
							}),
								d = e(".js-draw-end");
							d.length && d.remove();
							var u = i.render.box(c);
							a.$box = e(u), a.$container.append(a.$box), i.cacheBoxDoms(), l.length > 6 && a.$giftList.mCustomScrollbar(), i.bindBoxEvent(), t()
						})
					})
				}
			},
			showDrawBtn: function() {
				var t = this,
					i = e(".live-group-btns").find('[data-live-group="draw"]');
				t.doms.$actEnter = i, i.removeClass("hide"), i.bind("click", function() {
					t.flag.showFlag || (t.checkFirst(), g.dys({
						key: "dys.room.draw.btn.click"
					}))
				})
			},
			cacheBoxDoms: function() {
				var e = this,
					t = e.doms,
					i = t.$box;
				t.$input = i.find('input.js-normal-input[type="text"]'), t.$normalBtn = i.find(".js-luck-normal-enter"), t.$officeBtn = i.find(".js-luck-office-enter"), t.$normalSec = i.find(".js-luck-normal-sec"), t.$officeSec = i.find(".js-luck-office-sec"), t.$limitList = i.find(".js-limit-rules-list"), t.$limitScope = i.find(".js-limit-scope"), t.$limitTime = i.find(".js-limit-time"), t.$limitTimeBox = i.find(".js-limit-time-box"), t.$limitTimeRow = i.find(".js-limit-time-row"), t.$giftList = i.find(".js-luck-gift-list"), t.$giftListLi = t.$giftList.find("li"), t.$giftChoose = i.find(".js-luck-gift-now"), t.$giftValue = i.find(".gift-value-box"), t.$wordBtn = i.find(".js-luck-word-enter"), t.$giftBtn = i.find(".js-luck-gift-enter"), t.$wordSec = i.find(".js-luck-word-command"), t.$giftSec = i.find(".js-luck-gift-command"), t.$protRead = i.find(".js-luck-prot-read"), t.$start = i.find(".js-luck-draw-start"), t.$readProt = i.find(".js-luck-draw-prot"), t.$reset = i.find(".js-luck-draw-reset"), t.$close = i.find(".js-luck-draw-close"), t.gift = {
					$normalGift: i.find(".js-luck-draw-normal-gift"),
					$giftTips: i.find(".js-draw-gift-tips"),
					$normalNum: i.find(".js-luck-draw-normal-num"),
					$offical: i.find(".js-luck-draw-official"),
					$word: i.find(".js-luck-draw-wordc"),
					$giftNum: i.find(".js-luck-draw-giftc-num"),
					$giftName: t.$giftChoose
				}, t.$statusCheck = i.find(".js-luck-status-check"), t.offgift = {
					$name: i.find(".js-luck-offgift-name"),
					$num: i.find(".js-luck-offgift-num"),
					$img: i.find(".js-luck-offgift-img"),
					$needNum: i.find(".gift-command-num"),
					$needName: i.find(".gift-command-type"),
					$needValue: i.find(".gift-value-box")
				}, t.$wordTab = i.find(".js-luck-word-tab"), t.$lightTab = i.find(".js-luck-light-tab"), t.$lightSec = i.find(".js-luck-light-gift-command"), t.$shibbolethTabSec = i.find(".js-luck-shibboleth-tab")
			},
			checkFirst: function() {
				var e = this,
					t = s.get("firstLuckDraw");
				t ? e.checkActStatus() : e.showFirstGid()
			},
			checkActStatus: function() {
				var e = this;
				e.getRoomActInfo(function() {
					e.showLuckDrawInfo()
				})
			},
			showFirstGid: function() {
				y.init()
			},
			showLuckDrawInfo: function() {
				var t = this;
				t.getNowLuckDrawInfo(function(i) {
					var a = i.data;
					switch (+a.activity_status) {
					case 1:
						t.showLuckDraw(function() {
							t.setLastStatus(a), t.changeDrawType("audit")
						});
						break;
					case 2:
						t.showLuckDraw(function() {
							t.setLastStatus(a), t.changeDrawType("ready")
						});
						break;
					case 3:
						t.showLuckDraw(function() {
							t.setLastStatus(a), t.changeDrawType("failed", a.audit_remark)
						});
						break;
					case 4:
					case 7:
						e.dialog.tips_black("当前正在抽奖，请抽奖结束后再来开启~");
						break;
					case 5:
						t.showLuckDraw(function(e) {
							e || (t.changeDrawType("start"), t.setLastStatus(a))
						});
						break;
					default:
						t.showLuckDraw(function() {
							t.changeDrawType("start")
						})
					}
				})
			},
			setLastStatus: function(e) {
				var t, i = this,
					a = i.doms,
					n = a.gift,
					s = e.activity_type,
					r = e.join_type,
					o = e.join_condition;
				t = o.gift_name && h.getLength(o.gift_name) > 8 ? h.cutString(o.gift_name, 8) : o.gift_name, 3 === +r ? i.renderLimitList(o.lottery_range) : i.renderLimitList(o.lottery_range, o.expire_time), 1 === +r ? (n.$word.val(o.command_content), a.$wordBtn.trigger("click")) : 2 === +r ? (a.$giftChoose.attr("data-id", o.gift_id), a.$giftListLi.removeClass("active"), a.$giftList.find('[data-id="' + o.gift_id + '"]').addClass("active"), a.$giftChoose.val(t), n.$giftNum.val(o.gift_num), a.$giftValue.html(o.gift_price), a.$giftBtn.trigger("click")) : 3 === +r && (a.$lightTab.trigger("click"), a.$giftChoose.attr("data-id", o.gift_id), a.$giftListLi.removeClass("active"), a.$giftList.find('[data-id="' + o.gift_id + '"]').addClass("active"), a.$giftChoose.val(t), n.$giftNum.eq(1).val(o.gift_num), a.$giftValue.html(o.gift_price)), 2 === +s ? (n.$offical.val(e.prize_num), a.$officeBtn.trigger("click")) : 1 === +s && (n.$normalGift.val(e.prize_name), n.$normalNum.val(e.prize_num), a.$normalBtn.trigger("click"))
			},
			showStatusCheck: function(e, t) {
				var i = this.doms;
				e ? i.$statusCheck.html(e).css("display", "inline-block") : i.$statusCheck.hide(), t ? i.$statusCheck.addClass("pass-attention") : i.$statusCheck.removeClass("pass-attention")
			},
			changeDrawType: function(e, t) {
				var i = this,
					a = i.doms;
				if (a.$box) {
					var n = i.vars,
						s = a.gift;
					switch (e) {
					case "start":
						n.luckStatus = "start", i.removeAllBoxStatus(), s.$normalGift.val(""), s.$normalNum.val(""), s.$word.val(""), s.$giftNum.val(""), s.$offical.val(""), a.$start.text("提交"), a.$reset.text("重置"), a.$reset.show();
						var r = a.$giftListLi.eq(0);
						a.$giftChoose.val(r.attr("data-name")).attr("data-id", r.attr("data-id")), a.$giftValue.html(r.attr("data-val")), i.initLimitList(), a.$giftList.hide(), i.hideLimitList(), i.showStatusCheck(), a.$input.attr("readonly", !1);
						break;
					case "modify":
						n.luckStatus = "start", i.removeAllBoxStatus(), a.$start.text("提交"), a.$reset.text("重置"), a.$reset.show(), a.$giftList.hide(), i.hideLimitList(), i.showStatusCheck(), a.$input.attr("readonly", !1);
						break;
					case "audit":
						n.luckStatus = "audit", i.addBoxStatus("draw-audit"), a.$start.addClass("inreview"), a.$giftList.hide(), i.hideLimitList(), a.$start.text("审核中"), a.$reset.hide(), i.showStatusCheck("提交后需要等待2-3分钟完成审核"), a.$input.attr("readonly", !0);
						break;
					case "failed":
						n.luckStatus = "failed", i.addBoxStatus("draw-failed"), a.$start.removeClass("inreview"), a.$giftList.hide(), i.hideLimitList();
						var o = l.string.join('<span class="not-pass">', '<span class="not-pass-tips">', "<i></i>", t || "奖品名称不符合要求", "</span>", "</span>", "审核未通过!");
						i.showStatusCheck(o), a.$start.text("修改"), a.$reset.hide(), a.$input.attr("readonly", !0), g.dys({
							key: "dys.room.draw.show.failed",
							commandtype: a.$wordSec.hasClass("hide") ? 2 : 1
						});
						break;
					case "ready":
						n.luckStatus = "ready", i.addBoxStatus("draw-ready"), a.$start.removeClass("inreview"), a.$start.text("开启抽奖"), a.$reset.text("修改"), a.$reset.show(), a.$giftList.hide(), i.hideLimitList(), i.showStatusCheck("审核已通过！", !0), a.$input.attr("readonly", !0), g.dys({
							key: "dys.room.draw.show.success",
							commandtype: a.$wordSec.hasClass("hide") ? 2 : 1
						})
					}
				}
			},
			bindBoxEvent: function() {
				var t = this,
					i = t.doms,
					a = t.vars,
					n = t.flag;
				i.$box.on("click", function(s) {
					var r = e(s.target),
						o = a.luckStatus;
					if (r.hasClass("js-luck-draw-close")) t.hideDrawDlg(), "audit" === o && t.showCheckBox(1);
					else if (r.hasClass("js-play-rules")) t.showFirstGid();
					else if (r.hasClass("js-luck-draw-start")) switch (o) {
					case "start":
						t.checkLuckDrawInfo();
						break;
					case "failed":
						t.resetLuckDraw(function() {
							t.changeDrawType("modify")
						});
						break;
					case "ready":
						t.submitStartLuck();
						var l = i.$normalBtn.hasClass("active");
						g.dys({
							key: "dys.room.draw.start.click",
							lotterytype: l ? 1 : 2,
							gfid: i.$giftBtn.hasClass("active") ? i.$giftChoose.attr("data-id") : "",
							commandtype: i.$wordSec.hasClass("hide") ? 2 : 1
						})
					} else if (r.hasClass("js-luck-draw-reset")) {
						if ("ready" === o) return m.dyDlgHand && m.dyDlgHand.hide(), void(m.dyDlgHand = e.dy_dialog("修改后需再次提交审核哟~是否确认修改？", {
							className: "shark-ui-confirm luck-draw",
							mask: !0,
							zIndex: 502,
							buttons: [{
								content: "确认",
								callback: function() {
									this.hide(), t.resetLuckDraw(function() {
										t.changeDrawType("modify")
									})
								}
							}, {
								content: "取消",
								callback: function() {
									this.hide()
								}
							}]
						}));
						t.changeDrawType("start")
					}
					if ("failed" !== o && "ready" !== o && "audit" !== o) if (r.hasClass("js-luck-draw-normal-gift") ? t.toggleGiftTips(!0) : t.toggleGiftTips(!1), r.hasClass("js-luck-normal-enter")) {
						if ("normal" === a.luckType) return;
						if (e(".gift-command-btn").addClass("changeHover"), "command" === a.officialType && i.$giftBtn.removeClass("off_color"), "gift" === a.officialType && i.$wordBtn.removeClass("off_color"), "gift" === a.officialType || "light" === a.officialType) {
							var c = i.offgift;
							c.$needNum.val(""), c.$needNum.css("color", ""), c.$needName.val(a.pointGift.giftNUM), c.$needValue.text(a.pointGift.giftPRICE), i.$giftChoose.attr("data-id", a.pointGift.giftID), e(".gift-command-btn").css("border", "1px solid #ffa544"), e(".draw-gift-command input").css("border", "1px solid #f5b38b"), e(".js-luck-gift-change").css("color", "#d26357"), e(".draw-gift-command label").css("color", "#d26357"), e(".gift-command-num").removeAttr("readonly")
						}
						"command" === a.officialType && (e(".gift-command-btn").css("border", "1px solid #ffa544"), i.gift.$word.css("color", ""), i.gift.$word.val(""), i.gift.$word.removeAttr("readonly"), e(".js-luck-word-command label").css("color", "#d26357"), e(".js-luck-draw-wordc").css("border", "1px solid #ffa544")), a.luckType = "normal", i.$normalBtn.addClass("active"), i.$officeBtn.removeClass("active"), i.$officeSec.addClass("hide"), i.$normalSec.removeClass("hide"), t.hideLimitList(), i.$giftList.hide(), a.$giftLi && a.$giftLi.trigger("click")
					} else if (r.hasClass("js-luck-office-enter")) {
						if (!n.ifOfficial) return;
						e(".gift-command-btn").removeClass("changeHover"), "command" === a.officialType ? (i.$wordBtn.trigger("click"), i.$giftBtn.addClass("off_color"), i.$giftBtn.css("border", "1px solid #d2cec8")) : "gift" === a.officialType && (i.$giftBtn.trigger("click"), i.$wordBtn.addClass("off_color"), i.$wordBtn.css("border", "1px solid #d2cec8")), "gift" !== a.officialType && "light" !== a.officialType || t.getOfficeGift(!0, function(t) {
							var a = i.offgift;
							t.is_invalid ? (n.ifChangeGift = !1, i.$giftChoose.attr("data-id", t.gift_id), a.$needNum.val(t.gift_num), a.$needNum.css("color", "#d2cec8"), a.$needName.val(t.gift_name), a.$needValue.text(t.gift_price), e(".draw-gift-command input").css("border", "1px solid #d2cec8"), e(".js-luck-gift-change").css("color", "#d2cec8"), e(".draw-gift-command label").css("color", "#d2cec8"), e(".gift-command-num").attr("readonly", "readonly")) : n.ifChangeGift = !0
						}), "command" === a.officialType && t.getOfficeGift(!0, function(t) {
							i.gift.$word.css("color", "#d2cec8"), i.gift.$word.val(t.command_content), i.gift.$word.attr("readonly", "readonly"), e(".js-luck-word-command label").css("color", "#d2cec8"), e(".js-luck-draw-wordc").css("border", "1px solid #d2cec8")
						}), setTimeout(function() {
							a.luckType = "official", i.$officeBtn.addClass("active"), i.$normalBtn.removeClass("active"), i.$normalSec.addClass("hide"), i.$officeSec.removeClass("hide"), t.hideLimitList(), i.$giftList.hide()
						}, 100)
					} else if (r.hasClass("js-limit-rules-change")) i.$limitList.toggle(), i.$limitList.is(":visible") ? r.parents(".draw-limit-rules").addClass("arrow-up") : r.parents(".draw-limit-rules").removeClass("arrow-up");
					else if (r.hasClass("js-luck-gift-change")) {
						if ("official" === a.luckType && "Nochange" !== a.officialType && !n.ifChangeGift) return;
						i.$giftList.toggle(), i.$giftList.is(":visible") ? r.parents(".gift-command-box").addClass("arrow-up") : r.parents(".gift-command-box").removeClass("arrow-up")
					} else if (r.hasClass("js-luck-word-enter")) {
						if ("official" === a.luckType && "gift" === a.officialType) return;
						if ("word" === a.commandType) return;
						a.commandType = "word", i.$wordBtn.addClass("active"), i.$giftBtn.removeClass("active"), i.$wordSec.removeClass("hide"), i.$giftSec.addClass("hide")
					} else if (r.hasClass("js-luck-gift-enter")) {
						if ("gift" === a.commandType) return;
						if ("official" === a.luckType && "command" === a.officialType) return;
						a.commandType = "gift", i.$giftBtn.addClass("active"), i.$wordBtn.removeClass("active"), i.$giftSec.removeClass("hide"), i.$wordSec.addClass("hide")
					} else if (r.hasClass("js-luck-word-tab")) {
						"command" !== a.officialType && "gift" !== a.officialType || (n.ifOfficial = !0, e(".draw-gift-tab").css("color", "#cf865a")), "light" === a.officialType && (n.ifOfficial = !1, i.$normalBtn.trigger("click"), e(".draw-gift-tab").css("color", "#999999"));
						var d = i.$shibbolethTabSec.find("a.active").text();
						g.dys({
							key: "dys.room.draw.click.word"
						}), t.showStatusCheck(), i.$limitTimeBox.show(), i.$limitTimeRow.show(), t.hideLimitList(), i.$giftList.hide(), i.$wordTab.addClass("active"), i.$lightTab.removeClass("active"), i.$shibbolethTabSec.show(), "文字口令" === d ? (a.commandType = "word", i.$wordSec.removeClass("hide"), i.$giftSec.addClass("hide"), i.$lightSec.addClass("hide")) : (a.commandType = "gift", i.$wordSec.addClass("hide"), i.$giftSec.removeClass("hide"), i.$lightSec.addClass("hide"))
					} else if (r.hasClass("js-luck-light-tab")) {
						if ("command" !== a.officialType && "gift" !== a.officialType || (n.ifOfficial = !1, i.$normalBtn.trigger("click"), e(".draw-gift-tab").css("color", "#999999")), "light" === a.officialType && (n.ifOfficial = !0, e(".draw-gift-tab").css("color", "#cf865a")), "light" === a.commandType) return;
						a.commandType = "light", g.dys({
							key: "dys.room.draw.click.light"
						}), t.showStatusCheck(), i.$limitTimeBox.hide(), i.$limitTimeRow.hide(), t.hideLimitList(), i.$giftList.hide(), i.$lightTab.addClass("active"), i.$wordTab.removeClass("active"), i.$shibbolethTabSec.hide(), i.$wordSec.addClass("hide"), i.$giftSec.addClass("hide"), i.$lightSec.removeClass("hide")
					}
				}), "light" === a.officialType && i.$wordTab.trigger("click"), i.$giftList.on("click", "li", function() {
					var t = e(this),
						n = t.data(),
						s = n.id,
						r = n.name,
						o = n.val;
					a.$giftLi = t, a.pointGift.giftID = s, a.pointGift.giftNUM = r, a.pointGift.giftPRICE = o, r && h.getLength(r) > 8 && (r = h.cutString(r, 8)), i.$giftListLi.removeClass("active"), t.addClass("active"), i.$giftChoose.attr("data-id", s).val(r), i.$giftValue.html(o), i.$giftList.hide(), t.parents(".gift-command-box").removeClass("arrow-up")
				}), i.$limitList.on("click", ".item", function() {
					var a = e(this),
						n = a.data(),
						s = n.name,
						r = n.val;
					i.$limitScope.text(s), i.$limitScope.attr("data-val", r), t.clearScopeLimitCur(), a.addClass("scopeCur"), i.$limitTimeRow.is(":visible") || t.hideLimitList()
				}), i.$limitList.on("click", ".col", function() {
					var a = e(this),
						n = a.data(),
						s = n.val,
						r = n.minute;
					i.$limitTime.text(r), i.$limitTime.attr("data-val", s), t.clearTimeLimitCur(), a.addClass("cur")
				}), i.$box.on("keyup", ".js-number-input", function() {
					var t = e(this),
						i = t.val();
					if (!/\d+/.test(i)) return void t.val("");
					var a = parseInt(i, 10),
						n = t.attr("data-max-num");
					a > n && (a = n), t.val(a)
				}), i.gift.$normalGift.on("keyup", function() {
					for (var t = e(this), i = a.normalGift, n = (t.val() || "").split(""), s = /[\u4e00-\u9fa5]/, r = 0, o = t.attr("maxlength"), l = 0, c = n.length; c > l; l++) r += s.test(n[l]) ? 2 : 1;
					o >= r ? a.normalGift = n.join("") : t.val(i)
				})
			},
			bindRebateEvent: function() {
				var t, i = this,
					a = e(".draw-rebate-box"),
					n = a.find(".draw-rebate-quick-post");
				n.on({
					mouseover: function(e) {
						n.show()
					},
					mouseout: function(e) {
						n.hide()
					}
				}), a.find(".draw-box>div").on({
					mouseover: function(t) {
						var i = e(this).parent(),
							a = i.data("index"),
							s = m.rebateInfo.box_info[a];
						i.hasClass("un-open") && (n.addClass("un-open-wrap"), e("#draw-rqp-name").text(s.box_name), e(".draw-rqp-full").text(s.lucky_value), e("#draw-rqp-max").text(s.max_award), e("#draw-rqp-now").text(m.rebateInfoEnd.cost), n.css("top", 114 + 88 * i.index() + "px").show())
					},
					mouseout: function(e) {
						n.hide()
					}
				}), a.find(".draw-box>p").on({
					click: function(a) {
						var n = e(this).parent();
						if (n.hasClass("can-open")) {
							clearTimeout(t);
							var s = n.data("index"),
								o = m.rebateInfo.box_info[s],
								l = {
									box_id: o.box_id,
									room_id: +r.get("room.room_id"),
									activity_id: e(".draw-rebate-box").data("activity-id"),
									cate2_id: r.get("room.cate_id")
								};
							i.sendAjax(m.urls.openRebateBox, l, function(i, a) {
								if (i) return void e.dialog.tips_black(i);
								var r = a.data;
								gift = [];
								for (var o = 0; o < r.award_info.length; o++) {
									var l = r.award_info[o];
									gift.push("<span>" + ("dj" == l.award_type ? l.award_count + "个" : l.award_count) + l.award_name + "</span>")
								}
								r.award_info.length ? e(".draw-rebate-dialog").html("成功开启<span>" + m.rebateInfo.box_info[s].box_name + "!</span><br/>获得" + gift.join("，")).show() : e(".draw-rebate-dialog").html("少侠今日手气不佳<br/>距离鱼翅返利就差一点点~").show(), t = setTimeout(function() {
									e(".draw-rebate-dialog").hide()
								}, 2500), n.removeClass("can-open").addClass("has-open").addClass("is-opening"), setTimeout(function() {
									n.removeClass("is-opening")
								}, 2e3)
							}, "POST")
						}
					}
				}), e("#draw-rule-click").on("mouseover", function() {
					e(".draw-rebate-rule-wrap").show()
				}).on("mouseout", function() {
					e(".draw-rebate-rule-wrap").hide()
				}), this.rebateScrollTip()
			},
			rebateScrollTip: function() {
				var t = this,
					i = m.rebateInfoEnd.lucky_notice,
					a = e(".draw-rebate-scroll");
				this.rebateTipIndex = 0, a.eq(0).html(this.parseRebateTip(i[this.rebateTipIndex])), i.length > 1 && a.eq(1).html(this.parseRebateTip(i[this.rebateTipIndex + 1]));
				setInterval(function() {
					i.length <= 1 || (a.eq(0).html(t.parseRebateTip(i[t.rebateTipIndex % i.length])), a.eq(1).html(t.parseRebateTip(i[(t.rebateTipIndex + 1) % i.length])), ++t.rebateTipIndex, a.css("top", 0).animate({
						top: "-31px"
					}, 400, "swing"))
				}, 3e3)
			},
			parseRebateTip: function(t) {
				var i = e("#draw-rebate-scroll").hasClass("long") ? 15 : 5;
				if (!t) return "抽奖超值返利活动，仅限3天！海量鱼翅道具等你来拿！";
				var a = t.nickname.length > i ? t.nickname.slice(0, i) + "..." : t.nickname,
					n = t.anchor_name.length > i ? t.anchor_name.slice(0, i) + "..." : t.anchor_name;
				return "<span>" + a + "</span>在<span>" + n + "</span>房间开启<span>" + t.box_name + "</span>,获得<span>" + t.award_count + "鱼翅！</span>"
			},
			showRebateRadio: function() {
				var t = e("#draw-rebate-scroll"),
					i = e(".draw-gift-content"),
					a = e(".draw-rebate-box");
				t.length && (i[0].offsetTop + i[0].offsetHeight - (a[0].offsetTop + a[0].offsetHeight) < 0 ? t.removeClass("long") : t.addClass("long"), t.show())
			},
			toggleGiftTips: function(e) {
				var t = this,
					i = this.doms.gift.$giftTips,
					a = i.is(":visible");
				clearTimeout(t.vars.giftTipsTk);
				var n = s.get("luckDrawInputTips") || 0;
				e ? 1 > n && (a || (i.fadeIn(), t.vars.giftTipsTk = setTimeout(function() {
					i.fadeOut()
				}, 5e3), n++, s.set("luckDrawInputTips", n))) : a && i.fadeOut()
			},
			removeAllBoxStatus: function() {
				var e = this,
					t = e.doms.$box;
				t.removeClass("draw-audit").removeClass("draw-ready").removeClass("draw-failed")
			},
			addBoxStatus: function(e) {
				var t = this,
					i = t.doms.$box;
				t.removeAllBoxStatus(), i.addClass(e)
			},
			hideDrawDlg: function() {
				var e = this;
				e.doms && e.doms.$box && (e.doms.$box.hide(), e.flag.showFlag = !1)
			},
			showEndDlg: function(t) {
				var i = this,
					a = i.render.luck(t),
					n = e(a);
				i.removeLastDialog(), i.doms.$container.append(n), n.show(), g.dys({
					key: "dys.room.draw.lottery.result.show",
					type: 3 == t.joinType ? "爆灯" : "口令"
				}), i.showAdPart(t), n.find(".js-luck-end-list").mCustomScrollbar(), n.on("click", ".js-luck-end-close", function() {
					n.remove(), m.rebateInfoEnd = null
				}), n.on("click", ".winner-award-info", function() {
					u.init({
						id: t.activityId,
						prize: t.prize
					}), g.dys({
						key: "dys.room.draw.lottery.recinf.click"
					})
				}), i.showRebateRadio()
			},
			showAdPart: function(t) {
				var i = this,
					a = i.checkAdIsShow();
				if (!t.isAnchor) {
					if (t.isLuck && t.drawad && t.drawad.win && a) {
						var n = '<div class="winner-advertise-info"><div class="back"></div><div class="ad-ma"><img src="' + t.drawad.win + '" /></div><i class="close"></i></div>';
						e(".draw-end-info").css("backgroundSize", 0), e(".congratulation-img").hide(), e(".draw-info-text h2").css("marginBottom", "5px");
						var s = e(n);
						s.css({
							"background-size": "100%",
							background: "url(" + t.drawad.win_text + ") no-repeat",
							width: "320px",
							height: "117px"
						}), e(".draw-info-text").append(s), i.clickShowDialog(function() {
							e(".winner-advertise-info").remove(), e(".draw-end-info").css("backgroundSize", ""), e(".congratulation-img").show(), e(".congratulation-img").length <= 0 && e(".draw-info-text h2").css("marginBottom", "96px"), i.setNowDate()
						})
					}
					if (!t.isLuck && t.drawad && t.drawad.lose && a) {
						var n = '<div class="winner-advertise-info ' + (t.isNoBodyLuck ? "pos-abs-no" : "pos-abs") + '"><div class="back"></div><div class="ad-ma"><img src="' + t.drawad.lose + '" /></div><i class="close"></i></div>',
							s = e(n);
						s.css({
							"background-size": "100%",
							background: "url(" + t.drawad.lose_text + ") no-repeat",
							width: "320px",
							height: "117px"
						}), e(".draw-info-text").after(s), t.isNoBodyLuck && (e(".draw-end-info").css("backgroundSize", 0), e(".draw-info-text h3").css("marginTop", "-20px"), e(".draw-info-text h3").css("marginBottom", "140px")), i.clickShowDialog(function() {
							e(".winner-advertise-info").remove(), t.isNoBodyLuck && (e(".draw-end-info").css("backgroundSize", ""), e(".draw-info-text h3").css("marginTop", "114px"), e(".draw-info-text h3").css("marginBottom", "46px")), i.setNowDate()
						})
					}
				}
			},
			checkAdIsShow: function() {
				var e = s.get("luckDrawAdsShow");
				if (e) {
					var t = new Date,
						i = t.getFullYear() + "." + (t.getMonth() + 1) + "." + t.getDate();
					return +i.split(".")[0] < +e.split(".")[0] ? !1 : +i.split(".")[0] > +e.split(".")[0] ? !0 : +i.split(".")[1] < +e.split(".")[1] ? !1 : +i.split(".")[1] > +e.split(".")[1] ? !0 : !(+i.split(".")[2] <= +e.split(".")[2])
				}
				return !0
			},
			clickShowDialog: function(t) {
				e(".winner-advertise-info .close").on("click", function() {
					e.dialog({
						lock: !0,
						content: "已参加此活动，今日不再提醒",
						ok: t,
						cancel: function() {}
					})
				})
			},
			setNowDate: function() {
				var e = new Date,
					t = e.getFullYear() + "." + (e.getMonth() + 1) + "." + e.getDate();
				s.set("luckDrawAdsShow", t)
			},
			removeLastDialog: function() {
				var t = e(".js-draw-end");
				t.length && t.remove()
			},
			showCheckBox: function(t, i) {
				var a = this,
					n = this.doms.$box.is(":visible");
				if (!n) {
					var s = t ? a.render.close() : a.render.check(i),
						r = e(s);
					a.doms.$actEnter.find(".draw-tips").length || a.doms.$actEnter.append(r), r.show(), setTimeout(function() {
						r.remove()
					}, 5e3)
				}
			},
			checkLuckDrawInfo: function() {
				var t, i, a, n, s, r, o, l = this,
					c = l.doms,
					d = l.vars,
					u = c.gift;
				if ("normal" === d.luckType ? (a = 1, t = e.trim(u.$normalGift.val()), i = u.$normalNum.val()) : "official" === d.luckType && (a = 2, t = e.trim(u.$offical.attr("data-giftname")), i = u.$offical.val()), !t) return void l.showStatusCheck("奖品名称不能为空");
				if (!i) return void l.showStatusCheck("请设置奖品数量");
				if (t.length < 2) return void l.showStatusCheck("奖品名称最少2个字");
				if (r = parseInt(c.$limitTime.attr("data-val")), o = parseInt(c.$limitScope.attr("data-val")), "word" === d.commandType) {
					var f = e.trim(u.$word.val());
					if (!f) return void l.showStatusCheck("口令不能为空");
					n = {
						prize_name: t,
						prize_num: i,
						activity_type: a,
						join_type: 1,
						command: f,
						expire_time: r,
						lottery_range: o
					}
				} else if ("gift" === d.commandType) {
					if (s = u.$giftNum.val(), !s) return void l.showStatusCheck("礼物数量请输入1-" + d.normalMax + "之间的整数");
					n = {
						prize_name: t,
						prize_num: i,
						activity_type: a,
						join_type: 2,
						gift_id: u.$giftName.attr("data-id"),
						gift_num: s,
						expire_time: r,
						lottery_range: o
					}
				} else if ("light" === d.commandType) {
					if (s = u.$giftNum.eq(1).val(), s < d.lightMin || s > d.lightMax) return void l.showStatusCheck("礼物数量请输入" + d.lightMin + "-" + d.lightMax + "之间的整数");
					n = {
						prize_name: t,
						prize_num: i,
						activity_type: a,
						join_type: 3,
						gift_id: u.$giftName.attr("data-id"),
						gift_num: s,
						lottery_range: o
					}
				}
				l.saveLuckDrawInfo(n, function(e, t) {
					2 === e ? l.changeDrawType("ready") : 1 === e ? l.changeDrawType("audit") : l.showStatusCheck(t || "提交失败")
				})
			},
			submitStartLuck: function() {
				var t = this,
					i = t.vars,
					a = t.doms;
				a.gift;
				t.startLuckDraw(function() {
					t.hideDrawDlg(), i.luckStatus = "start", t.removeAllBoxStatus(), a.$start.text("提交"), a.$reset.text("重置"), a.$reset.show(), t.showStatusCheck(), a.$input.attr("readonly", !1), a.$giftList.hide(), t.hideLimitList(), e.dialog.tips_black("抽奖活动已开启")
				})
			},
			saveLuckDrawInfo: function(e, t) {
				this.sendAjax(m.urls.saveDrawInfo, e, function(e, i) {
					return e ? void t(3, e) : void t(+i.data.status)
				}, "POST")
			},
			getLuckEnter: function(e) {
				this.sendAjax(m.urls.luckEnter, {}, function(t, i) {
					t || e(i.data)
				})
			},
			getOfficeGift: function(t, i) {
				return t ? void this.sendAjax(m.urls.officeGift, {}, function(t, a) {
					if (t) return void e.dialog.tips_black(t);
					var n = a.data;
					i(0 == n.join_type ? {
						prize_name: n.prize_name,
						official_prize_id: n.official_prize_id,
						prize_left_num: n.prize_left_num,
						prize_img: n.prize_img,
						join_type: n.join_type
					} : 1 == n.join_type ? {
						prize_name: n.prize_name,
						official_prize_id: n.official_prize_id,
						prize_left_num: n.prize_left_num,
						prize_img: n.prize_img,
						join_type: n.join_type,
						command_content: n.join_condition.command_content
					} : {
						prize_name: n.prize_name,
						official_prize_id: n.official_prize_id,
						prize_left_num: n.prize_left_num,
						prize_img: n.prize_img,
						join_type: n.join_type,
						gift_id: n.join_condition.gift_id,
						is_invalid: n.join_condition.is_invalid,
						gift_num: n.join_condition.gift_num,
						gift_name: n.join_condition.gift_name,
						gift_price: n.join_condition.gift_price
					})
				}) : void i("")
			},
			getNowLuckDrawInfo: function(t) {
				this.sendAjax(m.urls.nowLuckDrawInfo, {
					room_id: this.vars.room_id,
					t: (new Date).getTime()
				}, function(i, a) {
					return i ? void e.dialog.tips_black(i) : void t(a)
				})
			},
			startLuckDraw: function(t) {
				this.sendAjax(m.urls.startLuckDraw, {}, function(i, a) {
					return i ? void e.dialog.tips_black(i) : void t(a)
				}, "POST")
			},
			getRoomActInfo: function(t) {
				this.sendAjax(m.urls.getActInfo, {}, function(i, a) {
					if (i) return void e.dialog.tips_black(i);
					var n = a.data;
					return 0 !== +n.status ? void e.dialog.tips_black(n.start_info) : void t(a)
				})
			},
			resetLuckDraw: function(t) {
				this.sendAjax(m.urls.resetDraw, {}, function(i, a) {
					return i ? void e.dialog.tips_black(i) : void t(a)
				}, "POST")
			},
			endLuckDraw: function() {
				this.sendAjax(m.urls.endLuckDraw, {}, function(t, i) {
					return t ? (o.exe("js_luckdraw_end_fail"), void e.dialog.tips_black(t)) : void 0
				}, "POST")
			},
			getGiftList: function(e) {
				this.sendAjax(m.urls.getGiftList, {}, function(t, i) {
					return t ? void e([]) : void e(i.data || [])
				})
			},
			initLimitList: function() {
				var e = this,
					t = this.doms;
				t.$limitScope.text("全部水友"), t.$limitScope.attr("data-val", 0), e.clearScopeLimitCur(), t.$limitList.find(".item").eq(0).addClass("scopeCur"), t.$limitTime.text(5), t.$limitTime.attr("data-val", 300), e.clearTimeLimitCur(), t.$limitList.find(".col").eq(4).addClass("cur")
			},
			renderLimitList: function(e, t) {
				var i = this,
					a = this.doms;
				e = void 0 === e ? 0 : e;
				var n = parseInt(e),
					s = ["全部水友", "关注我的水友", "我的粉丝团水友", "关注我且加入粉丝团"];
				if (a.$limitScope.text(s[n]), a.$limitScope.attr("data-val", n), i.clearScopeLimitCur(), a.$limitList.find('.item[data-val="' + n + '"]').addClass("scopeCur"), 2 === arguments.length) {
					t = void 0 === t ? 300 : t;
					var r = parseInt(t),
						o = r / 60;
					a.$limitTime.text(o), a.$limitTime.attr("data-val", r), i.clearTimeLimitCur(), a.$limitList.find('.col[data-val="' + r + '"]').addClass("cur")
				}
			},
			hideLimitList: function() {
				var e = this.doms;
				e.$limitList.hide(), e.$box.find(".arrow-up").removeClass("arrow-up")
			},
			clearTimeLimitCur: function() {
				var e = this.doms;
				e.$limitList.find(".col").removeClass("cur")
			},
			clearScopeLimitCur: function() {
				var e = this.doms;
				e.$limitList.find(".item").removeClass("scopeCur")
			},
			getOfficialDefaultPic: function() {
				var e = r.get("sys.web_url");
				return e + "app/douyu/res/page/room-normal/draw/officialGiftDeffault.png"
			},
			sendAjax: function(e, t, i, a) {
				if (!e) return void i("请求路径配置错误");
				var n = this,
					s = a || "GET",
					r = {
						url: e,
						type: s,
						dataType: "json",
						data: t || {}
					};
				"POST" === s ? g.getCSRFCookie(function(e) {
					r.data[e.name] = e.value, n.sendRequest(r, i)
				}) : n.sendRequest(r, i)
			},
			sendRequest: function(t, i) {
				var a = function(e) {
						0 !== +e.error ? i(e.msg) : i(null, e)
					},
					n = function(e) {
						i(e)
					},
					s = e.extend(t, {
						success: a,
						error: n
					});
				e.ajax(s)
			}
		};
	o.reg("room_draw_end", function(t) {
		var i = JSON.parse(t),
			a = i.light;
		if (a) return void v.endLuckDraw();
		var n;
		n = i.pNum > 0 ? l.string.join("<h3>确定结束抽奖？</h3>", "<p>结束后，系统将从已参与的<span>", i.pNum, "名</span>水友中抽取满足条件的用户，来获得奖品</p>") : l.string.join("<h3>确定结束抽奖？</h3>", "<p>当前还没有人参与抽奖</p>"), m.dyDlgHand && m.dyDlgHand.hide(), m.dyDlgHand = e.dy_dialog(n, {
			className: "shark-ui-confirm luck-draw luck-draw-end-dlg",
			mask: !0,
			zIndex: 502,
			buttons: [{
				content: "结束抽奖",
				callback: function() {
					this.hide(), v.endLuckDraw()
				}
			}, {
				content: "再看看",
				callback: function() {
					this.hide()
				}
			}]
		})
	}), o.reg("room_draw_copy_command", function(i) {
		return c.check() ? (t.trigger("mod.msg.luckDraw.info", {
			type: "dcc"
		}), void(m.doms.$copy ? m.doms.$copy.val(i) : m.doms.$copy = e('#js-send-msg [data-type="cont"]').val(i))) : void c.show("login")
	}), o.reg("room_draw_send_gift", function(i) {
		if (!c.check()) return void c.show("login");
		t.trigger("mod.msg.luckDraw.info", {
			type: "dsg"
		});
		var a = JSON.parse(i),
			n = a.id,
			s = +a.num,
			r = a.rebate;
		d.getGift().done(function(i) {
			return m.giftConfigData = i || {}, m.giftConfigData[n] ? g.countBalance(+n, s) ? (m.dyDlgHand && m.dyDlgHand.hide(), void(m.dyDlgHand = e.dy_dialog("当前余额不足，请充值后再进行操作~", {
				className: "shark-ui-confirm luck-draw",
				mask: !0,
				zIndex: 502,
				buttons: [{
					content: "确认",
					callback: function() {
						this.hide()
					}
				}]
			}))) : void(s > 0 && (s > 1 ? f.render().done(function() {
				var i = e('#gift-content [data-type=gift][data-giftid="' + n + '"]'),
					a = i.data("send") || 0;
				if (1 == a) {
					if (m.delayGiftQueue) {
						m.delayGiftQueue = !1;
						var o = setTimeout(function() {
							m.delayGiftQueue = !0, clearTimeout(o), o = null
						}, 300);
						if (r) {
							if (m.rebateQueueFlag) return;
							m.rebateQueueFlag = !0
						}
						var l = 0,
							c = setInterval(function() {
								return r && !m.drawIsStarting ? (clearInterval(c), c = null, void(m.rebateQueueFlag = !1)) : (t.trigger("mod.gift.draw.batch.send", {
									target: i,
									number: 1,
									batch: 1
								}), l++, void(l >= s && (clearInterval(c), c = null, r && (m.rebateQueueFlag = !1))))
							}, 300)
					}
				} else 2 == a && t.trigger("mod.gift.draw.batch.send", {
					target: i,
					number: s,
					batch: 1
				})
			}) : f.render().done(function() {
				var i = e('#gift-content [data-type=gift][data-giftid="' + n + '"]');
				t.trigger("mod.gift.draw.batch.send", {
					target: i,
					number: 1,
					batch: 1
				})
			}))) : void 0
		})
	}), o.reg("room_follow", function() {
		t.trigger("mod.room.msg.follow")
	}), o.reg("room_draw_join", function(e) {
		var t = g.hasJoinDraw(e);
		o.exe("js_draw_join", {
			activityId: e,
			status: t ? 1 : 0
		})
	}), o.reg("room_draw_status", function(e, t) {
		if (t) m.flashDrawBtnIsClose[e] = !0;
		else {
			var i = g.hasJoinDraw(e);
			if (!i) {
				var a = s.get("drawJoinArray"),
					n = a ? JSON.parse(a) : [];
				n.length >= 15 && n.shift(), n.push({
					activityId: e,
					status: 1,
					timestap: (new Date).getTime()
				}), s.set("drawJoinArray", JSON.stringify(n)), m.hasJoinDrawCache[e] = !0
			}
		}
	}), o.reg("room_rebate_end", function(e) {
		m.rebateInfoEnd = e
	}), t.on("room.giftprop.send.success.drawrebate", function(e) {
		o.exe("js_rebate_send_back", {
			gid: e
		})
	}), t.on("mod.msg.luckDraw.info", function(e) {
		"memberinfores" === e.type && ("1" != e.rafst && "1" != e.rafst_v2 || (m.drawIsStarting = !0))
	}), o.reg("room_data_handler", function(i) {
		var n = a.decode(i).too();
		switch (n.type) {
		case "lde":
		case "lde_v2":
			m.drawIsStarting = !1, t.trigger("mod.msg.luckDraw.info", n);
			var s = n.end_type;
			if (!s || 1 !== +s) return m.dyDlgHand && m.dyDlgHand.hide(), void(m.dyDlgHand = e.dy_dialog("服务器开了一会儿小差，抽奖终止", {
				className: "shark-ui-confirm luck-draw",
				mask: !0,
				zIndex: 502,
				buttons: [{
					content: "确认",
					callback: function() {
						this.hide()
					}
				}]
			}));
			var o = g.isAnchor(),
				l = g.isWinner(JSON.parse(n.win_list)),
				c = g.hasJoinDraw(n.activity_id);
			if (!o && "3" !== n.join_type && !l && !c && m.flashDrawBtnIsClose[n.activity_id]) return;
			g.getAdsFromActivity(function(e) {
				var t = g.resolveUserList({
					list: JSON.parse(n.win_list),
					join: n.join_count,
					name: n.gift_name,
					gift: n.gift_count,
					prize: n.prize_name,
					img: n.prize_img,
					time: n.join_time,
					fans: n.fans_count || 0,
					follow: n.follow_count || 0,
					lotteryRange: n.lottery_range || 0,
					activityId: n.activity_id || 0,
					activityType: n.activity_type || 0,
					prizeType: n.prize_type || -1,
					adListIndex: JSON.parse(n.ad_list),
					adListContent: e.lottery_setting || {},
					joinType: n.join_type,
					rebateInfo: m.rebateInfo,
					rebateInfoEnd: m.rebateInfoEnd
				});
				if (o || l || c || m.rebateInfoEnd && m.rebateInfoEnd.cost > 0) v.showEndDlg(t);
				else {
					v.showEndDlg(t);
					var i = setTimeout(function() {
						v.removeLastDialog(), m.rebateInfoEnd = null, clearTimeout(i)
					}, 5e3)
				}!o && m.rebateInfo && m.rebateInfoEnd && v.bindRebateEvent()
			});
			break;
		case "lda":
			var d = n.is_pass,
				u = n.remark; + d ? v.changeDrawType("ready") : v.changeDrawType("failed", u), v.showCheckBox(0, +d);
			break;
		case "lds":
		case "lds_v2":
			m.drawIsStarting = !0, t.trigger("mod.msg.luckDraw.info", n), v.hideDrawDlg();
			var f = r.get("room.owner_name");
			v.removeLastDialog(), m.rebateInfoEnd = null, g.sendNotice("start", {
				anchorName: f
			});
			break;
		case "ldt":
			var p = +n.tips_type;
			1 === p ? (m.dyDlgHand && m.dyDlgHand.hide(), m.dyDlgHand = e.dy_dialog("抽奖活动会于5分钟后结束，请及时开启抽奖，<br>不要让水友等太久哟~", {
				className: "shark-ui-confirm luck-draw",
				mask: !0,
				zIndex: 502,
				buttons: [{
					content: "确认",
					callback: function() {
						this.hide()
					}
				}]
			})) : 2 === p && (m.dyDlgHand && m.dyDlgHand.hide(), m.dyDlgHand = e.dy_dialog("主播离开一会儿，抽奖活动正常进行~", {
				className: "shark-ui-confirm luck-draw",
				mask: !0,
				zIndex: 502,
				buttons: [{
					content: "确认",
					callback: function() {
						this.hide()
					}
				}]
			}));
			break;
		case "drbm":
			t.trigger("mod.chat.msg.send.cd", n.cd);
			break;
		case "ld_ra":
			if (m.rebateInfoEnd) {
				var h = {};
				h.nickname = n.nn, h.box_id = n.boxid, h.box_name = n.bn, h.award_count = n.ac, h.anchor_name = n.an;
				var y = v.rebateTipIndex,
					b = m.rebateInfoEnd.lucky_notice;
				b.length < 10 ? b.push(h) : (b.splice(y % b.length + 1, 0, h), b.splice(y % b.length - 1, 1), v.rebateTipIndex--)
			}
		}
	});
	var y = {
		init: function() {
			this.hasTipsReady() ? e(".flexslider").show() : this.render()
		},
		hasTipsReady: function() {
			return e(".flexslider").length > 0
		},
		render: function() {
			var t = r.get("sys.web_url"),
				i = '<div class="flexslider luckFlexSilder"><ul class="slides"><li><img src="' + t + 'app/douyu/res/page/room-normal/luckdraw-tips/1.png?20170914" /></li><li><img src="' + t + 'app/douyu/res/page/room-normal/luckdraw-tips/2.png?20170914" /></li><li><img src="' + t + 'app/douyu/res/page/room-normal/luckdraw-tips/3.png?20170914" /></li><li><img src="' + t + 'app/douyu/res/page/room-normal/luckdraw-tips/4.png?20170914" /></li></ul><div class="startLuckDraw"></div><div class="closeLuckDraw"></div></div>';
			e("body").append(i), s.set("firstLuckDraw", 1), e(".flexslider").flexslider({
				animation: "slide",
				animationLoop: !1,
				prevText: "",
				nextText: "",
				keyboard: !1,
				before: function(t) {
					2 == t.currentSlide && "next" == t.direction ? (e(".flexslider").find(".flex-control-nav").hide(), e(".flexslider").find(".startLuckDraw").show()) : (e(".flexslider").find(".flex-control-nav").show(), e(".flexslider").find(".startLuckDraw").hide())
				}
			}), this.bindEvent()
		},
		bindEvent: function() {
			var t = e(".flexslider");
			t.on("click", ".closeLuckDraw", function() {
				t.remove()
			}), t.on("click", ".startLuckDraw", function() {
				t.remove(), v.doms.$box && v.doms.$box.is(":visible") || v.checkActStatus()
			})
		}
	};
	return {
		init: function() {
			v.init()
		}
	}
}), define("douyu/page/room/normal/mod/intimate-task-assembly", ["jquery", "shark/util/template/2.0", "shark/util/flash/data/1.0", "douyu/context"], function(e, t, i, a) {
	function n(t) {
		this.word = "", this.status = "default", e.extend(this, t), this.checkStu(), this.$tag = e(o(this))
	}
	var s = {
		type: function(e) {
			return Object.prototype.toString.call(e).slice(8, -1).toLowerCase()
		},
		join: function() {
			return Array.prototype.join.call(arguments, "")
		}
	},
		r = ["intimate-stu-edit", "intimate-stu-select", "intimate-stu-audit", "intimate-stu-success", "intimate-stu-failed"].join(" "),
		o = function() {
			var e = s.join('<div class="intimate-task-word {{ _initcls }}" data-name="{{ task_name }}" data-type="{{ recommend_type ? recommend_type : 0 }}" data-id="{{ id }}" data-status="default">', "{{ task_name }}", '<i class="intimate-task-close"></i>', '<div class="itt-audit">审核中', "<i></i>", "</div>", '<div class="itt-success">已通过', "<i></i>", "</div>", '<div class="itt-failed">未通过', "<i></i>", "</div>", "</div>");
			return t.compile(e)
		}();
	return n.prototype = {
		constructor: n,
		checkStu: function() {
			switch ("" + this.status) {
			case "0":
				this.status = "audit", this._initcls = "intimate-stu-audit";
				break;
			case "1":
				+this.sign ? (this.status = "success", this._initcls = "intimate-stu-success") : this.status = "default";
				break;
			case "2":
				this.status = "failed", this._initcls = "intimate-stu-failed";
				break;
			default:
				this.status = "default", this._initcls = ""
			}
		},
		setStatus: function(e) {
			if ("string" === s.type(e) && ("audit" !== this.status || "edit" !== e)) switch (this.lastStatus = this.status, e) {
			case "edit":
				this.setToEdit();
				break;
			case "select":
				this.setToSelect();
				break;
			case "audit":
				this.setToAudit();
				break;
			case "success":
				this.setToSuccess();
				break;
			case "failed":
				this.setToFailed();
				break;
			default:
				this.setToDefault()
			}
		},
		setToSelect: function() {
			this.status = "select", this.$tag.removeClass(r).addClass("intimate-stu-edit intimate-stu-select").attr("data-status", "select")
		},
		setToEdit: function() {
			this.status = "edit", this.$tag.removeClass(r).addClass("intimate-stu-edit").attr("data-status", "edit")
		},
		setToAudit: function() {
			this.status = "audit", this.$tag.removeClass(r).addClass("intimate-stu-audit").attr("data-status", "audit")
		},
		setToSuccess: function() {
			this.status = "success", this.$tag.removeClass(r).addClass("intimate-stu-success").attr("data-status", "success")
		},
		setToFailed: function() {
			this.status = "failed", this.$tag.removeClass(r).addClass("intimate-stu-failed").attr("data-status", "failed")
		},
		setToDefault: function() {
			this.status = "default", this.$tag.removeClass(r).attr("data-status", "default")
		}
	}, n
}), define("douyu/page/room/normal/mod/intimate-task-rank", ["jquery", "shark/observer", "shark/util/template/2.0", "shark/util/lang/1.0", "douyu/context"], function(e, t, i, a, n) {
	var s = {
		vars: {
			web_url: n.get("sys.web_url"),
			avatar_domain: n.get("sys.avatar_url")
		},
		waitSubmit: !1,
		dealUserIcon: function(e) {
			return e ? a.string.format("{0}upload/{1}_middle.jpg", s.vars.avatar_domain, e) : a.string.format("{0}/app/douyu/res/com/defaultAvatar.png?20161229", s.vars.web_url)
		},
		dealPlanIcon: function(e) {
			return e ? e : a.string.format("{0}/app/douyu/res/com/defaultAvatar.png?20161229", s.vars.web_url)
		},
		dealNickName: function(e) {
			return e ? e : "虚位以待"
		},
		isInteger: function(e) {
			var t = parseFloat(String(e));
			return t >= 0 && Math.floor(t) === t && isFinite(e)
		},
		returnType: function(e) {
			for (var t = [null, void 0], i = 0; i < t.length; i++) if (e == t[i]) return e;
			return Object.prototype.toString.call(e).slice(8, -1).toLowerCase()
		},
		dealEnduranceValue: function(e) {
			return s.isInteger(e) ? e : "--"
		},
		dealCaptureCount: function(e) {
			return s.isInteger(e) ? e + "次" : "--"
		},
		dealTrickInfo: function(e) {
			return e && e.uid ? e : {}
		},
		dealRenderLists: function(e) {
			e = "array" === s.returnType(e) ? e : [];
			for (var t = {
				room_id: "",
				uid: "",
				nickname: "",
				avatar_url: "",
				amount: "",
				capture_num: "",
				rank: ""
			}, i = [], a = 0; 50 > a; a++) {
				var n = e[a];
				n ? i[a] = n : i[a] = t
			}
			return i
		},
		dealPlanLists: function(e) {
			var t, i = e.length;
			for (t = 0; i > t; t++) {
				var a = e[t],
					n = a.gift_num_get,
					r = a.gift_num;
				s.isInteger(n) && s.isInteger(r) && n > r && (a.gift_num_get = a.gift_num)
			}
			return e
		},
		dealGiftName: function(e) {
			return e ? e : "火箭"
		},
		sendAjax: function(t, i) {
			var a = this,
				n = {
					url: "",
					type: "GET",
					data: {},
					dataType: "JSON",
					success: null,
					error: null,
					complete: function() {
						a.waitSubmit = !1
					}
				},
				s = e.extend(!0, n, t),
				r = s.success,
				o = s.error;
			r && (s.success = function() {
				a.waitSubmit = !1, r.apply(window, arguments)
			}), o && (s.error = function() {
				a.waitSubmit = !1, o.apply(window, arguments)
			}), s.url && (!i && a.waitSubmit || (a.waitSubmit = !0, e.ajax(s)))
		}
	},
		r = {
			doms: {},
			urls: {
				rankList: "/lapi/interact/anchorTask/rankList",
				playingRoomList: "/member/anchor_task/playing_room_list"
			},
			data: {
				type: 1,
				current_page: 1,
				roomInfo: null,
				trickInfo: null,
				enduranceList: [],
				trickList: [],
				arrangeList: [],
				yesterdayInfo: null
			},
			init: function() {},
			bindEvents: function() {
				var t = this;
				this.doms.$intimateTaskRank.on("click", ".intimate-header-tab li", function() {
					var i = t.data.type,
						a = e(this).attr("data-type");
					i != a && (t.data.type = a, t.toggleActiveTab(), t.toggleLists())
				}), this.doms.$intimateTaskRank.on("click", ".rl-content-3 .ranking-plan-btn", function() {
					t.getData(t.renderInitPlan)
				}), this.doms.$intimateTaskRank.on("click", ".it-close-btn", function() {
					t.closeRank()
				})
			},
			toggleActiveTab: function() {
				var e = ".tab-cell-" + this.data.type,
					t = this.doms.$headerTab;
				t.find(".tab-cell").removeClass("active"), t.find(e).addClass("active"), this.toggleTabDiviShow()
			},
			toggleTabDiviShow: function() {
				var e = r.data.type,
					t = this.doms.$headerTab;
				t.find(".divi-line").removeClass("active"), 1 == e ? t.find(".divi-line-two").addClass("active") : 3 == e && t.find(".divi-line-one").addClass("active")
			},
			getTabActive: function(e) {
				return r.data.type == e ? "active" : ""
			},
			getTabDiviActive: function(e) {
				var t = r.data.type;
				return 1 == t ? 1 == e ? "" : "active" : 2 == t ? "" : 1 == e ? "active" : ""
			},
			ifTopThree: function(e, t) {
				return e = s.isInteger(e) ? e : t + 1, s.isInteger(e) && 4 > e ? "active" : ""
			},
			ifCurrentAnchor: function(e) {
				return e.room_id == $ROOM.room_id ? "active" : ""
			},
			ifEvenCell: function(e) {
				return 1 & e ? "even-cell" : "odd-cell"
			},
			getRoomLink: function(e) {
				return s.isInteger(e) ? location.origin + "/" + e : "javascript:;"
			},
			dealRankNumber: function(e, t) {
				return s.isInteger(e) ? e : t + 1
			},
			calcScheduleInnerWidth: function(e, t) {
				if (s.isInteger(e.gift_num_get) && s.isInteger(e.gift_num) && e.gift_num > 0) {
					var i = e.gift_num_get / e.gift_num,
						a = parseInt(t * i, 10);
					return a = a > 0 ? a : 0, a = a > t ? t : a, "width: " + a + "px"
				}
				return ""
			},
			showRank: function() {
				this.getDoms(), this.doms.$intimateTaskRank.length < 1 ? this.renderMyBox() : this.refreshMyBox()
			},
			closeRank: function() {
				this.resetData(), this.doms.$intimateTaskRank.hide()
			},
			renderMyBox: function() {
				var e = this;
				this.renderPopup(function() {
					e.renderRankHeader(), e.renderHeaderTab(), e.getData(e.renderInitData), e.bindEvents()
				})
			},
			refreshMyBox: function() {
				this.doms.$intimateTaskRank.show(), this.toggleActiveTab(), this.toggleLists()
			},
			renderPopup: function(t) {
				var n = this,
					s = a.string.join('<div class="intimate-task-rank">', '<div class="it-close-btn"></div>', '<div class="intimate-rank-header">', '<div class="intimate-header-anchor"></div>', '<div class="intimate-header-tab"></div>', "</div>", '<div class="intimate-rank-body">', '<div class="rl-content-1 rl-content"></div>', '<div class="rl-content-2 rl-content"></div>', '<div class="rl-content-3 rl-content"></div>', "</div>", "</div>"),
					r = i.compile(s);
				e("body").append(r()), n.getDoms(), t && t()
			},
			getDoms: function() {
				var t = this.doms;
				t.$intimateTaskRank = e(".intimate-task-rank"), t.$rankHeader = e(".intimate-rank-header"), t.$headerAnchor = e(".intimate-header-anchor"), t.$headerTab = e(".intimate-header-tab"), t.$rankBody = e(".intimate-rank-body"), t.$rankContentCell = e(".rl-content")
			},
			renderRankHeader: function() {
				var e = a.string.join('<div class="anchor-info-wrap">', '<img class="anchor-avatar" src="{{dealUserIcon(roomInfo.avatar_url)}}"/>', '<div class="anchor-info">', '<div class="anchor-rank">', '<span class="anchor-rank-num inline-ellipsis">{{dealEnduranceValue(roomInfo.rank)}}</span>排名', "</div>", '<p class="anchor-name inline-ellipsis">{{dealNickName(roomInfo.nickname)}}</p>', '<p class="anchor-accout inline-ellipsis">耐力值:<span class="anchor-endurance-accout">{{dealEnduranceValue(roomInfo.amount)}}</span></p>', "</div>", "</div>", '<p class="fire-king-wrap">', '<span class="king-icon"></span>', '<span class="king-nick inline-ellipsis">{{dealNickName(trickInfo.nickname)}}</span>', '<span class="fire-count-wrap inline-ellipsis">输出:<span class="fire-count">{{dealEnduranceValue(trickInfo.amount)}}</span></span>', "</p>"),
					t = i.compile(e);
				this.doms.$headerAnchor.html(t({
					dealUserIcon: s.dealUserIcon,
					dealEnduranceValue: s.dealEnduranceValue,
					dealNickName: s.dealNickName,
					roomInfo: {},
					trickInfo: {}
				})), this.getHeaderDoms()
			},
			getHeaderDoms: function() {
				var t = this.doms;
				t.$HDAnchorIcon = e(".intimate-rank-header .anchor-avatar"), t.$HDAnchorRank = e(".intimate-rank-header .anchor-rank-num"), t.$HDAnchorName = e(".intimate-rank-header .anchor-name"), t.$HDAnchorAccout = e(".intimate-rank-header .anchor-endurance-accout"), t.$HDKingNick = e(".intimate-rank-header .king-nick"), t.$HDKingAccout = e(".intimate-rank-header .fire-count")
			},
			renderRankHeaderData: function() {
				var e = this.doms,
					t = this.data,
					i = t.roomInfo || {},
					a = t.trickInfo || {};
				e.$HDAnchorIcon.attr("src", s.dealUserIcon(i.avatar_url)), e.$HDAnchorRank.text(s.dealEnduranceValue(i.rank)), e.$HDAnchorName.text(s.dealNickName(i.nickname)), e.$HDAnchorAccout.text(s.dealEnduranceValue(i.amount)), e.$HDKingNick.text(s.dealNickName(a.nickname)), e.$HDKingAccout.text(s.dealEnduranceValue(a.amount))
			},
			renderHeaderTab: function() {
				var e = a.string.join("<ul>", '<li class="tab-cell tab-cell-1" data-type="1">小姐姐耐力榜</li>', '<li class="tab-cell tab-cell-2" data-type="2">整蛊小分队</li>', '<li class="tab-cell tab-cell-3" data-type="3">正在被安排</li>', "</ul>", '<span class="divi-line divi-line-one"></span>', '<span class="divi-line divi-line-two"></span>'),
					t = i.compile(e);
				this.doms.$headerTab.html(t()), this.toggleActiveTab()
			},
			renderInitData: function(e) {
				var t = this.data;
				t.roomInfo = e.room_info || {}, t.trickInfo = s.dealTrickInfo(e.trick_info), t.enduranceList = s.dealRenderLists(e.list || []), t.yesterdayInfo = e.yesterday_info || {}, this.renderRankHeaderData(), this.renderEnduranceList()
			},
			renderEnduranceList: function() {
				var e = this,
					t = a.string.join('<div class="ranking-list-wrap">', '<div class="yesterday-top">', '<a class="yesterday-link-wrap" href="{{getRoomLink(yesterdayInfo.room_id)}}" target="_blank">', '<img class="yesterday-anchor-icon" src="{{dealUserIcon(yesterdayInfo.avatar_url)}}"/>', '<span class="yesterday-anchor-name inline-ellipsis">{{dealNickName(yesterdayInfo.nickname)}}</span>', "</a>", '<p class="yesterday-anchor-msg">*每日24点产生耐力榜第一名</p>', "</div>", '<div class="ranking-list ranking-anchor-list">', '<div class="ranking-header">', '<span class="ranking-header-cell ranking-header-cell-rank">排名</span>', '<span class="ranking-header-cell ranking-header-cell-anchor">主播</span>', '<span class="ranking-header-cell ranking-header-cell-num">耐力值', '<span class="ranking-header-cell-icon">', '<span class="ranking-cell-triangle"></span>', '<span class="ranking-cell-state">', '主播喷喷任务,每收到<span class="ranking-cell-highlight">1鱼翅礼物,</span>', '提升主播<span class="ranking-cell-highlight">10点耐力值</span>', "</span>", "</span>", "</span>", '<span class="ranking-header-cell ranking-header-count">攻陷次数</span>', "</div>", "<ul>", "{{ each renderList }}", '<li class="rank-list-cell {{ifEvenCell($index)}}">', '<a class="rank-list-cell-link" href="{{getRoomLink($value.room_id)}}" target="_blank">', '<span class="rank-cell cell-rank-wrap"><span class="cell-rank {{ifTopThree($value.rank, $index)}}">{{dealRankNumber($value.rank, $index)}}</span></span>', '<span class="rank-cell cell-anchor-info inline-ellipsis {{ifCurrentAnchor($value)}}">', '<img class="cell-anchor-icon" src="{{dealUserIcon($value.avatar_url)}}"/>{{dealNickName($value.nickname)}}', "</span>", '<span class="rank-cell cell-endurance inline-ellipsis">{{dealEnduranceValue($value.amount)}}</span>', '<span class="rank-cell cell-capture-count inline-ellipsis">{{dealCaptureCount($value.capture_num)}}</span>', "</a>", "</li>", "{{ /each }}", "</ul>", "</div>", "</div>"),
					n = i.compile(t);
				e.doms.$rankBody.find(".rl-content-1").html(n({
					dealNickName: s.dealNickName,
					dealUserIcon: s.dealUserIcon,
					dealEnduranceValue: s.dealEnduranceValue,
					dealCaptureCount: s.dealCaptureCount,
					renderList: e.data.enduranceList,
					ifTopThree: e.ifTopThree,
					ifEvenCell: e.ifEvenCell,
					ifCurrentAnchor: e.ifCurrentAnchor,
					yesterdayInfo: e.data.yesterdayInfo,
					getRoomLink: e.getRoomLink,
					dealRankNumber: e.dealRankNumber
				})), e.doms.$rankBody.find(".ranking-anchor-list ul").mCustomScrollbar()
			},
			resetData: function() {
				this.data = {
					type: 1,
					current_page: 1,
					roomInfo: null,
					trickInfo: null,
					enduranceList: [],
					trickList: [],
					arrangeList: [],
					yesterdayInfo: null
				}
			},
			getAjaxConfig: function() {
				var e = this.urls.rankList,
					t = this.urls.playingRoomList,
					i = this.data.type,
					a = this.data.current_page,
					n = {
						url: e,
						data: {
							room_id: $ROOM.room_id,
							uid: $ROOM.owner_uid,
							type: 1
						}
					};
				return 2 == i ? n.data.type = 2 : 3 == i && (n = {
					url: t,
					data: {
						room_id: $ROOM.room_id,
						uid: $ROOM.owner_uid,
						page: a
					}
				}), n
			},
			getData: function(t) {
				var i = this,
					a = {
						url: "",
						data: "",
						type: "GET",
						dataType: "JSON",
						success: function(e) {
							0 == e.error && e.data ? t && t.call(i, e.data) : t && t.call(i, {})
						}
					};
				a = e.extend(!0, a, i.getAjaxConfig()), s.sendAjax(a)
			},
			renderInitTrick: function(e) {
				var t = this.data;
				t.roomInfo = e.room_info || {}, t.trickInfo = s.dealTrickInfo(e.trick_info), this.data.trickList = s.dealRenderLists(e.list || []), this.renderRankHeaderData(), this.renderTrickList()
			},
			toggleLists: function() {
				var e = this.data.type,
					t = this.doms.$rankBody;
				this.doms.$rankContentCell.hide(), 1 == e ? (t.find(".rl-content-1").show(), this.data.enduranceList.length < 1 && this.getData(this.renderInitData)) : 2 == e ? (t.find(".rl-content-2").show(), this.data.trickList.length < 1 && this.getData(this.renderInitTrick)) : (t.find(".rl-content-3").show(), this.data.arrangeList.length < 1 && this.getData(this.renderInitPlan))
			},
			getRenderTrickKing: function(e) {
				var t = "trick-king-icon-" + e,
					n = "";
				switch (e) {
				case 1:
					n = "整蛊大王";
					break;
				case 2:
					n = "整蛊勇士";
					break;
				case 3:
					n = "整蛊战士"
				}
				var s = a.string.join('<span class="trick-king-icon {{honorClass}}">{{honorText}}</span>'),
					r = i.compile(s);
				return r({
					honorClass: t,
					honorText: n
				})
			},
			addTrickHonor: function() {
				for (var e = this.data.trickList, t = e.length, i = 0; t > i; i++) {
					var a = e[i].rank;
					if (s.isInteger(a) && 4 > a) {
						var n = parseInt(a, 10) - 1;
						this.addHonorChild(n)
					}
				}
			},
			addHonorChild: function(e) {
				var t = this,
					i = t.doms.$rankBody.find(".ranking-user-list").find("li").eq(e).find(".cell-user-info");
				i.addClass("cell-user-info-king"), i.append(t.getRenderTrickKing(e + 1))
			},
			renderTrickList: function() {
				var e = this,
					t = a.string.join('<div class="ranking-list-wrap">', '<div class="ranking-list ranking-user-list">', '<div class="ranking-header">', '<span class="ranking-header-cell ranking-header-cell-rank">排名</span>', '<span class="ranking-header-cell ranking-header-cell-usernick">昵称</span>', '<span class="ranking-header-cell ranking-header-cell-num">火力输出', '<span class="ranking-header-cell-icon">', '<span class="ranking-cell-triangle trick-cell--triangle"></span>', '<span class="ranking-cell-state trick-cell-state">', '参与主播喷喷任务,每送出<span class="ranking-cell-highlight">1鱼翅礼物,</span>', '增加<span class="ranking-cell-highlight">10点火力</span>', "</span>", "</span>", "</span>", "</div>", "<ul>", "{{ each renderList }}", '<li class="rank-list-cell {{ifEvenCell($index)}}">', '<span class="rank-cell cell-rank-wrap"><span class="cell-rank {{ifTopThree($value.rank, $index)}}">{{dealRankNumber($value.rank, $index)}}</span></span>', '<span class="rank-cell cell-user-info">', '<img class="cell-anchor-icon" src="{{dealUserIcon($value.avatar_url)}}"/>', '<span class="cell-user-info-nick inline-ellipsis">{{dealNickName($value.nickname)}}</span>', "</span>", '<span class="rank-cell cell-firecount inline-ellipsis">{{dealEnduranceValue($value.amount)}}</span>', "</li>", "{{ /each }}", "</ul>", "</div>", "</div>"),
					n = i.compile(t);
				e.doms.$rankBody.find(".rl-content-2").html(n({
					dealNickName: s.dealNickName,
					dealUserIcon: s.dealUserIcon,
					dealEnduranceValue: s.dealEnduranceValue,
					dealCaptureCount: s.dealCaptureCount,
					renderList: e.data.trickList,
					ifTopThree: e.ifTopThree,
					ifEvenCell: e.ifEvenCell,
					ifCurrentAnchor: e.ifCurrentAnchor,
					yesterdayInfo: e.data.yesterdayInfo,
					dealRankNumber: e.dealRankNumber
				})), e.doms.$rankBody.find(".ranking-list ul").mCustomScrollbar(), e.addTrickHonor()
			},
			renderPlanBox: function(e) {
				var t = this,
					n = a.string.join('<div class="ranking-plan-wrap">', '<div class="ranking-plan-list"></div>', '<button class="ranking-plan-btn"></button>', "</div>"),
					s = i.compile(n);
				t.doms.$rankBody.find(".rl-content-3").html(s()), e && e.call(t)
			},
			renderPlanList: function() {
				var e = this,
					t = 148,
					n = a.string.join('<div class="plan-list-wrap">', "{{ each renderList }}", '<div class="plan-list-cell">', '<img class="plan-anchor-icon" src="{{dealPlanIcon($value.avatar_url)}}"/>', '<div class="plan-cell">', '<p class="plan-anchor-nick inline-ellipsis">{{$value.nickname}}</p>', '<div class="schedule-wrap" style="width: {{scheduleWrapWidth}}px">', '<div class="schedule-inner" style="{{calcScheduleInnerWidth($value, scheduleWrapWidth)}}"></div>', '<div class="schedule-text" style="width: {{scheduleWrapWidth}}px">{{dealGiftName($value.gift_name)}}&nbsp;{{$value.gift_num_get}}/{{$value.gift_num}}</div>', "</div>", "</div>", '<a class="plan-link" href="{{getRoomLink($value.room_id)}}" target="_blank">查房</a>', "</div>", "{{ /each }}", "</div>"),
					r = i.compile(n);
				e.doms.$rankBody.find(".ranking-plan-list").html(r({
					renderList: e.data.arrangeList,
					dealGiftName: s.dealGiftName,
					dealPlanIcon: s.dealPlanIcon,
					getRoomLink: e.getRoomLink,
					calcScheduleInnerWidth: e.calcScheduleInnerWidth,
					scheduleWrapWidth: t
				})), e.doms.$rankBody.find(".ranking-plan-list .plan-list-wrap").mCustomScrollbar()
			},
			renderInitPlan: function(t) {
				var i = this.data;
				i.roomInfo = t.room_info || {}, i.trickInfo = s.dealTrickInfo(t.trick_info), this.renderRankHeaderData();
				var a = t.room_data || {},
					n = s.isInteger(a.current_page) ? a.current_page : 0;
				i.current_page = n + 1, i.arrangeList = s.dealPlanLists(a.list || []), i.arrangeList.length < 1 ? this.renderPlanEmpty() : e(".rl-content-3 .ranking-plan-btn").length < 1 ? this.renderPlanBox(function() {
					this.renderPlanList()
				}) : this.renderPlanList()
			},
			renderPlanEmpty: function() {
				var e = a.string.join('<div class="no-plan-empty">', '<div class="empty-img"></div>', '<p class="empty-msg">找不到主播</p>', "</div>"),
					t = i.compile(e);
				this.doms.$rankBody.find(".rl-content-3").html(t())
			}
		};
	return r
}), define("douyu/page/room/normal/mod/intimate-task", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "shark/util/cookie/1.0", "shark/util/storage/1.0", "shark/util/flash/data/1.0", "douyu/context", "douyu/page/room/base/api", "douyu/com/exjsonp", "douyu/com/user", "douyu/com/get-gift-configs", "douyu/com/room-gift-tmp", "douyu/page/room/normal/mod/intimate-task-rank"], function(e, t, i, a, n, s, r, o, l, c, d, u, f, p) {
	var m = {
		waitSubmit: !1,
		crsf: "/curl/csrfApi/getCsrfCookie",
		getCSRFCookie: function(t) {
			var i = this,
				a = n.get(o.get("sys.tvk"));
			return a ? void(t && t({
				name: $SYS.tn,
				value: a
			})) : void e.ajax({
				url: i.crsf,
				type: "GET",
				dataType: "json",
				success: function(e) {
					0 === +e.error && i.getCSRFCookie(t)
				}
			})
		},
		sendAjax: function(t) {
			var i = this,
				a = {
					url: "",
					type: "GET",
					data: {},
					dataType: "JSON",
					success: null,
					error: null,
					complete: function() {
						i.waitSubmit = !1
					}
				},
				n = e.extend(!0, a, t);
			n.url && (i.waitSubmit || (i.waitSubmit = !0, "post" === n.type.toLowerCase() ? i.getCSRFCookie(function(t) {
				n.data[t.name] = t.value, e.ajax(n)
			}) : e.ajax(n)))
		}
	},
		h = {
			init: function() {
				this.hasTipsReady() ? e("#intimacy-task-userside-guide").show() : this.render()
			},
			hasTipsReady: function() {
				return e("#intimacy-task-userside-guide").length > 0
			},
			render: function() {
				var t = (o.get("sys.web_url"), '<div id="intimacy-task-userside-guide" class="flexslider"><ul class="slides"><li class="slides1"></li><li class="slides2"></li><li class="slides3"></li></ul><div class="inti-immediately-start">立即体验</div><div class="inti-close-guild"></div></div>');
				e("body").append(t), e("#intimacy-task-userside-guide").flexslider({
					animation: "slide",
					animationLoop: !1,
					prevText: "",
					nextText: "",
					keyboard: !1,
					before: function(t) {
						1 == t.currentSlide && "next" == t.direction ? (e("#intimacy-task-userside-guide").find(".flex-control-nav").hide(), e("#intimacy-task-userside-guide").find(".inti-immediately-start").show()) : (e("#intimacy-task-userside-guide").find(".flex-control-nav").show(), e("#intimacy-task-userside-guide").find(".inti-immediately-start").hide())
					}
				}), this.bindEvent()
			},
			bindEvent: function() {
				var t = e("#intimacy-task-userside-guide");
				t.off().on("click", ".inti-close-guild", function() {
					t.remove(), g.config.isPlayMethod && e("#userside-intimacy-task-box").show(), g.config.isPlayMethod = !1
				}).on("click", ".inti-immediately-start", function() {
					t.remove(), g.init(), g.config.isPlayMethod = !1
				})
			}
		},
		g = {
			ajaxUrls: {
				giftListUrl: o.get("sys.webconfUrl") + "resource/common/gift/gift_template/" + o.get("room.giftTempId") + ".json",
				taskListsUrl: "/member/anchor_task/get_intimate_task_setting",
				checkTaskNameUrl: "/member/anchor_task/invite_intimate_task_check",
				inviteTaskUrl: "/member/anchor_task/invite_intimate_task"
			},
			config: {
				roomId: parseInt(o.get("room.room_id"), 10),
				preAcceptTLArr: [],
				limitIntimateTaskPrice: {
					limit_price: .1
				},
				giftListObj: {},
				isPlayMethod: !1,
				clickIndex: 0,
				reTaskNameArr: [],
				tipText: {
					defaultPriceTip: "礼物总价值不得低于",
					limitPriceTip: "礼物价值需大于当前冠名",
					biddingBtn: "竞价",
					inviteBtn: "发出邀请"
				},
				isCompete: !1,
				biddingTask: ""
			},
			doms: {},
			init: function(t, i) {
				var a = e("#userside-intimacy-task-box");
				if (a.length > 0) a.show(), t && (this.setInitBiddingPage(i), this.isSameRecomTaskName(i), this.biddingUpdateGiftInfo(i), this.isduplicationOfName(i));
				else {
					var n = this.render();
					e("body").append(n), this.renderTaskListHtml.init(), this.renderLRGiftList.init(), this.bindEvent(), t && (this.config.isCompete = !0, this.setInitBiddingPage(i), this.config.biddingTask = i)
				}
			},
			bindEvent: function() {
				this.getDoms(), e(".spray-imt-active").length && t.trigger("dys", {
					key: "dys.room.energy.userActive.show"
				}), e(".spray-imt-active").on("click", function() {
					t.trigger("dys", {
						key: "dys.room.energy.userActive.click"
					})
				}), this.clickPlayMethodBtn(), this.clickCloseBtn(), this.clickRecomDelTaskBtn(), this.setDefinedTaskVal(), this.clickSendInviBtn(), this.ppAdd()
			},
			getDoms: function() {
				this.doms.$intimacyTaskBox = e("#userside-intimacy-task-box"), this.doms = e.extend(this.doms, {
					$intiPlayMethod: this.doms.$intimacyTaskBox.find(".inti-play-method"),
					$intiCloseBtn: this.doms.$intimacyTaskBox.find(".inti-close-btn"),
					$intiTaskDelete: this.doms.$intimacyTaskBox.find(".inti-task-delete"),
					$intiRecomTaskName: this.doms.$intimacyTaskBox.find(".inti-recommend-task-name"),
					$intiDefinedTask: this.doms.$intimacyTaskBox.find(".inti-user-defined-task"),
					$intiTaskName: this.doms.$intimacyTaskBox.find(".inti-task-name"),
					$intiErrorTip: this.doms.$intimacyTaskBox.find(".inti-error-tip"),
					$intiSendInviBtn: this.doms.$intimacyTaskBox.find(".inti-send-invitation-btn"),
					$intiGiftPriceTip: this.doms.$intimacyTaskBox.find(".inti-gift-price-tip"),
					$intiGiftPriceTipPre: this.doms.$intimacyTaskBox.find(".inti-gift-price-tip-pre"),
					$intiBiddingTip: this.doms.$intimacyTaskBox.find(".inti-bidding-tip"),
					$intiBiddingUsername: this.doms.$intimacyTaskBox.find(".inti-bidding-username"),
					$intiBiddingGiftname: this.doms.$intimacyTaskBox.find(".inti-bidding-gift-name"),
					$intiMinGiftPriceOrNum: this.doms.$intimacyTaskBox.find(".inti-min-gift-price"),
					$intiGiftPriceTipAfter: this.doms.$intimacyTaskBox.find(".inti-gift-price-tip-after")
				})
			},
			setInitBiddingPage: function(e) {
				this.doms.$intiDefinedTask.val(e), this.doms.$intiErrorTip.addClass("active")
			},
			biddingUpdateGiftInfo: function(e) {
				var t = this.matchBiddingListInfo(e);
				if (t) {
					var i = t.gift_id,
						a = t.gift_num;
					this.updateGiftInfo(i, a)
				}
			},
			clickPlayMethodBtn: function() {
				var e = this;
				this.doms.$intiPlayMethod.off().on("click", function() {
					e.config.isPlayMethod = !0, e.isShowThisBox("hide"), h.init()
				})
			},
			isShowThisBox: function(e) {
				"show" === e.toLowerCase() ? this.doms.$intimacyTaskBox.show() : this.doms.$intimacyTaskBox.hide()
			},
			clickCloseBtn: function() {
				var e = this;
				e.doms.$intiCloseBtn.off().on("click", function() {
					e.isShowThisBox("hide")
				})
			},
			ppAdd: function() {
				var e = this;
				e.doms.$intimacyTaskBox.on("click", ".J-task-pp", function(e) {
					p.showRank()
				})
			},
			clickRecomDelTaskBtn: function() {
				var t = this;
				t.doms.$intiTaskDelete.off().on("click", function() {
					t.setTaskNameShowState(2, ""), e("#userside-intimacy-task-box").find(".inti-task-list-name").eq(t.config.clickIndex).removeClass("active").data("state", 1), t.setBiddingTip(!1)
				})
			},
			setTaskNameShowState: function(e, t) {
				1 === e ? (this.doms.$intiRecomTaskName.removeClass("active"), this.doms.$intiDefinedTask.addClass("active").val(""), this.doms.$intiTaskName.text(t), this.doms.$intiErrorTip.addClass("active")) : (this.doms.$intiRecomTaskName.addClass("active"), this.doms.$intiDefinedTask.removeClass("active"))
			},
			setDefinedTaskVal: function() {
				var t = this;
				this.doms.$intiDefinedTask.off().on("keyup keydown change input keypress", function() {
					for (var t = e(this).val(), i = t.length, a = /^[\u4e00-\u9fa5]$/, n = 0, s = 0, r = 0, o = 0, l = 0; i > l; l++) a.test(t.charAt(l)) ? n++ : s++, 2 * n + s !== 39 && 2 * n + s !== 40 || (r = n, o = s);
					if (2 * n + s >= 40) {
						var c = t.substring(0, r + o);
						e(this).val(c)
					}
				}).on("blur", function() {
					var i = e(this).val(),
						a = t.getValueLength(i);
					return 4 > a ? void t.doms.$intiErrorTip.removeClass("active") : (t.doms.$intiErrorTip.addClass("active"), t.isSameRecomTaskName(i), void t.isduplicationOfName(i))
				})
			},
			getValueLength: function(e) {
				for (var t = /^[\u4e00-\u9fa5]$/, i = 0, a = 0, n = e.length; n > a; a++) t.test(e.charAt(a)) ? i += 2 : i++;
				return i
			},
			getGiftInfoDoms: function() {
				var t = e("#userside-intimacy-task-box"),
					i = t.find(".inti-gift-name"),
					a = t.find(".inti-gift-price"),
					n = t.find(".inti-gift-num");
				return {
					$intiGiftName: i,
					$intiGiftPrice: a,
					$intiGiftNum: n
				}
			},
			isduplicationOfName: function(e) {
				var t = this.matchBiddingListInfo(e);
				if (t) {
					var i = t.gift_id,
						a = t.gift_num,
						n = t.sponsor_name;
					this.setBiddingTip(!0, i, a, n, this.config.tipText.limitPriceTip, "")
				} else this.setBiddingTip(!1)
			},
			matchBiddingListInfo: function(e) {
				var t = this.config.preAcceptTLArr.length,
					i = 0,
					a = 0,
					n = "";
				if (0 >= t) return !1;
				for (var s = 0; t > s; s++) if (o.get("sys.uid") !== this.config.preAcceptTLArr[s].uid && e === this.config.preAcceptTLArr[s].task_name) {
					i = this.config.preAcceptTLArr[s].gift_id || 0, a = parseInt(this.config.preAcceptTLArr[s].gift_num, 10) || 0, n = this.config.preAcceptTLArr[s].sponsor_name || "";
					break
				}
				return a ? {
					gift_id: i,
					gift_num: a,
					sponsor_name: n
				} : !1
			},
			updateGiftInfo: function(e, t) {
				var i = this.getGiftInfoDoms(),
					a = this.getGiftNameAndPrice(e),
					n = a.gift_name,
					s = a.gift_price;
				t = parseInt(t, 10), t = t >= 99 ? t : t + 1, i.$intiGiftName.text(n).data("id", e), i.$intiGiftPrice.text(s), i.$intiGiftNum.val(t)
			},
			setBiddingTip: function(e, t, i, a, n, s) {
				if (e) {
					var r = this.getGiftNameAndPrice(t),
						o = r.gift_name,
						l = r.gift_price;
					l = this.renderLRGiftList.setRealPrice(l);
					var c = a;
					if (a) {
						var d = 5,
							u = a.length;
						u > d && (a = a.substring(0, d) + "..."), a += "："
					}
					this.doms.$intiGiftPriceTipPre.text(n), this.doms.$intiBiddingTip.removeClass("active"), this.doms.$intiBiddingUsername.text(a).attr("title", c), this.doms.$intiBiddingGiftname.text(o).data("price", l), this.doms.$intiMinGiftPriceOrNum.text(i), this.doms.$intiSendInviBtn.text(this.config.tipText.biddingBtn), this.doms.$intiGiftPriceTipAfter.text(s)
				} else this.doms.$intiGiftPriceTipPre.text(this.config.tipText.defaultPriceTip), this.doms.$intiBiddingTip.addClass("active"), this.doms.$intiMinGiftPriceOrNum.text(this.config.limitIntimateTaskPrice.limit_price + "鱼翅"), this.doms.$intiSendInviBtn.text(this.config.tipText.inviteBtn), this.doms.$intiGiftPriceTipAfter.text("");
				this.renderLRGiftList.isValidGiftPrice(), this.doms.$intiGiftPriceTip.removeClass("active")
			},
			getGiftNameAndPrice: function(e) {
				var t = this.renderLRGiftList.config.giftInfoArr[0],
					i = this.config.giftListObj[e] && this.config.giftListObj[e].gift_name || t.gift_name,
					a = this.config.giftListObj[e] && this.config.giftListObj[e].gift_price || t.gift_price;
				return {
					gift_name: i,
					gift_price: a
				}
			},
			isSameRecomTaskName: function(t) {
				var i = e("#userside-intimacy-task-box").find(".inti-task-list-name"),
					a = i.length;
				if (0 === this.config.reTaskNameArr.length) for (var n = 0; a > n; n++) this.config.reTaskNameArr.push(i.eq(n).text());
				if (this.config.reTaskNameArr.length) for (var n = 0; n < this.config.reTaskNameArr.length; n++) if (t === this.config.reTaskNameArr[n]) {
					this.setTaskNameShowState(1, t), i.eq(n).addClass("active").data("state", 2).siblings().removeClass("active").data("state", 1), this.config.clickIndex = n;
					break
				}
			},
			clickSendInviBtn: function() {
				var t = this;
				this.doms.$intiSendInviBtn.off().on({
					mousedown: function() {
						e(this).addClass("active")
					},
					mouseup: function() {
						var i = "",
							a = e("#userside-intimacy-task-box").find(".inti-valid-icon"),
							n = e(this).data("isclick");
						if (e(this).removeClass("active"), "1" == n) {
							if (e(this).data("isclick", "2"), t.doms.$intiDefinedTask.hasClass("active")) i = t.doms.$intiTaskName.text();
							else {
								i = t.doms.$intiDefinedTask.val();
								var s = t.getValueLength(i);
								if (4 > s) return e(this).data("isclick", "1"), void t.doms.$intiErrorTip.removeClass("active")
							}
							if (a.hasClass("active")) {
								var r = 375;
								return t.setGiftPriceTipAnimate(r), void setTimeout(function() {
									t.doms.$intiSendInviBtn.data("isclick", "1")
								}, r)
							}
							t.ckeckTaskContidion(i)
						}
					}
				})
			},
			ckeckTaskContidion: function(i) {
				var a = this,
					n = e("#userside-intimacy-task-box"),
					s = n.find(".inti-gift-name"),
					r = n.find(".inti-gift-num"),
					o = n.find(".inti-gift-price"),
					l = s.data("id"),
					c = r.val(),
					d = o.text();
				m.sendAjax({
					url: a.ajaxUrls.checkTaskNameUrl,
					type: "POST",
					data: {
						room_id: a.config.roomId,
						task_name: i,
						gift_id: l,
						gift_num: c
					},
					success: function(n) {
						if (n) {
							var s = parseInt(n.error, 10);
							switch (s) {
							case 0:
								a.sureInviteDialog(function() {
									a.sureSendInvitation(i, l, c)
								});
								break;
							case 1:
								-1 != d.indexOf("鱼丸") ? t.trigger("mod.gift.draw.fish.dialog") : a.remindYCLow();
								break;
							case 2:
								a.setGiftPriceTipAnimate(375), a.renderTaskListHtml.checkPreAcceptTaskList();
								break;
							case 3:
								var r = n.msg.split(",")[0] || 0,
									o = +n.msg.split(",")[1] || 0;
								a.setBiddingTip(!0, r, o, "", "当前主播任务列表已满，您需出价大于", "价值的礼物才能发起。"), a.doms.$intiGiftPriceTip.addClass("active"), a.setGiftPriceTipAnimate(375);
								break;
							case 4:
								var u = +n.msg || 0;
								u ? (a.config.limitIntimateTaskPrice.limit_price = u, a.doms.$intiMinGiftPriceOrNum.text(u + "鱼翅"), a.setGiftPriceTipAnimate(375), a.renderLRGiftList.isValidGiftPrice()) : e.dialog.tips_black("礼物总价值不得低于" + n.msg);
								break;
							default:
								e.dialog.tips_black(n.msg)
							}
							a.doms.$intiSendInviBtn.data("isclick", "1")
						}
					},
					error: function() {
						e.dialog.tips_black("网络繁忙, 请刷新重试"), a.doms.$intiSendInviBtn.data("isclick", "1")
					}
				})
			},
			sureInviteDialog: function(t) {
				var i = '<p class="inti-sponsor-invitation-title">是否发起亲密互动请求？</p><p class="inti-sponsor-invitation-content">主播接受请求后，系统将会<span>自动送出</span>对应数量的礼物</p>';
				e.dy_dialog(i, {
					className: "shark-ui-confirm intimacy-task-dialog",
					mask: !0,
					zIndex: 600,
					buttons: [{
						content: "发出",
						className: "confirmsure",
						callback: function() {
							this.hide(), t()
						}
					}, {
						content: "取消",
						callback: function() {
							this.hide()
						}
					}]
				})
			},
			sureSendInvitation: function(i, a, n) {
				var s = this;
				m.sendAjax({
					url: s.ajaxUrls.inviteTaskUrl,
					type: "POST",
					data: {
						room_id: s.config.roomId,
						task_name: i,
						gift_id: a,
						gift_num: n
					},
					success: function(i) {
						if (i) {
							var a = parseInt(i.error, 10);
							switch (a) {
							case 0:
								s.isShowThisBox("hide"), e.dialog.tips_black("您已发出互动邀请，请等待主播接受");
								break;
							case 1:
								var n = e("#userside-intimacy-task-box").find(".inti-gift-price").text(); - 1 != n.indexOf("鱼丸") ? t.trigger("mod.gift.draw.fish.dialog") : s.remindYCLow();
								break;
							case 2:
								s.setGiftPriceTipAnimate(375), s.renderTaskListHtml.checkPreAcceptTaskList();
								break;
							case 3:
								var r = i.msg.split(",")[0] || 0,
									o = +i.msg.split(",")[1] || 0;
								s.setBiddingTip(!0, r, o, "", "当前主播任务列表已满，您需出价大于", "价值的礼物才能发起。"), s.doms.$intiGiftPriceTip.addClass("active"), s.setGiftPriceTipAnimate(375);
								break;
							case 4:
								var l = +i.msg || 0;
								l ? (s.config.limitIntimateTaskPrice.limit_price = l, s.doms.$intiMinGiftPriceOrNum.text(l + "鱼翅"), s.setGiftPriceTipAnimate(375), s.renderLRGiftList.isValidGiftPrice()) : e.dialog.tips_black("礼物总价值不得低于" + i.msg);
								break;
							default:
								e.dialog.tips_black(i.msg)
							}
						}
					}
				})
			},
			remindYCLow: function() {
				e.dialog({
					title: "提示",
					content: "<p>赠送失败<br/>鱼翅不足，点击获取！</p><i></i>",
					cancel: !0,
					okVal: "充值",
					cancelVal: "取消",
					skin: "gift-error",
					lock: !0,
					ok: function() {
						window.open("/web_game/welcome/18")
					}
				})
			},
			setGiftPriceTipAnimate: function(e) {
				if (e) for (var t = e / 3 / 5, i = 0; 3 > i; i++) this.doms.$intiGiftPriceTip.animate({
					left: -10
				}, 2 * t).animate({
					left: 10
				}, t).animate({
					left: 0
				}, 2 * t)
			},
			getInteract: function() {
				var t = e.Deferred(),
					i = this;
				return i.sprayInteract && t.resolve(i.sprayInteract), c.load(o.get("sys.webconfUrl") + "/resource/common/interact.json", "interact", function(e) {
					i.sprayInteract = e, t.resolve(e)
				}, function(e) {
					t.reject(e)
				}, function() {}, !0), t.promise()
			},
			render: function() {
				var e = this,
					t = e.sprayInteract || {},
					n = t.mission_setting || {},
					s = e.openStatus || {},
					r = i.string.join("{{ if (hasAdd) }}", '<div id="userside-intimacy-task-box" class="hasAdd">', "{{ else }}", '<div id="userside-intimacy-task-box">', "{{ /if }}", '<div class="inti-title">', '<a class="inti-play-method">玩法</a>', '<div class="inti-close-btn"></div>', "</div>", "{{ if (hasAdd) }}", '<a href="javascript:;" class="spray-task-active J-task-pp"><img class="spray-task-active-img" src="{{spray.web_activity_background}}" /></a>', "{{ /if }}", '<div class="inti-accept-task-name">', '<div class="inti-task-title">任务</div>', '<div class="inti-select-task-box">', '<div class="inti-select-task">', '<div class="inti-recommend-task-name active"><span class="inti-task-name"></span><i class="inti-task-delete"></i></div>', '<input class="inti-user-defined-task" type="text" placeholder="邀请主播表演什么，2-20个字" />', "</div>", "</div>", "</div>", '<div class="inti-error-tip-box"><div class="inti-error-tip active">*请输入2-20个字</div></div>', '<div class="inti-ishas-task-list-wrap">', "</div>", '<div class="inti-set-gift-title">礼物设置</div>', '<div class="inti-set-gift">', "</div>", '<div class="inti-gift-price-tip">', '<span class="inti-gift-price-tip-pre">礼物总价值不得低于</span>', '<span class="inti-bidding-tip active"><span class="inti-bidding-username"></span><span class="inti-bidding-gift-name" data-price="1">赞</span>×</span>', '<span class="inti-min-gift-price">1鱼翅</span>', '<span class="inti-gift-price-tip-after"></span>', "</div>", '<div class="inti-send-invitation"><div class="inti-send-invitation-btn" data-isclick="1">发出邀请</div></div>', '<div class="inti-agree-tip">发出邀请表示已同意<a class="init-agree-tip-name" href="https://www.douyu.com/cms/gong/201705/17/5341.shtml" target="_blank">《亲密互动任务规范》</a></div>', "</div>");
				return a.compile(r)({
					spray: n,
					hasAdd: !(!s.is_activity_open || !n.web_activity_background)
				})
			},
			renderTaskListHtml: {
				doms: {},
				init: function() {
					this.getTaskListsData()
				},
				getTaskListsData: function() {
					var t = this;
					m.sendAjax({
						url: g.ajaxUrls.taskListsUrl,
						type: "POST",
						data: {
							room_id: g.config.roomId
						},
						success: function(i) {
							if (i) {
								var a = parseInt(i.error, 10);
								if (0 === a) {
									var n = i.data,
										s = n && n.recommend_intimate_task_list,
										r = n && n.limit_intimate_task_price,
										o = n && n.pre_accept_intimate_task_list;
									g.config.preAcceptTLArr = o || [], g.config.limitIntimateTaskPrice = r || {};
									var l = t.render(s),
										c = e("#userside-intimacy-task-box");
									c.find(".inti-ishas-task-list-wrap").html(l), c.find(".inti-min-gift-price").html((r.limit_price || "0.1") + "鱼翅"), g.config.isCompete && (g.isSameRecomTaskName(g.config.biddingTask), g.biddingUpdateGiftInfo(g.config.biddingTask), g.isduplicationOfName(g.config.biddingTask)), t.bindEvent()
								}
							}
						}
					})
				},
				bindEvent: function() {
					this.getDoms(), this.clickChangeBatchBtn(), this.clickRecomTaskName()
				},
				getDoms: function() {
					var t = e("#userside-intimacy-task-box");
					this.doms = e.extend(this.doms, {
						$intiTaskListBox: t.find(".inti-task-list-box"),
						$intiTaskList: t.find(".inti-task-list"),
						$intiChangeBatch: t.find(".inti-change-batch")
					})
				},
				clickChangeBatchBtn: function() {
					var t = this,
						i = this.doms.$intiTaskListBox.height(),
						a = this.doms.$intiTaskList.height(),
						n = Math.ceil(a / i),
						s = 0;
					return i >= a ? void this.doms.$intiChangeBatch.hide() : void this.doms.$intiChangeBatch.off().on("click", function() {
						s++, s = s >= n ? 0 : s, e(this).removeClass("active"), t.doms.$intiTaskList.css("top", -i * s + "px")
					})
				},
				clickRecomTaskName: function() {
					var t = this;
					t.doms.$intiTaskList.off().on("click", ".inti-task-list-name", function() {
						var t = e(this).index(),
							i = e(this).text(),
							a = parseInt(e(this).data("state"), 10);
						1 === a ? (e(this).addClass("active").data("state", 2).siblings().removeClass("active").data("state", 1), g.config.clickIndex = t, g.setTaskNameShowState(1, i), g.isduplicationOfName(i)) : (e(this).removeClass("active").data("state", 1), g.setTaskNameShowState(2, ""), g.setBiddingTip(!1))
					})
				},
				userSideSendGifts: function(i, a) {
					return d.check() ? (i = i || 0, a = a || 0, void u.getGift().done(function(n) {
						n && n[i] && a > 0 && (a > 1 ? f.render().done(function() {
							var n = e('#gift-content [data-type=gift][data-giftid="' + i + '"]'),
								s = n.data("send") || 0;
							if (1 == s) var r = 0,
								o = setInterval(function() {
									f.render().done(function() {
										t.trigger("mod.gift.draw.batch.send", {
											target: n,
											number: 1,
											batch: 1
										})
									}), r++, r >= a && (clearInterval(o), o = null)
								}, 300);
							else 2 == s && t.trigger("mod.gift.draw.batch.send", {
								target: n,
								number: a,
								batch: 1
							})
						}) : f.render().done(function() {
							var a = e('#gift-content [data-type=gift][data-giftid="' + i + '"]');
							t.trigger("mod.gift.draw.batch.send", {
								target: a,
								number: 1,
								batch: 0
							})
						}))
					})) : void d.show("login")
				},
				deleteTask: function(e) {
					var t = 0;
					e = parseFloat(e, 10) || 0;
					for (var i = 0, a = g.config.preAcceptTLArr.length; a > i; i++) if (t = parseFloat(g.config.preAcceptTLArr[i].flow_id, 10), e === t) {
						g.config.preAcceptTLArr.splice(i, 1);
						break
					}
				},
				addNewTask: function(e) {
					var t = {
						flow_id: e.fid,
						task_name: e.tn,
						uid: e.uid,
						sponsor_name: e.sn,
						gift_id: e.gfid,
						gift_num: e.gfc
					};
					g.config.preAcceptTLArr.push(t)
				},
				checkPreAcceptTaskList: function() {
					var e = this.getCurrentTaskName();
					g.isduplicationOfName(e)
				},
				getCurrentTaskName: function() {
					var t = e("#userside-intimacy-task-box"),
						i = t.find(".inti-user-defined-task"),
						a = t.find(".inti-task-name"),
						n = "";
					return n = i.hasClass("active") ? a.text() : i.val()
				},
				render: function(e) {
					var t = i.string.join('<div class="inti-recommend-title {{ taskNameData.length > 0 ? "" : "active" }}">', '推荐<div class="inti-change-batch">换一批</div>', "</div>", '<div class="inti-task-list-box {{ taskNameData.length > 0 ? "" : "active" }}">', '<ul class="inti-task-list">', "{{ each taskNameData as item index }}", '<li class="inti-task-list-name" data-id="{{item.id}}" data-state="1">{{item.task_name}}</li>', "{{ /each }}", "</ul>", "</div>", '<div class="inti-no-recommend-task-box {{taskNameData.length > 0 ? "active" : ""}}">', '<div class="inti-no-recommend-task">', "<h5>您可邀请主播进行才艺表演或回答问题</h5>", "<p>游戏：<span>带水友上分、秀一把露娜</span></p>", "<p>娱乐：<span>椅子舞、唱歌（歌名）、来一发抽奖</span></p>", "", "</div>", "</div>");
					return a.compile(t)({
						taskNameData: e
					})
				}
			},
			renderLRGiftList: {
				config: {
					giftInfoArr: []
				},
				doms: {},
				init: function() {
					this.getRoomGiftListData()
				},
				getRoomGiftListData: function() {
					var t = this;
					c.load(g.ajaxUrls.giftListUrl, "roomGiftConfig", function(i) {
						var a = [];
						if (i && 0 !== i.length) {
							var n = i.length;
							t.handleJSONData(i);
							for (var s = 0; n > s; s++) if (1 !== parseInt(i[s].isAlipay, 10)) {
								var r = parseFloat(i[s].gt, 10);
								if (0 === r || 2 === r) {
									var o = {};
									o.gift_id = i[s].id, o.gift_name = i[s].name, o.gift_price = i[s].price_name, a.push(o)
								}
							}
							var l = t.render(a);
							t.config.giftInfoArr = a, e("#userside-intimacy-task-box").find(".inti-set-gift").html(l);
							for (var s = 0; s < a.length; s++) g.config.giftListObj[a[s].gift_id] = {
								gift_name: a[s].gift_name,
								gift_price: a[s].gift_price
							};
							t.bindEvent()
						}
					})
				},
				handleJSONData: function(e) {
					for (var t = null, i = e.length, a = 0; i - 1 > a; a++) for (var n = 0; i - a - 1 > n; n++) this.switchYuchiPrice(e[n]) > this.switchYuchiPrice(e[n + 1]) && (t = e[n], e[n] = e[n + 1], e[n + 1] = t)
				},
				switchYuchiPrice: function(e) {
					return "undefined" == typeof e.pc ? 0 : 1 === +e.type ? e.pc / 1e3 : e.pc / 100
				},
				bindEvent: function() {
					this.getDoms(), this.addScrollStyle(), this.clickPullDownBtn(), this.clickIntiPdgfOption(), this.setGiftNums()
				},
				getDoms: function() {
					this.doms.$intimacyTaskBox = e("#userside-intimacy-task-box"), this.doms = e.extend(this.doms, {
						$intiGiftInfo: this.doms.$intimacyTaskBox.find(".inti-gift-info"),
						$intiGiftName: this.doms.$intimacyTaskBox.find(".inti-gift-name"),
						$intiGiftPrice: this.doms.$intimacyTaskBox.find(".inti-gift-price"),
						$intiPdgfSelect: this.doms.$intimacyTaskBox.find(".inti-pdgf-select"),
						$intiPdgfOption: this.doms.$intimacyTaskBox.find(".inti-pdgf-option"),
						$intiPdgfName: this.doms.$intimacyTaskBox.find(".inti-pdgf-name"),
						$intiPdgfPrice: this.doms.$intimacyTaskBox.find(".inti-pdgf-price"),
						$intiGiftNum: this.doms.$intimacyTaskBox.find(".inti-gift-num"),
						$intiValidIcon: this.doms.$intimacyTaskBox.find(".inti-valid-icon")
					})
				},
				addScrollStyle: function() {
					this.doms.$intiPdgfSelect.mCustomScrollbar()
				},
				clickPullDownBtn: function() {
					var t = this;
					this.doms.$intiGiftInfo.off().on("click", function() {
						var i = e(this).data("state");
						1 == i ? (t.doms.$intiPdgfSelect.removeClass("active"), e(this).data("state", 2)) : (t.doms.$intiPdgfSelect.addClass("active"), e(this).data("state", 1))
					})
				},
				clickIntiPdgfOption: function() {
					var t = this;
					this.doms.$intiPdgfOption.off().on("click", function() {
						var i = e(this).index(),
							a = t.doms.$intiPdgfName.eq(i).text(),
							n = t.doms.$intiPdgfName.eq(i).data("id"),
							s = t.doms.$intiPdgfPrice.eq(i).text();
						t.doms.$intiGiftName.text(a).data("id", n), t.doms.$intiGiftPrice.text(s), t.doms.$intiPdgfSelect.addClass("active"), t.doms.$intiGiftInfo.data("state", 1), t.isValidGiftPrice(), t.stopPropagationFn()
					})
				},
				stopPropagationFn: function(e) {
					var t = arguments.callee.caller.arguments[0] || window.event || e;
					t.stopPropagation ? t.stopPropagation() : t.cancelBubble = !0
				},
				setGiftNums: function() {
					var t = this;
					this.doms.$intiGiftNum.off().on("keyup keydown change input keypress", function() {
						var i = e(this).val();
						/[\D]/.test(i) && (i = i.replace(/[\D]/g, ""), e(this).val(i)), t.isValidGiftPrice()
					})
				},
				isValidGiftPrice: function() {
					var t = e("#userside-intimacy-task-box"),
						i = t.find(".inti-bidding-tip"),
						a = parseInt(this.doms.$intiGiftNum.val(), 10) || 0,
						n = this.doms.$intiGiftPrice.text(),
						s = this.setRealPrice(n),
						r = parseFloat(g.config.limitIntimateTaskPrice.limit_price, 10),
						o = a * s;
					if (i.hasClass("active")) this.setIsShowValidIcon(o >= r);
					else {
						var l = t.find(".inti-bidding-gift-name"),
							c = t.find(".inti-min-gift-price"),
							d = l.data("price"),
							u = parseInt(c.text(), 10),
							f = d * u;
						this.setIsShowValidIcon(o > f)
					}
				},
				setRealPrice: function(e) {
					var t = parseFloat(e, 10) || 0;
					return t = -1 !== e.indexOf("鱼丸") ? t / 1e3 : t
				},
				setIsShowValidIcon: function(e) {
					e ? this.doms.$intiValidIcon.removeClass("active") : this.doms.$intiValidIcon.addClass("active")
				},
				render: function(e) {
					var t = i.string.join('<div class="inti-gift-info" data-state="1">', '<span class="inti-gift-name" data-id="{{giftData[0].gift_id}}">{{giftData[0].gift_name || "赞"}}</span>', '<span class="inti-gift-price">{{giftData[0].gift_price || "0.1鱼翅"}}</span>', '<span class="inti-pull-down"></span>', '<div class="inti-pdgf-select active">', "{{ each giftData as item index }}", '<div class="inti-pdgf-option"><span class="inti-pdgf-name" data-id="{{item.gift_id}}">{{item.gift_name}}</span><span class="inti-pdgf-price">{{item.gift_price}}</span></div>', "{{ /each}}", "</div>", "</div>", '<span class="inti-multiply"></span>', '<div class="inti-gift-num-box"><input class="inti-gift-num" type="text" placeholder="1-99" maxlength="2" />个</div>', '<i class="inti-valid-icon active"></i>');
					return a.compile(t)({
						giftData: e
					})
				}
			}
		};
	return l.reg("room_data_handler", function(t) {
		var i = g.renderTaskListHtml,
			a = r.decode(t).too(),
			n = a.type;
		switch (n) {
		case "ittl":
			var s = a.list;
			s = r.isArray(s) ? r.decode(s) : [{
				value: s
			}];
			for (var l = null, c = null, d = 0, u = s.length; u > d; d++) if (l = s[d].value, c = l && r.decode(l).too(), c && c.uid == o.get("sys.uid")) {
				var f = +c.cgfc || 0,
					p = +c.rgfc || 0;
				if (p > f) {
					var m = c.gfid,
						h = p - f;
					i.userSideSendGifts(m, h)
				}
			}
			break;
		case "task_qmyq":
			if (e("#userside-intimacy-task-box").length <= 0) return;
			var v = parseFloat(a.ktfid, 10) || 0;
			0 !== v && i.deleteTask(v), i.addNewTask(a), i.checkPreAcceptTaskList();
			break;
		case "task_qmap":
			if (e("#userside-intimacy-task-box").length <= 0) return;
			var y = a.fid;
			i.deleteTask(y), i.checkPreAcceptTaskList();
			break;
		case "task_qmii":
			if (e("#userside-intimacy-task-box").length <= 0) return;
			var y = a.fid;
			i.deleteTask(y), i.checkPreAcceptTaskList();
			break;
		case "task_qmar":
			if (1 === parseInt(a.is_pass, 10) && o.get("sys.uid") == a.uid) {
				var m = a.gfid,
					h = +a.gfc;
				e.dialog.tips_black("主播接受了您的邀请，系统将自动送出您预设的礼物"), i.userSideSendGifts(m, h)
			}
			if (e("#userside-intimacy-task-box").length <= 0) return;
			var y = a.fid;
			i.deleteTask(y), i.checkPreAcceptTaskList()
		}
	}), {
		init: function() {
			var e = o.get("sys.uid") == o.get("room.owner_uid");
			e || (g.getInteract().then(function(e) {
				e && e.mission_setting && l.exe("js_spray_interact", JSON.stringify(e.mission_setting))
			}), l.reg("room_chongnengv3", function(e) {
				var t = JSON.parse(e),
					i = t.type;
				switch (i) {
				case "rule":
					0 == t.data && h.init();
					break;
				case "invite":
					g.init();
					break;
				case "compete":
					g.init(!0, t.data);
					break;
				case "give":
					var a = t.data || 0;
					g.renderTaskListHtml.userSideSendGifts(a, 1);
					break;
				case "send":
					var n = t.data;
					if (o.get("sys.uid") == n.uid) {
						var a = n.gid || 0,
							s = +n.need || 0;
						s && g.renderTaskListHtml.userSideSendGifts(a, s)
					}
					break;
				case "login":
					d.check() || d.show("login");
					break;
				case "advOpenStatus":
					g.openStatus = t.status;
					break;
				case "showRank":
					p.showRank()
				}
			}))
		}
	}
}), define("douyu/page/room/normal/mod/intimate-task-anchor", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "shark/util/cookie/1.0", "shark/util/storage/1.0", "shark/util/flash/data/1.0", "douyu/context", "douyu/com/user", "douyu/com/exjsonp", "douyu/page/room/base/api", "douyu/page/room/normal/mod/intimate-task-assembly", "douyu/page/room/normal/mod/intimate-task-rank"], function(e, t, i, a, n, s, r, o, l, c, d, u, f) {
	var p = {
		crsf: "/curl/csrfApi/getCsrfCookie",
		getCSRFCookie: function(t) {
			var i = this,
				a = n.get(o.get("sys.tvk"));
			return a ? void(t && t({
				name: $SYS.tn,
				value: a
			})) : void e.ajax({
				url: i.crsf,
				type: "GET",
				dataType: "json",
				success: function(e) {
					0 === +e.error && i.getCSRFCookie(t)
				}
			})
		},
		type: function(e) {
			return Object.prototype.toString.call(e).slice(8, -1).toLowerCase()
		},
		showErrDlg: function(t, i) {
			i && e.dy_dialog(i, {
				mask: !0,
				zIndex: 502,
				buttons: [{
					content: "确认",
					callback: function() {
						this.hide()
					}
				}]
			})
		},
		getStrLength: function(e) {
			if ("string" !== p.type(e)) return -1;
			for (var t = 0, i = 0, a = e.length; a > i; i++) t += e.charCodeAt(i) > 255 ? 2 : 1;
			return t
		},
		sendAjax: function(e, t, i, a) {
			if (!e) return void i("请求路径配置错误");
			var n = this;
			if (!n.waitSubmit) {
				n.waitSubmit = !0;
				var s = a || "GET",
					r = {
						url: e,
						type: s,
						dataType: "json",
						data: t || {}
					};
				"POST" === s ? n.getCSRFCookie(function(e) {
					r.data[e.name] = e.value, n.sendRequest(r, i)
				}) : n.sendRequest(r, i)
			}
		},
		sendRequest: function(t, i) {
			var a = this,
				n = function(e) {
					a.waitSubmit = !1, 0 !== +e.error ? i(+e.error, e.msg) : i(null, e)
				},
				s = function(e) {
					a.waitSubmit = !1, i(-1, e)
				},
				r = e.extend(t, {
					success: n,
					error: s
				});
			e.ajax(r)
		}
	},
		m = {
			init: function(t) {
				this.nextCallback = t, this.hasTipsReady() ? e("#intimacy-task-anchorside-guide").show() : this.render()
			},
			hasTipsReady: function() {
				return e("#intimacy-task-anchorside-guide").length > 0
			},
			render: function() {
				var t = '<div id="intimacy-task-anchorside-guide" class="flexslider"><ul class="slides"><li class="slides1"></li><li class="slides2"></li><li class="slides3"></li></ul><div class="inti-immediately-start">立即体验</div><div class="inti-close-guild"></div></div>';
				e("body").append(t), e("#intimacy-task-anchorside-guide").flexslider({
					animation: "slide",
					animationLoop: !1,
					prevText: "",
					nextText: "",
					keyboard: !1,
					before: function(t) {
						1 == t.currentSlide && "next" == t.direction ? (e("#intimacy-task-anchorside-guide").find(".flex-control-nav").hide(), e("#intimacy-task-anchorside-guide").find(".inti-immediately-start").show()) : (e("#intimacy-task-anchorside-guide").find(".flex-control-nav").show(), e("#intimacy-task-anchorside-guide").find(".inti-immediately-start").hide())
					}
				}), this.bindEvent()
			},
			bindEvent: function() {
				var t = this,
					i = e("#intimacy-task-anchorside-guide");
				i.off().on("click", ".inti-close-guild", function() {
					i.remove(), "function" === p.type(t.nextCallback) && t.nextCallback()
				}).on("click", ".inti-immediately-start", function() {
					i.remove(), "function" === p.type(t.nextCallback) && t.nextCallback()
				})
			}
		},
		h = {
			price: function(e, t) {
				var n = e || {},
					s = n.mission_setting || {},
					r = t || {},
					o = i.string.join('<div class="charge-task-intimate">', "{{ if (hasAdd) }}", '<div class="imt-anchor-set hasAdd">', '<a href="javascript:;" class="spray-task-active J-task-pp"><img class="spray-task-active-img" src="{{spray.web_activity_background}}" /></a>', "{{ else }}", '<div class="imt-anchor-set">', "{{ /if }}", '<a href="javascript:;" class="imt-add-close"></a>', '<a href="javascript:;" class="imt-anchor-tab1">发布充能任务</a>', '<a href="javascript:;" class="imt-anchor-tab2">设置亲密任务</a>', '<div class="imt-teract-recommend js-teract-recommend-word imt-empty"><!-- 空列表imt-empty -->', '<div class="imt-add-empty">', "</div>", '<div class="imt-teract-recommend-title">可供水友发起的亲密任务', '<i class="imt-edit js-teract-recommend-edit" data-status="0">编辑</i>', "</div>", '<div class="imt-teract-recommend-content js-teract-recommend-list">', '<div class="imt-teract-rec-sec js-teract-recommend-content"></div>', "</div>", '<div class="bottom-gradient"></div>', "</div>", '<div class="imt-add-self">', '<div class="imt-self-box">', '<input class="imt-self-input js-teract-recommend-task" maxlength="12" placeholder="自定义任务，2-6个字">', '<a class="imt-self-add js-teract-recommend-add" href="javascript:;"><i>+</i>添加</a>', "</div>", "</div>", '<div class="imt-teract-limit">', '<div class="imt-teract-limit-title">', "任务最低礼物价值", '<input type="text" maxlength="5" class="imt-limit-price js-teract-recommend-price" placeholder="0.1">', "鱼翅", "</div>", '<div class="imt-teract-limit-content">', '可填<span class="js-teract-recommend-limit">0.1-2000鱼翅</span>，用户可通过竞价提升礼物价值，建议不要设置太高', "</div>", '<div class="imt-teract-limit-btn js-teract-recommend-icons"></div>', "</div>", '<div class="imt-teract-oper">', '<div class="imt-teract-save js-teract-recommend-save">保存</div>', "</div>", "</div>", "</div>"),
					l = a.compile(o);
				return l({
					spray: s,
					status: r,
					hasAdd: !(!r.is_activity_open || !s.web_activity_background)
				})
			}
		},
		g = {
			imtTask: {},
			clearTagMark: !1,
			init: function() {
				t.on("mod.energy.imt.show", function(e) {
					return e ? void g.checkNoviceTimes() : void g.showImtDlg()
				}), g.getInteract().then(function(e) {
					e && e.mission_setting && d.exe("js_spray_interact", JSON.stringify(e.mission_setting))
				})
			},
			checkNoviceTimes: function() {
				var e = this;
				e.checkOtherActive(function() {
					e.showNoviceGuide(function() {
						e.showImtDlg()
					})
				})
			},
			showImtDlg: function() {
				var e = this;
				e.clearTagMark = !1, e.getActiveState().then(function() {
					e.imtTask.$box || (e.initImtTask(), e.bindImtEvent()), e.toggleImtDlg(!0), e.imtTask.$edit.attr("data-status", "0").text("编辑"), e.getImtTaskWord(function() {
						e.rimt && .1 !== +e.rimt.price && e.imtTask.$price.val(e.rimt.price), e.rimt && e.rimt.iconStatus ? e.imtTask.$iconStatus.html('如果您不想水友向您发出邀请，您可以<span class="icon-close js-icon-oper" data-oper="0">关闭亲密任务</span>') : e.imtTask.$iconStatus.html('您可以点击按钮开启亲密任务<span class="icon-open js-icon-oper" data-oper="1">开启亲密任务</span>'), e.rimt && e.rimt.priceMax && e.imtTask.$giftLimit.text(e.rimt.priceMin + "-" + e.rimt.priceMax + "鱼翅"), e.rimt && 0 != e.rimt.total && e.addImtWord()
					})
				})
			},
			bindImtEvent: function() {
				var i, a = this,
					n = a.imtTask;
				n.$price.on("input propertychange", function(t) {
					var n = e(this),
						s = n.val(),
						r = /^\d{0,3}\.{0,1}\d{0,1}$/;
					if (r.test(s)) i = s;
					else {
						var o = "undefinde" !== p.type(i) ? i : a.rimt.price || .1;
						n.val(o)
					}
				}), n.$iconStatus.on("click", ".js-icon-oper", function() {
					var t = e(this),
						i = t.attr("data-oper");
					a.setEntericonStatus(i, function() {
						+i ? n.$iconStatus.html('如果您不想水友向您发出邀请，您可以<span class="icon-close js-icon-oper" data-oper="0">关闭亲密任务</span>') : n.$iconStatus.html('您可以点击按钮开启亲密任务<span class="icon-open js-icon-oper" data-oper="1">开启亲密任务</span>')
					})
				}), n.$box.on("click", ".imt-anchor-tab1", function(e) {
					a.toggleImtDlg(), t.trigger("mod.energy.charge.show")
				}).on("click", ".imt-add-close", function(e) {
					a.toggleImtDlg()
				}).on("click", ".js-teract-recommend-save", function(e) {
					var t = n.$price.val();
					t = t.replace(/\.+$/, ""), a.updateLimitPrice(t || .1)
				}).on("click", ".js-teract-recommend-add", function(t) {
					var i = a.getNewTaskName();
					i ? (n.$task.val(""), a.updataNewTask(i, function(t) {
						e.dy_dialog.tips_black("自定义任务需要2-3分钟审核~"), a.addImtItem(t)
					})) : e.dy_dialog.tips_black("请输入2-6个字~")
				}).on("click", ".js-teract-recommend-edit", function(t) {
					var i = e(this),
						n = i.attr("data-status"),
						s = a.rimt.list,
						r = s.length;
					if (1 === +n) {
						i.attr("data-status", "0").text("编辑");
						for (var o = 0; r > o; o++) {
							var l = s[o].target;
							l.setStatus(l.lastStatus)
						}
					} else {
						i.attr("data-status", "1").text("完成");
						for (var c = 0; r > c; c++) s[c].target.setStatus("edit");
						a.clearTagMark || a.createTimerTask()
					}
				}).on("click", ".intimate-task-close", function(t) {
					var i = e(this),
						n = i.parents(".intimate-task-word"),
						s = n.attr("data-type"),
						r = n.attr("data-id");
					a.removeImtKey(r, s, function() {
						a.removeForList(r)
					})
				}).on("click", ".J-task-pp", function(e) {
					f.showRank()
				})
			},
			removeForList: function(e) {
				for (var t = this.rimt.list, i = 0, a = t.length; a > i; i++) {
					var n = t[i];
					if (n.id == e) {
						n.target.$tag.remove(), t.splice(i, 1);
						break
					}
				}
				t.length || this.imtTask.$word.addClass("imt-empty")
			},
			getNewTaskName: function() {
				var e = this.imtTask.$task.val(),
					t = p.getStrLength(e);
				return t >= 4 && 12 >= t ? e : !1
			},
			addImtItem: function(e) {
				e.target = new u(e), this.imtTask.$listCnt.prepend(e.target.$tag), this.imtTask.$list.mCustomScrollbar("update"), this.rimt.list.push(e), this.imtTask.$word.removeClass("imt-empty")
			},
			changeImtwordStu: function(e) {
				if (e.rid == o.get("room.room_id")) {
					var t, i = e.id,
						a = !1;
					try {
						t = this.rimt.list || []
					} catch (n) {
						t = []
					}
					for (var s = 0, r = t.length; r > s; s++) {
						var l = t[s];
						if (l.id == i) {
							a = !0;
							var c = +e.is_pass,
								d = 1 === c ? "success" : "failed";
							l.status = 1 === c ? 1 : 2, l.sign = 1, l.target.setStatus(d)
						}
					}
					a && (this.clearMark = !0, this.createTimerTask())
				}
			},
			addImtWord: function() {
				var e = this.imtTask.$list,
					t = this.imtTask.$listCnt,
					i = this.rimt.list;
				t.empty();
				for (var a = 0, n = i.length; n > a; a++) {
					var s = i[a];
					s.sign && (this.clearMark = 1), s.target = new u(s), t.append(s.target.$tag)
				}
				this.imtTask.$word.removeClass("imt-empty"), e.mCustomScrollbar(), this.createTimerTask()
			},
			toggleImtDlg: function(e) {
				e ? this.imtTask.$box.show() : this.imtTask.$box.hide()
			},
			showNoviceGuide: function(e) {
				if (o.get("room.showImtNoviceGuide")) return void("function" === p.type(e) && e());
				o.set("room.showImtNoviceGuide", 1);
				var t = s.get("energyChargeImtimate") || 0;
				1 > t ? (t++, s.set("energyChargeImtimate", t), m.init(e)) : "function" === p.type(e) && e()
			},
			createTimerTask: function() {
				var e = this,
					t = 0;
				clearTimeout(e.clearTicket), this.clearMark && (e.clearTicket = setTimeout(function() {
					var i = arguments;
					e.deleteImtSign(function(a) {
						if (a) {
							if (t++, t >= 3) return void clearTimeout(e.clearTicket);
							e.clearTicket = setTimeout(function() {
								i.callee()
							}, 3e3)
						} else clearTimeout(e.clearTicket), e.clearTagMark = !0, e.clearTaskTab()
					})
				}, 5e3))
			},
			clearTaskTab: function() {
				for (var e = this.rimt.list, t = 0, i = e.length; i > t; t++) {
					var a = e[t],
						n = a.target,
						s = n.status;
					"failed" === s ? (this.removeForList(a.id), t--, i--) : "audit" === s || "default" === s || n.setToDefault()
				}
				this.updataScorll()
			},
			updataScorll: function() {
				this.imtTask.$list.mCustomScrollbar("update")
			},
			initImtTask: function() {
				this.imtTask.$box = e(h.price(this.sprayInteract, this.openStatus)), e("body").append(this.imtTask.$box), this.cacheImtTaskDom()
			},
			getInteract: function() {
				var t = e.Deferred(),
					i = this;
				return i.sprayInteract && t.resolve(i.sprayInteract), c.load(o.get("sys.webconfUrl") + "/resource/common/interact.json", "interact", function(e) {
					i.sprayInteract = e, t.resolve(e)
				}, function(e) {
					t.resolve()
				}, function() {}, !0), t.promise()
			},
			getOpenStatus: function() {
				var t = this,
					i = e.Deferred();
				return t.openStatus ? (i.resolve(t.openStatus), i.promise()) : (e.ajax({
					url: "/member/anchor_task/get_open_status",
					type: "GET",
					data: {
						t: (new Date).getTime()
					},
					dataType: "JSON",
					success: function(e) {
						0 == e.error ? (t.openStatus = e.data, i.resolve(e.data)) : i.resolve()
					},
					error: function(e) {
						i.resolve()
					}
				}), i.promise())
			},
			getActiveState: function() {
				var t = this,
					i = e.Deferred();
				return e.when(t.getInteract(), t.getOpenStatus()).then(function(e, t) {
					e && t ? i.resolve(!0) : i.resolve(!1)
				}, function(e) {
					i.resolve(!1)
				}), i.promise()
			},
			cacheImtTaskDom: function() {
				var e = this.imtTask;
				e.$list = e.$box.find(".js-teract-recommend-list"), e.$listCnt = e.$box.find(".js-teract-recommend-content"), e.$price = e.$box.find(".js-teract-recommend-price"), e.$word = e.$box.find(".js-teract-recommend-word"), e.$task = e.$box.find(".js-teract-recommend-task"), e.$edit = e.$box.find(".js-teract-recommend-edit"), e.$giftLimit = e.$box.find(".js-teract-recommend-limit"), e.$iconStatus = e.$box.find(".js-teract-recommend-icons")
			},
			checkOtherActive: function(t) {
				var i = "function" === p.type(t) ? t : function() {};
				p.sendAjax("/member/lottery/get_room_status", {}, function(t, a) {
					t || (a && a.data && (0 === parseInt(a.data.status, 10) || 3 === parseInt(a.data.status, 10)) ? i() : e.dy_dialog.tips_black(a.data.start_info))
				}, "POST")
			},
			setEntericonStatus: function(t, i) {
				var a = "function" === p.type(i) ? i : function() {};
				p.sendAjax("/member/anchor_task/set_intimate_task_icon_status", {
					is_show: t
				}, function(t, i) {
					t || (i && 0 == i.error ? a() : e.dy_dialog.tips_black(i.msg))
				}, "POST")
			},
			getImtTaskWord: function(e) {
				var t = this,
					i = "function" === p.type(e) ? e : function() {};
				p.sendAjax("/member/anchor_task/get_intimate_task_setting_anchor", {}, function(e, a) {
					if (e) return t.rimt = {
						total: 0,
						list: [],
						price: "0.1",
						priceMax: "2000",
						priceMin: "0.1"
					}, void i();
					var n = a.data,
						s = n.recommend_intimate_task_list;
					t.rimt = {
						total: s ? s.length : 0,
						list: s || [],
						price: n.limit_intimate_task_price ? n.limit_intimate_task_price.limit_price : .1,
						priceMax: n.limit_intimate_task_price ? n.limit_intimate_task_price.max_price : 2e3,
						priceMin: n.limit_intimate_task_price ? n.limit_intimate_task_price.min_price : .1,
						iconStatus: n.icon_status
					}, i()
				}, "POST")
			},
			getTaskWordClone: function(t) {
				var i = "function" === p.type(t) ? t : function() {};
				p.sendAjax("/member/anchor_task/get_recommend_intimate_task_list_anchor", {}, function(t, a) {
					if (t) return void e.dy_dialog.tips_black(a);
					var n = [];
					a && a.data && (n = a.data), i(n)
				}, "POST")
			},
			updataNewTask: function(t, i) {
				var a = "function" === p.type(i) ? i : function() {};
				p.sendAjax("/member/anchor_task/add_recommend_intimate_task", {
					task_name: t
				}, function(t, i) {
					if (t) return void e.dy_dialog.tips_black(i);
					var n = e.extend({
						id: "-1",
						recommend_type: "1",
						task_name: "任务名称",
						status: 0,
						sign: 1
					}, i.data);
					a(n)
				}, "POST")
			},
			removeImtKey: function(e, t, i) {
				var a = "function" === p.type(i) ? i : function() {};
				p.sendAjax("/member/anchor_task/delete_recommend_intimate_task", {
					id: e,
					recommend_type: t
				}, function(e, t) {
					e || a()
				}, "POST")
			},
			deleteImtSign: function(e) {
				var t = "function" === p.type(e) ? e : function() {};
				p.sendAjax("/member/anchor_task/delete_recommend_intimate_task_sign", {}, function(e, i) {
					t(e)
				}, "POST")
			},
			updateLimitPrice: function(t) {
				p.sendAjax("/member/anchor_task/set_intimate_task_limit_price_setting", {
					limit_price: t,
					price_unit: 2
				}, function(t, i) {
					return t ? void e.dy_dialog.tips_black(i) : void e.dy_dialog.tips_black("礼物价值设置成功~")
				}, "POST")
			}
		};
	return d.reg("room_chongnengv3", function(t) {
		var i, a = JSON.parse(t),
			n = a.type;
		switch (n) {
		case "add":
			g.showImtDlg();
			break;
		case "rule":
			0 != a.data && m.init(function() {
				g.showImtDlg()
			});
			break;
		case "showRank":
			f.showRank();
			break;
		case "tip":
			i = a.data, p.showErrDlg("tip", i);
			break;
		case "toast":
			i = a.data, i && e.dy_dialog.tips_black(i);
			break;
		case "login":
			l.check() || l.show("login")
		}
	}), d.reg("room_data_handler", function(e) {
		var t = r.decode(e).too();
		"task_qmra" === t.type && g.changeImtwordStu(t)
	}), {
		init: function() {
			g.init()
		},
		getTaskWordClone: function(e) {
			g.getTaskWordClone(e)
		},
		showNoviceGuide: function(e) {
			g.showNoviceGuide(e)
		},
		getInteract: g.getInteract.bind(g),
		getOpenStatus: g.getOpenStatus.bind(g)
	}
}), define("douyu/page/room/normal/mod/energy-charge-task", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "shark/util/cookie/1.0", "shark/util/storage/1.0", "shark/util/flash/data/1.0", "douyu/context", "douyu/page/room/base/api", "douyu/com/exjsonp", "douyu/page/room/normal/mod/intimate-task", "douyu/page/room/normal/mod/intimate-task-anchor", "douyu/page/room/normal/mod/intimate-task-assembly", "douyu/page/room/normal/mod/intimate-task-rank"], function(e, t, i, a, n, s, r, o, l, c, d, u, f, p) {
	var m = o.get("sys.web_url"),
		h = {
			maxTaskNum: 6,
			minLen: 2,
			maxLen: 10,
			active: "active",
			storeName: "energyChargeTaskTips2017V3",
			guide_storeName: "energyChargeTaskGuide2017",
			giftDefaultIcon: m + "app/douyu/res/page/room-normal/chargetask/gift_default.png",
			sprayDeviceStu: !1,
			sprayDeviceEx: ""
		},
		g = {
			check: {
				isHasEntrance: "/member/anchor_task/get_open_status",
				getActInfo: "/member/lottery/get_room_status",
				isExistsTask: "/member/anchor_task/is_exists_task"
			},
			task: {
				getGiftList: "/member/lottery/get_room_gift_list",
				list: "/member/anchor_task/get_room_task_list"
			},
			status: {
				add: "/member/anchor_task/add_task_inst_v3",
				edit: "/member/anchor_task/edit_task_inst",
				remove: "/member/anchor_task/del_task_inst",
				publish: "/member/anchor_task/start_task_inst"
			},
			active: o.get("sys.webconfUrl") + "/resource/common/interact.json"
		},
		v = {
			taskNameFlag: !1,
			giftNumsFlag: !1,
			lock: {},
			guideNum: 0
		},
		y = s.get(h.guide_storeName) || 0,
		b = function() {
			y++, (!s.get(h.guide_storeName) || parseInt(s.get(h.guide_storeName), 10) < 1) && (s.set(h.guide_storeName, y, 31536e3), e(".charge-guide-one").fadeIn(), e(document).on("mousedown", function() {
				v.guideNum++, 1 === v.guideNum ? (e(".charge-guide-one").fadeOut(), e(".charge-guide-two").fadeIn()) : e(".charge-guide-two").fadeOut()
			}))
		},
		k = {
			init: function() {
				var t = this,
					i = e("#J_anchorandsupermenu"),
					a = e("body");
				t.doms = {
					btn: i.find('[data-live-group="energy-charge-btn"]'),
					popTips: i.find('[data-energy-charge="energy-charge-tips"]'),
					tipsEnter: i.find(".js-charge-pop-start")
				}, u.getOpenStatus().then(function(i) {
					if (i && 1 === parseInt(i.is_open, 10)) {
						t.openStatus = i;
						var n = s.get(h.storeName) || 0;
						n++, t.doms.btn.removeClass("hide"), (!s.get(h.storeName) || parseInt(s.get(h.storeName), 10) < 3) && (s.set(h.storeName, n, 31536e3), t.doms.popTips.removeClass("hide").show(), t.doms.popTips.on("click.energrChargePopTipsHide", '[data-energy-charge="popTips-close"]', function() {
							t.doms.popTips.addClass("hide")
						})), e("#energy-charge-wrap").length || u.getInteract().then(function(e) {
							t.sprayInteract = e, a.append(t.render.taskWrap()), t.getDoms(), t.bindEvent()
						})
					} else l.reg("room_energy_task_anchor_pop", function() {
						u.getInteract().then(function() {
							t.sprayInteract = data, a.append(t.render.taskWrap()), t.getDoms(), t.getHtml.getTaskList(), t.bindEvent()
						})
					})
				})
			},
			callFlash_PopupClose: function() {
				l.exe("js_chongneng_host_close")
			},
			getDoms: function() {
				var t = this.doms,
					i = e("#energy-charge-wrap");
				t.wrap = i, t.box = i.find('[data-energy-charge="charge-task-box"]'), t.content = i.find('[data-energy-charge="energy-charge-content"]'), t.back = i.find('[data-energy-charge="back"]'), t.titleIcon = i.find('[data-energy-charge="titleIcon"]'), t.content.on("click", ".intimate-task-word", function(i) {
					var a = e(this).attr("data-name");
					t.content.find(".charge-task-name").val(a)
				})
			},
			render: {
				taskWrap: function() {
					var e = k.sprayInteract ? k.sprayInteract.mission_setting || {} : {},
						t = k.openStatus || {},
						n = i.string.join("{{ if (hasAdd) }}", '<div class="charge-task-box hasAdd" id="energy-charge-wrap">', "{{ else }}", '<div class="charge-task-box" id="energy-charge-wrap">', "{{ /if }}", '<div class="charge-task charge-task-edit" data-energy-charge="charge-task-box">', "{{ if (hasAdd) }}", '<a href="javascript:;" class="spray-task-active J-task-pp"><img class="spray-task-active-img" src="{{spray.web_activity_background}}" /></a>', "{{ /if }}", '<a href="javascript:;" class="charge-tak-back charge-back" data-energy-charge="back">返回</a>', '<a href="javascript:;" class="imt-anchor-tab1">发布充能任务</a>', '<a href="javascript:;" class="imt-anchor-tab2">设置亲密任务</a>', '<a href="javascript:;" class="charge-close" data-energy-charge="close"></a>', '<div class="charge-task-inner">', '<div class="charge-content" data-energy-charge="energy-charge-content">', "</div>", "</div>", '<div class="charge-guide-one"></div>', '<div class="charge-guide-two"></div>', "</div>", "</div>"),
						s = a.compile(n),
						r = s({
							spray: e,
							status: t,
							hasAdd: !(!t.is_activity_open || !e.web_activity_background)
						});
					return r
				},
				gameShows: function() {
					var e = i.string.join('<div class="charge-content-info">', '<i class="info-title-icon"></i>', "<h3>玩法说明</h3>", '<div class="charge-content-info-text">', "<p>主播设置任务以及对应的礼物要求。</p>", "<p>当水友赠送礼物达到你设定的条件后，主播须完成对应任务。</p>", "</div>", '<div class="charge-instruction-steps"></div>', '<a class="charge-task-btn" href="javascript:;" data-energy-charge="task-add-btn">开始添加新任务</a>', "</div>"),
						t = a.compile(e),
						n = t();
					return n
				},
				addOrEditTask: function(e, t) {
					var n = i.string.join("{{ if (data && data.mstype == 1) }}", '<div class="charge-content-info spray-task-edit" data-spray="1">', "{{ else }}", '<div class="charge-content-info">', "{{ /if }}", '<span class="charge-edit-title">', '<span class="charge-edit-explain">任务</span>', '<input class="charge-task-name" type="text" {{ (data && data.mstype == 1) ? "readonly" : "" }} name="taskName" placeholder="填写不超过10个字，如转5圈"', '{{ if (type === "编辑")}}', 'data-task-id="{{ data.instId }}" data-gift-id="{{ data.giftId }}" value="{{ data.taskName }}" ', "{{ /if }}", ">", '<div class="charge-edit-recommend">', '<div class="charge-erc-title">推荐', "</div>", '<div class="charge-erc-content empty">', '<div class="charge-erc-csec"></div>', "</div>", '<div class="bottom-gradient"></div>', "</div>", '<span class="charge-edit-title">礼物设置</span>', '<div class="charge-gift-box" data-energy-charge="gift-select"></div>', '<span class="charge-edit-explain charge-cell">X</span>', '<div class="charge-edit-num">', '<input class="charge-task-num" maxLength="2" type="text" name="giftNums" placeholder="1~99"', '{{ if (type === "编辑")}}', 'value="{{ data.giftNum }}', "{{ /if }}", '">', '<span class="charge-task-unit">个</span>', "</div>", '<div class="charge-wrong-attention2" data-energy-charge="wrong-tips"></div>', '<div class="spray-task-attention {{ devicestu ? "spray-open" : "spray-close" }}" id="js-spray-device-status" data-status="0">', '<span class="spray-device-open"><i></i>{{ deviceex || "当前设备已开启" }}</span>', '<span class="spray-device-close"><i></i>{{ deviceex || "设备未开启，请先开启设备" }}</span>', "</div>", '<a class="charge-task-btn" href="javascript:;" data-energy-charge="task-submit-btn" data-click-lock="0">', '{{ if (type === "编辑")}}', "保存", "{{ else }}", "提交", "{{ /if }}", "</a>", '<div class="charge-authority-file">', '<a href="https://www.douyu.com/cms/gong/201705/17/5341.shtml" target="_blank">《亲密互动规范》</a>', "</div>", "</div>"),
						s = a.compile(n),
						r = s({
							type: e,
							data: t,
							devicestu: h.sprayDeviceStu,
							deviceex: h.sprayDeviceEx
						});
					return r
				},
				giftList: function(e, t, n) {
					var s = i.string.join('<div data-energy-charge="select-sec">', '<input type="text" data-gift-id="{{ selectGiftId ? selectGiftId : list[0].id }}" name="giftName" class="charge-gift-name" value="{{ selectText }}" readonly>', '<div class="imt-gift-name">{{ list[0].name }}</div>', '<div class="imt-gift-price">{{ list[0].price }}</div>', '<div class="charge-arrow-box" data-energy-charge="select-icon">', "<span></span>", "</div>", "</div>", '<ul class="charge-name-list" data-energy-charge="select-list">', "{{ if (misstype) }}", "{{ each list as item index }}", "{{ if (item.unit == 2) }}", '<li {{ if item.id == selectGiftId }}class="active"{{ /if }}', ' data-gift-name="{{ item.name }}" data-gift-id="{{ item.id }}" data-gift-price="{{ item.price }}">', '<span class="e-gift-name">{{ item.name }}</span>', '<span class="e-gift-price">{{ item.price }}</span>', "</li>", "{{ /if }}", "{{ /each }}", "{{ else }}", "{{ each list as item index }}", '<li {{ if item.id == selectGiftId }}class="active"{{ /if }}', ' data-gift-name="{{ item.name }}" data-gift-id="{{ item.id }}" data-gift-price="{{ item.price }}">', '<span class="e-gift-name">{{ item.name }}</span>', '<span class="e-gift-price">{{ item.price }}</span>', "</li>", "{{ /each }}", "{{ /if }}", "</ul>"),
						r = e[0].name + "(" + e[0].price + ")",
						o = e[0].id;
					e.forEach(function(e) {
						e.id == t && (o = e.id, r = e.name + "(" + e.price + ")")
					});
					var l = a.compile(s),
						c = l({
							list: e,
							selectGiftId: o,
							selectText: r,
							misstype: n || !1
						});
					return c
				},
				newTaskList: function(e) {
					var t = i.string.join('<div class="charge-content-info">', '<dl class="task-list-box" data-energy-charge="task-scroll">', "{{ each list as item }}", "{{ if (item.mission_type == 1) }}", '<dd class="spray-task-item" data-task-mstype="1" data-energy-charge="task-edit-list" data-status="{{ item.taskStatus }}" data-taskId="{{ item.taskId }}" data-task-status="{{ item.taskStatus }}" data-taskName="{{ item.taskName }}" data-giftId="{{ item.giftId }}" data-giftNum="{{item.giftNum}}">', "{{ else }}", '<dd data-energy-charge="task-edit-list" data-status="{{ item.taskStatus }}" data-taskId="{{ item.taskId }}" data-task-status="{{ item.taskStatus }}" data-taskName="{{ item.taskName }}" data-giftId="{{ item.giftId }}" data-giftNum="{{item.giftNum}}">', "{{ /if }}", "{{ if (item.taskStatus === 2 || item.taskStatus === 3)}}", '<div class="choose-radio" data-select-status="0" data-energy-charge="task-select"></div>', "{{ else }}", '<div class="choose-radio disable"></div>', "{{ /if }}", "{{ if (item.taskStatus === 2 && item.isInvalid) }}", '<div class="charge-audit-mark charge-audit-disable"></div>', "{{ else if (item.taskStatus === 3) }}", '<div class="charge-audit-mark charge-audit-failed"></div>', "{{ else if (item.taskStatus === 1) }}", '<div class="charge-audit-mark charge-audit-audit"></div>', "{{ else if (item.taskStatus === 4) }}", '<div class="charge-audit-mark charge-audit-publish"></div>', "{{ /if }}", '<div class="charge-gift-img">', '<img src="{{ item.giftIcon }}">', "</div>", '<div class="charge-gift-progress">', '<div class="gift-progress-info">', '<span class="progress-bar-scale">x{{ item.giftNum }}</span>', '<span class="task-name">{{ item.taskName }}</span>', '<span class="{{ item.taskStatusClass }}" data-energy-charge="task-audit-status">', "{{ if (item.taskStatus === 3) }}", "{{ item.auditRemark }}", "{{ else }}", "{{ item.taskStatusText }}", "{{ /if }}", "</span>", "</div>", "</div>", "{{ if (item.taskStatus === 4)}}", '<div class="gift-edit-btn">', '<a class="disable" href="javascript:;">编辑</a>', "</div>", "{{ else if (item.taskStatus === 1)}}", '<div class="gift-edit-btn">', '<a class="disable" href="javascript:;">编辑</a>', "</div>", "{{ else }}", '<div class="gift-edit-btn">', '<a href="javascript:;" data-energy-charge="task-edit-btn">编辑</a>', "</div>", "{{ /if }}", "</dd>", "{{ /each }}", "</dl>", '<div class="charge-authority-file">', "<span>点击发布表示已同意</span>", '<a href="https://www.douyu.com/cms/gong/201705/17/5341.shtml" target="_blank">《亲密任务互动规范》</a>', "</div>", '<a class="charge-task-btn" href="javascript:;" data-energy-charge="task-publish-btn">发布</a>', '<a class="charge-task-del-btn" data-energy-charge="task-delete-btn" href="javascript:;">删除</a>', '<a class="charge-task-add-btn" data-energy-charge="task-add-btn" href="javascript:;"><i>+</i>添加</a>', "</div>"),
						n = a.compile(t),
						s = n({
							list: e
						});
					return s
				},
				newTaskListEmpty: function() {
					var e = i.string.join('<div class="charge-content-info">', '<div class="charge-empty-bk"></div>', '<div class="charge-empty-tips">当前没有可发布的任务，<br>请添加新任务</div>', '<a href="javascript:;" data-energy-charge="task-add-btn" class="charge-empty-add"></a>', "</div>"),
						t = a.compile(e),
						n = t();
					return n
				}
			},
			check: {
				isHasEntrance: function(e, t) {
					var i = k,
						a = {
							url: g.check.isHasEntrance
						},
						n = {
							success: function(i) {
								i && 0 === parseInt(i.error, 10) && i.data && 1 === parseInt(i.data.is_open, 10) ? e() : t()
							},
							error: function() {
								t()
							}
						};
					i.sendAjax(a, n)
				},
				isOtherActive: function(t) {
					var i = k,
						a = {
							url: g.check.getActInfo
						},
						n = {
							success: function(i) {
								i && i.data && (0 === parseInt(i.data.status, 10) || 3 === parseInt(i.data.status, 10)) ? t() : e.dy_dialog.tips_black(i.data.start_info)
							}
						};
					i.sendAjax(a, n)
				},
				isExitsTask: function(t) {
					var i = k,
						a = {
							url: g.check.isExistsTask
						},
						n = {
							success: function(i) {
								i && 0 === parseInt(i.error, 10) && i.data ? 0 === parseInt(i.data.status, 10) ? t.notSeted() : t.isSeted() : e.dy_dialog.tips_black(i.msg || "获取直播间信息失败，请稍后重试", 2)
							}
						};
					i.sendAjax(a, n)
				},
				giftNums: function(i, a, n) {
					var s = k,
						r = i.nums,
						o = s.doms,
						l = /^[1-9]\d*$/;
					e.trim(r) ? l.test(r) && r > 0 && 1e3 > r ? (v.giftNumsFlag = !0, i.isEdit ? "back-wait" === o.back.attr("data-energy-charge-type") ? s.taskStatus.edit(i, n, !0) : s.taskStatus.edit(i, n) : (s.taskStatus.add(i, n), t.trigger("dys", {
						key: "dys.room.energy-chargr.submit.click"
					})), n.attr("data-click-lock", "1")) : (a.html("<i></i>请输入1~999间整数").show(), v.giftNumsFlag = !1) : (a.html("<i></i>礼物数量不能为空").show(), v.giftNumsFlag = !1)
				},
				nameLength: function(e) {
					return e ? !(e.length >= h.minLen && e.length <= h.maxLen) : void 0
				}
			},
			getHtml: {
				getGiftList: function(t) {
					var i = k,
						a = i.doms,
						n = a.wrap,
						s = {
							url: g.task.getGiftList
						},
						r = {
							success: function(s) {
								if (s && 0 === parseInt(s.error, 10)) if (e.isArray(s.data) && s.data.length) {
									var r = n.find('input[name="taskName"]'),
										o = r.attr("data-gift-id");
									a.content.find('[data-energy-charge="gift-select"]').html(i.render.giftList(i.handleData.giftList(s.data), o, t)), a.tips = n.find('[data-energy-charge="wrong-tips"]'), a.selectList = n.find('[data-energy-charge="select-list"]'), a.selectIcon = n.find('[data-energy-charge="select-icon"]'), a.selectGfname = n.find(".imt-gift-name"), a.selectGfprice = n.find(".imt-gift-price")
								} else a.content.find('[data-energy-charge="task-submit-btn"]').addClass("unavailable"), a.content.find('[data-energy-charge="gift-select"]').html('<input type="text" class="charge-gift-name" value="没有可用于充能任务的礼物" readonly>');
								else a.content.find('[data-energy-charge="task-submit-btn"]').addClass("unavailable"), a.content.find('[data-energy-charge="gift-select"]').html('<input type="text" class="charge-gift-name" value="礼物系统不可用" readonly>')
							}
						};
					i.sendAjax(s, r)
				},
				getTaskList: function(t) {
					var i, a = k,
						n = a.doms,
						s = {
							url: g.task.list
						},
						r = {
							success: function(s) {
								s && 0 === parseInt(s.error, 10) ? e.isArray(s.data) ? (0 === s.data.length ? (i = a.render.newTaskListEmpty(), a.addWrapClass("charge-no-task")) : (i = a.render.newTaskList(a.handleData.taskList(s.data)), a.addWrapClass("charge-task-list"), t && a.taskTips("提交成功，需等待2-3分钟审核", 2)), n.titleIcon.show(), n.back.hide(), n.content.removeClass("charge-loading").html(i).find('[data-energy-charge="task-scroll"]').mCustomScrollbar(), n.wrap.is(":hidden") && n.wrap.show()) : e.dy_dialog.tips_black("获取任务列表失败，请稍后再试", 2) : e.dy_dialog.tips_black(s.msg || "获取任务列表失败，请稍后再试", 2)
							},
							error: function() {
								a.taskTips("获取任务列表失败，请稍后再试", 2)
							}
						};
					a.sendAjax(s, r)
				}
			},
			handleData: {
				giftList: function(t) {
					var i = [];
					return e.each(t, function(e) {
						var a = t[e];
						i.push({
							id: a.gift_id || 0,
							name: a.gift_name || "",
							price: a.gift_price || "",
							unit: a.gift_unit
						})
					}), i
				},
				taskList: function(e) {
					for (var t = 0, i = e.length, a = []; i > t; t++) {
						var n = e[t],
							s = "",
							r = "";
						switch (1 == n.mission_type && (h.sprayDeviceStu = n.whiff_device_status, h.sprayDeviceEx = n.whiff_device_detail), parseInt(n.task_status, 10)) {
						case 1:
							s = "审核中", r = "in-review";
							break;
						case 2:
							1 === parseInt(n.is_invalid, 10) ? (s = "礼物失效", r = "not-approve") : (s = "", r = "is-approve");
							break;
						case 3:
							s = "审核未通过", r = "not-approve";
							break;
						case 4:
							s = "已发布", r = "is-publish"
						}
						a.push({
							taskId: n.inst_id || "",
							taskName: n.task_name || "",
							giftIcon: n.gift_icon || h.giftDefaultIcon,
							giftId: n.gift_id || "",
							giftNum: parseInt(n.gift_num, 10) || 0,
							taskStatus: parseInt(n.task_status, 10) || 0,
							taskStatusText: s,
							taskStatusClass: r,
							auditRemark: n.audit_remark || "名称违规",
							isInvalid: parseInt(n.is_invalid, 10) || 0,
							Remark: n.remark || "",
							mission_type: n.mission_type || 0
						})
					}
					return a
				}
			},
			taskStatus: {
				add: function(t, i) {
					var a = k,
						n = "submit",
						s = {
							url: g.status.add,
							type: "POST",
							data: {
								task_name: t.taskName,
								gift_id: t.giftId,
								gift_num: t.nums
							}
						},
						r = {
							complete: function() {
								v.lock[n] = !1
							},
							success: function(t) {
								t && (0 === parseInt(t.error, 10) ? (t.data && 2 == t.data.status ? a.getHtml.getTaskList() : a.getHtml.getTaskList(!0), a.doms.back.hide(), b()) : -2 === parseInt(t.error, 10) ? (i.attr("data-click-lock", "0"), e.dy_dialog(t.msg || "最多添加20条任务信息，请删除后再添加", {
									title: "提示",
									mask: !0,
									buttons: [{
										content: "确定",
										callback: function() {
											this.hide()
										}
									}]
								})) : (i.attr("data-click-lock", "0"), a.taskTips(t.msg || "提交失败，请稍后再试", 2)))
							},
							error: function() {
								i.attr("data-click-lock", "0"), a.taskTips("提交失败，请稍后再试", 2)
							}
						};
					a.sendAjax(s, r, n)
				},
				edit: function(e, t, i) {
					var a = k,
						n = "submit",
						s = {
							url: g.status.edit,
							type: "POST",
							data: {
								inst_id: e.taskId,
								gift_id: e.giftId,
								gift_num: e.nums,
								task_name: e.taskName
							}
						},
						r = {
							complete: function() {
								v.lock[n] = !1
							},
							success: function(e) {
								e && 0 === parseInt(e.error, 10) ? a.getHtml.getTaskList(i) : (t.attr("data-click-lock", "0"), a.taskTips(e.msg || "保存失败，请稍后再试", 2))
							},
							error: function() {
								t.attr("data-click-lock", "0"), a.taskTips("保存失败，请稍后再试", 2)
							}
						};
					a.sendAjax(s, r, n)
				},
				remove: function(t) {
					var i = k,
						a = i.doms,
						n = {
							url: g.status.remove,
							type: "POST",
							data: {
								inst_id: t.instId
							}
						},
						s = {
							success: function(e) {
								e && 0 === parseInt(e.error, 10) ? (i.doms.content.find('[data-task-select="1"]').remove(), i.doms.content.find('[data-energy-charge="task-scroll"]').mCustomScrollbar("update"), 0 === a.wrap.find('[data-energy-charge="task-edit-list"]').length && (i.addWrapClass("charge-no-task"), a.content.html(i.render.newTaskListEmpty()))) : i.taskTips(e.msg || "删除失败，请稍后再试", 2)
							},
							error: function() {
								i.taskTips("删除失败，请稍后再试", 2)
							}
						};
					e.dy_dialog("删除后不可恢复，确定要删除？", {
						title: "删除任务",
						mask: !0,
						buttons: [{
							content: "删除",
							callback: function() {
								this.hide(), i.sendAjax(n, s)
							}
						}, {
							content: "取消",
							callback: function() {
								this.hide()
							}
						}]
					})
				},
				publish: function(e) {
					var i = k,
						a = "publish",
						n = {
							url: g.status.publish,
							type: "POST",
							data: {
								inst_ids: e.instIds
							}
						},
						s = {
							complete: function() {
								v.lock[a] = !1
							},
							success: function(a) {
								a && 0 === parseInt(a.error, 10) ? (i.getHtml.getTaskList(), t.trigger("dys", {
									key: "dys.room.energy-chargr.publish.click",
									task_num: e.taskNums
								})) : i.taskTips(a.msg || "发布任务失败，请稍后再试", 2)
							},
							error: function() {
								i.taskTips("发布任务失败，请稍后再试", 2)
							}
						};
					i.sendAjax(n, s, a)
				}
			},
			taskAudit: function(e) {
				var t = this.doms.wrap.find('[data-energy-charge="task-edit-list"][data-taskId="' + e.inst_id + '"]'),
					i = t.find('[data-energy-charge="task-audit-status"]'),
					a = t.find(".choose-radio"),
					n = t.find(".gift-edit-btn a"),
					s = t.find(".charge-audit-mark"),
					r = "",
					o = "";
				1 === parseInt(e.is_pass, 10) ? (r = "", o = "is-approve", s.remove()) : 0 === parseInt(e.is_pass, 10) && (r = e.remark, o = "not-approve", s.removeClass("charge-audit-audit").addClass("charge-audit-failed")), a.removeClass("disable"), a.attr("data-select-status", "0"), a.attr("data-energy-charge", "task-select"), n.removeClass("disable"), n.attr("data-energy-charge", "task-edit-btn"), i.addClass(o).html(r)
			},
			giftSelect: function(e, t) {
				var i = this;
				i.addWrapClass("charge-task-edit"), i.doms.content.html(i.render.addOrEditTask(e, t)), i.getHtml.getGiftList(t && 1 == t.mstype), i.delayWordList()
			},
			delayWordList: function() {
				var e = this,
					t = e.doms.content.find(".charge-erc-content"),
					i = t.find(".charge-erc-csec");
				u.getTaskWordClone(function(e) {
					t.hide();
					var a = !0;
					if (e.length) for (var n = 0, s = e.length; s > n; n++) {
						var r = e[n];
						a = !1, r.recommend_type = 1, r.status = "1", r.sign = 0, r.target = new f(r), i.append(r.target.$tag)
					}
					a || t.removeClass("empty"), t.show().mCustomScrollbar()
				})
			},
			addWrapClass: function(e) {
				this.doms.box.removeClass().addClass("charge-task " + e)
			},
			taskTips: function(t, i, a) {
				t && e.dy_dialog.tips_black(t, 1e3 * i)
			},
			getCSRFCookie: function(t) {
				var i = this,
					a = n.get(o.get("sys.tvk"));
				return a ? void(t && t({
					name: o.get("sys.tn"),
					value: a
				})) : void e.ajax({
					url: "/curl/csrfApi/getCsrfCookie",
					type: "GET",
					dataType: "json",
					success: function(e) {
						0 === e.error && i.getCSRFCookie(t)
					}
				})
			},
			sendAjax: function(t, i, a) {
				var n = t.url,
					s = t.data || {},
					r = i || {};
				if (n) {
					if (a) {
						if (v.lock[a]) return;
						v.lock[a] = !0
					}
					this.getCSRFCookie(function(i) {
						s[i.name] = i.value, e.ajax({
							url: n,
							type: t.type || "GET",
							data: s,
							dataType: "json",
							complete: r.complete || e.noop,
							success: r.success || e.noop,
							error: r.error || e.noop
						})
					})
				}
			},
			showEnergyDlg: function(e) {
				var t = this,
					i = t.doms,
					a = i.wrap,
					n = i.content;
				return e ? (i.titleIcon.hide(), t.addWrapClass("charge-task-instruction"), n.addClass("charge-loading"), a.show(), void t.getHtml.getTaskList()) : void t.check.isOtherActive(function() {
					u.showNoviceGuide(function() {
						i.titleIcon.hide(), t.addWrapClass("charge-task-instruction"), n.addClass("charge-loading"), a.show(), t.getHtml.getTaskList()
					})
				})
			},
			bindEvent: function() {
				var i = this,
					a = i.doms,
					n = a.wrap,
					s = a.content;
				a.btn.on("click.energyChargeTaskBtn", function() {
					i.showEnergyDlg(), t.trigger("dys", {
						key: "dys.room.energy-chargr.entrance.click"
					})
				}), e(".spray-task-active").length && t.trigger("dys", {
					key: "dys.room.energy.Active.show"
				}), e(".spray-task-active").on("click", function() {
					t.trigger("dys", {
						key: "dys.room.energy.Active.click"
					})
				}), a.tipsEnter.on("click", function() {
					a.popTips.hide(), t.trigger("mod.energy.imt.show", !0)
				}), n.on("click.energyChargeTaskAdd", '[data-energy-charge="task-add-btn"]', function() {
					a.titleIcon.show(), i.addWrapClass("charge-task-edit"), i.giftSelect("添加"), a.back.html("<i></i>返回").attr("data-energy-charge-type", "back-task").show()
				}).on("click", ".imt-anchor-tab2", function(e) {
					n.find('[data-energy-charge="close"]').trigger("click"), t.trigger("mod.energy.imt.show")
				}).on("focus.energyChargeTaskName", 'input[name="taskName"]', function() {
					v.taskNameFlag || a.tips.hide()
				}).on("focus.energyChargeTaskGiftNums", 'input[name="giftNums"]', function() {
					!v.giftNumsFlag && v.taskNameFlag && a.tips.hide()
				}).on("click.energyChargeGiftSelectSan", 'input[name="giftName"], [data-energy-charge="select-sec"]', function() {
					a.selectIcon.toggleClass(h.active), a.selectList.mCustomScrollbar().toggle()
				}).on("click.energyChargeGiftSelectSingal", '[data-energy-charge="select-list"] li', function(t) {
					t.stopPropagation(), a.selectIcon.toggleClass(h.active), a.selectList.toggle().find("li").removeClass(h.active), e(this).addClass(h.active), n.find('input[name="giftName"]').val(e(this).text()).attr("data-gift-id", e(this).attr("data-gift-id")), a.selectGfname.text(e(this).attr("data-gift-name")), a.selectGfprice.text(e(this).attr("data-gift-price"))
				}).on("click.energyChargeAddTask", '[data-energy-charge="task-submit-btn"]', function() {
					var t = a.tips,
						s = n.find('input[name="taskName"]'),
						r = s.val(),
						o = n.find(".charge-back"),
						l = n.find('input[name="giftNums"]').val(),
						c = {
							taskName: r,
							taskId: s.attr("data-task-id") || "",
							giftId: n.find('input[name="giftName"]').attr("data-gift-id") || s.attr("data-gift-id"),
							nums: l,
							isEdit: "edit" === o.attr("data-energy-charge-type")
						};
					if ("0" === e(this).attr("data-click-lock")) {
						if (!e.trim(r)) return t.html("<i></i>任务名称不能为空").show(), v.taskNameFlag = !1, !1;
						if (i.check.nameLength(r)) return t.html("<i></i>任务名称2-10个字").show(), v.taskNameFlag = !1, !1;
						v.taskNameFlag = !0, i.check.giftNums(c, t, e(this))
					}
				}).on("click.energyChargeDeteleTaskMore", '[data-energy-charge="task-delete-btn"]', function() {
					var t = n.find('[data-task-select="1"]'),
						a = [],
						s = !1;
					if (t.each(function() {
						var t = e(this);
						1 == t.attr("data-task-mstype") ? s = !0 : a.push(t.attr("data-taskId"))
					}), a.length > 0) {
						var r = {
							instId: a.join(",")
						};
						i.taskStatus.remove(r)
					} else s ? i.taskTips("喷喷任务无法被删除", 2) : i.taskTips("请选择任务后再删除", 2)
				}).on("click.energyChargeEditTask", '[data-energy-charge="task-edit-btn"]', function() {
					var t = e(this).closest('[data-energy-charge="task-edit-list"]'),
						n = {
							instId: t.attr("data-taskId"),
							taskName: t.attr("data-taskName"),
							giftId: t.attr("data-giftId"),
							giftNum: t.attr("data-giftNum"),
							mstype: t.attr("data-task-mstype")
						};
					a.box.hasClass("charge-task-stay") || a.box.hasClass("charge-task-pulish") ? a.back.attr("data-energy-charge-type", "back-wait") : a.back.attr("data-energy-charge-type", "edit"), a.back.html("<i></i>返回").show(), i.giftSelect("编辑", n)
				}).on("click.energyChargeEditBack", '[data-energy-charge-type="back-task"],[data-energy-charge-type="edit"]', function() {
					v.taskNameFlag = !1, i.getHtml.getTaskList()
				}).on("click.energyChargeTaskSelect", '[data-energy-charge="task-edit-list"]', function() {
					var t = e(this).find('[data-energy-charge="task-select"]'),
						i = t.attr("data-select-status"),
						a = "0" === i ? "1" : "0";
					"1" === a ? e(this).addClass("select") : e(this).removeClass("select"), t.toggleClass(h.active).attr("data-select-status", a), t.closest('[data-energy-charge="task-edit-list"]').attr("data-task-select", a)
				}).on("click.energyChargeTaskPublish", '[data-energy-charge="task-publish-btn"]', function() {
					var t = n.find('[data-task-select="1"]'),
						a = [];
					return t.each(function() {
						a.push(e(this).attr("data-taskId"))
					}), 0 === a.length ? void i.taskTips("请选择任务后再发布", 2) : a.length > 6 ? void i.taskTips("最多只能发送6个任务", 2) : void i.taskStatus.publish({
						taskNums: a.length,
						instIds: a.join(",")
					})
				}).on("click.energyChargeTaskClose", '[data-energy-charge="close"]', function() {
					n.hide(), a.back.hide(), s.empty(), i.callFlash_PopupClose()
				}).on("click", ".J-task-pp", function(e) {
					p.showRank()
				}), l.reg("room_energy_task_anchor_pop", function() {
					i.getHtml.getTaskList()
				}), l.reg("room_data_handler", function(e) {
					var t = r.decode(e).too();
					if ("task_audit" === t.type) i.taskAudit(t);
					else if ("device_ss" === t.type && t.rid == o.get("room.room_id")) {
						var a = 1 == t.status;
						i.sprayDeviceSc(a, t.detail)
					}
				}), l.reg("room_chongnengv3", function(e) {
					var t = JSON.parse(e),
						i = t.type;
					switch (i) {
					case "showRank":
						p.showRank()
					}
				})
			},
			getInteract: function() {
				var t = e.Deferred(),
					i = this;
				return i.sprayInteract && t.resolve(i.sprayInteract), c.load(g.active, "interact", function(e) {
					i.sprayInteract = e, t.resolve(e)
				}, function(e) {
					t.reject(e)
				}, function() {}, !0), t.promise()
			},
			sprayDeviceSc: function(t, i) {
				h.sprayDeviceStu = t, h.sprayDeviceEx = i;
				var a = e("#js-spray-device-status");
				a.length && (a.removeClass("spray-close spray-open"), t ? (a.addClass("spray-open"), a.find(".spray-device-open").html("<i></i>当前设备已开启")) : (a.addClass("spray-close"), i && a.find(".spray-device-close").html("<i></i>" + i)))
			}
		};
	return {
		init: function() {
			var i = o.get("sys.uid") == o.get("room.owner_uid") ? 1 : 0;
			t.on("mod.roompoint.low", function(a) {
				i && (a === !0 ? l.reg("room_energy_task_anchor_pop", function() {
					e.dy_dialog.tips_black("您的积分过低，恢复后可继续使用充能任务", 3)
				}) : (k.init(), t.on("mod.energy.charge.show", function() {
					k.showEnergyDlg(!0)
				})))
			}), u.init(), d.init()
		}
	}
}), define("douyu/page/room/normal/mod/gameRecommend", ["jquery", "shark/util/storage/1.0", "shark/util/template/2.0", "douyu/page/room/base/api", "shark/observer"], function(e, t, i, a, n) {
	var s = {
		storeName: "cpsTip",
		urls: {
			whiteList: "/member/mgamecps/checkCpsWhitelist",
			getRecommend: "/ztCache/mobilegame/getroomapp",
			downloadLink: "/mgamecps/cps/intro?rid=",
			oneKeyPromote: "/member/mgamecps/oneKeyPromote",
			dialogStatus: "/member/mgamecps/getOpenLiveDialogStatus",
			joinCpsPlan: "/member/mgamecps/joinCpsPlan"
		},
		flag: !0
	},
		r = {
			init: function() {
				var t = this;
				t.getDoms(), t.userrole = !1, t.roomDataLogin = !1, this.addEvent(), a.reg("room_data_login", function() {
					t.roomDataLogin = !0, t.userrole && t.getRecommend()
				}), a.reg("room_cps_SendExtensionNum", function(t) {
					e.dialog.tips_black("本日发送手游推广弹窗次数已达10次")
				}), a.reg("room_cps_SendExtensionBack", function(t) {
					0 === t ? e.dialog.tips_black("发送游戏推广弹窗成功") : e.dialog.tips_black("发送游戏推广弹窗失败")
				})
			},
			getDoms: function() {
				this.doms = {
					$curVideo: e("#js-room-video"),
					$cpsEntry: e(".live-group-btns").find('[data-live-group="cps-btn"]'),
					$cpsTips: e(".live-group-btns").find('[data-cps="cps-tips"]')
				}
			},
			addEvent: function() {
				var t = this;
				this.doms.$cpsEntry.on("click", function() {
					n.trigger("dys", {
						key: "dys.room.cps.entrance.click"
					}), window.open("/member/mgamecps")
				}), this.doms.$cpsTips.on("click", ".pop-close-btn", function() {
					t.doms.$cpsTips.hide()
				}), this.doms.$curVideo.on("click", "#cpsPromoteModal .one-key-promote", function() {
					e("#cpsPromoteModal").hide(), t.promoteApp(), DYS.sub({
						action_code: "click_anchorlive_mgcya_popup_cya"
					})
				}), this.doms.$curVideo.on("click", "#cpsPromoteModal .ignore", function() {
					e("#cpsPromoteModal").hide(), DYS.sub({
						action_code: "click_anchorlive_mgcya_popup_later"
					})
				}), this.doms.$curVideo.on("click", "#cpsPromoteModal .change-app", function() {
					e(this).parent().hasClass("ios") ? t.renderApp("ios") : e(this).parent().hasClass("android") && t.renderApp("android")
				}), this.doms.$curVideo.on("click", "#cpsJoinModal .checkbox i", function() {
					e(this).hasClass("checked") ? e(this).removeClass("checked") : e(this).addClass("checked")
				}), this.doms.$curVideo.on("click", "#cpsJoinModal .join-now", function() {
					e("#cpsJoinModal .checkbox i").hasClass("checked") && (e("#cpsJoinModal").hide(), t.joinCpsPlan(), DYS.sub({
						action_code: "click_anchorlive_mgcya_popup_join"
					}))
				}), this.doms.$curVideo.on("click", "#cpsJoinModal .ignore", function() {
					e("#cpsJoinModal").hide(), DYS.sub({
						action_code: "click_anchorlive_mgcya_popup_ignore"
					})
				}), n.on("mod.center.userrole.ready", function(e) {
					var i = e.join(); - 1 !== i.indexOf(2) ? (t.userrole = "anchor", t.checkWhiteList(), n.on("room.normal.live.broadcast.close", function() {
						setTimeout(function() {
							t.getRecommendStatus()
						}, 18e4)
					}), n.on("room.normal.live.broadcast.send", function() {
						setTimeout(function() {
							t.getRecommendStatus()
						}, 18e4)
					}), n.on("room.normal.live.broadcast.nomore", function() {
						setTimeout(function() {
							t.getRecommendStatus()
						}, 18e4)
					}), n.on("room.normal.live.broadcast.disable", function() {
						t.getRecommendStatus()
					})) : t.userrole = "user", t.roomDataLogin && t.getRecommend()
				})
			},
			getRecommendStatus: function() {
				var t = this;
				e.ajax({
					type: "POST",
					url: s.urls.dialogStatus,
					dataType: "json",
					success: function(e) {
						0 === e.error && (1 === e.data.showDialog ? t.showJoinCpsModal() : 2 === e.data.showDialog && (t.cpsApp = e.data.appList, t.showRandomApp()))
					}
				})
			},
			showRandomApp: function() {
				var e = 0;
				if (this.cpsApp && (this.cpsApp.ios.length && (e += 1), this.cpsApp.android.length && (e += 1), 0 !== e)) {
					var t = ['<div class="cps-promote-modal" id="cpsPromoteModal">', "   <p>您推广的手游空空如也，赶紧推广吧</p>", '   <div class="random-cps-app {{if rows === 2}}two-row{{/if}}">', '       <div class="app-item ios"></div>', '       {{if rows === 2}}<div class="divide-line"></div>{{/if}}', '       <div class="app-item android"></div>', "   </div>", '   <div class="cps-modal-btn one-key-promote">一键推广</div>', '   <div class="cps-modal-btn ignore">下次再说</div>', "</div>"].join(""),
						a = i.compile(t),
						n = a({
							rows: e
						});
					this.doms.$curVideo.find("#cpsPromoteModal").remove(), this.doms.$curVideo.append(n), this.renderApp("ios"), this.renderApp("android")
				}
			},
			renderApp: function(e) {
				var t, a = ['<img class="app-pic" src="{{data.icon}}">', '<div class="app-name">', '   <span class="name">{{data.name}}</span>', '   <span class="game-platform">{{data.typeName}}</span>', "</div>", "{{if data.type === 4 || data.type === 5}}", '   <div class="divide-rate">新增用户单价：<span>{{data.cpa_price}}元/个</span></div>', "{{else}}", "   {{if data.rate_type === 1}}", '       <div class="divide-rate">分成比例：<span>{{data.rate}}%</span></div>', "   {{/if}}", "   {{if data.rate_type === 2}}", "       {{if data.rate_step.length > 1}}", '           <div class="divide-rate">分成比例：', "               <span>最高{{data.rate_max}}%</span></div>", "       {{else if data.rate_step.length === 1}}", '           <div class="divide-rate">分成比例：', "               <span>{{data.rate_step[0].rate}}%</span></div>", "       {{else}}", '           <div class="divide-rate">分成比例：<span>{{data.rate}}%</span></div>', "       {{/if}}", "   {{/if}}", "{{/if}}", '<div class="change-app"></div>'].join(""),
					n = i.compile(a);
				if ("ios" === e) if (this.cpsApp.ios && this.cpsApp.ios.length) {
					var s = Math.floor(Math.random() * this.cpsApp.ios.length),
						r = this.cpsApp.ios[s];
					r.cpa_price = Number(r.cpa_price).toFixed(2), r.typeName = this.cpsAppTypeName(r.type), this.iosAppId = r.app_id, t = n({
						data: r
					}), this.doms.$curVideo.find("#cpsPromoteModal .app-item.ios").html(t)
				} else this.doms.$curVideo.find("#cpsPromoteModal .app-item.ios").remove();
				else if ("android" === e) if (this.cpsApp.android && this.cpsApp.android.length) {
					var o = Math.floor(Math.random() * this.cpsApp.android.length),
						l = this.cpsApp.android[o];
					l.cpa_price = Number(l.cpa_price).toFixed(2), l.typeName = this.cpsAppTypeName(l.type), this.androidAppId = l.app_id, t = n({
						data: l
					}), this.doms.$curVideo.find("#cpsPromoteModal .app-item.android").html(t)
				} else this.doms.$curVideo.find("#cpsPromoteModal .app-item.android").remove()
			},
			showJoinCpsModal: function() {
				var e = ['<div class="cps-join-modal" id="cpsJoinModal">', "   <p>诚邀您加入斗鱼手游推广计划</p>", '   <div class="intro">精选的优质手游<br>一次推广，持续获得收益</div>', '   <div class="checkbox"><i></i>阅读并同意', '       <a target="_blank" href="https://www.douyu.com/cms/gong/201708/15/6045.shtml">', "《斗鱼手游推广服务协议》</a>", "   </div>", '   <div class="cps-modal-btn join-now">立即加入</div>', '   <div class="cps-modal-btn ignore">忽略</div>', "</div>"].join("");
				this.doms.$curVideo.find("#cpsJoinModal").remove(), this.doms.$curVideo.append(e)
			},
			promoteApp: function() {
				e.ajax({
					type: "POST",
					url: s.urls.oneKeyPromote,
					data: {
						android_app_id: this.androidAppId,
						ios_app_id: this.iosAppId
					},
					dataType: "json",
					success: function(t) {
						0 === t.error ? e.dialog.tips_black("推广成功") : 4002 === t.error ? e.dialog.tips_black(t.data) : 4009 === t.error ? e.dialog.tips_black(t.data) : 4010 === t.error ? e.dialog.tips_black(t.data) : e.dialog.tips_black("推广失败")
					},
					error: function() {
						e.dialog.tips_black("请求失败")
					}
				})
			},
			joinCpsPlan: function() {
				e.ajax({
					type: "POST",
					url: s.urls.joinCpsPlan,
					dataType: "json",
					success: function(t) {
						0 === t.error ? e.dialog.tips_black("成功加入推广计划") : e.dialog.tips_black(t.data)
					},
					error: function() {
						e.dialog.tips_black("请求失败")
					}
				})
			},
			cpsAppTypeName: function(e) {
				return 1 === e ? "安卓联运" : 2 === e ? "安卓CPS" : 3 === e ? "iOS CPS" : 4 === e ? "iOS CPA" : 5 === e ? "安卓联运CPA" : ""
			},
			getDate: function() {
				var e = new Date;
				return e.getFullYear() + e.getMonth() + e.getDate()
			},
			checkWhiteList: function() {
				var i = this;
				e.ajax({
					type: "POST",
					url: s.urls.whiteList,
					dataType: "json",
					success: function(e) {
						if (0 === e.error && 1 === e.data.whitelist && (i.doms.$cpsEntry.removeClass("hide"), 0 === e.data.joinPlan)) {
							var a = t.get(s.storeName) || 0;
							a !== i.getDate() && (i.doms.$cpsTips.removeClass("hide"), t.set(s.storeName, i.getDate(), 31536e3))
						}
					}
				})
			},
			getRecommend: function() {
				var t = this;
				$ROOM && $ROOM.room_id && s.flag && (s.flag = !1, e.ajax({
					type: "GET",
					url: s.urls.getRecommend,
					data: {
						r: parseInt($ROOM.nowtime / 600, 10),
						room_id: $ROOM.room_id
					},
					dataType: "json",
					success: function(e) {
						if (e.data && (e.data.ios || e.data.android)) {
							var i = window.location.protocol + "//" + window.location.hostname + s.urls.downloadLink + $ROOM.room_id;
							e.data.android && "" === e.data.android.down_link && ("anchor" === t.userrole ? i = "" : "user" === t.userrole && (i = e.data.ios && e.data.ios.page_url ? e.data.ios.page_url : ""));
							var n = {
								live_cid2: window.$ROOM.cate_id,
								ownerName: window.$ROOM.owner_name,
								downLink: i
							};
							e.data.ios && e.data.ios.down_link && (n.ios = {
								appId: e.data.ios.app_id,
								name: e.data.ios.app_name,
								icon: e.data.ios.app_icon,
								downLink: e.data.ios.down_link,
								url: e.data.ios.page_url,
								apply_type: e.data.ios.apply_type
							}), e.data.android && e.data.android.down_link && (n.android = {
								appId: e.data.android.app_id,
								name: e.data.android.app_name,
								icon: e.data.android.app_icon,
								downLink: e.data.android.down_link,
								url: e.data.android.page_url,
								apply_type: e.data.android.apply_type
							}), e.data.ad && (n.ad = {
								ad_type: e.data.ad.ad_type,
								ad_img: e.data.ad.ad_img,
								ad_url: e.data.ad.ad_url
							}), a.exe("js_game_recommend", n)
						}
					}
				}))
			}
		};
	return {
		init: function() {
			r.init()
		}
	}
}), define("douyu/com/switch", ["jquery", "shark/class", "shark/observer"], function(e, t, i) {
	var a = t({
		init: function(t) {
			this.config = e.extend(!0, {}, {
				target: "#switch",
				item: "li",
				content: '[data-switch="content"]',
				onCls: "on",
				tEvents: "click mouseover",
				currentIndex: 0,
				handleAjax: function() {},
				handleResize: function() {},
				handleOther: function() {}
			}, t), this.getDoms(), this.bindEvt()
		},
		getDoms: function() {
			var t = e(this.config.target);
			this.doms = {
				$target: t,
				$items: t.find(this.config.item),
				$contens: t.find(this.config.content)
			}
		},
		renderItem: function(e) {
			var e = void 0 !== e ? e : this.config.currentIndex,
				t = this.config.onCls,
				i = this.doms,
				a = i.$items,
				n = i.$contens;
			a.removeClass(t).eq(e).addClass(t), n.removeClass(t).eq(e).addClass(t)
		},
		handle: function() {
			var e = this.config.currentIndex,
				t = this.doms,
				i = t.$items.eq(e),
				a = i.attr("data-ajax"),
				n = i.attr("data-resize");
			this.renderItem(), "1" === a && (i.attr("data-ajax", "0"), this.config.handleAjax()), this.config.handleOther(e), "1" === n && this.config.handleResize()
		},
		over: function() {
			this.renderItem(0)
		},
		bindEvt: function() {
			function t(e) {
				e.stopPropagation(), e.preventDefault()
			}
			var i = this,
				a = this.config.item,
				n = this.doms,
				s = this.config.tEvents;
			n.$target.on(s, a, function(a) {
				t(a);
				var n = e(a.currentTarget).index();
				i.config.currentIndex !== n && (i.config.currentIndex = n, i.handle())
			})
		}
	});
	return {
		create: function(e) {
			return new a(e)
		}
	}
}), define("douyu/page/room/normal/mod/live-rank-info", ["jquery", "shark/observer", "shark/util/lang/1.0", "douyu/context", "shark/util/flash/data/1.0", "douyu/page/room/base/api", "douyu/com/header", "douyu/com/avatar", "douyu/com/switch", "douyu/com/exjsonp", "shark/util/template/1.0"], function(e, t, i, a, n, s, r, o, l, c, d) {
	var u, f = a.get("sys.web_url"),
		p = {
			GAP_TIME: 5e3,
			avatarDomain: a.get("sys.avatar_url"),
			defaultAvatar: a.get("sys.web_url") + "/app/douyu/res/com/defaultAvatar.png?20160903",
			resourceUrl: a.get("sys.resource_url"),
			maxLevel: 120,
			cateId: a.get("room.cate_id")
		},
		m = {
			interval: function(e, t, i) {
				setTimeout(function() {
					e() !== !1 && m.interval(e, t)
				}, t), i === !0 && e()
			},
			toSimpleNum: function(e, t, i) {
				var a = Math.pow(10, t);
				return isNaN(Number(e)) ? e : parseFloat(Number(e) / a).toFixed(i)
			},
			toChineseNumber: function(e, t, i) {
				var a, n = this,
					s = Number(e);
				if (isNaN(s)) return e;
				switch (t) {
				case "千万":
					a = n.toSimpleNum(e, 7, i) + t;
				case "百万":
				case "t":
				case "T":
					a = n.toSimpleNum(e, 6, i) + t;
				case "万":
					a = n.toSimpleNum(e, 4, i) + t;
					break;
				case "千":
				case "k":
				case "K":
					a = n.toSimpleNum(e, 3, i) + t;
					break;
				case "百":
					a = n.toSimpleNum(e, 2, i) + t;
					break;
				default:
					a = e
				}
				return a
			},
			join: function() {
				return Array.prototype.join.call(arguments, "")
			}
		},
		h = {
			doms: {},
			animate: {
				time: 3e3
			},
			aniTimes: {
				rank: 0,
				cont: 0
			},
			rank: {
				now: "",
				next: ""
			},
			init: function() {
				var e = this;
				e.cacheDoms(), e.contRestart()
			},
			cacheDoms: function() {
				var t = this.doms;
				t.$wrapper = e(".catagory-order-num-wrap .catagory-order-num-wrapper"), t.$items = e('[data-info-catagory-order="num"]'), t.$rank = t.$items.find('[data-info-catagory-order="rank"]'), t.$anisec = t.$items.find("div.catagory-order-num-item"), t.$word = t.$anisec.find("span.catagory-order-num-value-wrap"), t.$wrap = e(".catagory-order-num-wrap"), t.$content = e('[data-info-catagory-order="content"]'), this.contentRight = parseInt(t.$content.css("right"), 10) || 0, t.$triangle = e(".catagory-order-icon-triangle"), t.$triangle.css({
					right: "29px"
				})
			},
			setRank: function(e) {
				this.rank.next = e
			},
			rankChange: function(e) {
				var t = this,
					i = t.doms;
				"up" === e ? i.$rank.eq(0).text(t.rank.next) : "down" === e && i.$rank.eq(2).text(t.rank.next)
			},
			getRankMark: function() {
				var e = this.rank;
				return e.next > e.now ? "down" : "up"
			},
			rankAnimate: function() {
				var e = this,
					t = e.doms,
					i = e.animate.time,
					a = e.getRankMark();
				e.rankStop(), e.rankChange(a), "up" === a ? t.$wrapper.animate({
					top: "0px"
				}, i, function() {
					e.rankRestart()
				}) : "down" === a && t.$wrapper.animate({
					top: "-44px"
				}, i, function() {
					e.rankRestart()
				})
			},
			rankRestart: function() {
				var e = this.doms;
				e.$wrapper.css({
					top: "-22px"
				});
				var t = this.rank;
				t.now = t.next, e.$rank.eq(1).text(t.now)
			},
			rankStop: function() {
				this.doms.$wrapper.stop(), this.rankRestart()
			},
			contChange: function(e, t) {
				var i = parseInt(e || "0", 10);
				i > 1e4 && (i = (i / 1e4).toFixed(1) + "万");
				var a = ' <span style="color: #F7D54E; font-weight: 600;">--</span> 贡献值',
					n = t ? "领先后一名" : "落后上一名",
					s = (n + a).replace(/--/, i);
				this.doms.$word.html(s)
			},
			contAnimate: function() {
				var e = this,
					t = e.doms,
					i = e.animate.time;
				t.$wrap.width(201), t.$triangle.css({
					right: "110px"
				}), t.$content.css({
					right: e.contentRight + 81 + "px"
				}), t.$anisec.css({
					display: "inline-block"
				}), u.handleRankPos(), t.$word.animate({
					left: "-100px"
				}, i, function() {
					e.aniTimes.cont++, e.contRestart(), e.aniTimes.cont % 3 === 0 && e.aniTimes.cont < 9 && e.contAnimate()
				})
			},
			contRestart: function() {
				var e = this.doms;
				e.$anisec.hide(), e.$wrap.width(120), e.$word.css({
					left: 0
				}), e.$triangle.css({
					right: "29px"
				}), e.$content.css({
					right: this.contentRight + "px"
				}), u.handleRankPos()
			},
			contStop: function() {
				this.aniTimes.cont = 0, this.doms.$word.stop(), this.contRestart()
			}
		};
	return u = {
		resizeTimer: null,
		reLoadCont: "",
		init: function() {
			this.initConfig(), this.getDoms(), this.handleDropDownPos(), this.addEvent(), this.setBannerCursor(), this.getLolJsonData(), this.getnshJsonData(), this.getJdqsJsonData(), this.handleRankPos()
		},
		setBannerCursor: function() {
			var e = this.doms.$content.find(".yz-week-link");
			e.length && !e.prop("target") && e.css({
				cursor: "default"
			})
		},
		getJdqsJsonData: function() {
			var t = this;
			c.load($SYS.webconfUrl + "/resource/common/activity/rank/pubg.json", "pubgRankConfig", function(i) {
				var n = t.doms,
					s = (a.get("sys.webconfUrl"), n.$starsgathered),
					r = (n.$catesWrap, e(".sq-wrap"), a.get("room.room_id")),
					o = '<a href="/t/pubgstar" target="_blank"><span class="jdqs-corner-name"></span><span class="jdqs-corner-rank"></span></a>';
				if (i && i.list && +i.cid === +a.get("room.cate_id")) {
					var l = i.list,
						c = l[1] || {},
						d = l[2] || {}; - 99 !== c[r] && c[r] > 0 && c[r] < 801 ? (s.addClass("jdqs1"), s.append(o), s.find(".jdqs-corner-name").text("巅峰榜"), s.find(".jdqs-corner-rank").text("NO." + c[r])) : -99 !== d[r] && d[r] > 0 && d[r] < 801 && (s.addClass("jdqs2"), s.append(o), s.find(".jdqs-corner-name").text("新秀榜"), s.find(".jdqs-corner-rank").text("NO." + d[r])), -99 === c[r] && -99 === d[r] && s.remove(), -99 === parseInt(c[r], 10) && "undefined" == typeof d[r] && (s.addClass("jdqs2"), s.append(o), s.find(".jdqs-corner-name").text("新秀榜"), s.find(".jdqs-corner-rank").text("未上榜")), "undefined" == typeof c[r] && -99 === parseInt(d[r], 10) && (s.addClass("jdqs1"), s.append(o), s.find(".jdqs-corner-name").text("巅峰榜"), s.find(".jdqs-corner-rank").text("未上榜")), 0 === s.children().length && (s.addClass("jdqs2"), s.append(o), s.find(".jdqs-corner-name").text("新秀榜"), s.find(".jdqs-corner-rank").text("未上榜")), t.handleRankPos()
				}
			})
		},
		getLolJsonData: function() {
			var t = this;
			c.load($SYS.webconfUrl + "/resource/common/activity/rank/lol_rank_info.json", "lolRankConfig", function(i) {
				var n, s, r = t.doms,
					o = (a.get("sys.webconfUrl"), r.$starsgathered),
					l = (r.$catesWrap, e(".sq-wrap"), a.get("room.room_id")),
					c = '<a href="/t/lolstar" target="_blank"><span class="lol-corner-name"></span><span class="lol-corner-rank"></span></a>';
				i && i.list && +i.cid === +a.get("room.cate_id") && (e.each(i.list, function(e, t) {
					if (+e === +l && t.idx) if (s = +t.idx, rankType = +t.rankType, s > 0 && 1 === rankType ? n = "第" + s + "名" : s > 0 && 1001 > s && 2 === rankType ? n = "第" + s + "名" : -99 === s && (n = null), 1 === rankType && n) o.addClass("starsgathered1"), o.append(c), o.find(".lol-corner-name").text("聚星榜"), o.find(".lol-corner-rank").text(n);
					else if (2 === rankType && n) o.addClass("starsgathered2"), o.append(c), o.find(".lol-corner-name").text("新星榜"), o.find(".lol-corner-rank").text(n);
					else if (!n && "undefined" != typeof n && 0 != n) return o.append("<i></i>"), o.remove(), !1
				}), 0 === o.children().length && (o.addClass("starsgathered2"), o.append(c), o.find(".lol-corner-name").text("新星榜"), o.find(".lol-corner-rank").text("未上榜")), t.handleRankPos())
			})
		},
		getnshJsonData: function() {
			var t = this;
			c.load($SYS.webconfUrl + "/resource/common/activity/rank/lovemoon_rank_info.json", "lovemoonRankConfig", function(i) {
				var n, s, r = t.doms,
					o = (a.get("sys.webconfUrl"), r.$starsgathered),
					l = (r.$catesWrap, e(".sq-wrap"), a.get("room.room_id")),
					c = '<a href="/t/nshtop" target="_blank"><span class="nsh-corner-rank"></span></a>';
				i && i.list && +i.cid === +a.get("room.cate_id") && (e.each(i.list, function(e, t) {
					if (+e === +l && t.idx) if (s = +t.idx, s > 0 && 51 > s) n = "第" + s + "名", o.addClass("nshRankLabel"), o.append(c), o.find(".nsh-corner-rank").text(n);
					else if (-99 === s) return n = null, o.remove(), !1
				}), 0 === o.children().length && (o.addClass("nshRankLabel"), o.append(c), o.find(".nsh-corner-rank").text("未上榜")), t.handleRankPos())
			})
		},
		initConfig: function() {
			this.rankNum = "", this.score = "", this.rankList = [], this.lastTime = 0, this.lastUserTime = 0, this.ridState = !0, this.rids = [], this.cacheNums = [], this.cacheRun = !1
		},
		getDoms: function() {
			this.doms = {
				$infoContainer: e("#anchor-info"),
				$cates: e(".r-else-tag"),
				$catesWrap: e(".tag-fs-con"),
				$starsgathered: e(".starsgathered"),
				$container: e('[data-info-catagory-order="info"]'),
				$trigger: e('[data-info-catagory-order="trigger"]'),
				$content: e('[data-info-catagory-order="content"]'),
				$rankIcon: e('[data-info-catagory-order="icon"]'),
				$giftWeekIcon: e('[data-info-catagory-order="gift-week-icon"]'),
				$triangleIcon: e(".catagory-order-icon-triangle"),
				$numContainer: e('[data-info-catagory-order="num"].catagory-order-num'),
				$nums: e('[data-info-catagory-order="num"]').find(".catagory-order-num-value"),
				$score: e('[data-info-catagory-order="score"]'),
				$item: e('[data-info-catagory-order="item"]'),
				$lists: e('[data-info-catagory-order="lists"]'),
				$title: e(".catagory-order-title"),
				$liveContainer: e("#js-live-room-normal-left"),
				$share: e(".room-mes .sq-wrap"),
				$listScore: e('[data-info-catagory-order="score"]'),
				$bannerContainer: e('#anchor-info .catagory-order-container [data-type="banner"]')
			}, this.doms.$listScore.hide(), this.doms.$item.eq(0).append('<div class="room-mes-loading"><span class="room-mes-loading-img"></span><div class="room-mes-loading-holder"></div></div>'), this.cid = e(".catagory-order-num-item").eq(0).data("cate-id"), this.tid = e(".catagory-order-num-item").eq(0).data("tag-id")
		},
		getData: function(t, i) {
			var a = {
				url: t.url || "",
				type: t.type || "GET",
				data: t.data || {},
				dataType: "json",
				success: function(e) {
					i && i(e)
				},
				error: function(e) {
					i && i(e)
				}
			};
			t.jsonp && (a.jsonp = t.jsonp, a.callback = t.jsonCallBack), e.ajax(a)
		},
		intervalList: function(e) {
			var t = this;
			if (t.listShowFlag && !t.listTimeFlag) {
				var i = e || 60,
					a = arguments;
				t.ajaxAnchor(), t.listTimeFlag = !0, t.timeTicket = setTimeout(function() {
					t.listTimeFlag = !1, a.callee.apply(t, a)
				}, 1e3 * i)
			}
		},
		ajaxBanner: function() {
			var t = this;
			return e.ajax({
				url: "/ajax_api_cache/room/getAnchorRankListBanner",
				data: {
					rid: a.get("room.room_id")
				},
				dataType: "json",
				success: function(e) {
					0 === e.error && t.renderBanner(e)
				}
			})
		},
		renderBanner: function(e) {
			var t = e.data,
				i = ['<% if(src && src !== "") {%>', '<a class="yz-week-link" ', '<% if (url && url !== "") {%>', 'href="<%= url %>" target="_blank"', "<% } else {%>", 'href="javascript:;"', "<% } %>", ">", '<img src="<%= src %>">', "</a>", "<% }%>"],
				a = d.compile(i.join("")),
				n = a(t);
			this.doms.$bannerContainer.html(n)
		},
		ajaxAnchor: function() {
			var t = this;
			e.ajax({
				url: "/column_rank_list/getAnchorRankList",
				type: "GET",
				data: {
					cate_id: t.cate_id,
					room_id: a.get("room.room_id"),
					uid: a.get("room.owner_uid")
				},
				success: function(e) {
					var i = JSON.parse(e);
					0 === +i.code && (t.anchorRankList = i.data, t.resoveAnchorList())
				},
				error: function() {
					e.dialog.tips_black("主播榜列表请求失败")
				}
			})
		},
		resoveAnchorList: function() {
			var e = this,
				t = e.anchorRankList,
				i = t.length,
				n = !1;
			if (i) for (var s = a.get("room.room_id"), r = 0; i > r; r++) t[r].rid == s && (n = !0, e.ownAnchorData = t[r], e.ownAnchorData.index = r, e.nowRank = +e.ownAnchorData.idx);
			else e.ownAnchorData = "";
			n ? e.doms.$listScore.hide() : e.reLoadContShowMark !== !1 && (e.reLoadContShowMark = !0, "" !== e.reLoadCont && e.showListReCont()), e.renderAnchorList()
		},
		showListReCont: function() {
			var e = this,
				t = e.reLoadCont > 1e4 ? (e.reLoadCont / 1e4).toFixed(1) + "万" : parseInt(e.reLoadCont, 10);
			e.doms.$listScore.html("落后前一名<span>" + t + "</span>贡献值"), e.doms.$listScore.show()
		},
		handleArrData: function(t) {
			var i, a, s = [];
			if (!t) return s;
			i = t.split("/");
			for (var r = 0, o = i.length; o > r; r++) a = n.decode(i[r]).too(), e.isPlainObject(a) && !e.isEmptyObject(a) && s.push(a);
			return s
		},
		handleAvatar: function(e) {
			var t = p.defaultAvatar;
			return e && (t = i.string.format("{0}upload/{1}_middle.jpg", p.avatarDomain, e)), t
		},
		getIconByLevel: function(e) {
			var t = e > p.maxLevel ? p.maxLevel : e,
				a = e >= 70 ? "gif" : "png";
			return i.string.format("{0}app/douyu/res/page/room-normal/level/LV{1}.{2}?v=20180619", f, t, a)
		},
		handleNobleConfig: function(e, t) {
			var i = a.get("room.nobleConfig") || {};
			return "pic" === t ? i[e] ? p.resourceUrl + i[e].symbol.web_symbol_pic2 : "" : "desc" === t ? i[e] && i[e].symbol.name : void 0
		},
		formatContribute: function(e) {
			return e >= 1e4 && (e = m.toChineseNumber(e, "万", 1)), e
		},
		getOffsetLeft: function(e) {
			return (e.offset() || {}).left || 0
		},
		debounce: function() {
			var e = this,
				t = !0;
			return function() {
				t && (t = !1, setTimeout(function() {
					e.handleRankPos(), t = !0
				}, 60))
			}
		},
		handleRankPos: function() {
			var e = this,
				t = this.doms,
				i = t.$rankIcon,
				a = t.$giftWeekIcon,
				n = t.$starsgathered,
				s = t.$title;
			s.removeClass("maxlength");
			var r = e.getOffsetLeft(t.$cates),
				o = this.getOffsetLeft(t.$trigger),
				l = e.getOffsetLeft(i),
				c = (this.getOffsetLeft(a), e.getOffsetLeft(t.$share)),
				d = 106,
				u = 135,
				f = t.$trigger.width() || 0;
			i.width(d).css("visibility", "hidden"), n.width(u).css("visibility", "hidden"), parseInt(l, 10) <= parseInt(r, 10) || t.$catesWrap.height() > 30 ? i.width(0).css("visibility", "hidden") : i.width(d).css("visibility", "visible");
			var p = e.getOffsetLeft(n);
			parseInt(p, 10) <= parseInt(r, 10) ? (i.width(0).css("visibility", "hidden"), parseInt(e.getOffsetLeft(n), 10) <= parseInt(r, 10) || t.$catesWrap.height() > 30 ? n.width(0).css("visibility", "hidden") : n.width(u).css("visibility", "visible")) : n.width(u).css("visibility", "visible"), f > c - o && s.addClass("maxlength")
		},
		handleDropDownPos: function() {
			var e = this.doms,
				t = e.$infoContainer,
				i = e.$content,
				a = this.getOffsetLeft(i),
				n = this.getOffsetLeft(t),
				s = n - a;
			s > 0 ? i.css("right", "-" + s + "px") : i.css("right", "0")
		},
		handleNumAndScore: function() {
			var e = this.doms,
				t = this.rankNum,
				i = this.score;
			!i || 0 > i ? i = "--" : 0 == i && 1 == t ? i = "hide" : i /= 100, t && 0 != t ? 0 > t && (t = Math.abs(t) + "+", i = "hide") : (t = "--", i = "--"), e.$nums.html(t), "hide" !== i ? e.$score.find("span").html(i) : e.$score.hide()
		},
		handleRankNum: function(e) {
			var e = (this.doms, n.decode(e).too()),
				t = this.handleArrData(e.ri);
			this.bt = e.bt, this.rankNum = t[1] && t[1].idx || 0, this.handleNumAndScore()
		},
		handleRankScore: function(e) {
			var e = (this.doms, n.decode(e).too());
			this.score = e.sc, this.handleNumAndScore()
		},
		handleAnchorList: function(e) {
			var t = this.doms,
				e = n.decode(e).too(),
				i = this.handleArrData(e.rls),
				a = t.$lists.find("li").eq(1).data("cate-id");
			e.cate_id == a && (this.rankList = i), this.rids = [];
			for (var s = 0; s < this.rankList.length; s++) this.rids.push(this.rankList[s].rid);
			this.renderAnchorList()
		},
		renderAnchorList: function() {
			var e = this,
				t = m.join('<div class="yz-week-content">', '<div class="yz-rank-list">', "<ul>", "<% var idx; %>", "<% for (var i = 0; i < 5; i++) { %>", "<% var item = list[i]; %>", "<% if (item) { %>", "<% if (room && i === room.index) { %>", "<% if (i%2) { %>", '<li class="yz-current yz-bg">', "<% } else { %>", '<li class="yz-current">', "<% } %>", "<% } else { %>", "<% if (i%2) { %>", '<li class="yz-bg">', "<% } else { %>", "<li>", "<% } %>", "<% } %>", "<% if (item.vipId && item.vipId > 0) { %>", '<a class="yz-col-left" href="/<%= item.vipId %>" target=_blank>', "<% } else { %>", '<a class="yz-col-left" href="/<%= item.rid %>" target=_blank>', "<% } %>", "<% if (room) { %>", "<% if (i === room.index) { %>", '<span class="yz-contrib"><em class="yz-contrib-value">当前主播</em></span>', "<% } else { %>", '<span class="yz-contrib">', "<% var score = item.sc - room.sc; %>", "<% var wscore = Math.abs(score); %>", "<% if (wscore > 10000) { %>", '<% wscore = parseFloat(wscore/10000).toFixed(1) + "万"; %>', "<% } else { %>", "<% wscore = parseInt(wscore); %>", "<% } %>", "<% if (i > room.index) { %>", '领先 <em class="yz-contrib-value"> <%= wscore %> </em>贡献值', "<% } else { %>", '落后 <em class="yz-contrib-value"> <%= wscore %> </em>贡献值', "<% } %>", "</span>", "<% } %>", "<% } %>", '<div class="yz-wp-left">', "<% idx = item.idx %>", '<span class="yz-index"><%= item.idx %></span>', '<span class="yz-zhubo">', '<img src="<%= item.src %>" />', '<em class="yz-zhubo-icon"></em>', "</span>", '<p title="<%= item.owner_name %>"><%= item.owner_name %></p>', "<% if (item.is_live) { %>", '<div class="play-status">', "<% } else { %>", '<div class="play-status yz-stop">', "<% } %>", '<span class="yz-play"></span>', '<span class="yz-fenqu"><%= item.catagory %></span>', "</div>", "</div>", "</a>", "</li>", "<% } else { %>", "<% if (i%2) { %>", '<li class="yz-bg">', "<% } else { %>", "<li>", "<% } %>", '<a class="yz-col-left" href="javascript:;">', '<div class="yz-wp-left">', "<% idx = idx ? (idx + 1) : (i + 1) %>", '<span class="yz-index"><%= idx %></span>', '<span class="yz-zhubo">', '<img src="<%= Vars.defaultAvatar %>" />', '<em class="yz-zhubo-icon"></em>', "</span>", "<p>虚位以待</p>", "</div>", "</a>", "</li>", "<% } %>", "<% } %>", "</ul>", "</div>", '<p class="yz-week-text">', "注：列表数据每分钟更新一次", "</p>", "</div>"),
				i = d.compile(t),
				a = i({
					list: e.anchorRankList || [],
					room: e.ownAnchorData,
					Vars: p,
					Math: Math,
					parseInt: parseInt,
					parseFloat: parseFloat
				});
			this.doms.$item.eq(0).empty().append(a)
		},
		renderUserList: function(e) {
			var t = this,
				i = e.length,
				a = 3 - i >= 0 ? 3 - i : 0,
				e = 3 - i >= 0 ? e : e.slice(0, 3);
			if (a > 0) for (var n = 0; a > n; n++) e.push({});
			var s = ["<% for( var i = 0, len = list.length; i < len; i++ ){ %>", '<div class="catagory-order-item order-item-<%= i+1 %>">', '<div class="order-info">', '<img src="<%= list[i].avatar?list[i].avatar:defaultAvatar %>" alt="">', "<i></i>", '<p title="<%= list[i].nickname || "虚位以待" %>"><%= list[i].nickname || "虚位以待" %></p>', "</div>", '<div class="user-badge-group">', "<% if (parseInt(list[i].noble_lvl)) { %>", '<img class="user-noble" title="<%= handleNobleConfig(list[i].noble_lvl, "desc") %>" src="<%= handleNobleConfig(list[i].noble_lvl, "pic") %>">', "<% } %>", "<% if (list[i].level) { %>", '<img class="user-level" src="<%= getIconByLevel(list[i].level) %>">', "<% } else { %>", '<div class="user-level">--</div>', "<% } %>", "</div>", '<p class="user-contribute">周贡献：<%= formatContribute(list[i].gx) || "--" %></p>', "</div>", "<% } %>"].join(""),
				r = d.compile(s),
				o = r({
					list: e,
					defaultAvatar: p.defaultAvatar,
					formatContribute: t.formatContribute,
					getIconByLevel: t.getIconByLevel,
					handleNobleConfig: t.handleNobleConfig,
					parseInt: parseInt
				});
			this.doms.$item.eq(1).empty().append(o)
		},
		getAndHandleUserList: function(e) {
			var t = this,
				i = {
					url: "/column_rank_list/getUserRankList",
					data: {
						cate_id: e
					}
				};
			this.getData(i, function(e) {
				var i = [];
				0 == e.code && (i = e.data), t.renderUserList(i)
			})
		},
		handleCacheNums: function(e) {
			var t, i = this;
			i.cacheNums.push(e), i.cacheRun || m.interval(function() {
				return t = i.cacheNums.length, t ? (i.handleRankNum(i.cacheNums.splice(-1, 1)), i.cacheNums.length = 0, i.cacheRun = !0) : i.cacheRun = !1, i.cacheRun
			}, 1e3, !0)
		},
		handleRankWel: function(e) {
			var t = "",
				a = e.level >= 70 ? "" : "level-bgpng",
				n = e.level >= 100 ? "level-size2" : " level-size1";
			return t = i.string.join('<li class="jschartli" data-type="list" data-level="<%=node.level%>">', '<p class="text-cont rank-wel">', '<i class="rank-wel-order rank-wel-order<%= node.crw %>"></i>', "<% if (node.level > 0) { %>", '<a class="chat-icon-pad user-level<% if ( node.level < 10 ) { %> lve-icon-1to9 <% } %> <%= node.uli %> <%= imgType %> <%= imgSize %> " title="用户等级：<%= node.level %>">', "</a>", "<% } %>", '<a href="javascript:;" class="hy-name js-nick" rel="<%= node.uid %>" is-show-super-icon="<%= node.sahf%>" avatar="<%= node.ic %>" gid="<%= node.pg %>" title="<%= node.nn %>"><%= node.nn %></a>', "<span>欢迎您来到本直播间</span>", "</p>", "</li>"), render = d.compile(t), html = render({
				node: e,
				imgType: a,
				imgSize: n
			}), html
		},
		addEvent: function() {
			var i = this,
				a = this.doms,
				r = a.$trigger,
				o = a.$content,
				c = !1;
			s.reg("data_rank_num", function(e) {
				i.handleCacheNums(e);
				var t = n.decode(e).too();
				if ("rri" === t.type) {
					var a = n.decode(t.ri).too(),
						s = a.idx;
					i.nowRank = +s, +s ? (0 > +s && (s = Math.abs(+s) + "+", i.reLoadContShowMark = !1, i.doms.$listScore.hide()), h.rank.now ? (h.setRank(s), h.rankAnimate(), clearTimeout(i.timeTicket), i.listTimeFlag = !1, i.intervalList()) : h.rank.now = s) : (i.doms.$nums.text("--"), i.reLoadContShowMark = !1, i.doms.$listScore.hide())
				}
			}), s.reg("data_rank_score", function(e) {
				var t = n.decode(e).too();
				if ("qausrespond" === t.type) {
					var a = t.sc;
					0 > +a && (a = Math.abs(+a)), i.reLoadCont = a / 100, i.reLoadContShowMark && i.showListReCont();
					var s;
					if (i.nowRank) {
						var r = i.nowRank;
						if (0 === r) return;
						1 === r ? (s = t.sctn, h.contChange(s / 100, !0)) : h.contChange(i.reLoadCont, !1)
					} else if (+a) h.contChange(i.reLoadCont, !1);
					else {
						if (s = t.sctn, !+s) return;
						h.contChange(s / 100, !0)
					}
					return h.contStop(), void h.contAnimate()
				}
			}), r.on("mouseenter", function(n) {
				i.listShowFlag = !0, a.$content.addClass("on"), a.$triangleIcon.addClass("on"), i.cate_id = a.$lists.find("[data-cate-id]").attr("data-cate-id"), e(n.target).closest(".catagory-order-content").length || (t.trigger("dys", {
					key: "dys.room.title.rank.show",
					tid: i.tid,
					cid: i.cid,
					period: "w"
				}), c || (i.ajaxBanner(), c = !0), i.intervalList())
			}), r.on("mouseleave", function(e) {
				i.timer = setTimeout(function() {
					i.listShowFlag = !1, o.removeClass("on"), a.$triangleIcon.removeClass("on")
				}, 100)
			}), o.on("mouseenter", function() {
				clearTimeout(i.timer)
			}), o.on("mouseleave", function() {
				o.removeClass("on"), a.$triangleIcon.removeClass("on")
			}), t.on("mod.userenter.get.rankwel", function(e) {
				return i.handleRankWel(e)
			}), t.on("mod.normal.achorinfo.layout", i.debounce()), l.create({
				target: '[data-info-catagory-order="lists"]',
				item: ".catagory-order-name > li",
				content: '[data-info-catagory-order="item"]',
				tEvents: "click",
				handleOther: function(a) {
					var n = e(this.target).find(this.item).eq(a).data("cate-id");
					n && (i.currentUserTime = (new Date).getTime(), (!i.lastUserTime || i.currentUserTime - i.lastUserTime >= p.GAP_TIME) && (i.getAndHandleUserList(n), i.lastUserTime = i.currentUserTime)), t.trigger("dys", {
						key: "dys.room.title.rank.star.click",
						tid: i.tid,
						pos: 0
					})
				}
			}), a.$item.on("click", "a.order-info", function() {
				var i = e(this).index("a.order-info"),
					a = e(this).data("rid");
				t.trigger("dys", {
					key: "dys.room.title.rank.star.room.click",
					rid: a,
					pos: i + 1
				})
			}), a.$item.on("click", "a.order-link", function() {
				var i = e(this).index("a.order-link"),
					a = e(this).data("rid");
				t.trigger("dys", {
					key: "dys.room.title.rank.star.room.click",
					rid: a,
					pos: i + 1
				})
			}), a.$content.on("click", ".catagory-order-link", function() {
				t.trigger("dys", {
					key: "dys.room.title.rank.total.click",
					cid: i.cid
				})
			})
		}
	}, {
		init: function() {
			var t = e(".catagory-order-container").hasClass("yzpk");
			201 !== p.cateId && 311 !== p.cateId ? (u.init(), h.init()) : t || (u.init(), h.init())
		}
	}
}), define("douyu/page/room/normal/mod/yz-rank-list", ["jquery", "shark/observer", "shark/util/lang/1.0", "douyu/context", "shark/util/flash/data/1.0", "douyu/page/room/base/api", "douyu/com/header", "douyu/com/avatar", "douyu/com/switch", "douyu/com/exjsonp", "shark/util/template/1.0"], function(e, t, i, a, n, s, r, o, l, c, d) {
	var u, f = a.get("sys.web_url"),
		p = {
			GAP_TIME: 8e3,
			avatarDomain: a.get("sys.avatar_url"),
			defaultAvatar: a.get("sys.web_url") + "/app/douyu/res/com/defaultAvatar.png?20160903",
			resourceUrl: a.get("sys.resource_url"),
			maxLevel: 120,
			cateId: a.get("room.cate_id"),
			roomId: a.get("room.room_id")
		},
		m = {
			interval: function(e, t, i) {
				setTimeout(function() {
					e() !== !1 && m.interval(e, t)
				}, t), i === !0 && e()
			},
			toSimpleNum: function(e, t, i) {
				var a = Math.pow(10, t);
				return isNaN(Number(e)) ? e : parseFloat(Number(e) / a).toFixed(i)
			},
			toChineseNumber: function(e, t, i) {
				var a, n = this,
					s = Number(e);
				if (isNaN(s)) return e;
				switch (t) {
				case "千万":
					a = n.toSimpleNum(e, 7, i) + t;
				case "百万":
				case "t":
				case "T":
					a = n.toSimpleNum(e, 6, i) + t;
				case "万":
					a = n.toSimpleNum(e, 4, i) + t;
					break;
				case "千":
				case "k":
				case "K":
					a = n.toSimpleNum(e, 3, i) + t;
					break;
				case "百":
					a = n.toSimpleNum(e, 2, i) + t;
					break;
				default:
					a = e
				}
				return a
			},
			join: function() {
				return Array.prototype.join.call(arguments, "")
			}
		},
		h = {
			doms: {},
			animate: {
				time: 3e3
			},
			aniTimes: {
				rank: 0,
				cont: 0
			},
			rank: {
				now: "",
				next: ""
			},
			init: function() {
				var e = this;
				e.cacheDoms(), e.contRestart()
			},
			cacheDoms: function() {
				var t = this.doms;
				t.$wrapper = e(".catagory-order-num-wrap .catagory-order-num-wrapper"), t.$items = e('[data-info-catagory-order="num"]'), t.$rank = t.$items.find('[data-info-catagory-order="rank"]'), t.$anisec = t.$items.find("div.catagory-order-num-item"), t.$word = t.$anisec.find("span.catagory-order-num-value-wrap"), t.$wrap = e(".catagory-order-num-wrap"), t.$content = e('[data-info-catagory-order="content"]'), this.contentRight = parseInt(t.$content.css("right"), 10) || 0, t.$triangle = e(".catagory-order-icon-triangle"), t.$triangle.css({
					right: "29px"
				})
			},
			setRank: function(e) {
				this.rank.next = e
			},
			rankChange: function(e) {
				var t = this,
					i = t.doms;
				"up" === e ? i.$rank.eq(0).text(t.rank.next) : "down" === e && i.$rank.eq(2).text(t.rank.next)
			},
			getRankMark: function() {
				var e = this.rank;
				return e.next > e.now ? "down" : "up"
			},
			rankAnimate: function() {
				var e = this,
					t = e.doms,
					i = e.animate.time,
					a = e.getRankMark();
				e.rankStop(), e.rankChange(a), "up" === a ? t.$wrapper.animate({
					top: "0px"
				}, i, function() {
					e.rankRestart()
				}) : "down" === a && t.$wrapper.animate({
					top: "-44px"
				}, i, function() {
					e.rankRestart()
				})
			},
			rankRestart: function() {
				var e = this.doms;
				e.$wrapper.css({
					top: "-22px"
				});
				var t = this.rank;
				t.now = t.next, e.$rank.eq(1).text(t.now)
			},
			rankStop: function() {
				this.doms.$wrapper.stop(), this.rankRestart()
			},
			contChange: function(e, t) {
				var i = parseInt(e || "0", 10);
				i > 1e4 && (i = (i / 1e4).toFixed(1) + "万");
				var a = ' <span style="color: #F7D54E; font-weight: 600;">--</span> 贡献值',
					n = t ? "领先后一名" : "落后上一名",
					s = (n + a).replace(/--/, i);
				this.doms.$word.html(s)
			},
			contAnimate: function() {
				var e = this,
					t = e.doms,
					i = e.animate.time;
				t.$wrap.width(201), t.$triangle.css({
					right: "110px"
				}), t.$content.css({
					right: e.contentRight + 81 + "px"
				}), t.$anisec.css({
					display: "inline-block"
				}), u.handleRankPos(), t.$word.animate({
					left: "-100px"
				}, i, function() {
					e.aniTimes.cont++, e.contRestart(), e.aniTimes.cont % 3 === 0 && e.aniTimes.cont < 9 && e.contAnimate()
				})
			},
			contRestart: function() {
				var e = this.doms;
				e.$anisec.hide(), e.$wrap.width(120), e.$word.css({
					left: 0
				}), e.$triangle.css({
					right: "29px"
				}), e.$content.css({
					right: this.contentRight + "px"
				}), u.handleRankPos()
			},
			contStop: function() {
				this.aniTimes.cont = 0, this.doms.$word.stop(), this.contRestart()
			}
		};
	return u = {
		hourTimer: null,
		monthTimer: null,
		resizeTimer: null,
		tabIndex: 0,
		reLoadCont: "",
		init: function() {
			this.initConfig(), this.getDoms(), this.handleDropDownPos(), this.addEvent(), this.setBannerCursor(), this.handleRankPos()
		},
		setBannerCursor: function() {
			var e = this.doms.$content.find(".yz-week-link");
			e.length && !e.prop("target") && e.css({
				cursor: "default"
			})
		},
		initConfig: function() {
			this.rankNum = "", this.score = "", this.rankList = [], this.lastTime = 0, this.lastWeekTime = 0, this.ridState = !0, this.rids = [], this.cacheNums = [], this.cacheRun = !1
		},
		getDoms: function() {
			this.doms = {
				$infoContainer: e("#anchor-info"),
				$cates: e(".r-else-tag"),
				$catesWrap: e(".tag-fs-con"),
				$starsgathered: e(".starsgathered"),
				$container: e('[data-info-catagory-order="info"]'),
				$trigger: e('[data-info-catagory-order="trigger"]'),
				$content: e('[data-info-catagory-order="content"]'),
				$rankIcon: e('[data-info-catagory-order="icon"]'),
				$giftWeekIcon: e('[data-info-catagory-order="gift-week-icon"]'),
				$triangleIcon: e(".catagory-order-icon-triangle"),
				$numContainer: e('[data-info-catagory-order="num"].catagory-order-num'),
				$nums: e('[data-info-catagory-order="num"]').find(".catagory-order-num-value"),
				$score: e('[data-info-catagory-order="score"]'),
				$item: e('[data-info-catagory-order="item"]'),
				$lists: e('[data-info-catagory-order="lists"]'),
				$title: e(".catagory-order-title"),
				$liveContainer: e("#js-live-room-normal-left"),
				$share: e(".room-mes .sq-wrap"),
				$listScore: e('[data-info-catagory-order="score"]'),
				$bannerContainer: e('#anchor-info .catagory-order-container [data-type="banner"]')
			}, this.doms.$listScore.hide(), this.doms.$item.eq(0).append('<div class="room-mes-loading"><span class="room-mes-loading-img"></span><div class="room-mes-loading-holder"></div></div>'), this.cid = e(".catagory-order-num-item").eq(0).data("cate-id"), this.tid = e(".catagory-order-num-item").eq(0).data("tag-id")
		},
		getData: function(t, i) {
			var a = {
				url: t.url || "",
				type: t.type || "GET",
				data: t.data || {},
				dataType: "json",
				success: function(e) {
					i && i(e)
				},
				error: function(e) {
					i && i(e)
				}
			};
			t.jsonp && (a.jsonp = t.jsonp, a.callback = t.jsonCallBack), e.ajax(a)
		},
		intervalList: function(e) {
			var t = this;
			if (t.listShowFlag && !t.listTimeFlag) {
				var i = e || 60,
					a = arguments;
				t.ajaxWeekRank(), t.listTimeFlag = !0, t.timeTicket = setTimeout(function() {
					t.listTimeFlag = !1, a.callee.apply(t, a)
				}, 1e3 * i)
			}
		},
		ajaxWeekRank: function() {
			var t = this;
			e.ajax({
				url: "/column_rank_list/getAnchorRankList",
				type: "GET",
				data: {
					cate_id: t.cate_id,
					room_id: a.get("room.room_id"),
					uid: a.get("room.owner_uid")
				},
				success: function(e) {
					var i = JSON.parse(e);
					0 === +i.code && (t.anchorWeekRankList = i.data, t.resoveAnchorList())
				},
				error: function() {
					e.dialog.tips_black("主播榜列表请求失败")
				}
			})
		},
		resoveAnchorList: function() {
			var e = this,
				t = e.anchorWeekRankList,
				i = t.length,
				n = !1;
			if (i) for (var s = a.get("room.room_id"), r = 0; i > r; r++) t[r].rid == s && (n = !0, e.ownAnchorData = t[r], e.ownAnchorData.index = r, e.nowRank = +e.ownAnchorData.idx);
			else e.ownAnchorData = "";
			n ? e.doms.$listScore.hide() : e.reLoadContShowMark !== !1 && (e.reLoadContShowMark = !0, "" !== e.reLoadCont && e.showListReCont()), e.renderWeekList()
		},
		showListReCont: function() {
			var e = this,
				t = e.reLoadCont > 1e4 ? (e.reLoadCont / 1e4).toFixed(1) + "万" : parseInt(e.reLoadCont, 10);
			e.doms.$listScore.html("落后前一名<span>" + t + "</span>贡献值"), e.doms.$listScore.show()
		},
		handleArrData: function(t) {
			var i, a, s = [];
			if (!t) return s;
			i = t.split("/");
			for (var r = 0, o = i.length; o > r; r++) a = n.decode(i[r]).too(), e.isPlainObject(a) && !e.isEmptyObject(a) && s.push(a);
			return s
		},
		handleAvatar: function(e) {
			var t = p.defaultAvatar;
			return e && (t = i.string.format("{0}upload/{1}_middle.jpg", p.avatarDomain, e)), t
		},
		getIconByLevel: function(e) {
			var t = e > p.maxLevel ? p.maxLevel : e,
				a = e >= 70 ? "gif" : "png";
			return i.string.format("{0}app/douyu/res/page/room-normal/level/LV{1}.{2}?v=20170922", f, t, a)
		},
		handleNobleConfig: function(e, t) {
			var i = a.get("room.nobleConfig") || {};
			return "pic" === t ? i[e] ? p.resourceUrl + i[e].symbol.web_symbol_pic2 : "" : "desc" === t ? i[e] && i[e].symbol.name : void 0
		},
		formatContribute: function(e) {
			return e >= 1e4 && (e = m.toChineseNumber(e, "万", 1)), e
		},
		getOffsetLeft: function(e) {
			return (e.offset() || {}).left || 0
		},
		debounce: function() {
			var e = this,
				t = !0;
			return function() {
				t && (t = !1, setTimeout(function() {
					e.handleRankPos(), t = !0
				}, 60))
			}
		},
		handleRankPos: function() {
			var e = this,
				t = this.doms,
				i = t.$rankIcon,
				a = t.$giftWeekIcon,
				n = t.$starsgathered,
				s = t.$title;
			s.removeClass("maxlength");
			var r = e.getOffsetLeft(t.$cates),
				o = this.getOffsetLeft(t.$trigger),
				l = e.getOffsetLeft(i),
				c = (this.getOffsetLeft(a), e.getOffsetLeft(t.$share)),
				d = 106,
				u = 135,
				f = t.$trigger.width() || 0;
			i.width(d).css("visibility", "hidden"), n.width(u).css("visibility", "hidden"), parseInt(l, 10) <= parseInt(r, 10) || t.$catesWrap.height() > 30 ? i.width(0).css("visibility", "hidden") : i.width(d).css("visibility", "visible");
			var p = e.getOffsetLeft(n);
			parseInt(p, 10) <= parseInt(r, 10) ? (i.width(0).css("visibility", "hidden"), parseInt(e.getOffsetLeft(n), 10) <= parseInt(r, 10) || t.$catesWrap.height() > 30 ? n.width(0).css("visibility", "hidden") : n.width(u).css("visibility", "visible")) : n.width(u).css("visibility", "visible"), f > c - o && s.addClass("maxlength")
		},
		handleDropDownPos: function() {
			var e = this.doms,
				t = e.$infoContainer,
				i = e.$content,
				a = this.getOffsetLeft(i),
				n = this.getOffsetLeft(t),
				s = n - a;
			s > 0 ? i.css("right", "-" + s + "px") : i.css("right", "0")
		},
		handleNumAndScore: function() {
			var e = this.doms,
				t = this.rankNum;
			t && 0 != t ? 0 > t && (t = Math.abs(t) + "+") : t = "--", e.$nums.html(t)
		},
		handleRankNum: function(e) {
			var e = (this.doms, n.decode(e).too()),
				t = this.handleArrData(e.ri);
			this.bt = e.bt, this.rankNum = t[1] && t[1].idx || 0, this.handleNumAndScore()
		},
		handleAnchorList: function(e) {
			var t = this.doms,
				e = n.decode(e).too(),
				i = this.handleArrData(e.rls),
				a = t.$lists.find("li").eq(1).data("cate-id");
			e.cate_id == a && (this.rankList = i), this.rids = [];
			for (var s = 0; s < this.rankList.length; s++) this.rids.push(this.rankList[s].rid);
			this.renderWeekList()
		},
		renderWeekList: function() {
			var e = this,
				t = m.join('<div class="yz-week-content">', '<div class="notice-title">榜单每5分钟更新一次</div>', '<div class="yz-rank-list">', "<ul>", "<% var idx; %>", "<% for (var i = 0; i < 5; i++) { %>", "<% var item = list[i]; %>", "<% if (item) { %>", "<% if (room && i === room.index) { %>", "<% if (i%2) { %>", '<li class="yz-current yz-bg">', "<% } else { %>", '<li class="yz-current">', "<% } %>", "<% } else { %>", "<% if (i%2) { %>", '<li class="yz-bg">', "<% } else { %>", "<li>", "<% } %>", "<% } %>", "<% if (item.vipId && item.vipId > 0) { %>", '<a class="yz-col-left" href="/<%= item.vipId %>" target=_blank>', "<% } else { %>", '<a class="yz-col-left" href="/<%= item.rid %>" target=_blank>', "<% } %>", "<% if (room) { %>", "<% if (i === room.index) { %>", '<span class="yz-contrib"><em class="yz-contrib-value">当前主播</em></span>', "<% } else { %>", '<span class="yz-contrib">', "<% var score = item.sc - room.sc; %>", "<% var wscore = Math.abs(score); %>", "<% if (wscore > 10000) { %>", '<% wscore = parseFloat(wscore/10000).toFixed(1) + "万"; %>', "<% } else { %>", "<% wscore = parseInt(wscore); %>", "<% } %>", "<% if (i > room.index) { %>", '领先 <em class="yz-contrib-value"> <%= wscore %> </em>贡献值', "<% } else { %>", '落后 <em class="yz-contrib-value"> <%= wscore %> </em>贡献值', "<% } %>", "</span>", "<% } %>", "<% } %>", '<div class="yz-wp-left">', "<% idx = item.idx %>", '<span class="yz-index"><%= item.idx %></span>', '<span class="yz-zhubo">', '<img src="<%= item.src %>" />', '<em class="yz-zhubo-icon"></em>', "</span>", '<p title="<%= item.owner_name %>"><%= item.owner_name %></p>', "<% if (item.is_live) { %>", '<div class="play-status">', "<% } else { %>", '<div class="play-status yz-stop">', "<% } %>", '<span class="yz-play"></span>', '<span class="yz-fenqu"><%= item.catagory %></span>', "</div>", "</div>", "</a>", "</li>", "<% } else { %>", "<% if (i%2) { %>", '<li class="yz-bg">', "<% } else { %>", "<li>", "<% } %>", '<a class="yz-col-left" href="javascript:;">', '<div class="yz-wp-left">', "<% idx = idx ? (idx + 1) : (i + 1) %>", '<span class="yz-index"><%= idx %></span>', '<span class="yz-zhubo">', '<img src="<%= Vars.defaultAvatar %>" />', '<em class="yz-zhubo-icon"></em>', "</span>", "<p>虚位以待</p>", "</div>", "</a>", "</li>", "<% } %>", "<% } %>", "</ul>", "</div>", '<div class="yz-anchor-rank">当前主播排名：<em><%= nowRank %></em></div>', "</div>"),
				i = d.compile(t),
				a = i({
					list: e.anchorWeekRankList || [],
					room: e.ownAnchorData,
					Vars: p,
					Math: Math,
					parseInt: parseInt,
					parseFloat: parseFloat,
					nowRank: e.handleNowRank(e.nowRank)
				});
			this.doms.$item.eq(2).empty().append(a)
		},
		renderHourList: function() {
			var e = this,
				t = m.join('<div class="yz-week-content yz-nopadding-content">', '<div class="countDownBox clearfix">', '<div class="hourTitleRight">榜单每1分钟更新一次</div>', '<div class="hourTitleLeft">本小时还剩余：<span class="hourRankCountDown J-hourCount"><%= remainTime %></span></div>', "</div>", '<div class="hourListTitle">', '<div class="col col1">名次</div>', '<div class="col col2">主播昵称</div>', '<div class="col col3">本小时贡献值', '<span class="yzpk-queston-icon">', '<div class="yzpk-question-box">', "<span>用户在本小时每赠送0.1鱼翅礼物或100鱼丸，可提升1点本小时贡献值</span>", "</div>", "</span>", "</div>", "</div>", '<div class="yz-rank-list">', "<ul>", "<% var idx; %>", "<% for (var i = 0; i < 5; i++) { %>", "<% var item = list[i]; %>", "<% if (item) { %>", "<% if (room && i === room.index) { %>", "<% if (i%2) { %>", '<li class="yz-current yz-bg">', "<% } else { %>", '<li class="yz-current">', "<% } %>", "<% } else { %>", "<% if (i%2) { %>", '<li class="yz-bg">', "<% } else { %>", "<li>", "<% } %>", "<% } %>", "<% if (item.vip_id && item.vip_id > 0) { %>", '<a class="yz-col-left" href="/<%= item.vip_id %>" target=_blank>', "<% } else { %>", '<a class="yz-col-left" href="/<%= item.room_id %>" target=_blank>', "<% } %>", "<% if (room && i === room.index) { %>", '<span class="yz-contrib isHour ownColor"><%= item.score/100 %></span>', "<% } else { %>", '<span class="yz-contrib isHour"><%= item.score/100 %></span>', "<% } %>", '<div class="yz-wp-left">', "<% idx = item.rank_index %>", '<span class="yz-index"><%= (i + 1) %></span>', '<span class="yz-zhubo">', '<img src="<%= item.avatar %>" onerror="this.src=\'<%= Vars.defaultAvatar %>\';this.onerror=null;" />', '<em class="yz-zhubo-icon"></em>', "</span>", "<% if (room && i === room.index) { %>", '<p class="ownColor" title="<%= item.nickname %>"><%= item.nickname %></p>', "<% } else { %>", '<p title="<%= item.nickname %>"><%= item.nickname %></p>', "<% } %>", "<% if (item.show_status === 1) { %>", '<div class="play-status">', "<% } else { %>", '<div class="play-status yz-stop">', "<% } %>", '<span class="yz-play"></span>', '<span class="yz-fenqu"><%= item.cate2_name %></span>', "</div>", "</div>", "</a>", "</li>", "<% } else { %>", "<% if (i%2) { %>", '<li class="yz-bg">', "<% } else { %>", "<li>", "<% } %>", '<a class="yz-col-left" href="javascript:;">', '<span class="yz-contrib isHour">--</span>', '<div class="yz-wp-left">', "<% idx = idx ? (idx + 1) : (i + 1) %>", '<span class="yz-index"><%= (i + 1) %></span>', '<span class="yz-zhubo">', '<img src="<%= Vars.defaultAvatar %>" />', '<em class="yz-zhubo-icon"></em>', "</span>", "<p>虚位以待</p>", "</div>", "</a>", "</li>", "<% } %>", "<% } %>", "</ul>", "</div>", '<div class="yz-anchor-rank">当前主播排名：<em><%= nowRank %></em></div>', '<p class="yz-week-text">小时榜Top3，下一小时可获得顶级推荐奖励</p>', "</div>"),
				i = d.compile(t),
				a = i({
					list: e.anchorHourRankList || [],
					room: e.ownAnchorHourData,
					Vars: p,
					remainTime: e.countTime(e.hourRemainTime),
					nowRank: e.handleNowRank(e.nowHourRank)
				});
			this.doms.$item.eq(0).empty().append(a)
		},
		renderMonthList: function() {
			var e = this,
				t = m.join('<div class="yz-week-content">', '<div class="countDownBox month clearfix">', '<div class="hourTitleRight">榜单每1分钟更新一次</div>', '<div class="hourTitleLeft">距月榜截止：<span class="hourRankCountDown J-monthCount"><%= remainTime %></span></div>', "</div>", '<div class="yz-rank-list">', "<ul>", "<% var idx; %>", "<% for (var i = 0; i < 5; i++) { %>", "<% var item = list[i]; %>", "<% if (item) { %>", "<% if (room && i === room.index) { %>", "<% if (i%2) { %>", '<li class="yz-current yz-bg">', "<% } else { %>", '<li class="yz-current">', "<% } %>", "<% } else { %>", "<% if (i%2) { %>", '<li class="yz-bg">', "<% } else { %>", "<li>", "<% } %>", "<% } %>", "<% if (item.vipId && item.vipId > 0) { %>", '<a class="yz-col-left" href="/<%= item.vipId %>" target=_blank>', "<% } else { %>", '<a class="yz-col-left" href="/<%= item.room_id %>" target=_blank>', "<% } %>", "<% if (room && i === room.index) { %>", '<span class="yz-contrib isMonth ownColor">', '<span class="<%= rankChange(item.rank_change)%>"></span>', "</span>", "<% } else { %>", '<span class="yz-contrib isMonth">', '<span class="<%= rankChange(item.rank_change)%>"></span>', "</span>", "<% } %>", '<div class="yz-wp-left">', "<% idx = item.idx %>", '<span class="yz-index"><%= (i + 1) %></span>', '<span class="yz-zhubo">', '<img src="<%= item.avatar %>" />', '<em class="yz-zhubo-icon"></em>', "</span>", "<% if (room && i === room.index) { %>", '<p class="ownColor" title="<%= item.nickname %>"><%= item.nickname %></p>', "<% } else { %>", '<p title="<%= item.nickname %>"><%= item.nickname %></p>', "<% } %>", "<% if (item.is_live === 1) { %>", '<div class="play-status">', "<% } else { %>", '<div class="play-status yz-stop">', "<% } %>", '<span class="yz-play"></span>', '<span class="yz-fenqu"><%= item.cid2_name %></span>', "</div>", "</div>", "</a>", "</li>", "<% } else { %>", "<% if (i%2) { %>", '<li class="yz-bg">', "<% } else { %>", "<li>", "<% } %>", '<a class="yz-col-left" href="javascript:;">', '<span class="yz-contrib isMonth">--</span>', '<div class="yz-wp-left">', "<% idx = idx ? (idx + 1) : (i + 1) %>", '<span class="yz-index"><%= (i + 1) %></span>', '<span class="yz-zhubo">', '<img src="<%= Vars.defaultAvatar %>" />', '<em class="yz-zhubo-icon"></em>', "</span>", "<p>虚位以待</p>", "</div>", "</a>", "</li>", "<% } %>", "<% } %>", "</ul>", "</div>", '<div class="yz-anchor-rank">当前主播排名：<em><%= nowRank %></em></div>', '<p class="yz-week-text">榜单前30名，次月月初可获得高级推荐标签</p>', "</div>");
			if (e.anchorMonthRankList && e.anchorMonthRankList.length > 0) for (var i = 0; i < e.anchorMonthRankList.length; i++) {
				var a = e.anchorMonthRankList[i];
				a.nickname == e.nowMonthNickName && (e.nowMonthRank = i + 1)
			}
			var n = d.compile(t),
				s = n({
					list: e.anchorMonthRankList || [],
					room: e.ownAnchorMonthData,
					Vars: p,
					remainTime: e.countMonthTime(e.monthRemainTime),
					nowRank: e.handleNowRank(e.nowMonthRank),
					rankChange: e.monthRankChange
				});
			this.doms.$item.eq(1).empty().append(s)
		},
		getHourList: function(e) {
			var t = this;
			if (t.listShowFlag) {
				var i = {
					url: "/lapi/interact/ranklist/yzHourWRanklist"
				};
				this.getData(i, function(e) {
					var i = [],
						a = 0;
					0 == e.error && (i = e.data.list, a = e.data.date.deadline - e.data.date.now || 0);
					var n = t.handleData(i);
					t.anchorHourRankList = n, t.hourRemainTime = a, t.resolveHourList(), t.renderHourRemainTime(a)
				})
			}
		},
		handleData: function(t) {
			var i = [];
			return e.isEmptyObject(t) || (i = e.map(new Array(t.length), function(i, a) {
				var n = t[a],
					s = {};
				return s = e.isEmptyObject(n) ? {
					nickname: "虚位以待",
					cate2_name: "",
					avatar: p.defaultAvatar,
					show_status: "",
					score: "",
					room_id: "",
					rank_index: "",
					vip_id: "",
					is_vertical: ""
				} : {
					nickname: n.nn || "虚位以待",
					cate2_name: n.c2n || "",
					avatar: n.avatar || p.defaultAvatar,
					show_status: n.ss,
					score: n.sc,
					room_id: n.rid,
					rank_index: n.rank,
					vip_id: n.vid,
					is_vertical: n.isVertical
				}
			})), i
		},
		getMonthList: function(e) {
			var t = this;
			if (t.listShowFlag) {
				var i = {
					url: "/rank/MonthRank/YZRank",
					data: {
						top_num: 5,
						room_id: p.roomId
					}
				};
				this.getData(i, function(e) {
					var i = [],
						a = 0;
					0 == e.error && (i = e.data.list, a = e.data.date.deadline - e.data.date.now || 0), t.anchorMonthRankList = i, t.nowMonthRank = e.data.anchor_info.rank_index, t.nowMonthNickName = e.data.anchor_info.nickname, t.monthRemainTime = a, t.resolveMonthList(), t.renderMonthRemainTime(a)
				})
			}
		},
		resolveHourList: function() {
			var e = this,
				t = e.anchorHourRankList,
				i = t.length,
				n = !1;
			if (i) for (var s = a.get("room.room_id"), r = 0; i > r; r++) t[r].room_id == s && (n = !0, e.ownAnchorHourData = t[r], e.ownAnchorHourData.index = r, e.nowHourRank = +e.ownAnchorHourData.rank_index);
			else e.ownAnchorHourData = "";
			e.renderHourList()
		},
		hourRankIntervelShow: function(e) {
			var t = this,
				i = t.doms.$content.find(".J-hourCount");
			i.html(e)
		},
		resolveMonthList: function() {
			var e = this,
				t = e.anchorMonthRankList,
				i = t.length,
				n = !1;
			if (i) for (var s = a.get("room.room_id"), r = 0; i > r; r++) t[r].room_id == s && (n = !0, e.ownAnchorMonthData = t[r], e.ownAnchorMonthData.index = r, e.nowMonthRank = +e.ownAnchorMonthData.idx);
			else e.ownAnchorMonthData = "";
			e.renderMonthList()
		},
		monthRankIntervelShow: function(e) {
			var t = this,
				i = t.doms.$content.find(".J-monthCount");
			i.html(e)
		},
		countTime: function(e, t) {
			var i, a, n;
			e >= 0 && (i = Math.floor(e / 60 / 60 % 24), a = Math.floor(e / 60 % 60), n = Math.floor(e % 60), 10 > n && (n = "0" + n), 10 > a && (a = "0" + a), 10 > i && (i = "0" + i));
			var s = a + ":" + n;
			return t && (s = i + ":" + a + ":" + n), s
		},
		renderHourRemainTime: function(e) {
			var t = this,
				i = e;
			Math.floor(e / 86400);
			clearInterval(t.hourTimer), t.hourTimer = null, t.hourTimer = setInterval(function() {
				i--, i = 0 > i ? 0 : i, t.hourRankIntervelShow(t.countTime(i)), 0 >= i && (clearInterval(t.hourTimer), t.getHourList())
			}, 1e3)
		},
		countMonthTime: function(e) {
			var t, i, a, n;
			e >= 0 && (t = Math.floor(e / 86400), i = Math.floor(e / 60 / 60 % 24), a = Math.floor(e / 60 % 60), n = Math.floor(e % 60), 10 > n && (n = "0" + n), 10 > a && (a = "0" + a), 10 > i && (i = "0" + i));
			var s = t + "天" + i + "小时" + a + "分" + n + "秒";
			return s
		},
		renderMonthRemainTime: function(e) {
			var t = this,
				i = e;
			clearInterval(t.monthTimer), t.monthTimer = null, t.monthTimer = setInterval(function() {
				i--, i = 0 > i ? 0 : i, t.monthRankIntervelShow(t.countMonthTime(i)), 0 >= i && (clearInterval(t.monthTimer), t.getMonthList())
			}, 1e3)
		},
		handleNowRank: function(e, t) {
			var i;
			return i = e && 0 != e ? 0 > e ? Math.abs(e) + "+" : e : t ? "--" : "暂无排名"
		},
		monthRankChange: function(e) {
			var t, i = parseInt(e);
			return t = 1 === i ? "rank-up" : -1 === i ? "rank-down" : 0 === i ? "rank-nochange" : ""
		},
		handleCacheNums: function(e) {
			var t, i = this;
			i.cacheNums.push(e), i.cacheRun || m.interval(function() {
				return t = i.cacheNums.length, t ? (i.handleRankNum(i.cacheNums.splice(-1, 1)), i.cacheNums.length = 0, i.cacheRun = !0) : i.cacheRun = !1, i.cacheRun
			}, 1e3, !0)
		},
		handleRankWel: function(e) {
			var t = "",
				a = e.level >= 70 ? "" : "level-bgpng",
				n = e.level >= 100 ? "level-size2" : " level-size1";
			return t = i.string.join('<li class="jschartli" data-type="list" data-level="<%=node.level%>">', '<p class="text-cont rank-wel">', '<i class="rank-wel-order rank-wel-order<%= node.crw %>"></i>', "<% if (node.level > 0) { %>", '<a class="chat-icon-pad user-level<% if ( node.level < 10 ) { %> lve-icon-1to9 <% } %> <%= node.uli %> <%= imgType %> <%= imgSize %> " title="用户等级：<%= node.level %>">', "</a>", "<% } %>", '<a href="javascript:;" class="hy-name js-nick" rel="<%= node.uid %>" is-show-super-icon="<%= node.sahf%>" avatar="<%= node.ic %>" gid="<%= node.pg %>" title="<%= node.nn %>"><%= node.nn %></a>', "<span>欢迎您来到本直播间</span>", "</p>", "</li>"), render = d.compile(t), html = render({
				node: e,
				imgType: a,
				imgSize: n
			}), html
		},
		addEvent: function() {
			var i = this,
				a = this.doms,
				r = a.$trigger,
				o = a.$content;
			s.reg("room_data_handler", function(e) {
				var t = n.decode(e).too();
				if ("shrn" === t.type) {
					var a = n.decode(t.ri).too(),
						s = a.idx;
					i.nowHourRank = +s, i.doms.$nums.html(i.handleNowRank(s, !0)), +s ? (0 > +s && (s = Math.abs(+s) + "+"), h.rank.now ? (h.setRank(s), h.rankAnimate()) : h.rank.now = s, i.getHourList()) : i.doms.$nums.text("--")
				}
			}), s.reg("room_data_handler", function(e) {
				var t = n.decode(e).too();
				if ("shrndiff" === t.type) {
					var a = t.sc;
					0 > +a && (a = Math.abs(+a)), i.reLoadCont = a / 100, i.reLoadContShowMark && i.showListReCont();
					var s;
					if (i.nowHourRank) {
						var r = i.nowHourRank;
						if (0 === r) return;
						1 === r ? (s = t.sctn, h.contChange(s / 100, !0)) : h.contChange(i.reLoadCont, !1)
					} else if (+a) h.contChange(i.reLoadCont, !1);
					else {
						if (s = t.sctn, !+s) return;
						h.contChange(s / 100, !0)
					}
					return h.contStop(), void h.contAnimate()
				}
			}), r.on("mouseenter", function(n) {
				i.listShowFlag = !0, a.$content.addClass("on"), a.$triangleIcon.addClass("on"), i.cate_id = a.$lists.attr("data-cate-id"), e(n.target).closest(".catagory-order-content").length || (t.trigger("dys", {
					key: "dys.room.title.rank.show",
					tid: i.tid,
					cid: i.cid,
					period: "w"
				}), 0 === i.tabIndex ? (i.currentHourHoverTime = (new Date).getTime(), (!i.lastHourHoverTime || i.currentHourHoverTime - i.lastHourHoverTime >= p.GAP_TIME) && (i.getHourList(), i.lastHourHoverTime = i.currentHourHoverTime)) : 1 === i.tabIndex && (i.currentMonthHoverTime = (new Date).getTime(), (!i.lastMonthHoverTime || i.currentMonthHoverTime - i.lastMonthHoverTime >= p.GAP_TIME) && (i.getMonthList(), i.lastMonthHoverTime = i.currentMonthHoverTime)))
			}), r.on("mouseleave", function(e) {
				i.timer = setTimeout(function() {
					i.listShowFlag = !1, o.removeClass("on"), a.$triangleIcon.removeClass("on")
				}, 100)
			}), o.on("mouseenter", function() {
				clearTimeout(i.timer)
			}), o.on("mouseleave", function() {
				o.removeClass("on"), a.$triangleIcon.removeClass("on")
			}), t.on("mod.userenter.get.rankwel", function(e) {
				return i.handleRankWel(e)
			}), t.on("mod.normal.achorinfo.layout", i.debounce()), l.create({
				target: '[data-info-catagory-order="lists"]',
				item: ".catagory-order-name > li",
				content: '[data-info-catagory-order="item"]',
				tEvents: "click",
				handleOther: function(e) {
					2 === e || (1 === e ? (i.currentMonthTime = (new Date).getTime(), (!i.lastMonthTime || i.currentMonthTime - i.lastMonthTime >= p.GAP_TIME) && (i.getMonthList(), i.lastMonthTime = i.currentMonthTime)) : (i.currentHourTime = (new Date).getTime(), (!i.lastHourTime || i.currentHourTime - i.lastHourTime >= p.GAP_TIME) && (i.getHourList(), i.lastHourTime = i.currentHourTime))), t.trigger("dys", {
						key: "dys.room.title.rank.star.click",
						tid: i.tid,
						pos: 0
					})
				}
			}), a.$item.on("click", "a.order-info", function() {
				var i = e(this).index("a.order-info"),
					a = e(this).data("rid");
				t.trigger("dys", {
					key: "dys.room.title.rank.star.room.click",
					rid: a,
					pos: i + 1
				})
			}), a.$item.on("click", "a.order-link", function() {
				var i = e(this).index("a.order-link"),
					a = e(this).data("rid");
				t.trigger("dys", {
					key: "dys.room.title.rank.star.room.click",
					rid: a,
					pos: i + 1
				})
			}), a.$content.on("click", ".catagory-order-link", function() {
				t.trigger("dys", {
					key: "dys.room.title.rank.total.click",
					cid: i.cid
				})
			}), e(".catagory-order-name").on("click", "li", function() {
				var t = e(this).index();
				i.tabIndex = t
			})
		}
	}, {
		init: function() {
			var t = e(".catagory-order-container").hasClass("yzpk");
			!t || 201 !== p.cateId && 311 !== p.cateId || (u.init(), h.init())
		}
	}
}), define("douyu/page/room/normal/mod/yuba-group-dynamic", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "shark/util/storage/1.0", "douyu/context"], function(e, t, i, a, n, s) {
	var r = {
		vars: {
			reloadLimitTime: 6e4,
			timer: null,
			roomId: s.get("room.room_id")
		},
		urls: {
			groupDynamic: s.get("room.yuba_jump_url"),
			yuba: s.get("sys.yubaDomain").replace(/^http(s?):/, "").replace(/\/$/g, ""),
			getGroupDynamic: "/api/dy/Anchor/groupTrends"
		},
		data: {},
		init: function() {
			var t, i;
			this.doms = {
				roomTitle: e("#anchor-info")
			}, this.renders = {
				renderGroupDynamic: this.renderGroupDynamicFn()
			}, t = this.doms, i = t.roomTitle, t.anchorName = i.find("a.zb-name"), t.roomAvatar = i.find("div.anchor-pic"), this.setRoomAvatarInfo(), this.setAnchorNameTip(), this.bindEvents()
		},
		setRoomAvatarInfo: function() {
			var e = this.urls.groupDynamic,
				t = this.doms,
				a = i.string.join('<a data-groupdynamic="avatar" target="_blank" class="anchor-cover-wrap" href="' + e + '">', '<div class="cover"></div>', '<div class="yuba-icon"></div>', '<div class="text">进入TA的鱼吧</div>', "</a>", '<div class="yuba-group-active">', '<div class="triangle">', '<div class="triangle-bg"></div>', "</div>", '<div class="hover-expand"></div>', '<div class="group-title">', "<span>小组动态</span>", '<a data-groupdynamic="more" class="more fr hide" href="' + e + '" target="_blank">更多精彩内容<i class="icon"></i></a>', "</div>", '<div data-groupdynamic="list" class="list"></div>', "</div>");
			t.roomAvatar.append(a), t.groupDynamicList = t.roomAvatar.find('[data-groupdynamic="list"]'), t.moreLink = t.roomAvatar.find('[data-groupdynamic="more"]'), t.avatar = t.roomAvatar.find('[data-groupdynamic="avatar"]')
		},
		setAnchorNameTip: function() {
			this.doms.anchorName.attr({
				href: this.urls.groupDynamic,
				target: "_blank"
			}).append('<div class="tip" style="margin-left: -46px;"><div class="arrow"></div>进入TA的鱼吧</div>')
		},
		bindEvents: function() {
			var i = this,
				a = i.doms,
				n = i.vars;
			a.roomAvatar.on("mouseenter", function() {
				n.timer || (n.timer = setTimeout(function() {
					clearTimeout(n.timer), n.timer = null
				}, n.reloadLimitTime), i.getGroupDynamic()), t.trigger("dys", {
					key: "dys.room.anchor.yuba.group.show"
				})
			}).on("click", '[data-groupdynamic="more"]', function() {
				var e = i.data.originalData;
				t.trigger("dys", {
					key: "dys.room.anchor.yuba.group.more.click",
					f_id: e.fid,
					t_id: e.tid
				})
			}).on("click", '[data-groupdynamic="grouppostitem"]', function() {
				var i = e(this).parent().index();
				t.trigger("dys", {
					key: "dys.room.anchor.yuba.group.itempost.click",
					jurl: this.href,
					pos: i
				})
			}).on("click", '[data-groupdynamic="avatar"]', function() {
				var a = i.data.originalData;
				t.trigger("dys", {
					key: "dys.room.title.avatar.click",
					f_id: a.fid,
					t_id: a.tid,
					jurl: e(this).attr("href")
				})
			}), a.anchorName.on("click", function() {
				t.trigger("dys", {
					key: "dys.room.title.anchor.click",
					jurl: e(this).attr("href")
				})
			})
		},
		getGroupDynamic: function() {
			var t = this;
			e.ajax({
				url: this.urls.yuba + this.urls.getGroupDynamic,
				dataType: "jsonp",
				data: {
					room_id: this.vars.roomId
				}
			}).done(function(e) {
				var i = e && e.data && e.data.list || {
					list: null
				};
				t.data.originalData = e && e.data || {}, t.data.list = i, t.renderGroupDynamic()
			}).fail(function() {
				t.data.list = {
					list: null
				}, t.renderGroupDynamic()
			})
		},
		renderGroupDynamicFn: function() {
			var e = i.string.join("{{ each list as item index }}", '<div class="item">', '<a data-groupdynamic="grouppostitem" class="item-wrap" href="{{ item.post_url }}" target="_blank">', '<span class="item-head-pic">', '<img src="{{ item.avator }}" >', '<em class="icon"></em>', "</span>", '<div class="item-head-detail">', '<span class="item-nickname" title="{{ currUid == item.postuid ? userNickname : item.nickname }}">{{ currUid == item.postuid ? userNickname : item.nickname }}</span>', '<span class="title" title="{{ item.title }}">{{ if item.is_vote }}<i>投票</i> {{ /if }}{{ item.title }}</span>', "{{ if item.is_video }}", '<div class="item-pic-wrap">', '<span class="pic-wrap is-wh">', '<img src="{{ item.is_video }}">', '<span><i class="icon play-icon"></i></span>', "</span>", "</div>", "{{ else if item.is_img }}", '<div class="item-pic-wrap {{ item.imgs.length > 1 ? "pic-wrap-more" : "" }}">', "{{ each item.imgs as img i }}", "{{ if (item.imgs.length > 1 && img.width <= limitXH && img.height <= limitXH) || (item.imgs.length < 2 && img.width <= limitXW && img.height <= limitXH) || (item.imgs.length < 2 && img.width <= limitMW && img.height <= limitMH) }}", '<span class="pic-wrap">', "{{ else }}", "{{ if img.width > img.height }}", '<span class="pic-wrap is-wh" style="width:{{ limitXW > limitXH*img.width/img.height ? limitXH*img.width/img.height : limitXW }}px;">', "{{ else if img.height == img.width }}", '<span class="pic-wrap is-w-h">', "{{ else if img.height > img.width }}", '<span class="pic-wrap is-hw"style="height:{{ limitMH > limitMW*img.height/img.width ? limitMW*img.height/img.width : limitMH }}px;">', "{{ /if }}", "{{ /if }}", '<img src="{{ img.url }}">', "{{ if item.img_count > 3 && i == 2 }}", "<em>{{ item.img_count }}张</em>", "{{ /if }}", "</span>", "{{ /each }}", "</div>", "{{ /if }}", '<div class="data-bar">', '<span class="watch-num">{{ item.views }}</span>', '<span class="reply-num">{{ item.answer_num || "评论" }}</span>', "</div>", "</div>", "</a>", "</div>", "{{ /each }}"),
				t = a.compile(e);
			return t
		},
		renderGroupDynamic: function() {
			var e = this.data.list,
				t = this.doms,
				i = ['<div class="empty">', '<div class="empty-text">马上', '<a href="' + this.urls.groupDynamic + '" target="_blank">去发帖</a>', "更容易被主播看到</div>", "</div>"].join("");
			e.length > 0 ? (t.moreLink.removeClass("hide"), i = this.renders.renderGroupDynamic({
				limitXW: 130,
				limitMW: 95,
				limitXH: 90,
				limitMH: 125,
				currUid: s.get("sys.uid"),
				userNickname: s.get("sys.nickname"),
				list: e
			})) : t.moreLink.addClass("hide"), t.groupDynamicList.html(i)
		}
	};
	return {
		init: function() {
			r.init()
		}
	}
}), define("douyu/page/room/normal/mod/anchor-level", ["jquery", "shark/class", "shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "shark/util/flash/data/1.0", "douyu/context", "douyu/page/room/base/api"], function(e, t, i, a, n, s, r, o) {
	var l = {
		container: e("#container"),
		roomVideo: e("#js-room-video"),
		anInfoDom: e("#js-anchor-level-wrap")
	},
		c = {
			ownerName: r.get("room.owner_name"),
			rid: r.get("room.room_id"),
			uid: r.get("room.owner_uid"),
			url: {
				stayLv: "/anchor_level/getLevelInfo"
			},
			maxLevel: 100,
			maxExp: 255545e3
		},
		d = {
			formatDotZero: function(e) {
				return String(e).replace(/(\.\d*?)0+$/g, "$1").replace(/\.$/, "")
			},
			formatDecimals: function(e, t) {
				var i = new RegExp("(\\.\\d{" + t + "})\\d*$"),
					a = e + "",
					n = a.replace(i, "$1");
				return n = d.formatDotZero(n)
			},
			formatContribute: function(e, t) {
				return e >= 1e4 && (e = d.formatDecimals(e / 1e4, t) + "万"), e
			}
		},
		u = {
			_inited: !1,
			init: function(e) {
				var t = this;
				t.getDoms(), r.get("sys.uid") == c.uid && (t.doms.lookLevelIntro.show(), t.doms.anchorLevelIcon.attr({
					href: "/room/level/index",
					target: "_blank"
				})), t.bindEvent(), this._inited = !0
			},
			getDoms: function() {
				var e = l.anInfoDom;
				this.doms = {
					hoverWrap: e.find('[data-type-anchor="hover-wrap"]'),
					upLvNeedExpBox: e.find('[data-type-anchor="upLv-need-exp-box"]'),
					upLvMaxBox: e.find('[data-type-anchor="upLv-max-exp-box"]'),
					upLvNeedExp: e.find('[data-type-anchor="upLv-need-exp"]'),
					currLv: e.find('[data-type-anchor="current-lv"]'),
					nextLv: e.find('[data-type-anchor="next-lv"]'),
					proBar: e.find('[data-type-anchor="level-progress-bar"]'),
					curExpText: e.find('[data-type-anchor="exp-txt"]'),
					stayLvGetExp: e.find('[data-type-anchor="stayLv-get-exp"]'),
					stayLvNeedExp: e.find('[data-type-anchor="stayLv-need-exp"]'),
					stayLvTime: e.find('[data-type-anchor="stayLv-time"]'),
					anchorLevelIcon: e.find("[data-anchor-levelimg]"),
					lookLevelIntro: e.find('[data-type-anchor="look-level-introduce"]')
				}
			},
			sendAjax: function(t, i) {
				var a = t.url,
					n = t.type || "GET",
					s = t.data || {},
					r = i || {},
					o = r.success || e.noop,
					l = r.error || e.noop;
				a && e.ajax({
					url: a,
					type: n,
					data: s,
					dataType: "json",
					success: o,
					error: l
				})
			},
			leInfoHandle: function(e) {
				var t = parseFloat(e.o_exp, 10) / 100 || 0,
					i = parseFloat(e.o_minexp, 10) / 100 || 0,
					a = parseFloat(e.o_upexp, 10) / 100 || 100,
					n = t - i,
					s = parseInt(e.o_lev, 10) || 1,
					r = 2,
					o = !1,
					l = 0;
				return r = s < c.maxLevel ? s + 1 : s, l = n ? n / (a + n) : 0, l = d.formatDecimals(100 * l, 1), a = d.formatContribute(a, 2), t > c.maxExp && (l = 100, o = !0), {
					level: s,
					nextLv: r,
					bar: l,
					needExp: a,
					isMaxLv: o
				}
			},
			stayLeHandle: function(e) {
				var t = parseFloat(e.keep_exp, 10) || 0,
					i = parseFloat(e.exp_distance, 10) || 0,
					a = (e.end_time || "----.--.-- 23:59") + "前",
					n = 0 === i ? 1 : 0;
				return t = d.formatContribute(t, 2), i = d.formatContribute(i, 2), {
					stayLv: t,
					needExp: i,
					limitTime: a,
					isComplete: n
				}
			},
			levelRender: function(t) {
				var i = this;
				i.doms || i.getDoms();
				var a = i.doms,
					n = {};
				n = i.leInfoHandle(t) || {}, e.isEmptyObject(n) || (a.anchorLevelIcon.attr("data-anchor-levelimg", n.level), a.currLv.attr({
					"data-anchor-leveltext": n.level,
					title: "主播等级：" + n.level
				}).text("Lv." + n.level), n.isMaxLv || n.level >= c.maxLevel ? (a.nextLv.hide(), a.upLvNeedExpBox.hide(), a.upLvMaxBox.show()) : (a.nextLv.attr({
					"data-anchor-nextleveltext": n.nextLv,
					title: "主播等级：" + n.nextLv
				}).text("Lv." + n.nextLv), a.upLvNeedExpBox.show(), a.upLvNeedExp.text(n.needExp), a.upLvMaxBox.hide(), a.nextLv.show()), a.proBar.width(n.bar + "%"), a.curExpText.text(n.bar + "%"))
			},
			stayLvCB: {
				success: function(t) {
					var i = u,
						a = i.doms,
						n = {};
					if (t && !e.isEmptyObject(t)) {
						if (n = i.stayLeHandle(t) || {}, e.isEmptyObject(n)) return;
						a.stayLvNeedExp.text(n.stayLv), n.isComplete ? (l.anInfoDom.find('[data-type-anchor="stay-level-text"]').hide(), n.needExp = "已完成") : l.anInfoDom.find('[data-type-anchor="stay-level-text"]').show(), a.stayLvGetExp.text(n.needExp), a.stayLvTime.text(n.limitTime)
					}
				},
				error: function() {}
			},
			bindEvent: function() {
				var e = this,
					t = e.doms;
				e.timer = null, l.anInfoDom.on("mouseenter", function() {
					var i;
					t.hoverWrap.show(), e.timer || (i = {
						url: c.url.stayLv,
						type: "POST",
						data: {
							roomId: c.rid
						}
					}, e.sendAjax(i, e.stayLvCB), e.timer = setTimeout(function() {
						clearTimeout(e.timer), e.timer = null
					}, 2e3))
				}).on("mouseleave", function() {
					t.hoverWrap.hide()
				}), t.lookLevelIntro.length && t.lookLevelIntro.on("click", function() {
					i.trigger("dys", {
						key: "dys.room.anchorLevel.lookIntro.click"
					})
				})
			}
		},
		f = function() {
			var s = r.get("sys.uid") == c.uid ? 1 : 0,
				o = t({
					state: !0,
					timer: null,
					init: function(t, i) {
						var a = this,
							n = e('[data-tyep-anchor="upOrDown-tip"]');
						n.length && n.remove(), a.render(t, i), a.bindEvent()
					},
					dialogHtml: function(e, t) {
						var i = this,
							s = e,
							r = i.handleTextData(t),
							o = a.string.join('<div class="anchortip-inplayer {{ textData.typeClassName }}" id="upOrDown-tip" data-tyep-anchor="upOrDown-tip">', '<div class="anchortip-inplayer-placehodler anchortip-inplayer-center"></div>', '<div class="anchortip-inplayer-con anchortip-inplayer-center">', '<a class="anchortip-inplayer-close" data-type-anchor="upOrDown-close"></a>', '<div class="anchortip-inplayer-tipimg"></div>', '<span class="anchortip-inplayer-text1">', '<span class="anchortip-inplayer-center">{{ textData.text1.a }}</span>', '<span class="anchortip-inplayer-anchorname anchortip-inplayer-text-hightlight anchortip-inplayer-center">{{ infoData.ownerName }}</span>', '<span class="anchortip-inplayer-center">{{ textData.text1.b }}</span>', '<span class="anchortip-inplayer-anchorlevel anchortip-inplayer-center {{ textData.hlClassName }}">{{ infoData.level }}</span>', '<span class="anchortip-inplayer-center">{{ textData.text1.c }}</span>', "</span>", '<span class="anchortip-inplayer-text2">', '<span class="anchortip-inplayer-center">{{ textData.text2.a }}</span>', '<span class="anchortip-inplayer-exp anchortip-inplayer-text-hightlight anchortip-inplayer-center">{{ infoData.expLess }}</span>', '<span class="anchortip-inplayer-text-hightlight">{{ textData.text2.b }}</span>', "</span>", "</div>", "</div>"),
							l = n.compile(o),
							c = l({
								infoData: s,
								textData: r
							});
						return c
					},
					chatHtml: function(e, t) {
						var i, s, r, o = e;
						switch (t) {
						case "levelUp":
							i = a.string.join('<li class="jschartli normal-notice-new" data-type="list">', '<i class="sys-icon"></i>', '<div class="anchortip-inchat-cont clearfix">', '<div class="anchortip-inchat-r">', "<span>", '恭喜<a class="nick-new">{{ infoData.ownerName }}</a>', "主播等级达到", '<a style="margin: -2px 0 0 6px;" class="chat-icon-pad anchor-level-icon" title="主播等级：{{ infoData.level }}" data-anchor-levelimg="{{ infoData.level }}"></a>，继续挑战新的保级任务吧', "</span>", "</div>", "</div>", "</li>");
							break;
						case "stayFail":
							i = a.string.join('<li class="jschartli normal-notice-new" infoData-type="list">', '<i class="sys-icon"></i>', '<div class="anchortip-inchat-cont clearfix">', '<div class="anchortip-inchat-r">', "<span>", "很遗憾，", '<a class="nick-new">{{ infoData.ownerName }}</a>', '<span class="highLight"> {{ infoData.level }}级保级失败</span>，扣除', '<span class="highLight">{{ infoData.expLess }}</span> 经验值', "</span>", "</div>", "</div>", "</li>")
						}
						return s = n.compile(i), r = s({
							infoData: o
						})
					},
					render: function(e, t) {
						var a, n = this,
							r = {};
						e && (r = n.handleData(e, t), s || r.isPopup ? (a = n.dialogHtml(r, t), l.roomVideo.append(a)) : (a = n.chatHtml(r, t), i.trigger("mod.chat.msg.msg", a)))
					},
					handleData: function(e, t) {
						var i = {};
						switch (t) {
						case "levelUp":
							i.level = parseInt(e.lev, 10) || 1, i.expLess = "";
							break;
						case "stayFail":
							i.level = parseInt(e.llev, 10) || 1, i.expLess = d.formatContribute(parseInt(e.ddct, 10) / 100, 2) || 0
						}
						return s ? i.ownerName = "" : i.ownerName = c.ownerName || "", i.isPopup = parseInt(e.pu, 10) || 0, i
					},
					handleTextData: function(e) {
						var t = {
							text1: {},
							text2: {}
						};
						switch (e) {
						case "levelUp":
							s ? (t.text1.a = "恭喜您，主播等级达到", t.text1.b = "") : (t.text1.a = "恭喜", t.text1.b = "主播等级达到"), t.text1.c = "级", t.text2.a = "继续挑战新的保级任务吧", t.text2.b = "", t.hlClassName = "anchortip-inplayer-text-hightlight", t.typeClassName = "anchortip-inplayer--rankup";
							break;
						case "stayFail":
							s ? t.text1.a = "很遗憾，您" : t.text1.a = "很遗憾，", t.text1.b = "", t.text1.c = "级保级失败", t.text2.a = "扣除", t.text2.b = "经验值", t.hlClassName = "", t.typeClassName = "anchortip-inplayer--protectLevelFail"
						}
						return t
					},
					remove: function(t) {
						var i = this.state;
						i && e(t).fadeOut("800", function() {
							e(t).remove(), i = !1
						})
					},
					bindEvent: function() {
						var t = this,
							i = e("#upOrDown-tip");
						i.on("click", '[data-type-anchor="upOrDown-close"]', function() {
							t.remove(i), clearTimeout(t.timer)
						}), t.timer = setTimeout(function() {
							t.remove(i), clearTimeout(t.timer)
						}, 3e3)
					}
				});
			return {
				create: function(e, t) {
					return new o(e, t)
				}
			}
		},
		p = function() {
			var i = t({
				init: function(t, i) {
					var a, n, s = this;
					t && (a = s.handleData(t, i), n = e(s.render(a)), l.roomVideo.append(n), clearTimeout(s.timer), s.timer = setTimeout(function() {
						s.remove(n)
					}, 3e3))
				},
				render: function(e) {
					var t = a.string.join('<div class="anchor-protectlevel-task">', '<div class="anchor-protectlevel-task-placehodler anchor-protectlevel-task-center"></div>', '<div class="anchor-protectlevel-task-con anchor-protectlevel-task-center">', '<span class="anchor-protectlevel-task-center">您今日{{ data.type }}有效直播已达</span>', '<span class="anchor-protectlevel-task-center anchor-protectlevel-task-highlight">', '<span class="anchor-protectlevel-task-time">{{ data.time }}</span> 分钟', "</span>", '<span class="anchor-protectlevel-task-center">奖励</span>', '<span class="anchor-protectlevel-task-center anchor-protectlevel-task-highlight">', '<span class="anchor-protectlevel-task-exp">{{ data.exp }}</span> 经验值', "</span>", "</div>", "</div>"),
						i = n.compile(t),
						s = i({
							data: e
						});
					return s
				},
				handleData: function(e, t) {
					var i, a, n = {};
					return e ? ("single" === t ? (n.type = "单场", i = a = 100) : "total" === t && (n.type = "累计", i = a = 300), n.time = parseInt(e.st, 10) || i, a = parseInt(e.exp, 10) / 100 || a, n.exp = d.formatContribute(a, 2), n) : !1
				},
				remove: function(t) {
					e(t).fadeOut("800", function() {
						e(t).remove()
					})
				}
			});
			return {
				create: function(e, t) {
					return new i(e, t)
				}
			}
		};
	return i.on("mod.anthor.levelInfo.get", function(e) {
		"memberinfores" === e.type && (u._inited || u.init(), u.levelRender(e))
	}), o.reg("room_data_handler", function(e) {
		var t = s.decode(e).too(),
			i = t.type;
		switch (i) {
		case "synexp":
			u.levelRender(t);
			break;
		case "upbc":
			f().create(t, "levelUp");
			break;
		case "dgbc":
			f().create(t, "stayFail");
			break;
		case "slta":
			p().create(t, "single");
			break;
		case "tlta":
			p().create(t, "total")
		}
	}), {
		init: function() {
			u.init()
		}
	}
}), define("douyu/page/room/normal/mod/anchor-impress", ["jquery", "shark/util/lang/1.0", "shark/util/template/1.0", "shark/util/storage/1.0", "shark/util/cookie/1.0", "douyu/context", "shark/observer", "douyu/com/user"], function(e, t, i, a, n, s, r, o) {
	var l = s.get("room.room_id"),
		c = ['<div class="impress-dialog">', '<div class="impress-dialog-title">印象标签</div>', '<div class="impress-dialog-close">&times;</div>', '<div class="impress-dialog-change <%= allTags.length > 10 ? "" : "hide" %>"><span>换一批</span><div class="impress-change-btn"></div></div>', '<div class="impress-dialog-label">选择对TA的印象：</div>', '<div class="impress-dialog-notips <%= allTags.length > 0 ? "hide" : "" %>">还没有人评价ta，写出对你对ta的印象吧</div>', "<% if (allTags && allTags.length > 0){%>", '<div class="impress-dialog-cont impress-all">', '<div class="impress-dialog-list clearfix">', "<% for(var j=0;j<allTags.length;j++){%>", '<div class="impress-dialog-item" ', ' data-id="<%= allTags[j].id %>"', ' data-tag="<%= allTags[j].tag %>"', "><%= allTags[j].tag %></div>", "<%}%>", "</div>", "</div>", "<% } %>", '<div class="impress-dialog-diy"><span class="diy-add-sign"></span>自定义</div>', '<div class="impress-input-box hide clearfix">', '<div class="input-error">', '<span class="input-error-icon"></span>', '<span class="input-error-text"></span>', '<span class="input-error-close">&times;</span>', '<div class="input-error-arrow"></div>', '<div class="input-error-arrow2"></div>', "</div>", '<input type="text" class="impress-dialog-input" placeholder="输入标签（最多4个字）" maxlength="4">', '<span class="impress-dialog-edit disable">提交</span>', '<span class="impress-dialog-split"></span>', '<span class="impress-dialog-cancel">取消</span>', "</div>", '<div class="impress-dialog-label">我对TA的印象：</div>', '<div class="impress-dialog-holder"></div>', '<div class="impress-dialog-cont impress-mine hide">', '<div class="impress-dialog-list clearfix">', "</div>", "</div>", '<div class="impress-dialog-save">保存标签</div>', '<div class="impress-dialog-tips">说明：已选标签审核通过后，将进入主播标签库</div>', "</div>"].join(""),
		d = ['<label class="label">TA的标签：</label>', '<div class="impress-list clearfix">', "<% for(var j=0;j<tags.length;j++){%>", "<% var item = tags[j] %>", '<a href="/directory/tags/<%= item.id %>" class="impress-item" ', ' data-id="<%= item.id %>"', ' data-tag="<%= item.tag %>"', "><%= item.tag %></a>", "<%}%>", "</div>", '<div class="impress-add"><span class="impress-icon"></span>印象标签</div>'].join(""),
		u = null,
		f = null,
		p = [],
		m = {
			showIndex: 0,
			tempTags: null,
			pageSize: 10,
			init: function() {
				1 === +$ROOM.room_label_right_flag ? m.getRoomTag() : e(".live-room-normal-left").addClass("no-anchor-impress")
			},
			bindEvent: function() {
				m.$trigger.on("click", m.getAllTag), m.$container.on("click", ".impress-dialog-close", m.destory), m.$container.on("click", ".impress-dialog-change", m.changePage), m.$container.on("click", ".impress-all .impress-dialog-item", m.choseImpress), m.$container.on("click", ".impress-dialog-diy", m.showEditInput), m.$container.on("click", ".impress-dialog-edit:not(.disable)", m.saveNewImpress), m.$container.on("click", ".impress-dialog-cancel", m.hideEditInput), m.$container.on("click", ".impress-remove", m.removeImpress), m.$container.on("click", ".impress-dialog-save:not(.disable)", m.saveMineImpress), m.$container.on("click", ".input-error-close", m.hideInputError), r.on("mod.normal.title.layout", function() {
					m.layout()
				})
			},
			renderDialog: function() {
				if (!m.$dialog) {
					m.dialogRender || (m.dialogRender = i.compile(c));
					var t = m.dialogRender({
						allTags: f
					}),
						a = m.$dialog = e(t);
					m.$container.append(a), m.$holder = a.find(".impress-dialog-holder"), m.$mine = a.find(".impress-mine"), m.$mineList = m.$mine.find(".impress-dialog-list"), m.$all = a.find(".impress-all"), m.$allItems = m.$all.find(".impress-dialog-item"), m.$diy = a.find(".impress-dialog-diy"), m.$inputBox = a.find(".impress-input-box"), m.$input = a.find(".impress-dialog-input"), m.$saveBtn = a.find(".impress-dialog-save"), m.$errorBox = a.find(".input-error"), m.$errorText = a.find(".input-error-text"), m.getUserTag()
				}
				m.$input.on("blur keyup", function() {
					var e = m.$dialog.find(".impress-dialog-edit"),
						t = m.$input.val();
					t.length > 0 ? e.removeClass("disable") : e.addClass("disable")
				})
			},
			renderMyTag: function(t) {
				t && t.length > 0 ? (m.$holder.addClass("hide"), m.$mine.removeClass("hide")) : (m.$holder.removeClass("hide"), m.$mine.addClass("hide"));
				var i = [];
				m.$allItems.removeClass("selected"), e.each(t, function(e, t) {
					i.push('<div class="impress-dialog-item">', '<span class="impress-text">', t, "</span>", '<span class="impress-remove">&times;</span>', "</div>"), m.selecteImpress(null, t)
				}), i = i.join(""), m.$mineList.html(i)
			},
			renderRoomTag: function() {
				m.$container = e("#container"), m.$impress = e("#anchor-info .anchor-impress").show();
				var t = i.compile(d),
					a = t({
						tags: p
					});
				m.$impress.html(a), m.$trigger = m.$impress.find(".impress-add"), m.bindEvent()
			},
			changePage: function() {
				var e = m.showIndex + m.pageSize;
				e >= m.$allItems.length && (e = 0), m.$allItems.hide(), m.$allItems.slice(e, e + m.pageSize).show(), m.showIndex = e
			},
			selecteImpress: function(e, t) {
				e ? m.$allItems.filter("[data-id=" + e + "]").addClass("selected") : m.$allItems.filter("[data-tag=" + t + "]").addClass("selected")
			},
			choseImpress: function() {
				var t = e(this),
					i = t.data();
				t.hasClass("selected") ? m.removeMineImpress(i.tag + "") : m.addMineImpress(i.tag + "")
			},
			addMineImpress: function(e) {
				return m.tempTags.length >= 5 ? void m.toast("maxTag") : (m.tempTags.push(e), void m.renderMyTag(m.tempTags))
			},
			removeMineImpress: function(t) {
				var i = e.inArray(t, m.tempTags); - 1 !== i && (m.tempTags.splice(i, 1), m.renderMyTag(m.tempTags))
			},
			saveMineImpress: function() {
				var t = m.$mine.find(".impress-text");
				if (0 === t.length) return void m.toast("saveNull");
				var i = [];
				e.each(t, function() {
					i.push(e(this).text())
				}), m.getCSRFCookie(function(t) {
					var a = e.extend(t, {
						room_id: l,
						tag_list: i
					});
					m.requestData("/wgapi/livenc/anchor/tag/mark", JSON.stringify(a), function(e) {
						0 === +e.code ? (m.toast("succ"), u = m.tempTags.slice(0), m.destory()) : m.toast(e.msg || "fail")
					}, "post", "application/json")
				})
			},
			removeImpress: function() {
				var t = e.trim(e(this).closest(".impress-dialog-item").find(".impress-text").text());
				m.removeMineImpress(t)
			},
			saveNewImpress: function() {
				var t = e.trim(m.$input.val()),
					i = e.inArray(t, m.tempTags);
				if (-1 !== i) return void m.showInputError("tagExist");
				var a = /^[0-9a-zA-Z\u4E00-\u9FA5]+$/;
				return a.test(t) ? t.length > 4 ? void m.showInputError("maxText") : (m.hideInputError(), void m.requestData("/wgapi/livenc/anchor/tag/check", {
					room_id: l,
					tag_name: t
				}, function(e) {
					e.data && 0 === +e.data.status ? (m.addMineImpress(t), m.$input.val(""), m.$input.trigger("blur")) : m.showInputError("tagErr")
				})) : void m.showInputError("textError")
			},
			showEditInput: function() {
				m.$diy.addClass("hide"), m.$inputBox.removeClass("hide")
			},
			hideEditInput: function() {
				m.$input.val(""), m.$diy.removeClass("hide"), m.$inputBox.addClass("hide")
			},
			destory: function() {
				m.$input.off("blur keyup"), m.$dialog.hide(), m.tempTags = [], m.$dialog.remove(), m.$dialog = null
			},
			getCSRFCookie: function(t) {
				var i = this,
					a = n.get(s.get("sys.tvk"));
				if (!a) return void e.ajax({
					url: "/curl/csrfApi/getCsrfCookie",
					type: "GET",
					dataType: "json",
					success: function(e) {
						0 === +e.error && i.getCSRFCookie(t)
					}
				});
				var r = {};
				r[$SYS.tn] = a, t && t(r)
			},
			requestData: function(t, i, a, n, s) {
				e.ajax({
					url: t,
					data: i,
					type: n || "get",
					dataType: "json",
					contentType: s,
					success: a || e.noop
				})
			},
			getAllTag: function() {
				var e = o.check();
				return e ? void(f ? m.renderDialog() : m.requestData("/wgapi/live/anchor/tag/top", {
					room_id: l
				}, function(e) {
					0 === +e.code ? (f = e.data || [], m.renderDialog()) : m.error(e.msg)
				})) : (o.show("login"), !1)
			},
			getUserTag: function() {
				u ? (m.tempTags = u.slice(0), m.renderMyTag(m.tempTags)) : (m.requestData("/wgapi/livenc/anchor/tag/user", {
					room_id: l
				}, function(e) {
					0 === +e.code ? (u = e.data.tag_list || [], m.tempTags = u.slice(0), m.renderMyTag(u)) : m.error(e.msg)
				}), m.tempTags = [])
			},
			getRoomTag: function() {
				m.requestData("/wgapi/live/anchor/tag/top3", {
					room_id: l,
					cate2: $ROOM.cate_id
				}, function(t) {
					0 === +t.code && (e(".live-room-normal-left").removeClass("no-anchor-impress"), p = t.data || [], m.renderRoomTag(), r.trigger("mod.normal.title.layout"))
				})
			},
			error: function(t) {
				e.dialog.tips_black(t || "网络错误", 1)
			},
			toast: function(t) {
				var i = {
					succ: "主播印象提交成功",
					fail: "主播印象提交失败，请重试",
					maxTag: "亲，最多可选5个主播标签哦~",
					tips: "审核通过后的标签将进入主播标签库<br>亲，因为有你的标签，让水友又更了解主播一点了~ ",
					saveNull: "请至少选择一个标签"
				},
					a = e('<div class="impress-dialog-toast"><span class="inlie-text"></span></div>'),
					n = i[t] ? i[t] : t;
				m.$container.append(a), a.find(".inlie-text").html(n), a.animate({
					top: "-=10"
				}, 300), a.delay(1e3).animate({
					opacity: 0
				}, 300, function() {
					a.remove()
				})
			},
			showInputError: function(e) {
				var t = {
					maxText: "哎呀，字数太多了，不能超过4个字哦~",
					textError: "标签只能包含汉字，英文，数字",
					tagExist: "你已添加该标签",
					tagErr: "标签包含敏感词"
				},
					i = t[e] ? t[e] : e;
				m.$errorText.text(i), m.$errorBox.show()
			},
			hideInputError: function() {
				m.$errorBox.hide()
			},
			layout: function() {
				var t = m.$impress.find(".impress-item");
				if (3 === t.length) {
					var i = e("#anchor-info").width();
					e("#anchor-info .sq-wrap").outerWidth(!0);
					t.eq(2).show().css("opacity", 0);
					var a = m.$impress.outerWidth(!0);
					0 >= i - a - 350 ? t.eq(2).hide() : t.eq(2).show(), t.eq(2).css("opacity", 1)
				}
			}
		};
	return m
}), define("douyu/page/room/normal/mod/share", ["jquery", "shark/util/flash/data/1.0", "shark/observer", "shark/class", "douyu/page/room/base/api", "douyu/context", "shark/util/template/2.0", "shark/util/storage/1.0", "douyu/com/ajax"], function(e, t, i, a, n, s, r, o, l) {
	var c = {};
	c.templateSettings = {
		evaluate: /%([\s\S]+?)%/g,
		interpolate: /%=([\s\S]+?)%/g,
		escape: /%-([\s\S]+?)%/g
	}, c.template = function(t, i, a) {
		var n = /\\|'|\r|\n|\u2028|\u2029/g,
			s = function(e) {
				return "\\" + escapes[e]
			};
		!i && a && (i = a), i = e.extend({}, i, c.templateSettings);
		var r = RegExp([(i.escape || noMatch).source, (i.interpolate || noMatch).source, (i.evaluate || noMatch).source].join("|") + "|$", "g"),
			o = 0,
			l = "__p+='";
		t.replace(r, function(e, i, a, r, c) {
			return l += t.slice(o, c).replace(n, s), o = c + e.length, i ? l += "'+\n((__t=(" + i + "))==null?'':_.escape(__t))+\n'" : a ? l += "'+\n((__t=(" + a + "))==null?'':__t)+\n'" : r && (l += "';\n" + r + "\n__p+='"), e
		}), l += "';\n", i.variable || (l = "with(obj||{}){\n" + l + "}\n"), l = "var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n" + l + "return __p;\n";
		try {
			var d = new Function(i.variable || "obj", "_", l)
		} catch (u) {
			throw u
		}
		var f = function(e) {
				return d.call(this, e)
			},
			p = i.variable || "obj";
		return f.source = "function(" + p + "){\n" + l + "}", f
	};
	var d = ($SYS.res_url.replace(/https?:/, "") + "images/ZeroClipboard.swf", ['<div class="con hide" data-share-content="content">', '<i class="arrow-icon"></i>', '<div class="mouseenter-cover"></div>', '<div class="share-more clearfix">', '<div class="share-title js-share-title">呼唤小伙伴们前来围观吧</div>', '<div class="share-third-list">', '<!-- <h3 class="h3">呼唤小伙伴们前来围观吧</h3> -->', '<div class="s-more" data-share-btn="more">', '<ul class="trd-ullist clearfix">', "<li>", '<a class="sm1" href="javascript:;" title="分享到新浪微博" data-to="sinawb" target="_blank"></a>', "</li>", "<li>", '<a class="sm4" href="javascript:;" title="分享到QQ" data-to="qq" target="_blank"></a>', "</li>", "<li>", '<a class="sm3" href="javascript:;" title="分享到QQ空间" data-to="qzone" target="_blank"></a>', "</li>", "</ul>", "</div>", "</div>", '<div class="wx-qcode">', '<div class="wxqrimgbg">', '<div class="wxqrimg"></div>', '<i class="wex-icon"></i>', "</div>", "<p>微信扫码分享</p>", "</div>", "</div>", '<div class="addr">', '<div class="tt">', "<ul>", '<li class="hover" data-share-path="video">直播间地址</li>', '<li data-share-path="flash">flash地址</li>', '<li data-share-path="common">通用代码</li>', "</ul>", "</div>", '<div class="s-box">', '<div class="cc" style="display:block;">', '<input class="inn" type="text" data-share-input="path" readonly>', '<a href="javascript:;" class="s_copy btn" data-share-copy="btn">复制链接</a>', "</div>", "</div>", "</div>", "</div>"].join("")),
		u = {
			data: {
				orgin: "呼唤小伙伴们前来围观吧",
				activeShare: null
			},
			mouseTimer: 0,
			init: function() {
				u.$shareBtn = e("#share-content"), u.shareData = null, u.addEvent()
			},
			addEvent: function() {
				var t = this;
				u.$shareBtn.on("mouseenter", function() {
					u.shareData || u.getWbShareConfig(), u.initShareBox()
				}), u.$shareBtn.on("mouseleave", function() {
					u.destoryShareBox()
				}), u.$shareBtn.on("click", "[data-share-path]", function() {
					u.$shareBtn.find("[data-share-path]").removeClass("hover");
					var t = e(this);
					t.addClass("hover");
					var i = t.attr("data-share-path");
					u.changeShareLink(i)
				}), u.$shareBtn.on("click", "[data-to]", function(t) {
					var i = e(this);
					u.shareToThird(i.data("to"), i)
				}), i.on("mod.weibo.share", function(e) {
					n.exe("js_shareSuccess", e.exp)
				}), i.on("mod.msg.luckDraw.info", function(e) {
					"memberinfores" === e.type ? "1" != e.rafst && "1" != e.rafst_v2 || t.tryShowDrawShare() : "lds" === e.type || "lds_v2" === e.type ? t.tryShowDrawShare() : "lde" === e.type || "lde_v2" === e.type ? t.luckDrawEnd() : "dcc" !== e.type && "dsg" !== e.type || t.tryShowDrawShare(!0)
				})
			},
			luckDrawEnd: function() {
				this.data.draw = null, this.data.activeShare = null
			},
			formatDate: function(e) {
				var t, i, a, n;
				return t = new Date, i = ("0000" + t.getFullYear()).substr(-4), a = ("00" + (t.getMonth() + 1)).substr(-2), n = ("00" + t.getDate()).substr(-2), i + "-" + a + "-" + n
			},
			tryShowDrawShare: function(t) {
				var i, a, n = this,
					r = o.get("drawShareTips"),
					l = n.formatDate();
				if (r = r ? JSON.parse(r) : {}, s.get("room.owner_uid") == s.get("sys.uid")) n.data.draw = "抽奖活动已开启！<br>快通知你的粉丝前来参加吧！", n.data.activeShare = "draw-anchor", i = r.anchor || 0, a = r.anchorTime || "0", 3 > i && l > a && (i++, r = e.extend(r, {
					anchor: i,
					anchorTime: l
				}), o.set("drawShareTips", JSON.stringify(r)), n.initShareBox(), n.autoTimer = setTimeout(function() {
					n.destoryShareBox(), clearTimeout(n.autoTimer)
				}, 5e3));
				else if (n.data.draw = "抽奖活动已开启！<br>快通知你的小伙伴前来参加吧！", n.data.activeShare = "draw-user", t && (i = r.user || 0, a = r.userTime || "0", 3 > i && l > a)) {
					i++, r = e.extend(r, {
						user: i,
						userTime: l
					}), o.set("drawShareTips", JSON.stringify(r));
					var c = ['<div class="share-draw-tips">', '<span class="share-draw-arraw"></span>', "<span>房间正在抽奖！分享一下攒攒人品~</span>", "</div>"].join(""),
						d = e(c);
					u.$shareBtn.append(d);
					var f = setTimeout(function() {
						d.remove(), clearTimeout(f)
					}, 5e3)
				}
			},
			initShareBox: function() {
				clearTimeout(u.autoTimer);
				var t = u.$shareBtn;
				u.$shareContent || (u.$shareContent = e(d), t.append(u.$shareContent), u.$sharePathInput = t.find("[data-share-input=path]"), u.$copyBtn = t.find("[data-share-copy=btn]"), u.$weixinQrcode = t.find(".wxqrimg"), u.$sharePathInput.val($ROOM.share.video), u.initZclip(), u.renderQRcode(), i.trigger("dys", {
					key: "dys.room.title.share.show"
				})), this.data.draw && t.find(".js-share-title").html(this.data.draw), u.$shareContent.removeClass("hide"), t.removeClass("out"), clearTimeout(u.mouseTimer)
			},
			changeShareLink: function(e) {
				var t = $ROOM.share[e] || "";
				u.$sharePathInput.val(t)
			},
			destoryShareBox: function() {
				clearTimeout(u.mouseTimer), u.mouseTimer = setTimeout(function() {
					u.$shareContent.addClass("hide"), u.$shareBtn.addClass("out"), u.$shareContent.remove(), u.$shareContent = null, e("#global-zeroclipboard-html-bridge").off("mouseenter.shareRoom mouseleave.shareRoom")
				}, 100)
			},
			initZclip: function() {
				if (window.ZeroClipboard) {
					ZeroClipboard.config({
						swfPath: $SYS.web_url + "app/douyu/third/zclip-2.02/ZeroClipboard.swf?20171011"
					});
					var t = new ZeroClipboard(u.$copyBtn[0]);
					t.on("copy", function(a) {
						t.setText(u.$sharePathInput.val()), e.dialog.tips_black("已成功复制到您的剪切板", 1.5), i.trigger("dys", {
							key: "dys.room.title.url.copy"
						})
					}), e("#global-zeroclipboard-html-bridge").on("mouseenter.shareRoom", function() {
						clearTimeout(u.mouseTimer)
					}), e("#global-zeroclipboard-html-bridge").on("mouseleave.shareRoom", function() {
						u.destoryShareBox()
					})
				}
			},
			clone: function(e, t) {
				e = e ? e : {}, t || (t = e);
				for (var i in t) e[i] = t[i];
				return e
			},
			helperTmpl: function(e, t) {
				var i, a = "";
				if (c) {
					var n = u.clone(c.templateSettings);
					c.templateSettings = {
						evaluate: /%([\s\S]+?)%/g,
						interpolate: /%([\s\S]+?)%/g,
						escape: /%-([\s\S]+?)%/g
					}, i = c.template(e), a = i(t), c.templateSettings = n
				}
				return a
			},
			getWbShareConfig: function() {
				l({
					url: "/wb_share/shareContents",
					type: "get",
					cache: !0,
					dataType: "json",
					data: {
						rid: s.get("room.room_id"),
						cid2: s.get("room.cate_id")
					}
				}).then(function(e) {
					e && 0 === +e.error && e.data && u.generateShareText(e.data)
				})
			},
			generateShareText: function(e) {
				({
					roomName: s.get("room.room_name"),
					anchorName: s.get("room.owner_name"),
					roomId: s.get("room.room_id"),
					url: window.location.href
				});
				e && (u.shareData = {
					shareContent: e.description,
					shareTitle: e.title
				})
			},
			shareToThird: function(t, a) {
				var n, r = $ROOM.room_url,
					o = "我正在 " + $ROOM.room_name + " 的房间观看直播 / 主播" + $ROOM.owner_name + "，欢迎大家前来围观 / 来自#斗鱼TV#游戏直播！",
					l = "我正在 " + $ROOM.room_name + " 的房间观看直播 / 主播" + $ROOM.owner_name + "，欢迎大家前来围观 / 来自#斗鱼TV#游戏直播！";
				$SYS.uid && (r += "?fromuid=" + $SYS.uid);
				var c = {
					sinawb: "wb",
					qq: "qq",
					qzone: "qz"
				};
				if ("draw-user" === u.data.activeShare) {
					r += -1 !== r.indexOf("?") ? "&type=luck" : "?type=luck", c[t] && (r += "&source=" + c[t]);
					var d = s.get("room.owner_name"),
						f = parseInt(2 * Math.random(), 10) ? "什么？主播【" + d + "】又在偷偷抽奖！点击进入直播间，手快有手慢无！" : "主播【" + d + "】回馈粉丝在直播间开启抽奖啦！点击进入直播间，好福利不容错过！";
					o = f + r + " #斗鱼抽奖# #" + d + "#"
				} else "draw-anchor" === u.data.activeShare ? (r += -1 !== r.indexOf("?") ? "&type=luck" : "?type=luck", c[t] && (r += "&source=" + c[t]), o = "我的直播间正在限时抽奖，先到先得，赶紧来戳！ " + r + " #斗鱼抽奖# #" + s.get("room.owner_name") + "#") : u.shareData && u.shareData.shareContent && (o = u.shareData.shareContent || "");
				u.shareData && u.shareData.shareTitle && (l = u.shareData.shareTitle || "");
				var p = null;
				switch (t) {
				case "sinawb":
					n = "http://service.weibo.com/share/share.php??", p = {
						url: r,
						title: l,
						pic: $ROOM.room_pic,
						appkey: 979098171,
						ralateuid: 3982726153
					};
					break;
				case "qq":
					n = "http://connect.qq.com/widget/shareqq/index.html?", p = {
						url: r,
						desc: o,
						title: l,
						pics: $ROOM.room_pic
					};
					break;
				case "qzone":
					n = "http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?", p = {
						url: r,
						desc: o,
						title: l,
						pics: $ROOM.room_pic
					}
				}
				i.trigger("dys", {
					key: "dys.room.title.share.click",
					type: t
				});
				var m = [];
				e.each(p, function(e, t) {
					m.push(e + "=" + encodeURIComponent(t))
				});
				var h = n + m.join("&");
				a.attr("href", h)
			},
			randomInt: function(e, t) {
				return Math.floor(Math.random() * (t - e + 1)) + e
			},
			renderQRcode: function() {
				var e = "Microsoft Internet Explorer" == navigator.appName && parseInt(navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/)[1]) < 9 ? "table" : "canvas",
					t = $ROOM.room_url.replace(/\?[\w\W]+/, "");
				u.$weixinQrcode.qrcode({
					render: e,
					width: 77,
					height: 77,
					text: t
				})
			}
		};
	return u
}), define("douyu/page/room/normal/mod/anchor-games", ["jquery", "douyu/context", "shark/util/lang/1.0", "shark/util/template/2.0", "shark/observer", "shark/util/cookie/1.0", "douyu/com/user"], function(e, t, i, a, n, s, r) {
	var o = {
		init: function() {
			this.doms = {
				$share: e("#share-content")
			}, this.gameList = [], this.initBox()
		},
		initBox: function() {
			var t = this;
			if (window.$ROOM && window.$ROOM.room_id) {
				var i = this.isShow();
				i && (this.generateRenders(), this.initData(function() {
					t.doms.$share.before(e(t.renders.mainRender())), t.doms.$box = e("#anchorGames-content"), t.doms.$container = e(".anchorGames-container"), t.render(), t.initConfig(), t.addEvent()
				}))
			}
		},
		getCSRFCookie: function(i) {
			var a = this,
				n = s.get(t.get("sys.tvk")),
				r = t.get("sys.tn");
			n ? e.isFunction(i) && i(!0, {
				name: r,
				val: n
			}) : a.fetchData({
				url: "/curl/csrfApi/getCsrfCookie",
				jsonCallback: function(e) {
					0 === parseInt(e.error, 10) ? a.getCSRFCookie(i) : -99 === parseInt(e.error, 10) && i(!1)
				}
			})
		},
		fetchData: function(t) {
			var i = e.extend({
				url: "",
				type: "get",
				data: {},
				dataType: "json"
			}, t);
			t.jsonp && (i.jsonp = t.jsonp, i.callback = t.jsonpCallBack), e.ajax(i).done(function(t) {
				e.isFunction(i.jsonCallback) && i.jsonCallback(t)
			}).fail(function(t) {
				e.isFunction(i.jsonCallback) && i.jsonCallback(t)
			})
		},
		isShow: function() {
			return "www.douyu.com" === window.location.host ? 19 === window.$ROOM.cate_id : !0
		},
		initData: function(t) {
			var i = this;
			e.ajax({
				url: "/ztCache/wegame/game_list",
				type: "GET",
				dataType: "JSON",
				success: function(a) {
					i.gameList = a.data, i.doms.$list = e(i.renders.listRender({
						data: i.gameList
					})), t()
				}
			})
		},
		generateRenders: function() {
			this.renders = {};
			var e = this.renders;
			e.mainRender = a.compile(this.getTemplate("main")), e.listRender = a.compile(this.getTemplate("list")), e.iframePanel = a.compile(this.getTemplate("panel"))
		},
		getTemplate: function(e) {
			switch (e) {
			case "main":
				return i.string.join('<div id="anchorGames-content" class="anchorGames-box fl out">', '<p class="tit">', '<em class="anchorGames-icon"></em>', "<span>下载游戏</span>", "</p>", '<div class="anchorGames-container hide">', '<i class="arrow-icon"></i>', '<div class="anchorGames-cont">', '<div class="anchorGames-title">', '<p class="anchorGames-des">主播平时都在玩这些游戏哦，你也来试试吧~</p>', "</div>", "</div>", "</div>", "</div>");
			case "list":
				return i.string.join('<div class="anchorGames-list">', "<ul>", "{{ each data as item index }}", "<li>", '<a class="anchorGames-item" href="#" data-url="{{ item.pay_url }}">', '<span class="game-pic">', '<img src="{{ item.img_cover }}" alt="{{ item.name}}">', "</span>", '<div class="game-cont">', '<p class="game-name">{{ item.name}}</p>', '<p class="game-comments">{{ item.comments }}</p>', '<p class="game-price">', '<span class="price old-price">￥{{ item.price.original_price }}</span>', '<span class="price new-price">￥{{ item.price.cur_price }}</span>', "</p>", "</div>", "</a>", "</li>", "{{ /each }}", "</ul>", "</div>");
			case "panel":
				return i.string.join('<div class="gameBuy-payframe">', '<iframe width="750" height="560" src="{{ src }}" ></iframe>', "</div>");
			default:
				return ""
			}
		},
		initConfig: function() {
			this.doms.$list.mCustomScrollbar({
				axis: "y"
			})
		},
		show: function() {
			this.doms.$container.removeClass("hide")
		},
		hide: function() {
			this.doms.$container.addClass("hide")
		},
		addEvent: function() {
			var t = this;
			this.doms.$box.on("mouseenter", function() {
				t.show()
			}).on("mouseleave", function() {
				t.hide()
			}), this.doms.$box.on("click", ".anchorGames-item", function() {
				var i = e(this).parent().index(),
					a = t.gameList[i],
					n = a.pay_url;
				t.getCSRFCookie(function(i, s) {
					if (i) {
						var r = {};
						r[s.name] = s.val, e.ajax({
							url: "/special/weGame/getUserInfo",
							type: "POST",
							data: r,
							dataType: "JSON",
							success: function(i) {
								0 === i.error ? (n = n + "?game_id=" + a.game_id + "&ref=2002018053001:" + i.data.user + "|" + window.$ROOM.room_id, a && t.openpayDialog({
									src: n || "",
									title: a.name || ""
								})) : -99 === i.error ? (n = n + "?game_id=" + a.game_id + "&ref=2002018053001:" + window.$ROOM.room_id, a && t.openpayDialog({
									src: n || "",
									title: a.name || ""
								})) : e.dy_dialog.tips_black(i.msg)
							}
						})
					} else n = n + "?game_id=" + a.game_id + "&ref=2002018053001:" + window.$ROOM.room_id, a && t.openpayDialog({
						src: n || "",
						title: a.name || ""
					})
				})
			})
		},
		openpayDialog: function(t) {
			var i = this.renders.iframePanel({
				src: t.src
			});
			e.dy_dialog(i, {
				className: "anchorGames-pay",
				mask: !0,
				zIndex: 502,
				title: t.title || "",
				width: 750
			})
		},
		render: function() {
			e.isArray(this.gameList) && this.doms.$container.append(this.doms.$list)
		}
	};
	return o
}), define("douyu/page/room/normal/mod/qr-code", ["jquery", "douyu/context", "shark/observer"], function(e, t, i) {
	var a = (['<div class="con hide clearfix" data-qrcode-content="content">', '<i class="arrow-icon"></i>', '<div class="mouseenter-cover"></div>', '<div class="q-app-box fl">', "<h3>", "<span>手机看直播，畅享超清画质</span>", '<a class="download clearfix fr" href="/client" target="_blank">', '<i class="down-icon "></i>', '<span class="down-text ">下载斗鱼app</span>', "</a>", "</h3>", '<p class="q-des">斗鱼app扫描二维码，<a class="highlight">继续观看</a>精彩直播</p>', '<div class="q-ewm clearfix">', '<div class="q-ewm-fl fl">', "<span>1.点击APP右上方“扫一扫”</span>", '<img src="' + $SYS.web_url + '/app/douyu/res/page/room-normal/room-vactive-img1.png?v=20160602"></div>', '<div class="q-ewm-fr fr">', "<span>2.对准下方二维码</span>", '<div class="qrcodebg"> <b data-qrcode-img="img"></b> </div>', "</div>", "</div>", "</div>", "</div>"].join(""), ['<div class="con hide clearfix" data-qrcode-content="content">', '<i class="arrow-icon"></i>', '<div class="mouseenter-cover"></div>', '<div class="q-app-box fl">', '<div class="q-ewm1 clearfix">', '<div class="q-cut-line"></div>', '<div class="q-ewm-fr fr">', '<div class="qrcodebg"> <b data-qrcode-img="img"></b> </div>', '<div class="q-clientdown-title">斗鱼APP</div>', '<p class="q-msg">畅享超清画质</p>', '<p class="q-msg">手机扫一扫，<span class="q-highlight">继续观看</span></p>', '<a class="pc-clientdown-btn" href="/client#mobile" target="_blank"></a>', "</div>", '<div class="q-ewm-fl fl">', '<img class="pc-client-image" src="' + $SYS.web_url + '/app/douyu/res/page/room-normal/clientdown/room-client-download1.png?v=20180703"/>', '<div class="q-clientdown-title">PC客户端</div>', '<p class="q-msg q-highlight">绿色纯净＆夜间模式</p>', '<p class="q-msg">快速稳定的观看体验</p>', '<a class="pc-clientdown-btn" href="/client" target="_blank"></a>', "</div>", "</div>", "</div>", "</div>"].join("")),
		n = {
			renderBox: function() {
				if (!n.$content) {
					var e = this.$qrcodeBtn;
					e.append(a), n.$content = e.find('[data-qrcode-content="content"]'), n.$qrcodeImg = e.find("[data-qrcode-img=img]"), n.renderQRcode()
				}
				n.$content.removeClass("hide"), n.$qrcodeBtn.removeClass("out"), i.trigger("dys", {
					key: "dys.room.title.phone.show"
				})
			},
			destoryBox: function() {
				n.$content.addClass("hide"), n.$qrcodeBtn.addClass("out"), n.$content.remove(), n.$content = null
			},
			init: function() {
				this.$qrcodeBtn = e("#qrcode-content"), this.addEvent()
			},
			addEvent: function() {
				e("#qrcode-content").on("mouseenter", function() {
					n.renderBox()
				}).on("mouseleave", function() {
					n.destoryBox()
				})
			},
			renderQRcode: function() {
				var e = "Microsoft Internet Explorer" == navigator.appName && parseInt(navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/)[1]) < 9 ? "table" : "canvas",
					t = $ROOM.room_url.replace(/\?[\w\W]+/, "");
				t = 1 === $ROOM.nrt ? t + "?nrt=1" : t, n.$qrcodeImg.qrcode({
					render: e,
					width: 70,
					height: 70,
					text: t
				})
			}
		};
	return n
}), define("douyu/page/room/normal/mod/vcode-v3-sign", ["jquery", "shark/class", "shark/util/lang/1.0", "shark/util/template/2.0", "douyu/context", "douyu/com/sign", "douyu/com/imgp", "douyu/com/vcode-v3"], function(e, t, i, a, n, s, r, o) {
	var l = {
		sign: null,
		V3Instance: null
	},
		c = t({
			init: function(t) {
				this.config = e.extend(!0, {}, {
					title: "验证码",
					title1: "",
					shadow: {
						opacity: .7
					},
					pid: 30010
				}, t), this.render(), this.bindEvt()
			},
			v3Init: function() {
				var t = this,
					i = e("#v3-sign-captcha-gt");
				l.V3Instance = o.init(i, {
					op_type: 27,
					idpre: t.config.idpre,
					success: t.config.success ||
					function() {},
					error: t.v3Error ||
					function() {}
				}, {
					product: "custom",
					width: "100%",
					area: ".v3-sign-area",
					next_width: "260px",
					bg_color: "transparent"
				})
			},
			render: function() {
				var t = this.make(),
					i = e("body");
				this.config.$pop = e(t.pop), this.config.$shadow = e(t.shadow), i.append(this.config.$pop), i.append(this.config.$shadow), this.config._is_show = !1, this.v3Init(), this.show()
			},
			tpls: function() {
				var e = this,
					t = function(t) {
						var n = i.string.join('<div class="v3-sign-wrap">', '<div class="v3-sign-close">&times;</div>', '<span class="v3-sign-lsq"></span>', '<div class="v3-sign-header">', "<span>{{ title1 }}</span>{{ title2 }}", "</div>", '<div class="v3-sign-area"></div>', '<div class="captcha-gt" id="v3-sign-captcha-gt"></div>', '<div class="v3-sign"></div>', "</div>"),
							s = a.compile(n),
							r = s({
								title1: e.config.title1,
								title2: e.config.title
							});
						return r
					},
					n = function() {
						var t = i.string.join('<div class="v3-sign-shadow" style="opacity: {{ opacity }}; filter: {{ filterOpacity }}"></div>'),
							n = a.compile(t),
							s = n({
								opacity: e.config.shadow.opacity,
								filterOpacity: "Alpha(Opacity=" + 100 * e.config.shadow.opacity + ")"
							});
						return s
					};
				return {
					pop: t(),
					shadow: n()
				}
			},
			make: function() {
				var t = this.tpls();
				return {
					pop: e(t.pop),
					shadow: e(t.shadow)
				}
			},
			v3Error: function() {
				e("#v3-sign-captcha-gt").text("验证码加载失败，请稍后重试。")
			},
			showSign: function() {
				var t = this.config.pid,
					a = n.get("room.user_best_cq"),
					s = e("[data-dysign=" + t + "]").clone().attr({
						style: ""
					});
				if (s.size() && e.trim(s.html()) && !(a > 0)) {
					var r = i.string.join('<div class="vcode9-sign">', '<div class="s-cdown">', '<span class="closetxt"><em>0</em>s 后可关闭广告</span>', '<span class="closebtn" style="">关闭</span>', "</div>", '<div class="s-box"></div>', "</div>"),
						o = this;
					this.config.$sign = e(r), this.config.$pop.find(".v3-sign").append(this.config.$sign), this.config.$sign.find(".s-box").empty().append(s), this.config.$sign.find(".s-cdown .closebtn").one("click", function() {
						o.hideSign()
					}), this.cdownSign()
				}
			},
			cdownSign: function() {
				var e = this.config.$sign,
					t = this;
				e && (this.config.signCount = 15, e.show(), e.find(".s-cdown .closetxt em").text(5), e.find(".s-cdown .closetxt").show(), e.find(".s-cdown .closebtn").hide(), r.build(), l.isExposured || (s.exposure(), l.isExposured = !0), this.config.signTimer = setInterval(function() {
					t.config.signCount--, t.config.signCount < 0 && (t.hideSign(), clearInterval(t.config.signTimer)), t.config.signCount < 10 ? (e.find(".s-cdown .closetxt").hide(), e.find(".s-cdown .closebtn").show()) : e.find(".s-cdown .closetxt em").text(t.config.signCount - 10)
				}, 1e3))
			},
			hideSign: function() {
				this.config.$sign && (this.config.$sign.hide(), this.config.$sign.find(".s-box").empty()), this.config.signTimer && clearInterval(this.config.signTimer)
			},
			show: function() {
				var e = this;
				this.config.$pop.fadeIn(function() {
					e.config._is_show = !0, e.config.sign && l.V3Instance && e.showSign()
				})
			},
			hide: function() {
				var e = this;
				this.config.$pop.fadeOut(function() {
					e.config._is_show = !1, e.config.sign && e.hideSign()
				})
			},
			destroy: function() {
				this.config.$pop.remove(), this.config.$shadow.remove(), l.V3Instance && e.isFunction(l.V3Instance.destroy) && l.V3Instance.destroy();
			},
			refresh: function() {
				l.V3Instance && e.isFunction(l.V3Instance.refresh) && l.V3Instance.refresh()
			},
			bindEvt: function() {
				var e = this;
				this.config.$pop.on("click", ".v3-sign-close", function() {
					return e.destroy(), !1
				})
			}
		}),
		d = {
			create: function(e) {
				return new c(e)
			}
		};
	return d
}), define("douyu/page/room/normal/mod/olyw", ["jquery", "shark/class", "shark/observer", "shark/util/lang/1.0", "douyu/context", "douyu/com/user", "douyu/page/room/base/api", "shark/util/flash/data/1.0", "shark/util/template/1.0", "shark/util/storage/1.0", "douyu/page/room/normal/mod/vcode-v3-sign", "douyu/page/room/normal/mod/super-recommended"], function(e, t, i, a, n, s, r, o, l, c, d, u) {
	var f, p, m, h = (window.DYS, {
		yw: {
			state: {
				open: "open",
				close: "close"
			}
		}
	});
	f = t({
		tmpl: function() {
			var t = ['<div class="ywtipbox" data-tip-title="tip">', '<a class="get-box" href="javascript:;">', '<i class="yw-icon"></i>', '<span class="g-time">领取</span>', "</a>", '<div class="yw-warmTip tip"><div class="arrow"></div><span class="getyw-time">领取</span></div>', "</div>", '<div class="yw-collect-box hide">', '<span class="close"></span>', '<ul class="cb-list">', "<li>", '<span class="wait-get"></span>', '<a href="javascript:;" class="next-btn">等待中</a>', "</li>", "<li>", '<span class="wait-get"></span>', '<a href="javascript:;" class="next-btn">等待中</a>', "</li>", "<li>", '<span class="wait-get"></span>', '<a href="javascript:;" class="next-btn">等待中</a>', "</li>", "<li>", '<span class="wait-get"></span>', '<a href="javascript:;" class="next-btn">等待中</a>', "</li>", "</ul>", '<div class="c-txt get-state-special">别着急，奖励正在准备中，鱼丸、经验、道具等你来</div>', '<p class="yw-app-des">', "手机看直播专享奖励，暴击<b>1000</b>鱼丸等你来领！", '<a href="/client" target="_blank"  class="download-btn">立即下载</a>', "</p>", "<!-- 领鱼丸失败 -->", '<div class="get-defeat hide">', "<h3>领取失败</h3>", "<p>您本次领取鱼丸的地点和之前观看地点冲突,本段观看时长将被清零,继续观看后可领取。</p>", "<p>造成此问题的原因可能是因为您的账号已经被盗,建议您及时修改密码以及已绑定邮箱的密码</p>", "</div>", '<div class="get-defeat2 hide">', "<h3>领取失败</h3>", "<p>您今天领取的鱼丸已经超过数量上限啦，休息一下明日再来吧</p>", "</div>", "</div>", '<div class="get-fc get-fc2 hide">', '<a href="javascript:;" title="关闭"></a>', "</div>"];
			e(".get-yw").html(t.join(""))
		},
		init: function() {
			this.tmpl(), this.timer = null, this.config = e.extend(!0, {}, {
				ncqMaxLev: 4,
				cqMaxLev: 6,
				islog: !1,
				roomPointLow: !1,
				target: "#js-stats-and-actions .get-yw",
				time: ".getyw-time",
				ywBtnText: ".g-time",
				pic: ".g-pic",
				pop: ".get-yw .yw-collect-box",
				personal_yw: '[data-login-user="silver"]',
				state: h.yw.state.close,
				firstLoad: !0,
				timer: !0,
				ywGetHigh: "yw-get-high",
				ywOver: "yw-over",
				ywMake: "yw-make",
				list: {
					wait: {
						timeText: "等待",
						content: "别着急，奖励正在准备中，鱼丸、经验、道具等你来",
						cls: "get-state-next",
						pic: "wait-get",
						cqPic: "w-cq-get",
						btn: "next-btn",
						text: "等待中",
						cqText: "酬勤专享"
					},
					may: {
						timeText: "领取",
						content: "请点击领取您的奖励！",
						cls: "get-state-udrw",
						pic: "may-get",
						cqPic: "cq-get",
						btn: "may-btn",
						text: "可领取"
					},
					yet: {
						timeText: "",
						content: "",
						cls: "get-state-ard",
						pic: "yet",
						cqPic: "yet",
						btn: "yet-btn",
						text: "已领取"
					},
					over: {
						timeText: "完成",
						content: '<span class="moretask">做任务领取更多鱼丸！</span>',
						cls: "get-state-ard",
						pic: "yet-get",
						cqPic: "yet-get",
						btn: "yet-btn",
						text: "已领取"
					}
				}
			}), this.state = {
				cq: 0,
				level: 0,
				time: 0,
				over: !1,
				yw: 0,
				exp: 0
			}, this.getDoms(), this.render(), this.bindEvt()
		},
		getDoms: function() {
			var t = this,
				i = e(this.config.target),
				a = e(this.config.pop);
			this.doms = {
				$el: i,
				$time: e(t.config.time),
				$ywBtnText: e(t.config.ywBtnText),
				$pic: e(t.config.pic),
				$pop: a,
				$personal_yw: e(t.config.personal_yw).eq(0),
				$yws: a.find(".cb-list li"),
				$ywPics: a.find(".cb-list li span"),
				$ywBtns: a.find(".cb-list li a"),
				$text: a.find(".c-txt"),
				$getBox: i.find(".get-box")
			}
		},
		render: function() {
			var e = this;
			this.initList(), this.observer = i.create(this), this.observer.on("login", this.isLog), this.observer.on("cq.toggle", this.toggle), this.observer.on("cq.over", function(t) {
				e.renderTime("cqover", t), e.renderList("cqover", t), e.renderText("over")
			}), this.observer.on("ncq.over", function(t) {
				e.renderTime("ncqover", t), e.renderList("ncqover", t), e.config.firstLoad && t.over && e.renderText("over")
			}), this.observer.on("wait", function(t) {
				e.renderTime("wait", t), e.renderList("wait", t)
			}), this.observer.on("may", function(t) {
				e.renderTime("may", t), e.renderList("may", t), t.over ? e.renderText("over") : e.renderText("may")
			}), i.on("mod.userinfo.userinfoready", function() {
				e.config.userinfo = !0
			}), i.on("mod.olyw.destroy", function(t) {
				t = !t, e.toggleBan(t)
			}), i.on("mod.roompoint.low", function(t) {
				e.config.roomPointLow = !! t
			}), r.reg("room_data_chest", function(t) {
				e.getFlashTime(t)
			})
		},
		setState: function(t) {
			var i = this;
			this.state = e.extend(!0, {}, i.state, t)
		},
		initList: function() {
			var e = this.doms.$el;
			e.find(".cb-list li");
			this.renderAllList("wait", this.config.cqMaxLev), this.renderText("wait")
		},
		getFlashTime: function(e) {
			var t = o.decode(e),
				i = Number(t[0].value),
				a = Number(t[1].value),
				n = Number(t[2].value);
			this.config.isBan || (a = a ? a + 60 : a, this.setState({
				cq: n,
				level: i,
				time: a
			}), this.config.firstLoad && (this.updateTime(), this.config.firstLoad = !1))
		},
		updateTime: function() {
			var e = this,
				t = (this.doms.$el, this.doms.$time, this.doms.$ywBtnText, this.state);
			return this.setState({
				over: !1
			}), !t.cq && t.level > this.config.ncqMaxLev ? (this.setState({
				over: !0
			}), this.observer.trigger("ncq.over", t), void this.observer.trigger("cq.over", t)) : (t.time >= 1 ? (this.state.time--, this.observer.trigger("wait", t)) : (clearTimeout(e.timer), e.config.timer = null, this.observer.trigger("may", e.state)), void(e.config.timer && (e.timer = setTimeout(function() {
				e.updateTime()
			}, 1e3))))
		},
		renderTime: function(e, t) {
			var i = this.config.list,
				a = 0;
			if (t.time) var n = (n = Math.floor(t.time / 60)) < 10 ? "0" + n : n,
				s = (s = t.time % 60) < 10 ? "0" + s : s,
				a = n + ":" + s;
			this.config.cqMaxLev + 1;
			"cqover" === e && (this.doms.$ywBtnText.html(i.over.timeText).data("isshowtit", !1), this.doms.$time.html(i.over.timeText), this.doms.$getBox.removeClass(this.config.ywMake).removeClass(this.config.ywGetHigh).addClass(this.config.ywOver)), "ncqover" === e && (this.doms.$ywBtnText.html(i.may.timeText).data("isshowtit", !1), this.doms.$time.html(a || i.may.timeText), this.doms.$getBox.removeClass(this.config.ywMake).removeClass(this.config.ywGetHigh).addClass(this.config.ywOver)), "wait" === e && (this.doms.$ywBtnText.html(i.wait.timeText).data("isshowtit", !0), this.doms.$time.html(a), this.doms.$getBox.addClass(this.config.ywMake).removeClass(this.config.ywGetHigh).removeClass(this.config.ywOver)), "may" === e && (this.doms.$ywBtnText.html(i.may.timeText).data("isshowtit", !1), this.doms.$time.html(i.may.timeText), this.doms.$getBox.removeClass(this.config.ywMake).addClass(this.config.ywGetHigh).removeClass(this.config.ywOver), t.over && (this.doms.$ywBtnText.html(i.over.timeText).data("isshowtit", !1), this.doms.$time.html(i.over.timeText), this.doms.$getBox.removeClass(this.config.ywMake).removeClass(this.config.ywGetHigh).addClass(this.config.ywOver)))
		},
		renderList: function(e, t) {
			var i = this.config.list;
			this.doms;
			"cqover" === e && this.renderAllList("yet", this.config.cqMaxLev), "ncqover" === e && this.renderAllList("yet", this.config.ncqMaxLev), "wait" === e && this.renderAllList("yet", t.level - 1), "may" === e && (this.renderAllList("yet", t.level - 1), t.level > this.config.ncqMaxLev ? this.doms.$yws.eq(t.level - 1).find("span").removeClass().addClass(i.may.cqPic).end().find("a").html(i.may.text).removeClass().addClass(i.may.btn) : this.doms.$yws.eq(t.level - 1).find("span").removeClass().addClass(i.may.pic).end().find("a").html(i.may.text).removeClass().addClass(i.may.btn)), "yet" === e && this.renderAllList("yet", t.level)
		},
		renderAllList: function(t, i) {
			var a = this,
				n = this.config.list;
			"yet" === t && this.doms.$yws.each(function(t, a) {
				i > t && e(a).find("span").removeClass().addClass("yet").end().find("a").html(n.yet.text).removeClass().addClass(n.yet.btn)
			}), "wait" === t && this.doms.$yws.each(function(t, s) {
				i > t && (t + 1 <= a.config.ncqMaxLev ? e(s).find("span").removeClass().addClass(n.wait.pic).end().find("a").html(n.wait.text).removeClass().addClass(n.wait.btn) : e(s).find("span").removeClass().addClass(n.wait.cqPic).end().find("a").html(n.wait.cqText).removeClass().addClass(n.wait.btn))
			})
		},
		renderText: function(e, t) {
			var i = this.config.list;
			switch (e) {
			case "wait":
				this.doms.$text.removeClass().addClass("c-txt").addClass(i.wait.cls).html(i.wait.content);
				break;
			case "may":
				this.doms.$text.removeClass().addClass("c-txt").addClass(i.may.cls).html(i.may.content);
				break;
			case "yet":
				t && this.doms.$text.removeClass().addClass("c-txt").addClass(t.cls).html(t.content);
				break;
			case "over":
				this.doms.$text.removeClass().addClass("c-txt").addClass(i.over.cls).html(i.over.content);
				break;
			default:
				this.doms.$text.removeClass().addClass("c-txt").addClass(i.wait.cls).html(i.wait.content)
			}
		},
		renderTip: function(e, t) {
			var i = this.doms.$pop;
			"yw" === e ? i.append('<div class="exp-add"><div class="exprience1"><p><span> +' + t + "鱼丸</span></p></div></div>") : "exp" === e ? i.append('<div class="exp-add"><div class="exprience1"><p><span> +' + t + "经验</span></p></div></div>") : "prop" === e && i.append('<div class="exp-add"><div class="exprience1"><p><span> +' + t + "</span></p></div></div>");
			var a = i.find(".exprience1"),
				n = (i.width() - a.width()) / 2;
			a.css({
				position: "absolute",
				left: n,
				top: "80px",
				"z-index": 200
			}), a.stop().animate({
				top: "5px"
			}, 1e3).fadeOut("slow", function() {
				a.remove()
			})
		},
		checkTotalYw: function(t) {
			var a;
			return this.config.userinfo ? (a = this.doms.$personal_yw.text(), a >= 2e3 ? (e.dialog.alert("鱼丸存量达到2000啦! 暂时无法在线领鱼丸(其他获取鱼丸途径不受影响),<br>送点鱼丸给主播再来领取吧!"), i.trigger("dys", {
				key: "dys.room.yw.get.fail",
				em: "鱼丸存量超过2000啦! 暂时无法在线领鱼丸(其他获取鱼丸途径不受影响),<br>送点鱼丸给主播再来领取吧!"
			})) : t && t()) : t && t(), a
		},
		handleReturn: function(t, a) {
			var n = t.result,
				s = parseInt(t.leve),
				r = this.state.cq,
				o = t.gift_count || 0,
				l = t.exp / 100 || 0,
				c = (this.doms.$personal_yw, {}),
				d = "";
			if (2 == n) e.dialog({
				content: "当前ip输入验证码时错误次数过多，请等待一天后在重新尝试！",
				icon: "warning",
				okVal: "确定",
				ok: function() {}
			});
			else if (1 == n) e.dialog.tips_black("验证码输入错误", 1), m.refresh();
			else if (0 == n) {
				m.destroy(), i.trigger("mod.userinfo.change", {
					change: {
						silver: o
					}
				}), i.trigger("dys", {
					key: "dys.room.yw.get.success",
					yw: o,
					jy: l
				});
				var u = parseInt(t.lack_time);
				if (u && (u += 60), this.setState({
					cq: r,
					level: s,
					time: u
				}), d = t.props ? "prop" : o ? l ? "cq" : "yw" : "exp", "yw" === d) c = o >= 1e3 ? {
					content: "幸运女神眷顾您，恭喜您领取了<b>" + o + "个鱼丸</b>！",
					cls: "get-state-special"
				} : {
					content: "恭喜你领取了<b>" + o + "个鱼丸</b>！",
					cls: "get-state-ard"
				}, this.renderTip(d, o);
				else if ("exp" === d) c = {
					content: "恭喜你领取了<b>" + l + "经验</b>！",
					cls: "get-state-ard"
				}, this.renderTip(d, l);
				else if ("cq" === d) c = o >= 1e3 ? {
					content: "幸运女神眷顾您，恭喜您领取了<b>" + o + "个鱼丸</b>！",
					cls: "get-state-special"
				} : {
					content: "恭喜你领取了<b>" + o + "个鱼丸</b>和<b>" + l + "</b>点经验！",
					cls: "get-state-ard"
				}, this.renderTip(d, l);
				else if ("prop" === d) {
					var f = [];
					e(t.props).each(function(e, t) {
						f.push("<b>" + t.count + "个" + t.name + "</b>")
					}), f = f.join("和"), c = {
						content: "恭喜你领取了" + f,
						cls: "get-state-ard"
					}, this.renderTip(d, c.content)
				}
				this.renderText("yet", c), u ? (this.renderTime("wait", this.state), this.renderList("yet", this.state), this.setState({
					level: s + 1
				})) : (this.setState({
					level: s + 1
				}), this.renderTime("may", this.state)), 4 > s && (this.config.timer = !0, this.updateTime()), 4 === s && (this.setState({
					over: !0
				}), this.observer.trigger("ncq.over", this.state), this.observer.trigger("cq.over", this.state))
			} else {
				n += "";
				var p = "",
					h = "/member";
				switch (n) {
				case "216":
					p = "需要绑定手机和邮箱才能领取鱼丸！", h = "/member";
					break;
				case "218":
					p = "需要绑定手机才能领取鱼丸!", h = "/member#phone";
					break;
				case "219":
					p = "需要绑定邮箱才能领取鱼丸!", h = "/member#mod_email";
					break;
				case "270":
					p = "请稍后再试!";
					break;
				case "283":
					p = "鱼丸存量超过2000啦! 暂时无法在线领鱼丸(其他获取鱼丸途径不受影响),<br>送点鱼丸给主播再来领取吧!";
					break;
				case "212":
					p = "非酬勤用户无法领取!";
					break;
				case "5803":
					p = "您的背包已满，使用一些再来领取吧";
					break;
				default:
					p = "鱼丸领取失败！"
				}
				i.trigger("dys", {
					key: "dys.room.yw.get.fail",
					em: p
				}), "363" == n ? e(".get-defeat").removeClass("hide").show() : "214" == n && e(".get-defeat2").removeClass("hide").show(), "216" == n || "218" == n || "219" == n ? (e.dialog({
					content: p,
					title: "提示",
					icon: "warning",
					cancelVal: "以后再说",
					okVal: "立即绑定",
					lock: !0,
					ok: function() {
						window.location.href = h, i.trigger("dys", {
							key: "dys.room.yw.get.bind.action"
						})
					},
					cancel: function() {
						m.destroy(), i.trigger("dys", {
							key: "dys.room.yw.get.bind.close"
						})
					}
				}), i.trigger("dys", {
					key: "dys.room.yw.get.bind.show"
				})) : e.dialog.alert(p)
			}
		},
		toggleCqTip: function() {
			var t = arguments,
				a = "",
				s = this;
			return 0 === +n.get("room.cqSwitch") ? (e.dialog.tips_black("酬勤现已下线，请选择其他礼物！", 3), !1) : void(t.length && "open" === t[0] ? (a = '<div class="cq-dialog"><div class="cq-tit"><h3>提示</h3><a href="javascript:;" class="close">×</a></div><div class="cq-cont"><p class="yw-notic-des">噢，第五、六次领取机会为酬勤用户专享，快去给主播赠送一次酬勤来获得海量鱼丸的领取机会吧!</p></div><div class="cq-foot"><a href="javascript:;">赠送酬勤</a><a href="javascript:;" class="cancel">还是算了</a></div></div>', e("body").append(a), e(".cq-dialog").on("click", ".close", function() {
				s.toggleCqTip()
			}), e(".cq-dialog").on("click", ".cancel", function() {
				s.toggleCqTip()
			}), e(".cq-dialog").on("click", ".cq-foot a:first", function() {
				s.config.roomPointLow ? e.dialog.tips_black("主播由于多次违规，积分过低，礼物和酬勤系统不可用！", 3) : (i.trigger("mod.gift.openCQWindowAndInit"), s.toggleCqTip())
			})) : e(".cq-dialog").remove())
		},
		handleSubmit: function(t) {
			var i = this,
				a = this.state.cq,
				s = "open";
			!a && t >= 4 ? this.toggleCqTip(s) : this.checkTotalYw(function() {
				m = d.create({
					idpre: "gt-captcha-olyw-",
					sign: !0,
					title: "后可以领取对应奖励",
					title1: "验证通过",
					shadow: {
						opacity: 0
					},
					success: function(a) {
						var s = e.extend({
							leve: i.state.level,
							room_id: n.get("room.room_id")
						}, a);
						e.ajax("/member/cp/get_box_reward", {
							type: "POST",
							data: s,
							dataType: "json",
							success: function(e) {
								i.handleReturn(e, t)
							},
							error: function(e) {}
						})
					}
				})
			})
		},
		isLog: function() {
			this.config.islog = !0
		},
		toggleBan: function(e) {
			i.trigger("dys", {
				key: "dys.room.olyw.btn.click"
			}), e ? (clearTimeout(this.timer), this.config.isBan = !0, this.doms.$pop.hide().addClass("hide")) : (this.config.isBan = !1, this.doms.$ywBtnText.show(), i.trigger("dys", {
				key: "dys.room.yw.get.show"
			}))
		},
		open: function() {
			this.config.state = h.yw.state.open, this.doms.$pop.removeClass("hide").show(), e("#js-yw-rmd-rooms").length <= 0 ? (this.doms.$pop.find(".yw-app-des").eq(0).before('<div id="js-yw-rmd-rooms"></div>'), u.ywinit()) : u.ywRmdRefresh(), i.trigger("dys", {
				key: "dys.room.yw.get.show"
			})
		},
		close: function() {
			this.config.state = h.yw.state.close, this.doms.$pop.addClass("hide").hide()
		},
		toggle: function() {
			this.config.state === h.yw.state.open ? this.close() : this.config.isBan || this.open()
		},
		bindEvt: function() {
			function t(e) {
				e.stopPropagation(), e.preventDefault()
			}
			var a = this,
				n = this.doms.$el,
				r = (this.doms.$lead_close, this.doms.$pop),
				o = e("#js-stats-and-actions .ywtipbox"),
				l = o.find(".g-time");
			r.on("click", ".close", function(e) {
				t(e), a.observer.trigger("cq.toggle")
			}), r.on("click", ".download-btn", function(e) {
				i.trigger("dys", {
					key: "dys.room.olyw.download.click"
				})
			}), n.on("click", ".may-btn", function(n) {
				t(n), i.trigger("dys", {
					key: "dys.room.olyw.could.click"
				});
				var s = e(this).index(".yw-collect-box li a");
				a.handleSubmit(s)
			}), n.find(".get-box").on("click", function(e) {
				t(e);
				var n = a.config.islog;
				n ? a.observer.trigger("cq.toggle") : s.show(), i.trigger("dys", {
					key: "dys.room.olyw.btn.click"
				})
			}), r.on("click", ".moretask", function() {
				i.trigger("mod.task.toggleWindowAndInit")
			}), o.on("mouseover", function(t) {
				e(this).find(".get-box").addClass("highlight"), l.data("isshowtit") === !0 ? e(this).find(".tip").show() : e(this).find(".tip").hide()
			}), o.on("mouseout", function(t) {
				e(this).find(".get-box").removeClass("highlight"), e(this).find(".tip").hide()
			})
		}
	});
	var g = function() {
			var t = s.check();
			p || (p = new f, t ? (e(".get-yw").show(), p.observer.trigger("login"), v()) : e(".get-yw").hide())
		},
		v = function() {
			var t = "olywGetGuide",
				i = e("#js-stats-and-actions .ywtipbox"),
				a = c.get(t) || 0;
			if (i.is(":visible") && 0 === a) {
				var n = e('<div class="yw-user-guide"></div>');
				i.after(n), n.show(), setTimeout(function() {
					n.remove()
				}, 5e3), c.set(t, 1)
			}
		};
	return {
		init: function() {
			g()
		},
		onToggle: function() {
			p && p.observer.trigger("cq.toggle")
		}
	}
}), define("douyu/page/room/normal/mod/framebus", [], function() {
	var e;
	return function(e, t) {
		"object" == typeof exports && "undefined" != typeof module ? module.exports = t("undefined" == typeof global ? e : global) : "function" == typeof define && define.amd ? define([], function() {
			return t(e)
		}) : e.framebus = t(e)
	}(this, function(t) {
		function i(e) {
			return null == e ? !1 : null == e.Window ? !1 : e.constructor !== e.Window ? !1 : (w.push(e), !0)
		}
		function a(t) {
			var i, a = {};
			for (i in e) e.hasOwnProperty(i) && (a[i] = e[i]);
			return a._origin = t || "*", a
		}
		function n(e) {
			var t, i, a = o(this);
			return l(e) ? !1 : l(a) ? !1 : (i = Array.prototype.slice.call(arguments, 1), t = c(e, i, a), t === !1 ? !1 : (g(k.top, t, a), !0))
		}
		function s(e, t, i) {
			var a = o(this);
			return b(e, t, a) ? !1 : (_[a] = _[a] || {}, _[a][e] = _[a][e] || [], _[a][e].push({
				id: i ? i : (new Date).getTime() + "_" + x++,
				fn: t
			}), !0)
		}
		function r(e, t) {
			var i, a, n = o(this);
			if (a = _[n] && _[n][e], !a) return !1;
			if (t) {
				for (i = 0; i < a.length; i++) if (a[i].id === t) return a.splice(i, 1), !0
			} else delete _[n][e];
			return !1
		}
		function o(e) {
			return e && e._origin || "*"
		}
		function l(e) {
			return "string" != typeof e
		}
		function c(e, t, i) {
			var a = !1,
				n = {
					event: e,
					origin: i
				},
				s = t[t.length - 1];
			"function" == typeof s && (n.reply = y(s, i), t = t.slice(0, -1)), n.args = t;
			try {
				a = C + JSON.stringify(n)
			} catch (r) {
				throw new Error("Could not stringify event: " + r.message)
			}
			return a
		}
		function d(e) {
			var t, i, a, n;
			if (e.data.slice(0, C.length) !== C) return !1;
			try {
				t = JSON.parse(e.data.slice(C.length))
			} catch (s) {
				return !1
			}
			return null != t.reply && (i = e.origin, a = e.source, n = t.reply, t.reply = function(e) {
				var t = c(n, [e], i);
				return t === !1 ? !1 : void a.postMessage(t, i)
			}, t.args.push(t.reply)), t
		}
		function u(e) {
			k || (k = e || t, k.addEventListener ? k.addEventListener("message", p, !1) : k.attachEvent ? k.attachEvent("onmessage", p) : null === k.onmessage ? k.onmessage = p : k = null)
		}
		function f() {
			return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(e) {
				var t = 16 * Math.random() | 0,
					i = "x" === e ? t : 3 & t | 8;
				return i.toString(16)
			})
		}
		function p(e) {
			var t;
			l(e.data) || (t = d(e), t && (m("*", t.event, t.args, e), m(e.origin, t.event, t.args, e), v(e.data, t.origin, e.source)))
		}
		function m(e, t, i, a) {
			var n;
			if (_[e] && _[e][t]) for (n = 0; n < _[e][t].length; n++) _[e][t][n].fn.apply(a, i)
		}
		function h(e) {
			return !1
		}
		function g(e, t, i) {
			var a;
			try {
				for (e.postMessage(t, i), h(e) && g(e.opener.top, t, i), a = 0; a < e.frames.length; a++) e.frames[a] !== e && g(e.frames[a], t, i)
			} catch (n) {}
		}
		function v(e, t, i) {
			var a, n;
			for (a = w.length - 1; a >= 0; a--) n = w[a], n.closed === !0 ? w = w.slice(a, 1) : i !== n && g(n.top, e, t)
		}
		function y(t, i) {
			function a(s, r) {
				t(s, r), e.target(i).unsubscribe(n, a)
			}
			var n = f();
			return e.target(i).subscribe(n, a), n
		}
		function b(e, t, i) {
			return l(e) ? !0 : "function" != typeof t ? !0 : !! l(i)
		}
		var k, w = [],
			_ = {},
			x = 0,
			C = "/*framebus*/";
		u(), e = {
			target: a,
			include: i,
			publish: n,
			pub: n,
			trigger: n,
			emit: n,
			subscribe: s,
			sub: s,
			on: s,
			unsubscribe: r,
			unsub: r,
			off: r
		}
	}), e
}), define("douyu/page/room/normal/mod/guess", ["jquery", "shark/observer", "shark/util/storage/1.0", "douyu/com/user", "douyu/context", "douyu/page/room/normal/mod/framebus"], function(e, t, i, a, n, s) {
	var r = (window.DYS, {
		storage: {
			state: "guessstate",
			token: "guesstoken",
			allow: "guessallow",
			notAllow: "guessnotallow"
		},
		view: {
			$trigger: e("#js-guess"),
			$iframe: e("#js-guess-iframe"),
			$target: e('#js-guess-iframe iframe[data-type="iframe"]'),
			$relative: e("#js-stats-and-actions"),
			$tx_iframe: e('#js-guess-iframe iframe[data-type="tx_iframe"]')
		},
		state: {
			show: "show",
			hide: "hide",
			closure: !1,
			checked: !1
		},
		url: {
			ipCheck: "/lapi/live/qqLottery/ipCheck",
			getToken: "/api/qq_lottery/get_token",
			iframe: "https://qs.888.qq.com/m_qq/es/es.douyu.html#es.douyuV2=init",
			txIframe: "https://qs.888.qq.com/m_qq/es/es.message.html?__channel=douyu",
			txDomainName: "https://qs.888.qq.com"
		}
	}),
		o = {
			init: function() {
				var s, o, l = this;
				if (r.view.$trigger.length && r.view.$iframe.length && r.view.$relative.length) if (a.check()) {
					if (o = 10 + Math.floor(5 * Math.random() + 1), l.timer = setTimeout(function() {
						l.isSendReq = !0, l.getToken()
					}, 1e3 * o), l.getDoms(), t.trigger("mod.chat.action.view.add", {
						flag: "guess",
						dom: r.view.$trigger,
						lock: !0,
						tips: ""
					}), r.view.$trigger.show(), 1 == i.get(r.storage.state) && a.check() && l.show(), l.bindEvent(), s = r.view.$trigger.closest(".task-Getyw"), t.on("mod.layout.guess", function() {
						s[e(window).width() <= 1366 ? "addClass" : "removeClass"]("min-task-ball-guess"), l.state === r.state.show && l.layout()
					}), t.trigger("mod.layout.guess"), t.on("mod.guess.destroy", function(e) {
						r.state.closure = !e, l.hide()
					}), r.view.$trigger.is(":visible")) try {
						t.trigger("dys", {
							key: "dys.room.guess.init",
							ext: {
								rid: n.get("room.room_id"),
								cid: n.get("room.cate_id")
							}
						})
					} catch (c) {}
				} else r.view.$trigger.hide()
			},
			layout: function() {
				var e = r.view.$relative.outerWidth(),
					t = r.view.$iframe.outerWidth();
				r.view.$iframe.css({
					left: t >= e ? 0 : (e - t) / 2
				})
			},
			show: function() {
				this.state = r.state.show, this.getToken(), this.layout(), r.view.$iframe.show(), i.remove(r.storage.state);
				try {
					t.trigger("dys", {
						key: "dys.room.guess.show_quiz",
						ext: {
							rid: n.get("room.room_id"),
							cid: n.get("room.cate_id")
						}
					})
				} catch (e) {}
			},
			hide: function() {
				this.state = r.state.hide, r.view.$iframe.hide(), this.setRoute()
			},
			toggle: function() {
				return r.state.closure ? this.hide() : void(this.state === r.state.show ? this.hide() : this.show())
			},
			setRoute: function() {
				var e = "about:blank";
				this.state === r.state.show && (e = r.url.iframe + "&catename=" + r.prevCate + "&login_key=" + r.prevToken), r.view.$target.attr({
					src: e
				})
			},
			check: function() {
				return a.check() ? !0 : (this.login(), !1)
			},
			ipCheck: function(t) {
				if (1 != i.get(r.storage.allow) && !r.state.checked) return 1 == i.get(r.storage.notAllow) || r.state.checked ? void t() : void e.ajax({
					url: r.url.ipCheck,
					type: "GET",
					dataType: "json",
					data: {
						_v: (new Date).getTime()
					},
					success: function(e) {
						r.state.checked = !0, 0 === parseInt(e.error, 10) && (1 === parseInt(e.data.ip_allow, 10) ? (t(), i.set(r.storage.notAllow, 1, 10800)) : i.set(r.storage.allow, 1, 259200))
					}
				})
			},
			login: function() {
				a.show("login", {
					callback: function(e) {
						e === !0 && i.set(r.storage.state, 1)
					}
				})
			},
			getToken: function() {
				var t = this,
					a = t.doms;
				return 1 == i.get(r.storage.token) && void 0 !== r.prevToken && void 0 !== r.prevCate ? t.setRoute() : (i.set(r.storage.token, 1, 3600), a.guessLoading.show(), void e.ajax({
					url: r.url.getToken,
					type: "GET",
					dataType: "json",
					data: {
						roomid: n.get("room.room_id"),
						_v: (new Date).getTime()
					},
					error: function() {
						e.dialog.tips_black("请稍候再试！")
					},
					complete: function() {
						a.guessLoading.hide()
					},
					success: function(i) {
						var a = i.data;
						switch (clearTimeout(t.timer), parseInt(i.error, 10)) {
						case 0:
							r.prevCate = a.catename, r.prevToken = a.token, t.isSendReq && t.txIframeInit(), t.setRoute();
							break;
						case 1:
							t.login();
							break;
						default:
							e.dialog.tips_black(i.msg)
						}
					}
				}))
			},
			bindEvent: function() {
				var i = this,
					a = function(e) {
						e.preventDefault(), e.stopPropagation()
					},
					o = i.doms,
					l = !1;
				r.view.$trigger.on("click", function(a) {
					e(this).width("60px"), o.guessGameHover.hasClass("guess_game_hover0") && o.guessGameHover.removeClass("guess_game_hover0").addClass("guess_hover_mark"), o.guessCorner.is("hidden") || o.guessCorner.hide();
					try {
						t.trigger("dys", {
							key: "dys.room.guess.click_quizbutton",
							ext: {
								rid: n.get("room.room_id"),
								cid: n.get("room.cate_id")
							}
						})
					} catch (r) {}
					i.check() && (l ? (i.hide(), i.guessHover(), l = !1) : (i.show(), s.emit("message.start", {
						c: "es.douyu.message",
						m: "openWindow"
					}), l = !0))
				}), r.view.$iframe.on("click", '[data-type="close-guess"]', function(e) {
					a(e), i.hide(), i.guessHover(), l = !1
				}), e("#container").on("click.guess", function(t) {
					var a = e(t.target).closest("#js-guess-iframe,#js-guess");
					0 === a.length && (i.hide(), i.guessHover(), l = !1)
				}), o.guessClose.on("click", function(t) {
					a(t), e(this).closest(".guess_close_parent").fadeOut()
				})
			},
			guessHover: function() {
				var e = this.doms;
				e.guessGameHover.hasClass("guess_hover_mark") && e.guessGameHover.removeClass("guess_hover_mark").addClass("guess_game_hover0")
			},
			txIframeInit: function() {
				var e = this,
					t = "about:blank",
					i = r.view.$iframe.data("open-roomid") ? n.get("room.room_id") : "0";
				"http:" === location.protocol && (r.url.txIframe += "&domainDebug=1"), t = r.url.txIframe + "&catename=" + encodeURIComponent(r.prevCate) + "&login_key=" + encodeURIComponent(r.prevToken) + "&liveId=" + encodeURIComponent(i), r.view.$tx_iframe.attr({
					src: t
				}), e.getInitState()
			},
			getInitState: function() {
				var e = this,
					t = s.target(r.url.txDomainName);
				t.on("message.ready", function() {
					s.emit("message.start", {
						c: "es.douyu.message",
						m: "getIconData"
					}, function(t) {
						var i = JSON.parse(e.htmlEncode(JSON.stringify(t))) || {};
						0 === parseInt(i.errCode, 10) && i.data && i.data.config && e.renderCorner(i.data.config)
					})
				})
			},
			htmlEncode: function(e) {
				var t, i;
				return "undefined" == typeof e ? "" : (t = document.createElement("div"), i = document.createTextNode(e), t.appendChild(i), t.innerHTML)
			},
			getDoms: function() {
				this.doms = {
					guessLoading: r.view.$iframe.find(".guess_loading"),
					guessPrize: r.view.$trigger.find(".guess_corner_prize"),
					guessPrizeTitle: r.view.$trigger.find(".guess_prize_title"),
					guessPrizeSubTitle: r.view.$trigger.find(".guess_prize_sub_title"),
					guessPrizeDesc: r.view.$trigger.find(".guess_prize_desc"),
					guessGameTips: r.view.$trigger.find(".guess_game_tips"),
					gameTipsTitle: r.view.$trigger.find(".game_tips_title"),
					gameTipsContent: r.view.$trigger.find(".game_tips_content"),
					guessGameHover: r.view.$trigger.find(".guess_game_hover"),
					guessGameImg: r.view.$trigger.find(".guess_game_img"),
					guessHoverTitle: r.view.$trigger.find(".guess_hover_title"),
					guessHoverFocus: r.view.$trigger.find(".guess_hover_focus"),
					guessHoverNews: r.view.$trigger.find(".guess_hover_news"),
					guessClose: r.view.$trigger.find(".guess_close"),
					guessCornerPoint: r.view.$trigger.find(".guess_corner_point"),
					guessCornerWenan: r.view.$trigger.find(".guess_corner_wenan"),
					guessCorner: r.view.$trigger.find(".guess_corner"),
					guessLoading: r.view.$iframe.find(".guess_loading")
				}
			},
			renderCorner: function(e) {
				var t, i, a = this,
					n = a.doms,
					s = 0,
					o = e.length;
				if (o > 0) for (; o > s; s++) switch (i = e[s].data || {}, e[s].code) {
				case 0:
					n.guessPrizeTitle.text(i.title), n.guessPrizeSubTitle.text(i.subTitle), n.guessPrizeDesc.text(i.desc), n.guessPrizeTitle.attr("title", i.title), n.guessPrizeSubTitle.attr("title", i.subTitle), n.guessPrizeDesc.attr("title", i.desc), n.guessPrize.show();
					break;
				case 1:
					n.gameTipsTitle.text(i.title), n.gameTipsContent.text(i.subTitle), n.gameTipsTitle.attr("title", i.title), n.gameTipsContent.attr("title", i.subTitle), n.guessGameTips.show();
					break;
				case 2:
					n.guessGameImg.attr("src", i.img), n.guessHoverTitle.text(i.title), n.guessHoverFocus.text(i.subTitle), n.guessHoverNews.text(i.desc), n.guessHoverTitle.attr("title", i.title), n.guessHoverFocus.attr("title", i.subTitle), n.guessHoverNews.attr("title", i.desc), n.guessGameHover.addClass("guess_game_hover0");
					break;
				case 3:
					n.guessCornerPoint.show();
					break;
				case 4:
					t = i.type.toLowerCase(), r.view.$trigger.width("72px"), "new" === t ? n.guessCornerWenan.addClass("guess_new") : "hot" === t ? n.guessCornerWenan.addClass("guess_hot") : "free" === t && n.guessCornerWenan.addClass("guess_free"), n.guessCornerWenan.show()
				}
			}
		};
	return {
		init: function() {
			o.init()
		}
	}
}), define("douyu/page/room/normal/mod/anchor-guess", ["jquery", "shark/util/lang/1.0", "shark/util/template/2.0", "douyu/context", "shark/observer", "douyu/page/room/base/api", "shark/util/flash/data/1.0", "douyu/com/user"], function(e, t, i, a, n, s, r, o) {
	var l = {
		urls: {
			enter: "/lapi/interact/anchorGuess/isDisPlayGuess",
			token: "/member/guess/get_token"
		},
		htmlTemplate: {
			iframe: function() {
				var e = t.string.join("{{ if (isAnchor) }}", '<div class="anchor-guess anchor-side">', "{{ else }}", '<div class="anchor-guess user-side">', "{{ /if }}", '<iframe id="js-anchor-guess-iframe" class="anchor-guess-iframe" scrolling="no" src="about:blank" frameborder="0"></iframe>', "</div>");
				return i.compile(e)
			},
			enter: function() {
				var e = t.string.join('<div class="anchor-guess-wrap">', '<div class="anchor-guess-btn"></div>', "<!-- 开启和获奖通知提醒 begin -->", '<div class="anchor-guess-invite" id="js-guess-start">', "</div>", "<!-- 开启和获奖通知提醒 end -->", "<!-- 获奖通知 begin -->", '<div class="anchor-guess-lottery" id="js-guess-luck">', '<i class="arrow-icon"><i></i></i>', '<div class="anchor-guess-lotterycon">', '<a href="javascript:;" class="lotterycon-close-btn js-guess-luck-close">X</a>', '<p class="lotterycon-p1">恭喜您，中奖了！</p>', '<p class="lotterycon-p2">恭喜竞猜投注获胜，赢得豆子奖励</p>', "</div>", "</div>", "<!-- 获奖通知 end -->", "</div>");
				return i.compile(e)
			},
			startDlg: function() {
				var e = t.string.join('<i class="arrow-icon"><i></i></i>', '<div class="anchor-guess-invitecon">', '<a href="javascript:;" class="invite-close-btn js-guess-start-close">X</a>', '<div class="guess-invitecon-box">', '<div class="guess-invitecon-head">', '<div class="head-mask"></div>', '<img src="{{ pic }}" alt="">', "</div>", '<div class="guess-invitecon-desc">', '<h2 title="{{ nickname }}邀请您参与互动竞猜"><span>{{ nickname }}</span> 邀请您参与互动竞猜</h2>', "<p>赢豆子赢到手软！快上车！</p>", "</div>", "</div>", '<a href="javascript:;" class="click-guess-btn">点击竞猜></a>', "</div>");
				return i.compile(e)
			}
		}
	},
		c = {
			showThirdguess: !1,
			firstOpenGuess: !0,
			render: {},
			init: function() {
				var e = this;
				e.dataCache(), e.getThirdLink()
			},
			showEnter: function() {
				var t = this,
					i = t.render.iframe({
						isAnchor: t.isAnchor
					});
				t.$iframe = e(i), t.$roomVideo.append(t.$iframe), t.$enter = e(t.render.enter({})), n.trigger("dys", {
					key: "dys.room.anchor.guess.third.showenter"
				}), n.trigger("mod.chat.action.view.add", {
					flag: "anchorGuess",
					dom: t.$enter,
					lock: !0,
					tips: ""
				}), t.$enter.show(), t.cacheDoms(), t.bindEvent(), t.regApi(), t.initGuessStatus()
			},
			initGuessStatus: function() {
				var e = this.guessStatus;
				if (1 == e.is_open) {
					var t = e.nickname,
						i = e.pic;
					this.showStartNotice(t, i)
				}
			},
			showStartNotice: function(t, i) {
				if (t && i) {
					var n = a.get("room.owner_uid"),
						s = a.get("sys.uid");
					if (n != s) {
						var r = this.render.start({
							pic: i,
							nickname: t
						});
						this.$luck.hide(), e(".js-new-guess-entertips").is(":visible") || e(".js-new-guess-entertips-special").is(":visible") || this.$start.empty().append(r).show()
					}
				}
			},
			cacheDoms: function() {
				var e = this;
				e.$start = e.$enter.find("#js-guess-start"), e.$luck = e.$enter.find("#js-guess-luck"), e.$third = e.$iframe.find(".anchor-guess-iframe")
			},
			enterClkEvent: function(e, t) {
				e.stopPropagation();
				var i = this;
				return o.check() ? (t && n.trigger("dys", {
					key: "dys.room.anchor.guess.third.click"
				}), void(i.showThirdguess ? t && (i.$iframe.hide(), i.showThirdguess = !1) : i.getToken(function(e) {
					if (i.firstOpenGuess) i.$third.attr("src", e), i.thirdSrc = e, i.$acget = document.getElementById("js-anchor-guess-iframe").contentWindow, i.firstOpenGuess = !1, i.target = e.split("?")[0];
					else if (e !== i.thirdSrc) {
						i.thirdSrc = e;
						try {
							var t = e.split("?")[1],
								a = JSON.stringify({
									guessToken: t.split("=")[1]
								});
							i.$acget.postMessage(a, i.target)
						} catch (n) {}
					}
					i.$iframe.show(), i.showThirdguess = !0
				}))) : void o.show("login")
			},
			bindEvent: function() {
				var e = this;
				e.$enter.on("click", function(t) {
					e.$start.hide(), e.enterClkEvent(t, !0)
				}).on("click", "#js-guess-luck", function(t) {
					e.$start.hide(), e.enterClkEvent(t)
				}).on("click", "#js-guess-start", function(t) {
					e.$start.hide(), e.enterClkEvent(t)
				}).on("click", ".js-guess-start-close", function(t) {
					e.$start.hide(), t.stopPropagation()
				}).on("click", ".js-guess-luck-close", function(t) {
					e.$luck.hide(), t.stopPropagation()
				}), window.addEventListener ? window.addEventListener("message", function(t) {
					e.clFreamMsg(t.data)
				}) : window.attachEvent("message", function(t) {
					e.clFreamMsg(t.data)
				})
			},
			clFreamMsg: function(e) {
				var t = this;
				try {
					var i = JSON.parse(e);
					1 == i.closeGuess && t.$iframe && (t.$iframe.hide(), t.showThirdguess = !1)
				} catch (a) {}
			},
			regApi: function() {
				var e = this;
				s.reg("room_data_handler", function(t) {
					var i = r.decode(t).too();
					if ("anchorguess" === i.type) if (1 === +i.remark) {
						var a = i.nickname,
							n = i.pic;
						e.showStartNotice(a, n)
					} else 2 === +i.remark && (e.$start.hide(), e.$luck.show())
				})
			},
			dataCache: function() {
				var t = this,
					i = t.render,
					n = +a.get("sys.uid"),
					s = +a.get("room.owner_uid");
				t.$roomVideo = e("#js-room-video"), t.isAnchor = n === s, t.roomId = a.get("room.room_id"), i.iframe = l.htmlTemplate.iframe(), i.enter = l.htmlTemplate.enter(), i.start = l.htmlTemplate.startDlg()
			},
			getThirdLink: function() {
				var e = this;
				e.getEnter(function(t) {
					e.guessStatus = t, e.showEnter()
				})
			},
			getEnter: function(t) {
				var i = this.roomId,
					n = a.get("room.cate_id");
				i && n && e.ajax({
					url: l.urls.enter,
					type: "GET",
					dataType: "json",
					data: {
						room_id: i,
						cate2_id: n
					},
					success: function(e) {
						0 === +e.error && 1 === +e.data && t(e.guessOpen)
					}
				})
			},
			getToken: function(t) {
				e.ajax({
					url: l.urls.token,
					type: "GET",
					dataType: "json",
					data: {
						roomid: this.roomId
					},
					success: function(e) {
						0 === +e.error && t(e.data)
					}
				})
			}
		};
	return {
		init: function() {
			setTimeout(function() {
				c.init()
			}, 1e3)
		}
	}
}), define("douyu/page/room/normal/mod/yz-gift-rank", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/template/2.0", "douyu/context", "douyu/page/room/base/api", "douyu/com/user", "douyu/com/exjsonp", "douyu/com/room-gift-tmp"], function(e, t, i, a, n, s, r, o, l) {
	var c = n.get("sys.web_url"),
		d = n.get("room.room_id"),
		u = n.get("sys.webconfUrl"),
		f = n.get("room.rankActivity.giftWeekListType"),
		p = n.get("room.rankActivity." + f + ".aid"),
		m = "最佳助力",
		h = {
			ajaxUrls: {
				totalList: "/ztCache/ZtCacheList/getYanZhiZhouXingRankList",
				taGiftList: "/ztCache/ZtCacheList/getRankPlace",
				rule: u + "/resource/common/rank/h5.json"
			},
			defaultImg: {
				anchor: c + "app/douyu/res/com/defaultAvatar.png?v=20170726",
				user: c + "app/douyu/res/com/defaultAvatar.png?v=20170726",
				gift: c + "app/douyu/res/page/room-normal/giftmodal/gift_default.png?v=20170711",
				stealth: c + "app/douyu/res/page/room-normal/vip/invisible_list.png?v=20170711"
			},
			status: {
				show: !1,
				lock: !1,
				timeFlag: !0,
				firstReq: !1
			},
			data: {
				room_id: d,
				uid: n.get("room.owner_uid"),
				aid: p
			},
			ruleCB: "topBannerRender",
			activeClass: "gift-title-active",
			timer: null,
			maxLen: 5,
			defaultName: "虚位以待",
			defaultAvatar1: n.get("sys.web_url") + "app/douyu/activity/res/starmagic/default.jpg",
			$chatContainer: e("#js-chat-cont"),
			cateFlag: f ? "yzGiftWeekList" == n.get("room.rankActivity." + f + ".actThemeTag") : 0
		},
		g = {
			countDown: function(t, i, a) {
				var n = e(t);
				i >= 0 ? (n.addClass(a).attr("disabled", !0).val(i + "s"), i--, h.status.timeFlag = !1, clearTimeout(h.timer), h.timer = setTimeout(function() {
					g.countDown(t, i, a)
				}, 1e3)) : n.removeClass(a).attr("disabled", !1).val("刷新")
			},
			formatDotZero: function(e) {
				var t = /(\.\d+)0+$/,
					i = e.replace(t, "$1");
				return parseInt(i, 10) == i && (i = parseInt(i, 10)), i
			},
			toSimpleNum: function(e, t, i) {
				var a = Math.pow(10, t),
					n = 0;
				return isNaN(Number(e)) ? e : (n = parseFloat(Number(e) / a), g.formatDotZero(n.toFixed(i)))
			},
			toChineseNumber: function(e, t, i) {
				var a, n = Number(e);
				return isNaN(n) ? e : a = g.toSimpleNum(e, 4, i) + t
			},
			formatContribute: function(e, t) {
				return e >= 1e4 && (e = g.toChineseNumber(e, "万", t)), e
			},
			hasWeekGift: function() {
				var t = e("#gift-content");
				return !!t.find("[data-noble=2]").length
			},
			handleAvatar: function(e) {
				var t = h.defaultAvatar1;
				return e && (t = i.string.format("{0}upload/{1}_middle.jpg", n.get("sys.avatar_url"), e)), t
			}
		},
		v = {
			init: function() {
				var e = this;
				e.doms = {}, e.renderBtn(), e.renderWrap(), e.getDoms(), e.bindEvent(), e.doms.container.mCustomScrollbar()
			},
			renderBtn: function() {
				var i, a, n, s, r, o, l, c = this;
				i = e('<div class="gift-week-pic"></div>'), t.trigger("mod.chat.action.view.add", {
					flag: "weekList1",
					dom: i,
					lock: !0,
					tips: ""
				}), a = e('<div class="gift-week-pic"></div>'), t.trigger("mod.chat.action.view.add", {
					flag: "weekList2",
					dom: a,
					lock: !0,
					tips: ""
				}), n = e('<div class="gift-week-pic"></div>'), t.trigger("mod.chat.action.view.add", {
					flag: "weekList3",
					dom: n,
					lock: !0,
					tips: ""
				}), s = e('<div class="gift-week-pic"></div>'), t.trigger("mod.chat.action.view.add", {
					flag: "giftweek201711",
					dom: s,
					lock: !0,
					tips: ""
				}), r = e('<div class="gift-week-pic"></div>'), t.trigger("mod.chat.action.view.add", {
					flag: "giftweek201805",
					dom: r,
					lock: !0,
					tips: ""
				}), o = e('<div class="gift-week-pic"></div>'), t.trigger("mod.chat.action.view.add", {
					flag: "giftweek201806",
					dom: o,
					lock: !0,
					tips: ""
				}), l = e('<div class="gift-week-pic"></div>'), t.trigger("mod.chat.action.view.add", {
					flag: "summerWeekList",
					dom: l,
					lock: !0,
					tips: ""
				}), c.doms.btns = [i, a, n, s, r, o, l]
			},
			renderWrap: function() {
				var t = e("#container"),
					n = i.string.join("{{ if (cateFlag) }}", '<div class="gift-rank-week-mask gift-just-face {{ type }}" id="yz-gift-rank-mask" style="display: none">', "{{ else }}", '<div class="gift-rank-week-mask {{ type }}" id="yz-gift-rank-mask" style="display: none">', "{{ /if }}", '<div class="gift-rank-week-wrap">', '<a class="gift-rank-close" href="javascript:;" data-yz-gift-rank="close"></a>', '<div class="gift-rank-week">', '<div class="gift-title">', "{{ if (cateFlag) }}", '<span class="gift-title-active" data-yz-gift-rank="gift-total-rank-btn">礼物总榜</span>', '<span data-yz-gift-rank="gift-ta-rank-btn">本房主播</span>', "{{ else }}", '<span class="gift-title-active" data-yz-gift-rank="gift-total-rank-btn">礼物榜总榜</span>', '<span data-yz-gift-rank="gift-ta-rank-btn">TA的礼物榜</span>', "{{ /if }}", "</div>", '<div class="gift-tab-content" data-yz-gift-rank="container">', '<div class="gift-self" data-yz-gift-rank="ta-gift-rank-wrap">', "{{ if (cateFlag) }}", '<div class="gift-table-wrap">', '<div data-yz-gift-rank="ta-gift-rank"></div>', "</div>", '<div class="gift-rank-update"><span>榜单数据每分钟更新1次</span><input class="gift-reload gift-daoshu" type="button" disabled="disabled" name="" value="60s" data-yz-gift-rank="time-refresh-btn"></div>', "{{ else }}", '<input class="gift-reload gift-daoshu" type="button" disabled="disabled" name="" value="60s" data-yz-gift-rank="time-refresh-btn">', "<h4>榜单数据每隔1分钟更新一次</h4>", '<div class="gift-table-wrap">', '<table class="gift-table" data-yz-gift-rank="ta-gift-rank"></table>', "</div>", "{{ /if }}", "</div>", '<div class="gift-rank" data-yz-gift-rank="gift-total-rank-wrap">', '<div data-yz-gift-rank="last-week-rank"></div>', '<div class="gift-current" data-yz-gift-rank="curr-week-rank"></div>', "{{ if (!cateFlag) }}", '<div class="gift-rank-rule" data-yz-gift-rank="rule-wrap" style="display: none">', '<div class="lastTitleBox"><i class="ruleTitle"></i></div>', '<ul class="gift-rank-rule-wrap gift-plr20" data-yz-gift-rank="rule-box"></ul>', "</div>", "{{ /if }}", "</div>", "</div>", "</div>", "</div>", '<div class="gift-rank-week-holder"></div>', "</div>"),
					s = a.compile(n),
					r = s({
						type: f,
						cateFlag: h.cateFlag
					});
				t.append(r)
			},
			renderLastWeek: function(e) {
				var t = this.doms.lastWeekWrap,
					n = i.string.join('<div class="lastTitleBox">', "{{ if (cateFlag) }}", '<a class="rule-btn1" href="javascript:;">周星奖励', '<div class="gift-week-award">', '<div class="gift-award-list">', '<div class="gift-award-list-img g-img1"></div>', '<div class="gift-award-list-info">', "<h5><em>分区1号位</em>及移动端<em>首页5号位</em>（持续一周）</h5>", "<p>史无前例的超人气推荐位，为你带来绝无仅有的流量洪峰！", "</div>", "</div>", '<div class="gift-award-list">', '<div class="gift-award-list-img g-img2"></div>', '<div class="gift-award-list-info">', "<h5>更高礼物分成带来<em>超值收益</em>（8/1～8/31有效）</h5>", "<p>当月获得过礼物周星的主播，在结算该月礼物收益时每个周星将获得5%的额外分成，额外分成比例可累计（单周最多累计5%，单月最多累计20%）。</p>", "</div>", "</div>", '<div class="gift-award-list">', '<div class="gift-award-list-img g-img3"></div>', '<div class="gift-award-list-info">', "<h5>周星主播<em>荣耀定制</em>（持续一周）</h5>", "<p>定制直播间、礼物周星角标。</p>", "</div>", "</div>", '<div class="gift-award-list">', '<div class="gift-award-list-img g-img4"></div>', '<div class="gift-award-list-info">', "<h5>官方媒介<em>宣传</em></h5>", "<p>将获得优质的官方媒介宣传！</p>", "</div>", "</div>", "</div>", "</a>", "{{ else }}", '<a class="rule-btn1" href="javascript:;" data-yz-gift-rank="rule-btn">周星奖励</a>', "{{ /if }}", '<i class="lastTitle"></i>', "{{ if (cateFlag) }}", "<span>统计数据为 {{ data.start }} 到 {{ data.end }}</span>", "{{ else }}", "<span>（统计数据为 {{ data.start }} 到 {{ data.end }}）</span>", "{{ /if }}", "</div>", '<div class="gift-plr20 clearfix">', "{{ each list as item index }}", '<div class="gift-last-week-wrap {{ if (index > 0) }}gift-ml10{{ /if }}">', '<div class="gift-last-week">', '<div class="gift-icon">', '<img src="{{item.giftImg }}" title="{{item.giftName }}" class="gift-icon-img"/>', '<span class="giftName">{{item.giftName}}</span>', "</div>", '<div class="gift-left">', '<a class="gift-zhubo" title="{{ item.anchorTitle }}" href="{{ item.anchorHref }}" {{ if item.isAnchor }} style="cursor: default;"{{ else }} target="_blank"{{ /if }} data-yz-gift-rank="lastWeek-anchor">', '<img src="{{ item.anchorImg }}" />', "{{ if item.anchorLive != 0 }}", '<span class="gift-status"></span>', "{{ /if }}", "</a>", '<div class="gift-zhubo-name">', '<h6 title="{{ item.anchorName }}"><a href="{{ item.anchorHref }}"  data-yz-gift-rank="lastWeek-anchor" {{ if item.isAnchor }} style="cursor: default;"{{ else }} target="_blank"{{ /if }}>{{ item.anchorName }}</a></h6>', "<span>收到：<em>{{ item.anchorGiftNum }}个</em></span>", "</div>", "</div>", '<div class="gift-right">', '<div class="gift-zhubo-name">', '<h6><i class="fire"></i>{{bigFanTitle}}</h6>', '<span class="bestUserName">{{ item.userName }}</span>', "</div>", "</div>", "</div>", "</div>", "{{ /each }}", "</div>"),
					s = a.compile(n),
					r = s({
						data: e,
						list: e.list,
						cateFlag: h.cateFlag,
						bigFanTitle: m
					});
				t.html(r)
			},
			renderList: function(e, t) {
				var n = this.doms.currWeekWrap,
					s = this,
					r = i.string.join('<div class="lastTitleBox">', "{{ if (cateFlag) }}", '<a class="rule-btn2" href="javascript:;">活动规则', '<div class="gift-week-rule">', "{{ #newRulesHtml }}", "</div>", "</a>", "{{ if (isLastWeek) }}", '<a class="rule-btn1" href="javascript:;">周星奖励', '<div class="gift-week-award">', '<div class="gift-award-list">', '<div class="gift-award-list-img g-img1"></div>', '<div class="gift-award-list-info">', "<h5><em>分区1号位</em>及移动端<em>首页5号位</em>（持续一周）</h5>", "<p>史无前例的超人气推荐位，为你带来绝无仅有的流量洪峰！", "</div>", "</div>", '<div class="gift-award-list">', '<div class="gift-award-list-img g-img2"></div>', '<div class="gift-award-list-info">', "<h5>更高礼物分成带来<em>超值收益</em>（8/1～8/31有效）</h5>", "<p>当月获得过礼物周星的主播，在结算该月礼物收益时每个周星将获得5%的额外分成，额外分成比例可累计（单周最多累计5%，单月最多累计20%）。</p>", "</div>", "</div>", '<div class="gift-award-list">', '<div class="gift-award-list-img g-img3"></div>', '<div class="gift-award-list-info">', "<h5>周星主播<em>荣耀定制</em>（持续一周）</h5>", "<p>定制直播间、礼物周星角标。</p>", "</div>", "</div>", '<div class="gift-award-list">', '<div class="gift-award-list-img g-img4"></div>', '<div class="gift-award-list-info">', "<h5>官方媒介<em>宣传</em></h5>", "<p>将获得优质的官方媒介宣传！</p>", "</div>", "</div>", "</div>", "</a>", "{{ /if }}", "{{ else }}", '<a class="rule-btn1" href="javascript:;" data-yz-gift-rank="rule-btn">榜单规则</a>', "{{ /if }}", '<i class="currentTitle"></i>', "</div>", '<div class="gift-plr20 clearfix">', "{{ each list as items index }}", '<ul class="gift-current-list {{ if index % 2 == 1 }}gift-current-ml{{ /if }}">', '<h6><img src="{{ items.giftImg }}" title="{{ items.giftName }}">{{ items.giftName }}', "{{ if (cateFlag) }}", '<span class="gift-current-list-title">收到个数</span>', "{{ /if }}", "</h6>", "{{ each items.list as item index }}", "{{ if index == 0 }}", '<li class="gift-current-first">', "{{ if (cateFlag) }}", '<a class="gift-current-avatar" title="{{ item.anchorName }}" href="{{ item.anchorHref }}" {{ if item.isAnchor }} style="cursor: default;" {{ else }} target="_blank"{{ /if }} data-yz-gift-rank="current-anchor">', '<img src="{{ item.anchorImg }}" title="{{ item.anchorName }}" />', '<span class="gift-current-index-new"></span>', "</a>", "{{ else }}", '<span class="gift-current-index-new"></span>', "{{ /if }}", '<div class="gift-current-zhubo">', '<a class="name" title="{{ item.anchorName }}" href="{{ item.anchorHref }}" {{ if item.isAnchor }} style="cursor: default;"{{ else }} target="_blank"{{ /if }} data-yz-gift-rank="current-anchor">{{ item.anchorName }}</a>', "{{ if cateFlag && item.anchorLive != 0 }}", '<span class="gift-is-onlive" title="直播中"></span>', "{{ /if }}", "{{ if (cateFlag) }}", '{{ if (item.bestUserGiftNum != "0") }}', '<span class="bestUser">{{bigFanTitle}}&nbsp;&gt;<span class="the-best-detial"><i title="{{ item.bestUserName  }}">{{ item.bestUserName }}</i><i>：</i>送出{{ item.bestUserGiftNum }}个</span>', "{{ /if }}", "{{ else }}", '<span class="bestUser">{{bigFanTitle}}：{{ item.bestUserName }}</span>', "{{ /if }}", "</div>", '<div class="gift-current-reward">', "{{ if (cateFlag) }}", '<span class="anchor-gift-number">{{ item.anchorGiftNum }}</span>', "{{ else }}", '<span class="anchor-gift-number">收到：{{ item.anchorGiftNum }}个</span>', '<span class="bestuser-sendgift-number">赠送：{{ item.bestUserGiftNum }}个</span>', "{{ /if }}", "</div>", '<span class="gift-current-status {{ item.anchorIdxStatu }}"></span>', "</li>", "{{ else }}", "<li>", '<span class="gift-current-index-new">{{item.anchorIdx}}</span>', '<div class="gift-current-zhubo">', '<a class="name" title="{{ item.anchorName }}" href="{{ item.anchorHref }}" {{ if item.isAnchor }} style="cursor: default;"{{ else }} target="_blank"{{ /if }} data-yz-gift-rank="current-anchor">{{ item.anchorName }}</a>', "{{ if item.anchorLive != 0 }}", '<span class="gift-is-onlive" title="直播中"></span>', "{{ /if }}", "{{ if (cateFlag) }}", '{{ if (item.bestUserGiftNum != "0") }}', '<span class="bestUser">{{bigFanTitle}}&nbsp;&gt;<span class="the-best-detial"><i title="{{ item.bestUserName  }}">{{ item.bestUserName }}</i><i>：</i>送出{{ item.bestUserGiftNum }}个</span>', "{{ /if }}", "{{ else }}", '<span class="bestUser">{{bigFanTitle}}：{{ item.bestUserName }}</span>', "{{ /if }}", "</div>", '<div class="gift-current-reward">', "{{ if (cateFlag) }}", '<span class="anchor-gift-number">{{ item.anchorGiftNum }}</span>', "{{ else }}", '<span class="anchor-gift-number">收到：{{ item.anchorGiftNum }}个</span>', '<span class="bestuser-sendgift-number">赠送：{{ item.bestUserGiftNum }}个</span>', "{{ /if }}", "</div>", '<span class="gift-current-status {{ item.anchorIdxStatu }}"></span>', "</li>", "{{ /if }}", "{{ /each }}", "</ul>", "{{ /each }}", "</div> ", "</div>"),
					o = a.compile(r),
					l = o({
						list: e,
						cateFlag: h.cateFlag,
						isLastWeek: t,
						bigFanTitle: m,
						newRulesHtml: s.newRulesHtml
					});
				n.html(l)
			},
			renderRule: function(e) {
				var t = this.doms,
					n = t.wrap.find('[data-yz-gift-rank="rule-box"]'),
					s = i.string.join("{{ each list as item }}", "<li>", "<p>{{ item }}</p>", "</li>", "{{ /each }}"),
					r = a.compile(s),
					o = r({
						list: e
					});
				n.html(o)
			},
			renderNewRule: function(e) {
				var t = i.string.join("{{ each list as item }}", "<p>", "{{ item }}", "</p>", "{{ /each }}"),
					n = a.compile(t),
					s = n({
						list: e
					});
				this.newRulesHtml = s
			},
			renderTaList: function(e) {
				var t = i.string.join("{{ if (cateFlag) }}", "{{ each list as item }}", '<div class="gift-table-list">', '<div class="gift-pic">', '<img src="{{ item.giftImg }}">', "</div>", '<div class="giftName">{{ item.giftName }}</div>', '{{ if (item.getNum != "本周还未收到") }}', '<div class="gift-self-rank">排名：<span>{{ item.idx }}</span></div>', '<div class="gift-self-receive">收到：<span>{{ item.getNum }}</span>个</div>', "{{ else }}", '<div class="gift-receive-none">本周暂未收到</div>', "{{ /if }}", "</div>", "{{ /each }}", "{{ else }}", '<tr class="gift-table-th">', '<th width="35%">礼物</th>', '<th width="45%">当前排名</th>', '<th width="20%" class="center">收到个数</th>', "</tr>", "{{ each list as item }}", "<tr>", '<td width="35%">', '<div class="gift-pic">', '<img src="{{ item.giftImg }}">', "</div>", '<span class="giftName">{{ item.giftName }}</span>', "</td>", '<td width="45%">{{ item.idx }}</td>', '<td width="20%" class="center">{{ item.getNum }}</td>', "</tr>", "{{ /each }}", "{{ /if }}"),
					n = a.compile(t),
					s = n({
						list: e,
						cateFlag: h.cateFlag
					});
				this.doms.taGiftRank.html(s)
			},
			renderWelcome: function() {
				var e = i.string.join('<div class="summer2018-enter">', '<object autoplay="autoplay" width="100%" height="250px" data="/common/douyu/images/summerEnter201806.swf">', '<param name="wmode" value="transparent">', '<embed src="/common/douyu/images/summerEnter201806.swf" wmode="transparent">', "</object>", '<div class="imageBox"><img src="{{data.ic}}" /></div>', '<div class="enter-name-wrap">欢迎<span>{{ data.nn }}</span>驾临直播间</div>', "</div>"),
					t = a.compile(e);
				return t
			},
			showWelcome: function(t) {
				var i = this,
					a = i.renderWelcome(),
					n = e(a({
						data: t
					}));
				h.$chatContainer.append(n), clearTimeout(i.timer), i.timer = setTimeout(function() {
					h.$chatContainer.find(".summer2018-enter").remove()
				}, 8e3)
			},
			getDoms: function() {
				var t = this,
					i = e("#yz-gift-rank-mask");
				t.doms = e.extend(!0, t.doms, {
					wrap: i,
					container: i.find('[data-yz-gift-rank="container"]'),
					giftTotalRankBtn: i.find('[data-yz-gift-rank="gift-total-rank-btn"]'),
					taGiftRankBtn: i.find('[data-yz-gift-rank="gift-ta-rank-btn"]'),
					lastWeekWrap: i.find('[data-yz-gift-rank="last-week-rank"]'),
					currWeekWrap: i.find('[data-yz-gift-rank="curr-week-rank"]'),
					giftTotalRank: i.find('[data-yz-gift-rank="gift-total-rank-wrap"]'),
					taGiftRankWrap: i.find('[data-yz-gift-rank="ta-gift-rank-wrap"]'),
					taGiftRank: i.find('[data-yz-gift-rank="ta-gift-rank"]'),
					refresh: i.find('[data-yz-gift-rank="time-refresh-btn"]')
				})
			},
			sendAjax: function(t, i) {
				var a = t.url,
					n = t.type || "GET",
					s = t.data || {},
					r = i || {},
					o = r.success || e.noop,
					l = r.error || e.noop;
				a && e.ajax({
					url: a,
					type: n,
					data: s,
					dataType: "json",
					success: o,
					error: l
				})
			},
			getRule: function() {
				var t = this,
					i = t.doms,
					a = "",
					n = [];
				o.load(h.ajaxUrls.rule, h.ruleCB, function(s) {
					if (s && !e.isEmptyObject(s)) for (var r in s) if (r == p) {
						a = s[r] && s[r].content, n = a.split("\n");
						break
					}
					t.renderRule(n), i.wrap.find('[data-yz-gift-rank="rule-wrap"]').show(), t.renderNewRule(n)
				})
			},
			handleData: {
				lastWeek: function(t) {
					var i = {},
						a = [],
						s = t,
						o = 0,
						l = s.length,
						c = r.check();
					if (!t || !l) return !1;
					for (; l > o; o++) {
						var u = s[o],
							f = u.data || {},
							p = 5 == n.get("sys.groupid"),
							m = n.get("sys.nickname") == f.user_name,
							v = f.room_id == d,
							y = u.range ? u.range : "------_------",
							b = {};
						y = y.split("_"), i.start = y[0], i.end = y[1];
						var k = f.vipId ? +f.vipId : 0,
							w = k ? k : f.room_id || "";
						b = {
							anchorName: f.owner_name || "虚位以待",
							anchorHref: w ? v ? "javascript:void(0);" : "/" + w : "javascript:void(0);",
							anchorTitle: 0 == f.is_live ? "在赶来路上" : "进入直播间",
							anchorImg: f.avatar || h.defaultImg.anchor,
							anchorLive: f.is_live || "0",
							anchorGiftNum: f.num ? g.formatContribute(f.num, 1) : "--",
							isStealth: f.is_stealth || 0,
							userName: f.user_name || "虚位以待",
							userImg: f.user_icon || h.defaultImg.user,
							userSendNum: f.user_num ? g.formatContribute(f.user_num, 1) : "0",
							giftName: f.gift_name || "礼物名称",
							giftImg: f.gift_icon ? f.gift_icon : h.defaultImg.gift,
							isAnchor: v
						}, 0 != f.is_stealth && (c && (v || p || m) ? e.extend(!0, b, {
							isStealth: f.is_stealth,
							userName: f.user_name || "",
							userImg: f.user_icon || h.defaultImg.user
						}) : e.extend(!0, b, {
							isStealth: 0,
							userName: "神秘人",
							userImg: h.defaultImg.stealth
						})), a[o] = b
					}
					return i.list = a, i
				},
				currWeek: function(t) {
					var i = [],
						a = t.length ? t : Array(2);
					return t ? (e.each(a, function(e, t) {
						var a = {},
							n = t || {},
							s = n.list || {},
							r = s.length || 0,
							o = 0;
						for (a.giftName = n.gift_name || "礼物", a.giftImg = n.gift_icon ? n.gift_icon : h.defaultImg.gift, a.list = [], r > h.maxLen && (s.length = r = h.maxLen); r > o; o++) {
							var l = s[o].rid == d,
								c = s[o],
								u = c.vipId ? +c.vipId : 0,
								f = u ? u : c.rid || "";
							a.list.push({
								anchorName: c.owner_name || "",
								anchorHref: f ? l ? "javascript:void(0);" : "/" + f : "javascript:void(0);",
								anchorTitle: l ? "" : 0 == c.is_live ? "在赶来路上" : "进入直播间",
								anchorImg: c.src || h.defaultImg.anchor,
								anchorTarget: "_blank",
								anchorIdx: c.idx || o + 1,
								anchorLive: c.is_live || "0",
								anchorGiftNum: c.sc ? g.formatContribute(c.sc, 1) : "0",
								anchorIdxStatu: "0" == c.statu ? "keep" : "1" == c.statu ? "down" : "up",
								isAnchor: l,
								bestUserName: c.bestuser ? c.bestuser.nickname || "虚位以待" : "虚位以待",
								bestUserGiftNum: c.bestuser && c.bestuser.sc ? g.formatContribute(c.bestuser.sc, 1) : "0"
							})
						}
						for (; r < h.maxLen;) a.list.push({
							anchorName: "虚位以待",
							anchorHref: "javascript:void(0);",
							anchorTitle: "",
							anchorImg: h.defaultImg.anchor,
							anchorTarget: "",
							anchorIdx: ++r,
							anchorLive: "0",
							anchorGiftNum: "0",
							anchorIdxStatu: "keep",
							isAnchor: !0,
							bestUserName: "虚位以待",
							bestUserGiftNum: "0"
						});
						i.push(a)
					}), i) : !1
				},
				taRankList: function(e) {
					var t, i = [],
						a = 0;
					for (t = e.length; t > a; a++) {
						var n = e[a] || {},
							s = parseInt(n.idx, 10),
							r = "暂无排名";
						s > 0 ? r = "第" + s + "名" : 0 > s && (r = -s + "+"), i[a] = {
							giftName: n.gift_name || "",
							giftImg: n.gift_icon ? n.gift_icon : h.defaultImg.gift,
							idx: r,
							getNum: n.receive_num > 0 ? g.formatContribute(n.receive_num, 1) : "本周还未收到"
						}
					}
					return i
				}
			},
			listAjaxCb: {
				success: function(t) {
					if (0 === parseInt(t.code, 10)) {
						var i = t.data || {};
						m = i.big_fan_title, i && i.lastWeek && !e.isEmptyObject(i.lastWeek) && v.renderLastWeek(v.handleData.lastWeek(i.lastWeek)), i && i.currWeek ? v.renderList(v.handleData.currWeek(i.currWeek), e.isEmptyObject(i.lastWeek)) : v.emptyRender()
					} else v.emptyRender()
				},
				error: function() {
					v.emptyRender()
				}
			},
			taAjaxCb: {
				success: function(e) {
					0 === parseInt(e.code, 10) && e.data ? v.renderTaList(v.handleData.taRankList(e.data)) : v.doms.taGiftRank.html('<tr class="gift-table-th"><th>暂无数据</th></tr>')
				},
				error: function() {
					v.doms.taGiftRank.html('<tr class="gift-table-th"><th>暂无数据</th></tr>')
				}
			},
			emptyRender: function() {
				var e = [];
				v.renderList(v.handleData.currWeek(e), 1)
			},
			initRank: function() {
				var e = this,
					i = e.doms,
					a = i.wrap;
				e.timer = null, h.status.show ? (a.fadeOut(300), h.status.show = !1) : (h.status.lock || (e.sendAjax({
					url: h.ajaxUrls.totalList,
					data: {
						aid: p
					}
				}, e.listAjaxCb), e.sendAjax({
					url: h.ajaxUrls.taGiftList,
					data: h.data
				}, e.taAjaxCb), e.getRule(), h.status.lock = !0, clearTimeout(e.timer), e.timer = setTimeout(function() {
					h.status.lock = !1
				}, 6e4)), a.fadeIn(300), h.status.timeFlag && g.countDown(i.refresh, 60, "gift-daoshu"), h.status.show = !0), t.trigger("dys", {
					key: "dys.room.giftWeekRank.enterBtn.click"
				})
			},
			bindEvent: function() {
				var i = this,
					a = i.doms,
					n = a.wrap;
				e.each(a.btns, function() {
					this.on("click", function() {
						i.initRank()
					})
				}), n.on("click", '[data-yz-gift-rank="gift-total-rank-btn"]', function() {
					a.giftTotalRank.show(), a.taGiftRankWrap.hide(), e(this).addClass(h.activeClass), a.taGiftRankBtn.removeClass(h.activeClass), a.container.mCustomScrollbar("update")
				}).on("click", '[data-yz-gift-rank="gift-ta-rank-btn"]', function() {
					a.giftTotalRank.hide(), a.taGiftRankWrap.show(), e(this).addClass(h.activeClass), a.giftTotalRankBtn.removeClass(h.activeClass), h.status.firstReq = !0, a.container.mCustomScrollbar("update"), t.trigger("dys", {
						key: "dys.room.giftWeekRank.taGiftRank.click"
					})
				}).on("click", '[data-yz-gift-rank="lastWeek-anchor"]', function() {
					"javascript:void(0);" !== e(this).attr("href") && t.trigger("dys", {
						key: "dys.room.giftWeekRank.totalList.lastWeek.anchor.click"
					})
				}).on("click", '[data-yz-gift-rank="current-anchor"]', function() {
					"javascript:void(0);" !== e(this).attr("href") && t.trigger("dys", {
						key: "dys.room.giftWeekRank.totalList.currWeek.anchor.click"
					})
				}).on("click", '[data-yz-gift-rank="rule-btn"]', function() {
					a.container.mCustomScrollbar("scrollTo", "bottom", {
						scrollInertia: 1e3,
						timeout: 60
					})
				}).on("click", '[data-yz-gift-rank="time-refresh-btn"]', function() {
					g.countDown(a.refresh, 60, "gift-daoshu"), h.status.timeFlag = !0, i.sendAjax({
						url: h.ajaxUrls.taGiftList,
						data: h.data
					}, i.taAjaxCb)
				}).on("click", '[data-yz-gift-rank="close"]', function() {
					n.fadeOut(300), h.status.show = !1
				})
			}
		};
	return s.reg("room_show_yzgift_rank", function() {
		v.initRank()
	}), {
		init: function() {
			l.render().done(function() {
				n.get("room.rankActivity." + f + ".activeRoomOPen") && n.get("room.rankActivity." + f + ".activeTimeOnline") && g.hasWeekGift() && v.init()
			})
		}
	}
}), define("douyu/page/room/normal/mod/taobao-goods", ["jquery", "shark/class", "shark/observer", "shark/util/template/2.0", "shark/util/flash/data/1.0", "shark/util/lang/1.0", "shark/util/storage/1.0", "shark/util/cookie/1.0", "douyu/context", "douyu/com/user", "douyu/page/room/base/api"], function(e, t, i, a, n, s, r, o, l, c, d) {
	var u = {
		JSLOADING: "JS-loading",
		JSDISABLED: "JS-disabled",
		pushedClass: "JS-pushed",
		active: "active"
	},
		f = {
			pushurl: "/room/wab/set_push_item",
			showbtnurl: "/room/wab/set_show_float_entry",
			getList: "/room/wabu/get_data"
		},
		p = {
			pusheditemclosed: "pusheditemclosed",
			entryClosed: "entryClosed"
		},
		m = {
			getRestTime: function(e) {
				var t, i;
				return e = e ? parseInt(e, 10) : 0, t = new Date, t.setDate(t.getDate() + e), t.setHours(24), t.setMinutes(0), t.setSeconds(0), i = t.getTime() - (new Date).getTime()
			}
		},
		h = {
			flags: {
				isListShow: 0,
				imgAdded: 0
			},
			init: function(t) {
				var i, a = this;
				this.doms = {
					roomVideo: e("#js-room-video"),
					statsNactions: e("#js-stats-and-actions")
				}, this.keyPre = "trans", this.config = t, this.currentIndex = 0, this.listObj = {}, i = this.config.shop, this.listRender = this.listRenderFn(), this.recomandRender = this.recomandRenderFn(), this.pushedGoodsRender = this.pushedGoodsRenderFn(), this.showIsLive = 1 == l.get("room.show_status"), this.config.customerServiceUrl = "/member/customer_service", this.config.hasAnchorOwnGoods = !1, this.config.scriptLoaded = !1, i && i.items && i.items.length && (this.listData = i.items, e.each(this.listData, function() {
					return this.is_showcase ? void 0 : (a.config.hasAnchorOwnGoods = !0, !1)
				}), this.renderBtn(), this.renderList(), this.showIsLive && (i.push && i.push.item_id && i.push.item_id != r.get(p.pusheditemclosed) && this.showPushed(this.listObj[this.keyPre + i.push.item_id]), !r.get(p.entryClosed) && i.showFloatEntry && this.showEntryToViewers())), this.bindEvents()
			},
			renderBtn: function() {
				var e = (this.config.shop, this.config.hasAnchorOwnGoods),
					t = '<div selector="shopbuybtn" class="shopbuybtn' + (e ? "" : " douyushopbuybtn") + ' "></div>';
				this.doms.statsNactions.append(t), i.trigger("mod.chat.action.view.add", {
					flag: "taobaogoods",
					dom: this.doms.statsNactions.find('[selector="shopbuybtn"]'),
					lock: !0,
					tips: e ? "主播推荐的优质商品" : "鱼购精选商品"
				})
			},
			renderList: function(e, t) {
				var i, a, n, s, r = this,
					o = r.config,
					l = this.doms.roomVideo,
					c = o.shop,
					d = e || r.listData,
					u = d.length,
					f = d[0],
					p = 4,
					m = [];
				for (u && f && !f.ad_id && c.ad && (d.unshift(c.ad), u = d.length), n = 0; u > n; n++) a = m[parseInt(n / p, 10)], "undefined" == typeof a && (a = [], m.push(a)), i = d[n], a.push(i), r.listObj[r.keyPre + i.item_id] = i;
				r.listLength = m.length, s = r.listRender({
					isCurrentAnchor: r.config.isCurrentAnchor,
					pushedItemId: r.showIsLive && (t || c && c.push && c.push.item_id),
					shoplink: c && c.shopUrl,
					showEntry: c && r.listLength && c.showFloatEntry,
					hasAnchorOwnGoods: r.config.hasAnchorOwnGoods,
					list: m,
					customerServiceUrl: r.config.customerServiceUrl
				}), l.find('[selector="pushlist"]').remove(), l.append(s), l.find('[selector="pushlist"]').show(), r.listLength < 2 && l.find('[selector="pushlist"]').find('[selector="prevgoodspage"], [selector="nextgoodspage"]').addClass("hide")
			},
			pushedGoodsRenderFn: function() {
				var e = s.string.join('<div selector="pushedgoodsitemwrap" class="fishop-anchor-push-box">', '<div class="fishop-anchor-push-main">', '<div class="fishop-anchor-push-main-bg"></div>', '<div class="fishop-anchor-push-main-content">', "<h4>主播力推</h4>", '<a selector="closebkbmpushed" tabindex="-1" class="close" href="javascript:;">×</a>', '<a selector="pushedgoodsitem" tabindex="-1" data-id="{{item_id}}" data-piid="{{ piid }}" data-sourceid="{{source_id}}" data-type="{{item_scope.type}}" target="_blank" href="{{ url }}" class="push-cover">', '<img src="{{ pict_url }}">', '<span class="push-cover-des">', '<span class="push-cover-des-bg"></span>', '<span class="push-cover-des-main">', '<span class="ibm" title="{{ title }}">{{ title }}</span>', '<span class="holder"></span>', "</span>", "</span>", "</a>", "</div>", '<a tabindex="-1" href="handler"></a>', "</div>", "</div>"),
					t = a.compile(e);
				return t
			},
			recomandRenderFn: function() {
				var e = s.string.join('<div selector="recomandbtnwrap" class="fishop-anchor-recommands-box">', '<a tabindex="-1" selector="closerecomandbtn" class="close" href="javascript:;">×</a>', '<div class="fishop-anchor-recommands-main">', '<div class="fishop-anchor-recommands-main-bg"></div>', '<a tabindex="-1" href="javascript:;" class="fishop-anchor-recommands-main-content">', '<i class="widget"></i>', "</a>", '<a tabindex="-1" href="javascript:;" class="handler"></a>', "</div>", "</div>"),
					t = a.compile(e);
				return t
			},
			listRenderFn: function() {
				var t = e.param({
					ty: "0",
					a: "0",
					uin: 800190050,
					from: 5
				}),
					i = s.string.join('<div selector="pushlist" tabindex="-1" class="fishop-anchor-recommands-sub', "{{ if shoplink }}", " status-anchor", "{{ /if }}", "{{ if isCurrentAnchor }}", " status--showswitch", "{{ /if }}", '">', '<div class="fishop-anchor-recommands-sub-bg"></div>', '<a tabindex="-1" selector="closebkbmlist" class="close" href="javascript:;">×</a>', '<div class="fishop-anchor-recommands-sub-content">', '<div class="rshop-part">', '<a tabindex="-1" selector="anchorshop" href="{{ shoplink }}" target="_blank" class="tshop-name">', '<i class="icon-tshop"></i>', "<strong> 主播鱼塘 </strong>", "</a>", "</div>", '<div class="fishop-anchor-recommands-list-box">', '<a tabindex="-1" selector="prevgoodspage" class="handler handler-prev hide" href="javascript:;"></a>', '<a tabindex="-1" selector="nextgoodspage" class="handler handler-next" href="javascript:;"></a>', '<div selector="goodslist" class="fishop-anchor-recommands-list-main">', "{{ each list as items }}", "<ul>", "{{ each items as item }}", '<li {{if !item.ad_id}} selector="productitem"{{/if}} data-id="{{ item.item_id || item.ad_id }}" data-piid="{{ item.piid }}" data-sourceid="{{item.source_id}}" data-type="{{item.item_scope.type}}">', "{{ if item.ad_id }}", '<a tabindex="-1" selector="adlink" class="fishop-anchor-recommands-link" target="_blank" href="{{ item.url }}">', '<span class="cover-box" selector="goodsimg" data-img="{{ item.pict_url }}">', "</span>", '<em class="price">　</em>', "</a>", "{{ else }}", "{{ if isCurrentAnchor }}", '<a tabindex="-1" {{ if !item.is_showcase }}selector="changepushed"{{ /if }} class="fishop-anchor-recommands-link {{ if item.item_id == pushedItemId }} active{{ /if }}{{ if item.is_showcase }}status--show-push-btn{{ /if }}" target="_blank" href="{{ item.url }}">', "{{ else }}", '<a selector="itemlink" tabindex="-1" target="_blank" href="{{ item.url }}">', "{{ /if }}", '<span class="cover-box" selector="goodsimg" data-img="{{ item.pict_url }}">', '<b class="cover-des">', "{{ if isCurrentAnchor && !item.is_showcase }}", '<span selector="pushtext" class="cover-main">', "{{ if item.item_id != pushedItemId }}", "实时推送", "{{ else }}", "取消推送", "{{ /if }}", "</span>", "{{ else }}", '<span class="cover-des-main"> {{ item.title }} </span>', "{{ /if }}", "<i></i>", "</b>", "</span>", '<em class="price">', "￥{{ item.price }}", "</em>", "</a>", "{{ /if }}", "</li> ", "{{ /each }}", "</ul> ", "{{ /each }}", "</div>", "</div>", "</div>", "{{ if isCurrentAnchor }}", '<div class="fishop--anchor--enter">', "{{ if shoplink }}", '<div class="anchor--enter--wrap clearfix">', '<span class="enter--icon"></span>', '<dl class="enter--content">', "<dt>推荐入口状态</dt>", '<dd><span selector="showbtntoviewerchecker" class="enterbtn ', "{{ if !showEntry }}", "status--close", "{{ /if }}", '"></span></dd>', "</dl>", "</div>", "{{ /if }}", '<div id="J_customerservice" class="customer--service--wrap">', '<a tabindex="-1" class="customer--service--btn" target="_blank" href="http://crm2.qq.com/page/portalpage/wpa.php?' + t + '">', '<i class="customer--service--icon"></i>鱼商客服', "</a>", "</div>", "</div>", "{{ /if }}", "</div>"),
					n = a.compile(i);
				return n
			},
			bindEvents: function() {
				var t = this,
					i = this.doms.roomVideo;
				i.on("click.carousel", '[selector="prevgoodspage"]', function() {
					DYS.sub({
						action_code: "click_mdse_recom_mdse_cpage",
						ext: {
							type: "up"
						}
					}), t.once(-1)
				}).on("click.carousel", '[selector="nextgoodspage"]', function() {
					DYS.sub({
						action_code: "click_mdse_recom_mdse_cpage",
						ext: {
							type: "down"
						}
					}), t.once(1)
				}).on("click", '[selector="closebkbmlist"]', function() {
					DYS.sub({
						action_code: "click_mdse_recom_mdse_close"
					}), t.hideList()
				}), i.on("click", '[selector="anchorshop"]', function() {
					"javascript:;" != this.href && DYS.sub({
						action_code: "click_mdse_recom_shop"
					})
				}), this.doms.statsNactions.on("click", '[selector="shopbuybtn"]', function(e) {
					t.config.shop.wab_enter_url ? window.open(t.config.shop.wab_enter_url, "_blank") : (t.flags.isListShow || DYS.sub({
						action_code: "click_giftbar_ahrecom"
					}), t.toggleList())
				}), e("#container").on("click", function(i) {
					var a = e(i.target).closest('[selector="pushlist"], [selector="shopbuybtn"], [selector="recomandbtnwrap"]');
					0 === a.length && t.hideList()
				}), i.on("click", '[selector="showbtntoviewerchecker"]', function() {
					var i = e(this),
						a = i.hasClass("status--close") ? 1 : 0;
					t.getCSRFCookie(function(e) {
						var n = {
							flag: a
						};
						n[e.name] = e.value, t.ajax(i, f.showbtnurl, n, function(e, n) {
							i[a ? "removeClass" : "addClass"]("status--close"), t[a ? "showEntryToViewers" : "hideEntryToViewers"]()
						})
					})
				}), i.on("click", '[selector="closerecomandbtn"]', function(e) {
					e.stopPropagation(), DYS.sub({
						action_code: "click_mdse_recom_close"
					}), t.hideEntryToViewers(), r.set(p.entryClosed, 1, m.getRestTime())
				}), i.on("click", '[selector="recomandbtnwrap"]', function(e) {
					t.config.shop.wab_enter_url ? window.open(t.config.shop.wab_enter_url, "_blank") : (DYS.sub({
						action_code: "click_mdse_recom"
					}), t.showList()), t.hideEntryToViewers()
				}), i.on("click", '[selector="closebkbmpushed"]', function() {
					DYS.sub({
						action_code: "click_mdse_hrecom_close"
					}), t.hidePushed(), r.set(p.pusheditemclosed, t.config.shop.push.item_id)
				}), i.on("click", '[selector="changepushed"]', function(i) {
					var a = e(this);
					i.preventDefault(), a.hasClass(u.active) ? (t.setPush(a, 0), t.hidePushed()) : e.dy_dialog("确定实时推送该商品？<br>5分钟后允许更换其他商品", {
						title: "确认框",
						mask: !0,
						buttons: [{
							content: "确定",
							callback: function(e) {
								t.setPush(a, 1), this.hide()
							}
						}, {
							content: "取消",
							callback: function() {
								this.hide()
							}
						}]
					})
				}), i.on("click", '[selector="pushedgoodsitem"]', function() {
					var t = e(this);
					DYS.sub({
						action_code: "click_mdse_hrecom",
						ext: {
							id: t.data("piid"),
							item_id: t.data("id"),
							source_id: t.data("sourceid"),
							it_att: t.data("type")
						}
					})
				}), i.on("click", '[selector="itemlink"]', function() {
					var t = e(this).closest('[selector="productitem"]'),
						i = t.index();
					DYS.sub({
						action_code: "click_mdse_recom_mdse",
						ext: {
							pos: i,
							id: t.data("piid"),
							item_id: t.data("id"),
							source_id: t.data("sourceid"),
							it_att: t.data("type")
						}
					})
				}), i.on("click", '[selector="adlink"]', function() {
					var t = e(this).closest('[selector="productitem"]');
					DYS.sub({
						action_code: "click_mdse_recom_ad",
						ext: {
							ad_id: t.data("id")
						}
					})
				})
			},
			hideList: function() {
				this.flags.isListShow = 0, this.doms.roomVideo.find('[selector="pushlist"]').removeClass("expanded")
			},
			showList: function() {
				var t = this.flags,
					i = this.doms.roomVideo.find('[selector="pushlist"]').addClass("expanded").find('[selector="goodslist"]');
				t.isListShow = 1, t.imgAdded || i.find('[selector="goodsimg"]').each(function() {
					e(this).prepend('<img src="' + e(this).data("img") + '" />')
				}), t.imgAdded = 1, this.config.shop.ad && this.config.shop.ad.ad_id && DYS.sub({
					action_code: "show_mdse_recom_ad",
					ext: {
						ad_id: this.config.shop.ad.ad_id
					}
				})
			},
			toggleList: function() {
				this.flags.isListShow ? this.hideList() : this.showList()
			},
			showEntryToViewers: function() {
				var e = this.doms.roomVideo;
				e.find('[selector="recomandbtnwrap"]').remove(), e.append(this.recomandRender()), setTimeout(function() {
					e.find('[selector="recomandbtnwrap"]').addClass("expanded")
				}, 10)
			},
			hideEntryToViewers: function() {
				this.doms.roomVideo.find('[selector="recomandbtnwrap"]').removeClass("expanded")
			},
			showPushed: function(e) {
				var t = this.doms.roomVideo,
					i = t.find('[selector="pushedgoodsitemwrap"]');
				i.remove(), t.append(this.pushedGoodsRender(e)), setTimeout(function() {
					t.find('[selector="pushedgoodsitemwrap"]').addClass("expanded")
				}, 10)
			},
			showFlashPushed: function(t) {
				var i = this,
					a = i.listObj[i.keyPre + t];
				a ? i.showPushed(a) : e.get(f.getList, {
					room_id: l.get("room.room_id")
				}, function(e) {
					!e.error && e.data && e.data.items && (i.flags.imgAdded = 0, i.renderList(e.data.items, t), i.showPushed(i.listObj[i.keyPre + t]), i.config.shop.push.item_id = t)
				}, "json"), r.remove(p.entryClosed)
			},
			hidePushed: function() {
				this.doms.roomVideo.find('[selector="pushedgoodsitemwrap"]').removeClass("expanded")
			},
			setPush: function(t, i) {
				var a = this,
					n = t.closest('[selector="productitem"]');
				a.getCSRFCookie(function(s) {
					var r = {
						item_id: n.data("id"),
						flag: i
					};
					r[s.name] = s.value, a.ajax(a.doms.roomVideo, f.pushurl, r, function(s, r) {
						e.dialog.tips_black(i ? "推送成功" : "取消成功"), a.setPushStatus(t, n, i)
					})
				})
			},
			setPushStatus: function(e, t, i) {
				this.doms.roomVideo.find('[selector="changepushed"]').removeClass(u.active).find('[selector="pushtext"]').text("实时推送"), i && e.addClass(u.active).find('[selector="pushtext"]').text("取消推送")
			},
			disablePush: function() {
				this.doms.roomVideo.find('[selector="changepushed"]').addClass(u.JSDISABLED)
			},
			enablePush: function() {
				this.doms.roomVideo.find('[selector="changepushed"]').removeClass(u.JSDISABLED)
			},
			once: function(e) {
				e > 0 ? this.currentIndex++ : this.currentIndex--, this.currentIndex > this.listLength - 1 && (this.currentIndex = this.listLength - 1, next.addClass("hide")), this.currentIndex < 0 && (this.currentIndex = 0, prev.addClass("hide")), this.go(this.currentIndex)
			},
			go: function(e) {
				var t = this.doms.roomVideo,
					i = t.find('[selector="prevgoodspage"]').removeClass("hide"),
					a = t.find('[selector="nextgoodspage"]').removeClass("hide"),
					n = t.find('[selector="goodslist"]');
				0 == this.currentIndex ? i.addClass("hide") : this.currentIndex == this.listLength - 1 && a.addClass("hide"), n.stop().animate({
					scrollLeft: e * n.outerWidth()
				})
			},
			ajax: function(t, i, a, n, s) {
				var r = {
					type: s || "post",
					dataType: "json",
					context: t,
					url: i,
					data: a,
					beforeSend: function() {
						this.addClass(u.JSLOADING)
					},
					complete: function() {
						this.removeClass(u.JSLOADING)
					},
					error: function() {
						e.dialog.tips_black("操作失败，请稍候重试！")
					},
					success: function(i) {
						i.error ? 1 == i.error && e.dialog.tips_black(i.msg) : n(t, i)
					}
				};
				t.hasClass(u.JSLOADING) || e.ajax(r)
			},
			getCSRFCookie: function(t) {
				var i = this,
					a = l.get("sys.tn"),
					n = o.get(l.get("sys.tvk"));
				return n ? void(t && t({
					name: a,
					value: n
				})) : void e.ajax({
					url: "/curl/csrfApi/getCsrfCookie",
					type: "GET",
					dataType: "json",
					success: function(e) {
						0 === e.error && i.getCSRFCookie(t)
					}
				})
			}
		};
	return {
		init: function() {
			var e = l.get("sys.uid"),
				t = l.get("room.owner_uid"),
				a = Number(e) === Number(t),
				s = l.get("room.wab");
			h.init({
				isCurrentAnchor: a,
				shop: s
			}), i.on("mod.video.state.flashlivestate", function(e) {
				e = n.decode(e).too(), 1 == e.code && a && h.disablePush()
			}), d.reg("room_data_hideshopbtn", function() {
				h.hideEntryToViewers()
			}), d.reg("room_data_handler", function(e) {
				var t = n.decode(e).too();
				"wab" == t.type && ("1" == t.a ? h.hidePushed() : t.item_id && "0" == t.a && h.showFlashPushed(t.item_id), r.remove(p.pusheditemclosed))
			})
		}
	}
}), define("douyu/page/room/normal/mod/anchor-dynamic", ["jquery", "shark/util/storage/1.0", "douyu/context", "douyu/com/user", "douyu/com/insight"], function(e, t, i, a, n) {
	var s = {
		urls: {
			yuba: i.get("sys.yubaDomain").replace(/^http(s?):/, "").replace(/\/$/g, "")
		},
		storName: "anchordynamic50%",
		init: function() {
			var i = this,
				a = t.get(i.storName);
			this.doms = {
				anchorDynamic: e("#js-room-anchor-dynamic")
			}, !a && this.doms.anchorDynamic.length && n.build({
				selectors: this.doms.anchorDynamic,
				appear: function() {
					i.render(), i.bindEvents()
				}
			}), t.set(i.storName, !a)
		},
		getUrl: function() {
			return this.urls.yuba + "/api/dy/anchor/newgetAnchorpost?room_id=" + i.get("room.room_id") + "&parent_url=" + encodeURIComponent(location.protocol + "//" + location.host)
		},
		render: function() {
			this.doms.anchorDynamic.append('<iframe class="anchor-dynamic" src="' + this.getUrl() + '" frameborder="0"></iframe>')
		},
		bindEvents: function() {
			var e = this,
				t = e.doms.anchorDynamic.find("iframe"),
				i = function(e) {
					var i = e || window.event;
					i.source === t[0].contentWindow && ("showanchorpost" === i.data ? t.show() : "showlogin" === i.data && a.show("login"))
				};
			window.addEventListener ? window.addEventListener("message", i) : window.attachEvent ? window.attachEvent("onmessage", i) : window.onMessage = i
		}
	};
	return {
		init: function() {
			s.init()
		}
	}
}), define("douyu/page/room/normal/mod/yz-rank-info", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/flash/data/1.0", "shark/util/template/2.0", "douyu/context", "douyu/page/room/base/api", "douyu/com/sign"], function(e, t, i, a, n, s, r, o) {
	var l = {
		webUrl: s.get("sys.web_url"),
		uploadUrl: s.get("sys.upload_url"),
		signUrl: s.get("sys.sign_url"),
		time: new Date,
		timeCha: 0,
		serverRefresh: 0,
		adImgSrc: "",
		currAnRankInfo: {},
		posid: 40010,
		currAdInfo: {},
		getFlashMsg: !1
	},
		c = {
			tools: {
				serverTime: function() {
					var e, t, i = new Date(l.time),
						a = i.getDay(),
						n = i.getHours() > 1 ? 1 : 0;
					a = 0 === a ? 7 : a, e = 0 === n && 1 === a ? 0 : 8 - a - n, i.setDate(i.getDate() + e + n), i.setHours(1), i.setMinutes(0), i.setSeconds(0), t = i.getTime(), l.serverRefresh = t
				},
				timeAddZero: function(e) {
					return 10 > e ? "0" + e : e
				},
				changeTime: function(e) {
					var t = c.tools,
						i = {
							day: 864e5,
							hour: 36e5,
							minute: 6e4
						},
						a = e,
						n = {},
						s = {},
						r = "",
						o = {};
					return o.second = a / 1e3, o.minute = o.second / 60, o.hour = o.minute / 60, o.day = o.hour / 24, n.day = parseInt(o.day, 10), n.hour = parseInt(o.hour, 10) % 24, n.minute = parseInt(o.minute, 10) % 60, n.second = parseInt(o.second, 10) % 60, a >= i.day ? s.day = s.hour = s.minute = s.second = !0 : a >= i.hour && a < i.day ? s.hour = s.minute = s.second = !0 : a >= i.minute && a < i.hour ? s.minute = s.second = !0 : s.second = !0, s.day && (r += n.day + "天"), s.hour && (n.hour = s.day ? t.timeAddZero(n.hour) : n.hour, r += n.hour + "小时"), s.minute && (n.minute = s.hour ? t.timeAddZero(n.minute) : n.minute, r += n.minute + "分"), s.second && (n.second = s.minute ? t.timeAddZero(n.second) : n.second, r += n.second + "秒"), r
				},
				timeStr: function() {
					var e = c.tools,
						t = l.serverRefresh - ((new Date).getTime() + l.timeCha);
					t = 0 > t ? t + 6048e5 : t;
					var i = e.changeTime(t);
					return i
				},
				showWan: function(e) {
					var t = Number(e),
						i = "约",
						a = "";
					return t > 1e4 ? (a = "万", t = (t / 1e4).toFixed(1), parseInt(t, 10) == t && (t = parseInt(t, 10))) : t = parseInt(t, 10), i + t + a
				}
			},
			init: function() {
				l.getFlashMsg || (l.getFlashMsg = !0, c.listen())
			},
			listRender: function(e, t) {
				var a = this.tools.changeTime(l.time),
					s = i.string.join('<div class="yz-week-mask" id="yz-week-mask">', '<div class="yz-week-modal">', '<div class="yz-week-modal-wrap">', '<div class="yz-week-close" data-type-yz="close-btn">', '<a href="javascript:;">×</a>', "</div>", '<div class="yz-week-content">', '<div class="clearfix">', '<div class="yz-week-title">', "<h2>颜值周星榜</h2>", '<div class="yz-week-text">', '<p>每周重置榜单 <span>倒计时：<em data-type-yz="time">{{ time }}</em></span></p>', "</div>", "</div>", '<a class="yz-link-more" href="/directory/rank_list/yz" target="_blank" data-type-yz="rank-more">更多榜单&gt;&gt;</a>', "</div>", "{{ if adInfo }}", '<div class="yz-week-banner {{cTrackClass}}" id="yz-week-banner" data-dysign="40010" data-dysign-mid="{{adInfo.mid}}" data-dysign-gid="{{adInfo.gid}}">', '<a class="yz-week-link" href="{{ if adInfo.link }}{{ adInfo.link }}{{ else }}javascript:void(0){{ /if }}" {{ if adInfo.link }}target="_blank"{{ /if }}>', '<img src="{{ adInfo.src }}">', "</a>", "</div>", "{{ /if }}", '<div class="yz-wrap">', '<div class="yz-rank-list">', '<p class="yz-week-text">榜单数据每分钟更新一次</p>', '<ul data-type-yz="main-rank">', "{{ each mainData as item index }}", '<li class="{{ if index % 2 === 1 }}yz-bg{{ /if }} {{ if item.isCurr == 1}}yz-current{{ /if }}">', '<a class="yz-col-left" href="{{ item.href }}" {{ item.target }}  {{ if item.cursor }} style="cursor: default;" {{/if}}>', '<span class="yz-contrib">{{ item.strGxz.strGxz1 }}<em class="yz-contrib-value">{{ item.strGxz.strGxz2 }}</em>{{ item.strGxz.strGxz3 }}</span>', '<div class="yz-wp-left">', '<span class="yz-index">{{ item.idx }}</span>', '<span class="yz-zhubo">', '<img src="{{ item.src }}" />', '<em class="yz-zhubo-icon"></em>', "</span>", "<p {{ item.title }}>{{ item.owner_name }}</p> ", '<div class="play-status {{ if item.isLive == 0 }}  yz-stop {{ /if }}">', "{{ if item.isLive == 1}}", '<span class="yz-play"></span> ', "{{ /if }}", '<span class="yz-fenqu">{{ item.zone }}</span> ', "</div>", "</div>", "</a>", "</li>", "{{ /each }}", "</ul>", "</div>", "</div>", "</div>", "</div>", "</div>", '<div class="yz-week-mask-holder"></div>', "</div>"),
					r = n.compile(s),
					o = "";
				t.cTrackUrl && t.cTrackUrl.length > 0 && (o = "js-monitor-sign");
				var c = r({
					mainData: e,
					adInfo: t,
					cTrackClass: o,
					time: a
				});
				return c
			},
			layout: function(t) {
				var i = this,
					a = e("#container"),
					n = i.listRender(t.mainData, t.adInfo);
				a.append(e(n)), l.exposure || (l.exposure = !0, o.exposure()), i.bindEvent()
			},
			sendAjax: function(t, i) {
				var a = t.url,
					n = t.type || "GET",
					s = t.data || {},
					r = i || {},
					o = r.success || e.noop,
					l = r.error || e.noop;
				a && e.ajax({
					url: a,
					type: n,
					data: s,
					dataType: "json",
					success: o,
					error: l
				})
			},
			handleData: {
				hasCurrAn: !1,
				currAuIndex: -1,
				findCurrAn: function(e) {
					for (var t = this, i = 0, a = e || [], n = a.length, r = s.get("room.room_id"); n > i; i++) r == a[i].rid ? (a[i].isCurr = 1, t.currAuIndex = i, t.hasCurrAn = !0) : a[i].isCurr = 0
				},
				gxzHandle: function(e) {
					for (var t = e, i = c.handleData.currAuIndex, a = t[i].credit, n = "", s = "", r = "", o = [], l = 0, d = t.length, u = c.tools.showWan; d > l; l++) i > l ? (n = "落后", s = u(Math.abs(t[l].credit - a)), r = "贡献值") : l === i ? (n = r = "", s = "当前主播") : (n = "领先", s = u(Math.abs(t[l].credit - a)), r = "贡献值"), t[l].strGxz = {
						strGxz1: n,
						strGxz2: s,
						strGxz3: r
					};
					return o
				},
				aHandle: function(e) {
					for (var t = e || [], i = s.get("room.owner_name"), a = 0; 7 > a; a++) {
						if (t[a].rid && t[a].owner_name !== i) {
							var n = t[a].vipId ? +t[a].vipId : 0,
								r = n ? n : t[a].rid || "";
							t[a].href = r ? "/" + r : "javascript:void(0)", t[a].target = "target=_blank"
						} else t[a].href = "javascript:void(0)", t[a].title = "";
						t[a].title = "title=" + t[a].owner_name
					}
					return t
				},
				dataLess: function(e) {
					var t = e || [],
						i = t.length,
						a = 0,
						n = 0;
					if (c.handleData.hasCurrAn) c.handleData.gxzHandle(t);
					else for (; i > n; n++) t[n].strGxz = {
						strGxz1: "",
						strGxz2: "",
						strGxz3: ""
					};
					for (; i++ < 7;) t.push({
						idx: i,
						rid: "",
						owner_name: "虚位以待",
						src: l.webUrl + "/app/douyu/res/page/room-normal/yzmodal/yz_zhubo_pic_default.png?20170317",
						isCurr: "0",
						isLive: "0",
						zone: "",
						strGxz: {
							strGxz1: "",
							strGxz2: "",
							strGxz3: ""
						},
						cursor: !0
					});
					if (!c.handleData.hasCurrAn) if (l.currAnRankInfo.idx <= 7) {
						for (t.splice(l.currAnRankInfo.idx - 1, 0, l.currAnRankInfo), c.handleData.currAuIndex = l.currAnRankInfo.idx - 1, t.length = 7; 7 > a; a++) t[a].idx = a + 1;
						c.handleData.gxzHandle(t)
					} else t[6] = l.currAnRankInfo;
					return t
				},
				returnData: function(e) {
					var t = [];
					return c.handleData.findCurrAn(e), t = c.handleData.dataLess(e), c.handleData.aHandle(t)
				}
			},
			listAjaxCb: {
				success: function(t) {
					var i, a = {},
						n = [];
					t.data && (a = t.data, n = c.handleData.returnData(a), i = l.currAdInfo && e.isEmptyObject(l.currAdInfo) ? !1 : l.currAdInfo, c.layout({
						mainData: n,
						adInfo: i
					}))
				},
				error: function() {
					e.dialog.tips_black("网络故障，请稍后重试"), l.getFlashMsg = !1
				}
			},
			timeAjaxCb: {
				success: function(e) {
					0 === parseInt(e.error, 10) && (l.time = e.time, l.timeCha = e.time - new Date), c.tools.serverTime(), c.getRankDate()
				},
				error: function() {
					c.getRankDate()
				}
			},
			adAjaxCb: {
				success: function(e) {
					var t = [];
					if (0 === parseInt(e.error, 10)) {
						if (t = e.data[0] ? e.data[0] : [], t.srcid && t.link) {
							var i = t.srcid,
								a = o.helper.innerPath(i);
							l.currAdInfo.src = a, l.currAdInfo.link = t.link, l.currAdInfo.gid = t.gid, l.currAdInfo.mid = t.mid, l.currAdInfo.cTrackUrl = t.c_track_url, l.currAdInfo.iTrackUrl = t.i_track_url;
							var n = new Image;
							n.src = l.currAdInfo.src
						}
						o.helper.pushPageAdvar(e.data)
					} else l.currAdInfo = {}
				},
				error: function() {
					l.currAdInfo = {}
				}
			},
			getRankDate: function() {
				var e = {
					url: "/rank/weekRank/yanzhiRankList"
				};
				c.sendAjax(e, c.listAjaxCb)
			},
			getAdData: function() {
				for (var e = window._pageadvar || [], t = e.length, i = 0, a = l.posid, n = {}; t > i; i++) if (a == e[i].posid) {
					if (e[i].srcid && e[i].link) {
						var s = e[i].srcid,
							r = o.helper.innerPath(s);
						n = {
							src: r,
							link: e[i].link,
							gid: e[i].gid,
							mid: e[i].mid,
							cTrackUrl: e[i].c_track_url,
							iTrackUrl: e[i].i_track_url
						};
						var c = new Image;
						c.src = n.src
					}
					break
				}
				return n
			},
			getAdDataInfo: function() {
				var e = this,
					t = o.helper.buildSignApi(l.posid),
					i = "/lapi/sign/signapi/getinfo";
				$SYS && $SYS.sign_newver && (i = "/japi/sign/web/getinfo");
				var a = {
					url: i,
					type: "POST",
					data: t
				};
				e.sendAjax(a, e.adAjaxCb)
			},
			getTimeStr: function(t) {
				var i = this,
					a = c.tools.timeStr();
				e(t).text(a), setTimeout(function() {
					i.getTimeStr(t)
				}, 1e3)
			},
			bindEvent: function() {
				var i = this,
					a = e("#yz-week-mask");
				i.getTimeStr(a.find('[data-type-yz="time"]')), a.on("click", '[data-type-yz="close-btn"]', function() {
					a.fadeOut("500", function() {
						a.remove(), l.getFlashMsg = !1
					})
				}), a.on("click", '[data-type-yz="rank-more"]', function() {
					t.trigger("dys", {
						key: "dys.room.yzRank.rankMore.click"
					})
				}), a.on("click", 'ul[data-type-yz="main-rank"] li', function() {
					"javascript:void(0)" !== e(this).find("a").attr("href") && t.trigger("dys", {
						key: "dys.room.yzRank.mainAnthor.click"
					})
				})
			},
			listen: function() {
				var e = this;
				window._pageadvar ? l.currAdInfo = c.getAdData() : e.getAdDataInfo();
				var t = {
					url: "/lapi/member/ticker"
				};
				e.sendAjax(t, e.timeAjaxCb)
			}
		};
	r.reg("data_rank_num", function(t) {
		var i = a.decode(t).too();
		"rri" === i.type && (i.ri = a.decode(i.ri).too(), (!i.ri.idx || parseInt(i.ri.idx, 10) <= 0) && (i.ri.idx = "暂无排名"), l.currAnRankInfo = e.extend(!0, {}, i, i.ri), l.currAnRankInfo.strGxz = {
			strGxz1: "",
			strGxz2: "当前主播",
			strGxz3: ""
		}, l.currAnRankInfo.isCurr = 1, l.currAnRankInfo.isLive = 1, l.currAnRankInfo.owner_name = s.get("room.owner_name"), l.currAnRankInfo.src = s.get("room.avatar.middle"), l.currAnRankInfo.zone = s.get("room.second_lvl_name"), l.currAnRankInfo.credit = l.currAnRankInfo.sc)
	}), r.reg("room_show_yz_rank", c.init)
}), define("douyu/page/room/normal/mod/jifen", ["jquery", "shark/observer", "shark/util/lang/1.0", "shark/util/template/1.0", "shark/util/storage/1.0", "shark/util/cookie/1.0", "shark/util/flash/data/1.0", "shark/util/date/1.0/date", "douyu/context", "douyu/com/user", "douyu/com/exjsonp", "douyu/com/imgp", "douyu/page/room/base/api"], function(e, t, i, a, n, s, r, o, l, c, d, u, f) {
	var p = l.get("sys.webconfUrl"),
		m = l.get("sys.web_url"),
		h = l.get("room.levelInfo"),
		g = {
			officalDef: m + "app/douyu/res/page/room-normal/room-jifen/official_gift_default.jpg?20171102",
			anchorDef: m + "app/douyu/res/page/room-normal/room-jifen/anchor_gift_default.jpg?20171102"
		},
		v = {
			jifenConfig: null,
			siwtchStatus: null,
			url: p + "resource/common/points/config_web.json",
			init: function() {
				v.getConfig(function(e) {
					v.siwtchStatus = v.getAnchorRights(e), v.initJifenView()
				})
			},
			initJifenView: function() {
				v.siwtchStatus && (+$ROOM.owner_uid === +$SYS.uid ? b.init() : y.init())
			},
			getConfig: function(e) {
				v.jifenConfig ? e(v.jifenConfig) : d.load(v.url, "jifenConfig", function(t) {
					v.jifenConfig = t, e(t)
				})
			},
			crsf: "/curl/csrfApi/getCsrfCookie",
			getCSRFCookie: function(t) {
				var i = s.get(l.get("sys.tvk"));
				return i ? void(t && t({
					name: $SYS.tn,
					value: i
				})) : void e.ajax({
					url: v.crsf,
					type: "GET",
					dataType: "json",
					success: function(e) {
						0 === +e.error && v.getCSRFCookie(t)
					}
				})
			},
			getAnchorRights: function(t) {
				var i = !1;
				return 0 === +t.main_switch ? i : (e.each(t.room_whitelist || [], function(e, t) {
					return t == $ROOM.room_id ? (i = !0, !1) : void 0
				}), i ? i : (e.each(t.tag_whitelist || [], function(e, t) {
					return t == $ROOM.cate_id ? (i = !0, !1) : void 0
				}), i && +t.min_level > +h.level ? i = !1 : i))
			}
		},
		y = {
			ajaxLoadDelay: 1e4,
			marqueeTimer: 0,
			ajaxLoadStatus: 0,
			init: function() {
				y._inited || (y._inited = !0, y.cache = {
					dynamic: null,
					tasks: null,
					online: null,
					activeTab: "goods",
					mineNum: 0,
					followed: 0
				}, a.helper("secondFormat", function(e) {
					return o.format(new Date(1e3 * parseInt(e)), "yyyy-MM-dd hh:mm")
				}), y.$container = e("#container"), y.addTriggerBtn(), y.addEvent())
			},
			addTriggerBtn: function() {
				var i = this,
					a = e('<div class=" js-jifen-enter-wrap"><div class="jifen-enter-btn"></div></div>');
				t.trigger("mod.chat.action.view.add", {
					flag: "jifen",
					dom: a,
					tips: "礼品兑换中心"
				}), a.show(), i.userGuideShow()
			},
			addEvent: function() {
				var i = y.$container;
				f.reg("room_data_handler", function(e) {
					var t = r.decode(e).too();
					"online_task_notify" === t.type && (y.cache.online = t, y.userOnlineTaskRender())
				}), t.on("room.anchor.follow.change", y.userFollowUpdate), i.on("click", ".jifen-enter-btn", function() {
					return t.trigger("dys", {
						key: "dys.room.jifen.giftbtn.click"
					}), c.check() ? void(y.$dialog || (y.userCenterRender(), y.userDynamicResponse(), "goods" === y.cache.activeTab ? (y.userGoodsResponse(), y.userGoodsShow()) : (y.userTaskResponse(), y.userTaskShow()))) : void c.show("login")
				}), i.on("click", ".ujifen-goods-tab", function() {
					e(this).hasClass("active") || (y.cache.activeTab = "goods", y.userGoodsResponse(), y.userGoodsShow(), y.$dialog.find(".ujifen-task-tab").removeClass("active"), e(this).addClass("active"))
				}), i.on("click", ".ujifen-task-tab ", function() {
					e(this).hasClass("active") || (y.cache.activeTab = "task", y.userTaskResponse(), y.userTaskShow(), y.$dialog.find(".ujifen-goods-tab").removeClass("active"), e(this).addClass("active"))
				}), i.on("click", ".ujifen-dialog .close-btn", function() {
					y.userCenterDestroy()
				}), i.on("click", ".ujifen-taball-content .prev-btn:not(.disabled)", function() {
					y.changePrevGoods()
				}), i.on("click", ".ujifen-taball-content .next-btn:not(.disabled)", function() {
					y.changeNextGoods()
				}), i.on("click", ".ujifen-record-content .prev-btn:not(.disabled)", function() {
					y.changePrevRecord()
				}), i.on("click", ".ujifen-record-content .next-btn:not(.disabled)", function() {
					y.changeNextRecord()
				}), i.on("click", ".ujifen-goods-item .goods-btn:not(.disabled)", function() {
					var t = e(this).closest(".ujifen-goods-item").data();
					y.exchangeGoodsConfirm(t)
				}), i.on("click", ".ujifen-dialog .ujifen-anchor-btn", function() {
					y.userRecordShow()
				}), i.on("click", ".ujifen-dialog .ujifen-back", function() {
					y.userRecordHide()
				}), i.on("click", ".ujifen-dialog .select-month", function() {
					y.$dialog.find(".selected-month").removeClass("selected-month"), e(this).addClass("selected-month");
					var t = e(this).text();
					y.$dialog.find(".ujifen-calender-current .current-text").html(t), y.userRecordReponse(1)
				}), i.on("click", ".ujifen-byfollow .ujifen-task-btn:not(.no-follow,.complete)", function() {
					var t = e(this),
						i = t.data("taskid");
					y.getTaskJiFen(i, function(e) {
						y.cache.tasks && (y.cache.tasks.follow = []), y.showGetPointTips(t, e.tp), t.addClass("complete"), t.text("已领取")
					})
				}), i.on("click", ".ujifen-byfollow .no-follow", function() {
					y.response({
						url: "/room/follow/add/" + $ROOM.room_id,
						type: "post",
						dataType: "text",
						data: {
							room_id: $ROOM.room_id
						},
						success: function(e) {
							"ok" === e && (y.userFollowUpdate(1), t.trigger("room.anchor.follow.change", 1))
						}
					})
				}), i.on("click", ".ujifen-bywatch .ujifen-task-btn:not(.not-satisfy)", function() {
					var t = e(this).data("taskid");
					y.getOnlineJiFen(t)
				}), i.on("click", ".ujifen-bydownload .js-task-download", function() {
					var t = e(this).data();
					y.showTaskDownload(t)
				}), i.on("click", ".ujifen-bydownload .js-task-complete", function() {
					var t = e(this),
						i = t.data("taskid"),
						a = t.data("index");
					y.getTaskJiFen(i, function(e) {
						t.text("已领取").removeClass("js-task-complete").addClass("complete"), y.cache.tasks.games[a].taskStatus = 2, y.showGetPointTips(t, e.tp)
					})
				})
			},
			showGetPointTips: function(t, i) {
				e.dialog.tips_black("恭喜您领取了" + i + "积分")
			},
			exchangeGoodsConfirm: function(t) {
				var i = '确定要使用<span class="dydialog-ujifen-cf70">' + t.point + "</span>积分兑换";
				4 === +t.type && (i += '<div class="ujifen-exchange-tips">积分勋章仅在兑换直播间展示，<br>发言时可见，有效期30天，可累计；</div>'), e.dy_dialog(i, {
					title: "兑换信息提示",
					mask: !0,
					buttons: [{
						content: "确定",
						callback: function(e) {
							y.exchangeGoods(t), this.hide()
						}
					}, {
						content: "取消",
						callback: function(e) {
							this.hide()
						}
					}]
				})
			},
			exchangeGoods: function(i) {
				y.response({
					url: "/member/point_user/exchangeGift",
					type: "post",
					data: {
						md5_id: i.mid,
						room_id: $ROOM.room_id
					},
					success: function(a) {
						if (0 === +a.error) {
							var n = '<span class="dydialog-ujifen-succ"></span>恭喜你兑换成功<br>';
							n += 1 == i.otype ? "可在“站内信”中查看信息详情" : "主播已私信你，请快去填写收货地址吧~", e.dy_dialog(n, {
								title: "兑换成功",
								mask: !0,
								buttons: [{
									content: "我知道了",
									callback: function(e) {
										this.hide()
									}
								}]
							}), a.data && (y.userJiFenUpdate(a.data.point), "undefined" != typeof a.data.silver && t.trigger("mod.userinfo.change", {
								current: {
									silver: a.data.silver
								}
							})), y.userGoodsUpdate(i)
						} else e.dialog.tips_black(a.data || "兑换失败")
					},
					error: function() {
						e.dialog.tips_black("网络错误")
					}
				})
			},
			userGoodsUpdate: function(e) {
				var t = y.$dialog.find(".ujifen-goods-item[data-mid=" + e.mid + "]"),
					i = t.find(".goods-stock-num"),
					a = i.text() || 0;
				a = a > 0 ? a - 1 : a, i.text(a), 0 === a && t.find(".goods-btn").addClass("disabled")
			},
			changePrevGoods: function() {
				var e = y.$dialog.find(".ujifen-taball-content .ujifen-pagebar"),
					t = e.data("page") || 1;
				t > 1 && (t -= 1), y.userGoodsResponse(t)
			},
			changeNextGoods: function() {
				var e = y.$dialog.find(".ujifen-taball-content .ujifen-pagebar"),
					t = e.data("page") || 1,
					i = e.data("size");
				i > t && (t += 1), y.userGoodsResponse(t)
			},
			response: function(t) {
				var i = e.extend({
					dataType: "json",
					type: "get",
					error: function() {}
				}, t);
				"post" === i.type ? v.getCSRFCookie(function(t) {
					e.extend(i, t), e.ajax(i)
				}) : e.ajax(i)
			},
			userGoodsResponse: function(e) {
				var t = e || 1;
				y.response({
					url: "/member/point_user/getAnchorStoreGiftList",
					type: "post",
					data: {
						room_id: $ROOM.room_id,
						page: t
					},
					success: function(e) {
						0 === +e.error && (y.cache.pageIndex = t, y.userGoodsRender(e.data))
					}
				})
			},
			userGoodsShow: function() {
				y.$dialog.find(".js-ujifen-goods-box").show(), y.$dialog.find(".js-ujifen-task-box").hide()
			},
			userDynamicResponse: function() {
				y.response({
					url: "/point/gift/getExchangeDynamicTop10",
					type: "post",
					data: {
						room_id: $ROOM.room_id
					},
					success: function(e) {
						0 === +e.error && (y.cache.dynamic = e.data || [], y.userDynamicRender(e.data))
					}
				})
			},
			userDynamicRender: function(e) {
				if (0 !== y.cache.dynamic.length) {
					var t = i.string.join('<div class="ujifen-dynamic-desc"><span class="icon"></span>大家都在兑换</div>', '<div class="ujifen-dynamic-cont">', '<ul class="ujifen-dynamic-list">', "<% for( var i=0; i< list.length ;i ++) {%>", "<% var item = list[i]; %>", '<li class="ujifen-dynamic-item">', '<div class="exchange-user">', '<span class="user-name ellipsis" title="<%= item.nickname%>"><%= item.nickname%></span>', '<span class="user-desc">兑换了</span>', "</div>", '<div class="exchange-name ellipsis" title="<%= item.name %>"><%= item.name %></div>', "</li>", "<%}%>", "</ul></div>"),
						n = a.compile(t),
						s = n({
							list: y.cache.dynamic
						});
					y.$dialog.find(".ujifen-exchange-dynamic").html(s), y.createMarquee(y.$dialog.find(".ujifen-dynamic-list"))
				}
			},
			createMarquee: function(e) {
				var t = e.find(".ujifen-dynamic-item");
				t.length > 3 && (clearInterval(y.marqueeTimer), e.append(t.clone()), y.marqueeTimer = setInterval(function() {
					t = e.find(".ujifen-dynamic-item"), e.animate({
						marginTop: -165
					}, 600, function() {
						e.append(t.slice(0, 3)), e.css("marginTop", 0)
					})
				}, 6e3))
			},
			userGoodsRender: function(e) {
				y.$dialog.find(".ujifen-goods-box").mCustomScrollbar("destroy");
				var t = i.string.join('<div class="ujifen-goods-box">', "<%if (list.length == 0){%>", '<div class="ujifen-nogoods "></div>', "<% } else {%>", '<ul class="ujifen-goods-list clearfix">', "<% for( var i=0; i< list.length ;i ++) {%>", "<% var item = list[i]; %>", '<li class="ujifen-goods-item" ', ' data-mid="<%= item.md5_id %>"', ' data-point="<%= item.point %>"', ' data-otype="<%= item.type_is_official %>"', ' data-type="<%= item.type %>"', ' data-num="<%= item.remain_number %>"', ' data-gid="<%= item.gid %>">', '<img class="goods-img" data-original="<%= item.pic %>" src="<%= item.type_is_official == 1 ? official : anchor %>" >', "<% if(item.user_type == 2){ %>", '<div class="goods-type-fans">粉丝专属</div>', "<%}%>", '<div class="goods-name" title="<%= item.name %>">', "<% if( item.type_is_official == 1){ %>", '<span class="goods-type-official">官方</span>', "<% } else {%>", '<span class="goods-type-anchor">主播提供</span>', "<%}%>", "<%= item.name %>", "</div>", '<div class="goods-cost">积分', '<span class="goods-cost-num"><%= item.point %></span>', "</div>", "<% if(item.status == 1) {%>", '<div class="goods-stock">库存', '<span class="goods-stock-num"><%= item.remain_number %></span>', "</div>", "<% } else if (item.status == 3) {%>", '<div class="goods-stop">已停售</div>', "<%}%>", '<div class="goods-btn <%= item.remain_number == 0 || item.status == 3 ? "disabled" : "" %>">兑换</div>', "</li>", "<%}%>", "</ul>", "<%}%>", "</div>", y.userPageRender()),
					n = Math.ceil(e.total / e.limit),
					s = a.compile(t),
					r = s({
						list: e.list,
						size: n,
						page: e.page,
						official: g.officalDef,
						anchor: g.anchorDef
					});
				y.$dialog.find(".js-ujifen-goods-box").html(r), y.$dialog.find(".ujifen-goods-box").mCustomScrollbar(), y.userJiFenUpdate(e.point), u.build()
			},
			userPageRender: function() {
				var e = i.string.join('<div class="ujifen-pagebar <%= size <=1 ?"hide":"" %>"', ' data-page="<%= page %>" data-size="<%= size %>">', '<span class="prev-btn <%= page === 1 ? "disabled" : ""%>">上一页</span>', '<span class="page-num">', '<span class="current"><%= page %></span>/<span class="total"><%= size %></span>', "</span>", '<span class="next-btn <%= page== size ? "disabled" : "" %>">下一页</span>', "</div>");
				return e
			},
			userTaskResponse: function() {
				y.cache.tasks && 0 !== y.ajaxLoadStatus ? y.userTaskRender(y.cache.tasks) : y.response({
					url: "/member/point_task/getTaskList",
					data: {
						room_id: $ROOM.room_id
					},
					success: function(e) {
						0 === +e.error && (y.cache.tasks = e.data, e.data.st && (y.cache.online = e.data.st), y.userTaskFilter(e.data), y.userTaskRender(e.data))
					}
				}), y.ajaxLoadStatus = 1, setTimeout(function() {
					y.ajaxLoadStatus = 0
				}, y.ajaxLoadDelay)
			},
			userTaskFilter: function(e) {
				for (var t = 0; t < e.games.length; t++) {
					var a = e.games[t];
					if (a.taskName = "", a.taskStatus = 0, a.ios_task && a.ios_task.length > 0) {
						a.ios_task = a.ios_task[0], a.taskName = a.ios_task.name, +a.ios_task.status && (a.taskStatus = 1), a.ios_task.task_id && (a.taskid = a.ios_task.task_id), a.ios_task.point && (a.point = a.ios_task.point), a.ioslink = a.ios_link + (-1 !== a.ios_link.indexOf("?") ? "&" : "?"), a.ioslink += "callback=";
						var n = i.string.format("app_id={0}&room_id={1}&uid={2}", a.ios_app_id, $ROOM.room_id, $SYS.uid); - 1 === a.callback.indexOf("?") ? a.ioslink += encodeURIComponent(a.callback + "?" + n) : a.ioslink += encodeURIComponent(a.callback + "&" + n)
					}
					a.android_task && a.android_task.length > 0 && (a.android_task = a.android_task[0], a.taskName = a.android_task.name, +a.android_task.status && (a.taskStatus = 1), a.android_task.task_id && (a.taskid = a.android_task.task_id), a.android_task.point && (a.point = a.android_task.point), a.androidlink = a.android_task.link)
				}
			},
			userTaskShow: function() {
				y.$dialog.find(".js-ujifen-goods-box").hide(), y.$dialog.find(".js-ujifen-task-box").show()
			},
			userTaskRender: function(e) {
				y.$dialog.find(".ujifen-task-content").mCustomScrollbar("destroy");
				var t = i.string.join('<div class="ujifen-task-content">', '<div class="ujifen-task-list">', '<div class="ujifen-task-item ujifen-bygift">', '<div class="ujifen-task-intro">', '<span class="icon"></span>', '<span class="task-title">送礼物获积分</span>', '<span class="title-more">送<span class="bygift-yc"><%= gift.num %>鱼翅</span>可以获得<span class="get-num"><%= gift.point %></span>积分</span>', "</div>", "</div>", '<div class="ujifen-task-item ujifen-bywatch hide">', "</div>", "<%if (follow && follow.length !== 0) {%>", '<div class="ujifen-task-item ujifen-byfollow" data-point="<%= follow.point %>">', '<div class="ujifen-task-intro">', '<span class="icon"></span>', '<span class="task-title">关注该主播</span>', '<span class="title-more">', '<span class="get-num">+<%= follow.point %>积分</span>', "</span>", "</div>", '<div data-taskid="<%= follow.task_id %>" class="ujifen-task-btn ', '<%= follow.status == 0 ? "no-follow" : follow.status == 2 ? "complete" : "" %>">', '<%= follow.status == 0 ? "关注" : follow.status ==1 ? "领取" : "已领取" %>', "</div>", "</div>", "<%}%>", "<% for( var i = 0; i< games.length ; i ++ ) { %>", "<% var item = games[i]; %>", '<div class="ujifen-task-item ujifen-bydownload" data-point="<%= item.point %>">', '<div class="ujifen-task-intro">', '<img class="ujifen-task-icon" src="<%= item.icon%>">', '<span class="task-title"><%= item.taskName %></span>', '<span class="title-more">', '<span class="get-num">+<%= item.point %>积分</span>', "</span>", "</div>", '<div class="ujifen-bydownload-remark">', "*本房间下载的游戏，只能在本房间领取积分", "</div>", "<% if(item.taskStatus == 0) {%>", '<div class="ujifen-task-btn js-task-download"', ' data-androidlink="<%= item.androidlink %>"', ' data-ioslink="<%= item.ioslink %>">下载</div>', "<%} else if(item.taskStatus == 1){%>", '<div class="ujifen-task-btn js-task-complete" data-taskid="<%= item.taskid%>" data-index="<%= i %>">领取</div>', "<%} else {%>", '<div class="ujifen-task-btn complete">已领取</div>', "<%}%>", "</div>", "<% } %>", "</div>", "</div>", "</div>"),
					n = a.compile(t),
					s = n(e);
				y.$dialog.find(".js-ujifen-task-box").html(s), y.userOnlineTaskRender(), y.userFollowUpdate(y.cache.followed || 0), y.$dialog.find(".ujifen-task-content").mCustomScrollbar()
			},
			showTaskDownload: function(t) {
				var i = [];
				t.ioslink && i.push('<span class="ujifen-ios-download"><div class="qrcode"></div><div class="os-text">【IOS】</div></span>'), t.androidlink && i.push('<span class="ujifen-android-download"><div class="qrcode"></div><div class="os-text">【Android】</div></span>'), i.push("<div>请用手机“扫一扫”下载</div>"), e.dy_dialog(i.join(""), {
					title: "下载应用",
					mask: !0,
					onInit: function() {
						t.ioslink && y.renderQRcode(e(".ujifen-ios-download .qrcode"), t.ioslink), t.androidlink && y.renderQRcode(e(".ujifen-android-download .qrcode"), t.androidlink)
					}
				})
			},
			renderQRcode: function(t, i) {
				var a = "Microsoft Internet Explorer" == navigator.appName && parseInt(navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/)[1]) < 9 ? "table" : "canvas";
				e(t).qrcode({
					render: a,
					width: 110,
					height: 110,
					text: i
				})
			},
			userFollowUpdate: function(e) {
				if (y.cache.followed = +e || 0, y.$dialog) {
					var t = y.$dialog.find(".ujifen-byfollow .ujifen-task-btn");
					1 == y.cache.followed ? (t.removeClass("no-follow"), t.hasClass("complete") || t.text("领取")) : (t.addClass("no-follow"), t.hasClass("complete") || t.text("关注"))
				}
			},
			userJiFenUpdate: function(e) {
				y.cache.mineNum = e || 0, y.$dialog.find(".mine-num").text(e)
			},
			userOnlineTaskRender: function() {
				if (y.cache.online && y.$dialog) {
					var e = y.$dialog.find(".ujifen-task-item.ujifen-bywatch"),
						t = y.cache.online;
					if (0 === e.length) return;
					var n = i.string.join('<div class="ujifen-task-intro">', '<span class="icon"></span>', '<span class="task-title">看直播领积分</span>', "<% if(hasNext == 1) {%>", '<span class="title-more">再看<span class="bywatch-time"><%= nextTime %></span>即可获得<span class="get-num"><%= nextJifen %></span>积分，加油~</span>', "<%} else {%>", '<span class="title-more">恭喜您完成今日的观看任务，明天再继续努力~</span>', "<%}%>", '<span class="task-reset-tips">(每日04:00重置此任务)</span>', "</div>", '<div class="ujifen-bywatch-detail">', '<div class="ujifen-watch-step-list clearfix">', "<% for(var i=0,j=list.length;i<j;i++){%>", "<% var item = list[i];%>", '<div class="ujifen-watch-step <%= i== j-1 ? "last-child" : ""%>">', '<div class="icon ', '<%= item.complete == 0 ? "disabled" : "" %> ', '<%= item.complete == 2 ? "chest-shake" : "" %>', '<%= item.complete == 3 ? "chest-open" : "" %>', '"></div>', '<div class="ujifen-task-btn <%= item.complete != 2 ? "not-satisfy" : "" %>"', ' data-taskid="<%= taskid %>" >', "<%= item.text %></div>", "</div>", "<%}%>", "</div>", '<div class="ujifen-watch-progress">', '<div class="progress-current" style="width:<%= width %>px">', "</div>", "</div>", "</div>"),
						s = a.compile(n),
						r = [32, 186, 342, 499, 530],
						o = r[0],
						l = [];
					t.otfl = +t.otfl, t.otpl = +t.otpl;
					for (var c = 1; 5 > c; c++) {
						var d = {
							complete: 0
						};
						c <= t.otfl && (d.text = "领取", d.complete = 2, o = r[c]), c == t.otfl + 1 && (d.text = "进行中", d.complete = 1), c > t.otfl + 1 && (d.text = "等待中", d.complete = 0), c <= t.otpl && (d.text = "已领取", d.complete = 3), l.push(d)
					}
					var u = 1;
					t.otfl >= 4 && (u = 0);
					var f = s({
						list: l,
						nextTime: Math.ceil(t.nls / 60) + "分钟",
						nextJifen: t.nlp,
						width: o,
						taskid: t.tid,
						hasNext: u
					});
					e.html(f).removeClass("hide")
				}
			},
			getTaskJiFen: function(t, i) {
				y.response({
					url: "/member/point_task/awardGameTask",
					type: "post",
					data: {
						room_id: $ROOM.room_id,
						task_id: t
					},
					success: function(t) {
						0 === +t.error ? (y.userJiFenUpdate(t.data.point), i && i(t.data)) : e.dialog.tips_black(t.data || "领取失败")
					},
					error: function() {
						e.dialog.tips_black("网络错误")
					}
				})
			},
			getOnlineJiFen: function(t, i) {
				y.response({
					url: "/member/point_task/getPoint",
					type: "post",
					data: {
						room_id: $ROOM.room_id,
						task_id: t
					},
					success: function(t) {
						0 === +t.error ? (e.dialog.tips_black(t.data.msg || "领取成功"), y.userJiFenUpdate(t.data.point), y.cache.online = t.data, y.userOnlineTaskRender(), i && i()) : e.dialog.tips_black(t.data || "领取失败")
					},
					error: function() {
						e.dialog.tips_black("网络错误")
					}
				})
			},
			userRecordReponse: function(e) {
				var t = y.$dialog.find(".selected-month"),
					i = {
						page: e,
						limit: 7,
						month: t.data("month"),
						year: t.data("year"),
						room_id: $ROOM.room_id
					};
				y.response({
					url: "/member/point_user/getExchangeGiftLog",
					data: i,
					success: function(e) {
						0 === +e.error && y.userRecordRender(e.data)
					}
				})
			},
			userRecordHide: function() {
				y.$dialog.removeClass("ujifen-record-dialog")
			},
			userRecordShow: function(e) {
				y.$dialog.addClass("ujifen-record-dialog");
				var t = i.string.join('<div class="ujifen-record-calender clearfix">', '<div class="ujifen-calender-select">', '<div class="ujifen-calender-current">', '<span class="icon calender"></span>', '<span class="current-text">本月</span>', '<span class="icon arrow"></span>', "</div>", '<ul class="ujifen-month-list">', "<% for(var j=0;j<monthList.length;j++){%>", "<% date = monthList[j]; %>", '<li class="select-month <%= date.month == selected ? "selected-month " : ""%>', '<%= date.month == currentMonth ? " current-month" : ""%>"', ' data-month="<%= date.month %>"  data-year="<%= date.year %>" >', '<%= date.month == currentMonth ? "本" : date.month %>月</li> ', "<%}%>", "</ul>", "</div>", "</div>", '<div class="ujifen-dialog-tabcont">', "</div>"),
					n = a.compile(t),
					s = (new Date).getMonth(),
					r = (new Date).getFullYear(),
					o = (s - 2 + 12) % 12 + 1,
					l = (s - 1 + 12) % 12 + 1;
				s++;
				var c = [{
					year: o > s ? r - 1 : r,
					month: o
				}, {
					year: l > s ? r - 1 : r,
					month: l
				}, {
					year: r,
					month: s
				}];
				"undefined" == typeof e && (e = s);
				var d = n({
					monthList: c,
					selected: e,
					currentMonth: s
				});
				y.$dialog.find(".ujifen-record-content").html(d), y.userRecordReponse(1)
			},
			userRecordRender: function(e) {
				var t = i.string.join('<div class="ujifen-record-list">', '<div class="ujifen-record-thead clearfix">', '<div class="ujifen-record-td exchange-time">兑换时间</div>    ', '<div class="ujifen-record-td exchange-desc">兑换信息</div>', '<div class="ujifen-record-td exchange-used">使用积分</div>    ', "</div>", '<div class="ujifen-record-tbody">', "<% if (list.length === 0) {%>", '<div class="ujifen-record-none">暂无记录</div>', "<%} else {%>", "<% for (var i = 0; i < list.length; i++) { %>", "<% var item = list[i]; %>", '<div class="ujifen-record-tr clearfix">', '<div class="ujifen-record-td exchange-time">', "<%= secondFormat(item.create_time) %></div>", '<div class="ujifen-record-td exchange-desc ellipsis" title="<%= item.name %>">', '<img src="<%= item.pic %>" class="desc-icon" /><%= item.name %></div>', '<div class="ujifen-record-td exchange-used">-<%= item.point %></div> ', "</div>", "<%}%>", "<%}%>", "</div>", "</div>", y.userPageRender()),
					n = a.compile(t),
					s = Math.ceil(e.total / 7),
					r = n({
						list: e.list || [],
						size: s,
						page: e.page
					});
				y.$dialog.find(".ujifen-record-content .ujifen-dialog-tabcont").html(r)
			},
			changeNextRecord: function() {
				var e = y.$dialog.find(".ujifen-record-content .ujifen-pagebar"),
					t = e.data("page") || 1,
					i = e.data("size");
				i > t && (t += 1), y.userRecordReponse(t)
			},
			changePrevRecord: function() {
				var e = y.$dialog.find(".ujifen-record-content .ujifen-pagebar"),
					t = e.data("page") || 1;
				t > 1 && (t -= 1), y.userRecordReponse(t)
			},
			userCenterRender: function() {
				var t = i.string.join('<div class="jifen-dialog-wrap">', '<div class="jifen-dialog ujifen-dialog">', '<div class="ujifen-dialog-title center-title">', '<a class="ujifen-help" href="/member/point/point_instruction" target="_blank">', '<span class="icon"></span>兑换中心说明', "</a>", '<span class="ujifen-title">礼品<span class="impt">兑换中心</span></span>', "</div>", '<div class="ujifen-dialog-title record-title">', '<a class="ujifen-back" href="javascript:;"><span class="icon"></span>返回</a>', '<span class="ujifen-title"><span class="impt">兑换</span>记录</span>', "</div>", '<div class="close-btn">&times;</div>', '<div class="ujifen-dialog-content ujifen-taball-content">', '<div class="ujifen-anchor-info">', '<img class="ujifen-anchor-head" src="<%= anchor.pic %>" >', '<div class="ujifen-anchor-name"><%= anchor.name %></div>', '<div class="ujifen-anchor-desc">“感谢你们每天都来看我直播，大家可以用积分免费兑换各大礼品~”</div>', '<div class="ujifen-anchor-btn">兑换记录</div>', "</div>", '<div class="ujifen-dialog-tabcont">', '<div class="ujifen-left-menu">', '<div class="ujifen-mine-num">', '<div class="icon"></div>', '<div class="mine-num"><%= mineNum %></div> ', '<div class="mine-text">我的积分</div>   ', "</div>", '<div class="ujifen-goods-tab <%= activeTab =="goods" ? "active" : "" %>">', '<div class="icon"></div>', '<div class="ujifen-tab-box cleafix">', '<div class="ujifen-tab-text1 fl">积分兑换</div>', '<div class="ujifen-tab-text2 fl">多种好礼随意换</div>', '<div class="ujifen-tab-arrow"></div>', "</div>", "</div>", '<div class="ujifen-task-tab <%= activeTab == "task" ? "active" : "" %>">', '<div class="icon"></div>', '<div class="ujifen-tab-box cleafix">', '<div class="ujifen-tab-text1 fl">积分任务</div>', '<div class="ujifen-tab-text2 fl">每日任务，轻松拿积分</div>', '<div class="ujifen-tab-arrow"></div>', "</div>", "</div>", '<div class="ujifen-exchange-dynamic">', "</div>", "</div>", '<div class="ujifen-tabcont-main js-ujifen-goods-box">', "</div>", '<div class="ujifen-tabcont-main js-ujifen-task-box">', "</div>", "</div>", "</div>", '<div class="ujifen-dialog-content ujifen-record-content" ></div>', "</div>", '<i class="after"></i>', "</div>"),
					n = a.compile(t),
					s = n({
						anchor: {
							pic: $ROOM.avatar.middle,
							name: $ROOM.owner_name
						},
						mineNum: y.cache.mineNum || 0,
						activeTab: y.cache.activeTab
					});
				y.$dialog = e(s), y.$container.append(y.$dialog)
			},
			userCenterDestroy: function() {
				clearInterval(y.marqueeTimer), y.$dialog.remove(), y.$dialog = null
			},
			userGuideShow: function() {
				var t = n.get("user-jifen-guide", 1) || 0;
				if (1 !== t) {
					var a = i.string.join('<div class="jifen-guide-dialog">', '<a href="javascript:;" class="close-btn js-anchor-guide-close"></a>', '<div class="content">', "<h2><span>礼品兑换中心</span>上线啦，<br />为心爱的主播打call</h2>", "<p>你可以到主播兑换中心兑换心仪礼品</p>", "</div>", "</div>");
					y.$guide = e(a), n.set("user-jifen-guide", 1), e(".js-jifen-enter-wrap").append(y.$guide), y.$guide.on("click", ".js-anchor-guide-close", function() {
						y.$guide.remove()
					})
				}
			}
		},
		b = {
			init: function(t) {
				this.config = e.extend(!0, {
					container: "#container",
					currentPage: 1,
					firstStatus: "anchorScoreFirstShow",
					showAnchorDialog: !1
				}, t), this.$container = e(this.config.container), this.$container.length && (this.render(), this.bindEvent())
			},
			render: function() {
				this.renderEnter(), n.get(this.config.firstStatus) || (this.renderGuide(), n.set(this.config.firstStatus, 1))
			},
			template: {
				guide: function() {
					return i.string.join('<div class="jifen-guide-dialog">', '<a href="javascript:;" class="close-btn js-anchor-guide-close"></a>', '<div class="content">', "<h2><span>礼品兑换中心</span>上线啦，<br />帮你留住粉丝，提高收入</h2>", "<p>水友可以到你的兑换中心兑换礼品</p>", "</div>", "</div>")
				},
				anchor: function() {
					return i.string.join('<div class="jifen-dialog-wrap">', '<div class="jifen-dialog jifen-anchor-dialog">', '<div class="jifen-anchor-head">', '<a href="/room/point/point_instruction" target="_blank" class="instruction"><i></i>兑换中心说明</a>', "<h2>我的<span>兑换中心</span></h2>", '<a href="javascript:;" class="close-btn js-anchor-dialog-close"></a>', "</div>", '<div class="jifen-anchor-info">', "<div>", '<div class="head">', '<img src="<%= data.anchorAvatar %>" alt="">', '<span class="head-mask"></span>', "</div>", '<div class="info">', '<div class="anchor-name"><%= data.anchorName %><span class="anchor-level-icon" data-anchor-levelimg="<%= data.anchorLevel %>"></span></div>', '<div class="slogan">“感谢你们每天都来看我直播，大家可以用积分免费兑换各大礼品~”</div>', "</div>", "</div>", '<a href="/room/point/my" target="_blank" class="jifen-btn center-my-btn">去个人中心添加礼品</a>', "</div>", '<div class="jifen-anchor-container" selector="jfanchor-container">', '<div class="loading"><img src="' + $SYS.web_url + 'app/douyu/res/page/room-normal/loading.gif" />正在加载中</div>', '<div class="jifen-anchor-box" selector="jfanchor-box"></div>', "</div>", "</div>", '<i class="after"></i>', "</div>")
				},
				empty: function() {
					return i.string.join('<div class="jifen-anchor-empty">', '<div class="empty-bg"></div>', '<a href="/room/point/official" target="_blank" class="jifen-btn center-official-btn">去官方礼品池</a>', "</div>")
				},
				list: function() {
					return i.string.join('<div class="jifen-anchor-gift" selector="jfanchor-list">', '<ul class="jifen-gift-list">', "<% var length = data.list.length || 0; %>", "<% for (var i = 0; i < length; i++) { %>", "<% var item = data.list[i]; %>", "<li>", '<% if(item.type == 2) { %> <span class="gift-user-type"></span> <% } %>', '<img src="<%= item.pic %>" alt="">', '<div class="gift-info">', '<div class="gift-name-box">', '<span class="tag <%= item.tagClasName %>-tag"><%= item.tagText %></span>', '<span class="gift-name" title="<%= item.name %>"><%= item.name %></span>', "</div>", '<div class="const-jifen"><span>积分<em><%= item.point %></em></span></div>', '<div class="gift-num"><span>库存<em><%= item.number %></em></span><span>已兑换<em><%= item.sold %></em></span></div>', "</div>", "</li>", "<% } %>", "</ul>", "<% if(data.totalPage > 1) { %>", '<div class="pagination">', '<a href="javascript:;" class="jifen-btn turn-btn <% if(data.isPrevDisable) { %> is-disable <% } %>" data-page="prev">上一页</a>', '<span class="current"><%= data.currentPage %></span>/<span class="all"><%= data.totalPage %></span>', '<a href="javascript:;" class="jifen-btn turn-btn <% if(data.isNextDisable) { %> is-disable <% } %>" data-page="next">下一页</a>', "</div>", "<% } %>", "</div>")
				},
				change: function() {
					return i.string.join('<div class="jifen-anchor-exchange">', '<span class="bg"></span>', '<div class="carousel-wrap">', '<ul class="clearfix">', "<% for (var i = 0, length = data.length; i < length; i++) { %>", "<% var item = data[i]; %>", '<li><span class="user-name" title="<%= item.nickname %>"><%= item.nickname %></span>兑换了<span class="gift" title="<%= item.name %>"><%= item.name %></span></li>', "<% } %>", "</ul>", "</div>", "</div>")
				}
			},
			renderEnter: function() {
				var i = this;
				i.$btn = e('<div class=" js-jifen-enter-wrap"><div class="jifen-enter-btn"></div></div>'), t.trigger("mod.chat.action.view.add", {
					flag: "jifen",
					dom: i.$btn,
					tips: "礼品兑换中心"
				}), i.$btn.show()
			},
			renderGuide: function() {
				var t = this;
				t.$anchorGuide = e(t.template.guide()), e(".js-jifen-enter-wrap").append(t.$anchorGuide), t.$anchorGuide.on("click", ".js-anchor-guide-close", function() {
					t.$anchorGuide.remove(), t.$anchorGuide = null
				})
			},
			renderScore: function() {
				var t = this;
				t.config.showAnchorDialog = !0, t.$anchorScore = e(a.compile(t.template.anchor())({
					data: {
						anchorAvatar: l.get("room.avatar.middle"),
						anchorName: l.get("room.owner_name"),
						anchorLevel: l.get("room.levelInfo.level")
					}
				})), t.$container.append(t.$anchorScore), t.$anchorScoreContainer = t.$anchorScore.find('[selector="jfanchor-container"]'), t.$anchorScoreBox = t.$anchorScoreContainer.find('[selector="jfanchor-box"]'), t.$anchorScore.on("click", ".js-anchor-dialog-close", function() {
					t.$anchorScore.off("click").remove(), t.config.currentPage = 1, t.config.showAnchorDialog = !1
				}), t.getListData()
			},
			getListData: function(e) {
				var t = this;
				t.getData("/member/point_anchor/getAnchorStoreGiftList", {
					page: t.config.currentPage
				}, function(i) {
					var a = i.data || {};
					0 === parseInt(i.error, 10) && parseInt(a.total, 10) > 0 ? (t.renderList(a), e || t.renderChange()) : e || t.$anchorScoreContainer.html(t.template.empty())
				})
			},
			turnPage: function(t) {
				var i = this;
				i.$anchorScoreContainer.off().on("click", ".turn-btn", function() {
					var a = e(this).data("page");
					"prev" === a && i.config.currentPage > 1 && (i.config.currentPage -= 1), "next" === a && i.config.currentPage < t && (i.config.currentPage += 1), i.getListData(!0)
				})
			},
			handleListData: function(t) {
				var a = t || {},
					n = a.list || [],
					s = {
						list: [],
						currentPage: parseInt(a.page, 10) || 1,
						totalPage: Math.ceil(t.total / t.limit) || 1
					};
				return s.isPrevDisable = s.currentPage <= 1, s.isNextDisable = s.currentPage >= s.totalPage, e.each(n, function(e, a) {
					var n, r = {};
					e >= parseInt(t.limit, 10) || (parseInt(a.type_is_official, 10) ? (r.tagClasName = "official", r.tagText = "官方") : (r.tagClasName = "anchor", r.tagText = "主播提供"), r.defaultImg = i.string.format("{0}app/douyu/res/page/room-normal/room-jifen/{1}_gift_default.jpg?v=20171024", l.get("sys.web_url"), r.tagClasName), a.pic ? (n = new Image, n.src = a.pic, n.onerror = function() {
						this.src = i.string.format("{0}app/douyu/res/page/room-normal/room-jifen/{1}_gift_default.jpg?v=20171024", l.get("sys.web_url"), r.tagClasName)
					}, r.pic = n.src) : r.pic = r.defaultImg, r.point = parseInt(a.point, 10) || 0, r.number = parseInt(a.remain_number, 10) || 0, r.sold = parseInt(a.sold_number, 10) || 0, r.name = a.name || "", r.type = parseInt(a.user_type, 10) || 1, s.list.push(r))
				}), s
			},
			renderList: function(e) {
				var t = this,
					i = t.handleListData(e),
					n = a.compile(t.template.list())({
						data: i
					});
				n && (t.$anchorScoreContainer.find(".loading").remove(), t.$anchorScoreBox.html(n), t.$anchorScoreBox.find(".jifen-gift-list").mCustomScrollbar("destroy").mCustomScrollbar(), t.turnPage(i.totalPage))
			},
			renderChange: function() {
				var e = this;
				e.getData("/point/gift/getExchangeDynamicTop10", {
					room_id: l.get("room.room_id")
				}, function(t) {
					var i = t.data || [],
						n = i.length;
					0 === parseInt(t.error, 10) && n && (e.$anchorScoreContainer.prepend(a.compile(e.template.change())({
						data: i
					})), n > 2 && (e.$carousel = e.$anchorScoreContainer.find(".carousel-wrap"), e.carousel()))
				})
			},
			getData: function(t, i, a) {
				v.getCSRFCookie(function(n) {
					var s = e.extend(!0, {}, i);
					s[n.name] = n.value, e.ajax({
						url: t || "",
						type: "POST",
						data: s,
						dataType: "json",
						async: !1,
						error: function() {
							e.dialog.tips_black("网络错误，稍后再试！")
						},
						success: function(t) {
							e.isFunction(a) && a(t)
						}
					})
				})
			},
			carousel: function() {
				function e() {
					s += 1, t.animate({
						marginTop: -(s * a)
					}, 600, function() {
						s >= n && (s = 0, t.css({
							marginTop: 0
						}))
					})
				}
				var t = this.$carousel.find("ul"),
					i = t.height(),
					a = this.$carousel.height(),
					n = Math.ceil(i / a),
					s = 0;
				this.$carousel.append(t.clone()), setInterval(function() {
					e()
				}, 5e3)
			},
			bindEvent: function() {
				var i = this;
				e(".jifen-enter-btn").on("click", function() {
					return t.trigger("dys", {
						key: "dys.room.jifen.giftbtn.click"
					}), c.check() ? void(i.config.showAnchorDialog || i.renderScore()) : void c.show("login")
				})
			}
		};
	return {
		init: function() {
			v.init()
		}
	}
}), define("douyu/page/room/normal/mod/motorcade", ["jquery", "douyu/context", "shark/observer", "shark/util/template/2.0", "shark/util/lang/1.0", "douyu/page/room/base/api", "shark/util/flash/data/1.0"], function(e, t, i, a, n, s, r) {
	var o = {
		enterArr: [],
		avatarDomain: t.get("sys.avatar_url"),
		defaultAvatar: t.get("sys.web_url") + "/app/douyu/res/com/defaultAvatar.png?v=20180110",
		vars: {
			embed: 0,
			chat: 0,
			flag: 0
		}
	},
		l = {
			renderMotorcadeEffect: function() {
				var e = ['<div class="motorcade-call-enter" style="bottom: 30px;">', '<div class="motorcade-enter" style="bottom: 0;">', '<div class="motorcade-user-icon">', '<img src="{{ handleAvatar(data.icon) }}">', "</div>", '<div class="motorcade-user-card">', '<div class="motorcade-card-main">', '<h2 title="{{ data.nn }}">{{ data.nn }}</h2>', "<p>正在召唤车队成员</p>", "</div>", "</div>", "</div>", "</div>"].join(""),
					t = a.compile(e);
				return t
			},
			handleAvatar: function(e) {
				var t = o.defaultAvatar;
				return e && (t = n.string.format("{0}upload/{1}_middle.jpg", o.avatarDomain, e)), t
			}
		},
		c = {
			init: function() {
				this.renderHtml = {
					renderMotorcadeEffect: l.renderMotorcadeEffect()
				}, s.reg("room_data_handler", function(e) {
					var t = r.decode(e).too();
					"clubcall" === t.type && c.motorcadeCall(t)
				}), i.on("mod.chat.success", function(e) {
					if (o.vars[e] = 1, !o.vars.flag && o.vars.embed && o.vars.chat) {
						var t = window.embedMsg;
						if (t && t.driverInPlace) try {
							t.driverInPlace()
						} catch (i) {} finally {
							o.vars.flag = 1
						}
					}
				})
			},
			motorcadeCall: function(e) {
				return e ? void(o.enterArr.length ? o.enterArr.push(e) : (o.enterArr.push(e), c.appendMotorcadeEffect(e))) : config
			},
			appendMotorcadeEffect: function(t) {
				var i = this,
					a = i.renderHtml.renderMotorcadeEffect({
						data: t,
						handleAvatar: l.handleAvatar
					}),
					n = e(a);
				e("#js-chat-cont").append(n), n.animate({
					bottom: 0
				}, 500, function() {
					setTimeout(function() {
						n.remove(), o.enterArr.splice(0, 1), o.enterArr.length && i.appendMotorcadeEffect(o.enterArr[0])
					}, 5e3)
				})
			}
		};
	return {
		init: function() {
			c.init()
		}
	}
}), define("douyu/page/room/normal/mod/rec-video", ["jquery", "shark/observer", "douyu/context", "shark/util/template/1.0", "douyu/com/insight"], function(e, t, i, a, n) {
	var s = a.compile(['<ul class="lives" data-type="lives">', "<% for(var i=0; i<data.length;i++){%>", "<% var item = data[i]; %>", '<li class="live <%= className %>">', '<div class="">', '<a href="' + $SYS.vsite_url + '/show/<%= item.hash_id %>" target="_blank" title="<%= item.title %>" data-rt="<%= item.ranktype %>" data-subrt="<%= item.recomType %>" data-vid="<%= item.vid %>" data-type="<%= item.rtype %>" data-tid="<%= item.cid2%>" data-rpos="<%= item.rpos%>" data-hashid="<%= item.hash_id %>">', '<div class="live-preview">', '<div class="img-box-cont">', '<img src="<%= item.video_pic%>" >', '<i class="play" ></i>', "</div>", "<% if(item.is_short == 1){ %>", '<div class="duration short-video"><span></span><em>短视频</em></div>', "<%} else { %>", '<div class="duration"><span></span><em><%= formatDuration(item.video_duration) %></em></div>', "<%}%>", "</div>", '<div class="live-details">', "<% if(item.is_short == 1){ %>", "<% if(item.contents || item.topicTitle){ %>", '<h3 class="live-title"><%= item.contents ? item.contents : item.topicTitle  %></h3>', "<% }%>", '<div class="live-info">', '<span class="u-name"><i class="icon"></i><%= item.author %></span>', '<span class="w-num"><i class="icon"></i><%= item.view_num %></span>', "</div>", "<% if(item.is_short == 1 && !item.contents && !item.topicTitle){ %>", '<h3 class="live-title">&nbsp;&nbsp;&nbsp;&nbsp;</h3>', "<%}%>", "<%} else { %>", '<h3 class="live-title"><%= item.title %></h3>', '<div class="live-info">', '<span class="u-name"><i class="icon"></i><%= item.author %></span>', '<span class="w-num"><i class="icon"></i><%= item.view_num %></span>', "</div>", "<%}%>", "</div>", "<% if(item.isLive === true) {%>", '<div class="icon watch-back">回看</div>', "<%}%>", "</a>", "</div>", "</li>", "<%}%>", "</ul>"].join("")),
		r = {
			render: s,
			init: function(a) {
				var s = {
					selector: ".tab-content.video",
					className: ""
				};
				this.config = e.extend({}, s, a), n.build({
					selectors: this.config.selector,
					appear: function() {
						e.ajax({
							url: "/swf_api/getRoomRecommVod/" + i.get("room.room_id"),
							type: "GET",
							dataType: "json",
							success: r.ajaxSuccess
						})
					}
				}), e("#js-recommand .tab-header .contribute").on("click", function() {
					t.trigger("dys", {
						key: "mod.normal.recom.hotv.click"
					})
				})
			},
			formatDuration: function(e) {
				var t = parseInt(e, 10),
					i = parseInt(t % 60),
					a = parseInt(t / 60),
					a = a > 9 ? a : "0" + a;
				i = i > 9 ? i : "0" + i;
				var n = "mm:ss";
				return n = n.replace("mm", a), n = n.replace("ss", i)
			},
			ajaxSuccess: function(i) {
				if (0 === i.error && i.data && i.data.length > 0) {
					i.className = r.config.className, i.formatDuration = r.formatDuration;
					var a = r.render(i);
					e(r.config.selector).html(a), t.trigger("mod.normal.recommand.layout"), e('[data-target="video"] li.live a').each(function(i, a) {
						t.trigger("dys", {
							key: "dys.room.recom.show",
							pos: e(a).closest("li").index() + 1,
							vid: e(a).data("vid"),
							rt: e(a).data("rt"),
							tid: e(a).data("tid"),
							rpos: e(a).data("rpos"),
							sub_rt: e(a).data("subrt")
						}), e(a).on("mousedown", function() {
							t.trigger("dys", {
								key: "dys.room.recom.click",
								pos: e(a).closest("li").index() + 1,
								vid: e(a).data("vid"),
								rt: e(a).data("rt"),
								tid: e(a).data("tid"),
								rpos: e(a).data("rpos"),
								sub_rt: e(a).data("subrt")
							})
						})
					})
				}
			}
		};
	return r
}), define("douyu/page/room/normal/mod/recommended", ["jquery", "shark/observer"], function(e, t) {
	var i = {
		videoWidht: 283,
		promoteCount: 3
	},
		a = {},
		n = {};
	return a.init = function() {
		a.$recommand = e("#js-recommand"), a.$trigger = a.$recommand.find('[data-type="trigger"]'), a.$target = a.$recommand.find('[data-type="target"]'), a.$promote = a.$recommand.find('[data-target="promote"]'), a.$video = a.$recommand.find('[data-target="video"]'), a.$equalLeft = e("#js-live-room-normal-equal-left"), a.$equalRight = e("#js-live-room-normal-equal-right"), a.$seprator = a.$recommand.find(".other").find(".sperator"), a.layout(), t.on("mod.normal.recommand.layout", function() {
			a.layout()
		})
	}, a.layout = function() {
		a.$promote.length && !a.$promote.hasClass("hide") && (a.$promos = a.$promote.find('[data-type="promos"]'), i.promoteBoxWidht = a.$promos.width(), i.promoteRow = Math.floor(i.promoteBoxWidht / i.promoteWidht), a.promoteLayout()), a.$video.length && !a.$video.hasClass("hide") && (a.$lives = a.$video.find('[data-type="lives"]'), i.livesBoxWidht = a.$lives.width(), i.livesRow = Math.floor(i.livesBoxWidht / i.videoWidht), a.videoLayout())
	}, a.promoteLayout = function() {
		var t = a.$promos.width(),
			n = 30 * i.promoteCount,
			s = (t - n) / i.promoteCount,
			r = 204 / 362 * s;
		a.$promos.each(function() {
			e(this).find("li").each(function(t) {
				e(this).css({
					width: s,
					height: r
				})
			})
		}), a.$seprator.css({
			width: t + 30
		})
	}, a.videoLayout = function() {
		var t = a.$lives.width(),
			i = t / Math.ceil(t / 283) - 20;
		a.$lives.find("li").each(function() {
			e(this).width(i);
			var t = i - 2,
				a = t / 16 * 9;
			e(this).find("img").height(a);
			var n = (a - 50) / 2,
				s = (t - 50) / 2;
			e(this).find(".play").css({
				left: s,
				top: n
			})
		})
	}, n.init = function() {
		var t = "Mac68K" == navigator.platform || "MacPPC" == navigator.platform || "Macintosh" == navigator.platform || "MacIntel" == navigator.platform;
		if (t && window.ZeroClipboard) {
			var i = e(".join-qq"),
				n = i.find("a");
			i.css("position", "relative"), ZeroClipboard.config({
				swfPath: $SYS.web_url + "app/douyu/third/zclip-2.02/ZeroClipboard.swf?20171011"
			});
			var s = new ZeroClipboard(n);
			s.on("copy", function(t) {
				if (s.setText(n.data("qqgroup") + ""), "1" === n.data("lock")) return !1;
				n.data("lock", "1");
				var a = e('<div style="position:absolute;left:37px;top:58px;width:240px;padding:5px 10px;line-height:16px;background:rgba(0,0,0,0.5);text-align:center;color:#fff;border-radius:4px;font-size:14px">QQ for Mac暂不支持一键加群功能<br>已为您将群号复制至剪贴板</div>').appendTo(i);
				a.delay(1500).animate({
					opacity: 0
				}, 300, function() {
					a.remove(), n.data("lock", "0")
				})
			}), n.on("click", function() {
				return !1
			})
		}
		a.$recommand.on("click", '[data-type="trigger"]', function(t) {
			t.preventDefault(), t.stopPropagation();
			var i = e(this),
				n = i.data("trigger");
			a.$trigger.removeClass("current"), a.$target.addClass("hide"), i.addClass("current"), a.$recommand.find('[data-target="' + n + '"]').removeClass("hide"), a.layout();
			var s = a.$equalLeft.height(),
				r = a.$equalRight.height();
			a.$equalLeft.css({
				"min-height": r > s ? r : ""
			})
		}), a.$recommand.find('[data-type="trigger"]').eq(0).trigger("click")
	}, {
		init: function() {
			a.init(), n.init()
		}
	}
}), define("douyu/page/room/normal/mod/guide", ["jquery", "shark/observer", "douyu/context", "douyu/com/user", "douyu/page/room/base/api"], function(e, t, i, a, n) {
	var s = {
		chat: {
			isLogin: a.check(),
			isShow: !1,
			$target: e("#js-chat-speak")
		},
		curBody: e("body")
	};
	return Guide = function(e) {
		this.init(e)
	}, e.extend(!0, Guide.prototype, {
		init: function(t) {
			this.config = e.extend(!0, {
				speed: 6e5,
				delay: !0
			}, t), this.showWatch(), this.bindEvt()
		},
		interval: function(e, t, i) {
			var a = this;
			this.timer = setTimeout(function() {
				e() !== !1 && a.interval(e, t)
			}, t), i === !0 && e()
		},
		render: function() {
			var e = this;
			Number(i.get("sys.uid")) !== Number(i.get("room.owner_uid")) && this.interval(function() {
				e._runtime()
			}, this.config.speed, !this.config.delay)
		},
		_runtime: function() {
			s.chat.isShow || s.chat.isLogin || this.chat()
		},
		chat: function() {
			this.$chat = e('<div class="' + this.randomClass() + '"><div class="lead-close" data-type="live-lead-close"></div></div>'), s.chat.$target.append(this.$chat), s.chat.isShow = !0
		},
		randomClass: function() {
			var e = ["live-lead", "live-lead live-yw-lead", "live-lead live-quality-lead", "live-lead live-focus-lead", "live-lead live-share-lead"];
			return e[Math.ceil(Math.random() * e.length) - 1]
		},
		relayout: function() {
			if (this.$chat) {
				var e = s.chat.$target.offset();
				this.$chat.css({
					left: e.left,
					top: e.top - this.$chat.outerHeight(!0)
				})
			}
		},
		bindEvt: function() {
			var i = this;
			e(document).on("click", '[data-type="live-lead-close"]', function(e) {
				e.preventDefault(), e.stopPropagation(), i.$chat.hide().remove(), s.chat.isShow = !1, t.trigger("dys", {
					key: "dys.room.guide.close"
				})
			}).on("click", ".live-lead", function(e) {
				e.preventDefault(), a.show("login", {
					source: "click_msg_login_remind"
				}), t.trigger("dys", {
					key: "dys.room.guide.click"
				}), a.show("login", {
					source: "click_msg_login_remind"
				})
			}), e(window).resize(function() {
				i.relayout()
			})
		},
		showWatchTpl: function(t) {
			var i = this;
			i.videoContent = e("#js-room-video");
			var s = '<div class="show-watch" data-watch-content="content"><div class="close"><a href="#" data-watch-close="btn">关闭</a></div><div class="lead-txt" data-watch-content="txt"><div class="watchtxt"><p class="start"><span data-watch-time="second">5S</span>后将切换为 普通画质</p><p class="end">已切换为 普通画质</p><h4>登录继续畅享 超/高清画质</h4></div><div class="watchbtn"><a class="abtn1" href="#" data-watch-btn="login">登录</a><a class="abtn2" href="#" data-watch-btn="register">注册</a></div><div class="watchdown"><a target="_blank" href="/client" >[ 下载APP畅享超清 ]</a></div></div><div class="lead-txt hide" data-watch-content="normal"><div class="watchtxt"><p>当前观看的是普通画质</p><h4>登录继续畅享 超/高清画质</h4></div><div class="watchbtn"><a class="abtn1" href="#" data-watch-btn="login">登录</a><a class="abtn2" href="#" data-watch-btn="register">注册</a></div><div class="watchdown"><a target="_blank" href="/client">[ 下载APP畅享超清 ]</a></div></div></div>';
			e(".show-watch").remove(), i.videoContent.append(s), i.timSecond = e('[data-watch-time="second"]'), e('[data-watch-close="btn"]').on("click", function() {
				return e('[data-watch-content="content"]').hide(), n.exe("js_timeLoginTip"), !1
			}), e('[data-watch-btn="login"]').on("click", function() {
				return a.show("login"), !1
			}), e('[data-watch-btn="register"]').on("click", function() {
				return a.show("reg"), !1
			}), t ? (e('[data-watch-content="txt"]').removeClass("hide"), e('[data-watch-content="normal"]').addClass("hide")) : (e('[data-watch-content="txt"]').addClass("hide"), e('[data-watch-content="normal"]').removeClass("hide"))
		},
		showWatch: function() {
			var e = this;
			n.reg("room_bus_showwatchtipdown", function() {
				e.showWatchTpl(!0), e.showWatchtips()
			}), n.reg("room_bus_showwatchtip", function() {
				e.showWatchTpl(!1)
			})
		},
		showWatchtips: function() {
			var t = this,
				i = 5;
			this.watchTimer = setInterval(function() {
				return i--, 0 > i ? (clearInterval(t.watchTimer), e('[data-watch-content="txt"]').addClass("hide"), e('[data-watch-content="normal"]').removeClass("hide"), void n.exe("js_switchStream")) : void t.timSecond.html(i + "S")
			}, 1e3)
		}
	}), {
		init: function(e) {
			return new Guide(e)
		}
	}
}), define("douyu/page/room/normal/mod/filter-keywords", ["jquery", "shark/observer", "shark/util/storage/1.0", "douyu/context", "douyu/page/room/base/api"], function(e, t, i, a, n) {
	var s = "c_filter_keywords_data",
		r = {
			localData: {
				globalKw: [],
				roomKw: {},
				keywordsFilter: 0,
				levelFilter: 0,
				levelLimit: ""
			},
			config: {
				roomId: parseInt(a.get("room.room_id"), 10) || 0,
				curScope: "global",
				curRoomKWData: [],
				noKwsRoomTx: "本房间",
				noKwsAllRoomTx: "全站",
				maxRoomNums: 20,
				maxKWNums: 20,
				maxKWLength: 10,
				roomNums: 0,
				switchStatus: {
					0: "未开启",
					1: "已开启"
				},
				tip1: "最多添加20个关键词",
				tip2: "请勿添加重复的关键词",
				tip3: "关键词长度最多为10个字",
				tip4: "最多设置20个直播间",
				tip5: "当前仅支持屏蔽0~30级用户"
			},
			doms: {
				$jsFilterKeyWords: e("#js-filter-keywords")
			},
			init: function() {
				this.clickFilterKeywordsBtn()
			},
			dys: function(e) {
				t.trigger("dys", e)
			},
			clickFilterKeywordsBtn: function() {
				var t = this;
				this.doms.$jsFilterKeyWords.find(".filter-keywords-btn").off().on("click", function() {
					var i = e("#room-filter-keywords-wrap");
					1 === i.length ? (i.remove(), t.config.curScope = "room") : t.renderMainHtml(), t.dys({
						key: "dys.room.filterkeywords.enterbtn"
					})
				})
			},
			renderMainHtml: function() {
				this.getKeywordsData(), this.doms.$jsFilterKeyWords.append(this.render()), this.getDoms(), this.renderRoomKeywordsHtml(), this.renderSwitchStatus(), this.addScrollBar(), this.bindEvent()
			},
			getKeywordsData: function() {
				var e = i.get(s);
				this.localData = e ? "string" == typeof e ? JSON.parse(e) : e : this.localData, this.config.curRoomKWData = this.localData.roomKw[this.config.roomId] || [], this.getCurRoomNums(this.localData.roomKw)
			},
			getDoms: function() {
				this.doms.$roomFilterKwsWrap = e("#room-filter-keywords-wrap"), this.doms = e.extend(this.doms, {
					$roomFilterClose: this.doms.$roomFilterKwsWrap.find(".room-filter-close"),
					$roomFilterTabs: this.doms.$roomFilterKwsWrap.find(".room-filter-tabs"),
					$roomFilterContent: this.doms.$roomFilterKwsWrap.find(".room-filter-content"),
					$noKeywordsBox: this.doms.$roomFilterKwsWrap.find(".no-keywords-box"),
					$curKeywordsNums: this.doms.$roomFilterKwsWrap.find(".cur-keywords-nums"),
					$roomFilterInput: this.doms.$roomFilterKwsWrap.find(".room-filter-input"),
					$roomFilterAdd: this.doms.$roomFilterKwsWrap.find(".room-filter-add"),
					$fkMcBox: this.doms.$roomFilterKwsWrap.find(".fk-mc-box"),
					$filKeyMainContent: this.doms.$roomFilterKwsWrap.find(".filter-keywords-main-content"),
					$curFilterScope: this.doms.$roomFilterKwsWrap.find(".cur-filter-scope"),
					$switch: this.doms.$roomFilterKwsWrap.find(".room-filter-switch"),
					$roomFilterLevelInput: this.doms.$roomFilterKwsWrap.find(".room-level-filter-input")
				})
			},
			getCurRoomNums: function(e) {
				var t = 0;
				for (var i in e) t++;
				this.config.roomNums = t
			},
			renderRoomKeywordsHtml: function() {
				var e = this.localData.globalKw || [];
				e.length > 0 ? (this.doms.$curKeywordsNums.text(e.length), this.renderKeywordsHtml(e)) : this.isShowKeywordsContent(!1)
			},
			renderSwitchStatus: function() {
				var e = ["level", "keywords"],
					t = this.doms.$roomFilterKwsWrap;
				this.doms.$roomFilterLevelInput.val(this.localData.levelLimit);
				for (var i = 0, a = e.length; a > i; i++) {
					var n = e[i],
						s = t.find("[data-channel=" + n + "]"),
						r = t.find("[data-switch-status=" + n + "]");
					1 === this.localData[n + "Filter"] ? (s.addClass("is-checked"), r.addClass("on").text(this.config.switchStatus[1])) : (s.removeClass("is-checked"), r.removeClass("on").text(this.config.switchStatus[0]))
				}
			},
			addScrollBar: function() {
				this.doms.$fkMcBox.mCustomScrollbar()
			},
			bindEvent: function() {
				this.clickCloseBtn(), this.clickTabsNav(), this.clickAddBtn(), this.clickDeleteBtn(), this.clickSwitch(), this.lelveEdit()
			},
			clickCloseBtn: function() {
				var e = this;
				this.doms.$roomFilterClose.off().on("click", function() {
					e.doms.$roomFilterKwsWrap.remove(), e.config.curScope = "global"
				})
			},
			clickTabsNav: function() {
				var t = this;
				this.doms.$roomFilterTabs.off().on("click", ".room-filter-tab", function() {
					var i = e(this).data("scope"),
						a = t.config.curScope;
					a !== i && (e(this).addClass("active").siblings().removeClass("active"), "room" === i ? (t.config.curScope = "room", t.handleDataIsEmpty(t.config.curRoomKWData, t.config.noKwsRoomTx)) : (t.config.curScope = "global", t.handleDataIsEmpty(t.localData.globalKw, t.config.noKwsAllRoomTx)))
				})
			},
			handleDataIsEmpty: function(e, t) {
				var e = e || [];
				e.length > 0 ? (this.isShowKeywordsContent(!0), this.doms.$curKeywordsNums.text(e.length), this.renderKeywordsHtml(e)) : (this.isShowKeywordsContent(!1), this.changeTipText(t)), this.doms.$curFilterScope.text(t)
			},
			clickAddBtn: function() {
				var e = this;
				this.doms.$roomFilterAdd.off().on("click", function() {
					var t = e.doms.$roomFilterInput.val();
					if (e.dys({
						key: "dys.room.filterkeywords.addbtn",
						kv: t,
						type: "room" === e.config.curScope ? 1 : 0
					}), 0 !== t.length) {
						if (t.length > e.config.maxKWLength) return void e.showTipBox(e.config.tip3);
						if ("room" === e.config.curScope) {
							if (e.isExceedMaxRoomNum()) return;
							if (e.isValidCondition(e.config.curRoomKWData, t)) return;
							e.config.curRoomKWData.push(t), e.localData.roomKw[e.config.roomId] || e.config.roomNums++, e.localData.roomKw[e.config.roomId] = e.config.curRoomKWData, e.handleAddRenderData(e.config.curRoomKWData)
						} else {
							if (e.isValidCondition(e.localData.globalKw, t)) return;
							e.localData.globalKw.push(t), e.handleAddRenderData(e.localData.globalKw)
						}
						i.set(s, JSON.stringify(e.localData)), n.exe("js_filterKeywords", e.localData), e.doms.$roomFilterInput.val("")
					}
				})
			},
			clickSwitch: function() {
				var t = this,
					a = i.get(s);
				this.localData = a ? "string" == typeof a ? JSON.parse(a) : a : this.localData, this.doms.$switch.off().on("click", function() {
					var a = e(this).data("channel"),
						r = t.doms.$roomFilterKwsWrap.find("[data-switch-status=" + a + "]"),
						o = a + "Filter";
					e(this).hasClass("is-checked") ? (t.localData[o] = 0, e(this).removeClass("is-checked"), r.removeClass("on").text(t.config.switchStatus[0]), "level" === a && (t.doms.$roomFilterLevelInput.val(""), t.localData.levelLimit = "")) : (t.localData[o] = 1, e(this).addClass("is-checked"), r.addClass("on").text(t.config.switchStatus[1]), "level" === a && t.doms.$roomFilterLevelInput.focus()), i.set(s, JSON.stringify(t.localData)), n.exe("js_filterKeywords", t.localData)
				})
			},
			lelveEdit: function() {
				var t = this,
					a = i.get(s);
				this.localData = a ? "string" == typeof a ? JSON.parse(a) : a : this.localData, this.doms.$roomFilterLevelInput.off().on("blur", function() {
					var a, r = +e.trim(e(this).val()) || "",
						o = t.doms.$roomFilterKwsWrap.find('[data-channel="level"]'),
						l = t.doms.$roomFilterKwsWrap.find('[data-switch-status="level"]');
					r && (+r > 30 && (t.showTipBox(t.config.tip5), r = 30, e(this).val(30), t.localData.levelLimit = 30), o.hasClass("is-checked") || (a && clearTimeout(a), a = setTimeout(function() {
						o.addClass("is-checked"), l.addClass("on").text(t.config.switchStatus[1])
					}, 350)), t.localData.levelFilter = 1), !r && o.hasClass("is-checked") && (a && clearTimeout(a), a = setTimeout(function() {
						o.removeClass("is-checked"), l.removeClass("on").text(t.config.switchStatus[0])
					}, 350), e(this).val(""), t.localData.levelFilter = 0), t.localData.levelLimit = r, i.set(s, JSON.stringify(t.localData)), n.exe("js_filterKeywords", t.localData)
				})
			},
			isExceedMaxRoomNum: function() {
				return this.localData.roomKw[this.config.roomId] ? !1 : this.config.roomNums >= this.config.maxRoomNums ? (this.showTipBox(this.config.tip4), !0) : void 0
			},
			isValidCondition: function(e, t) {
				return e.length >= this.config.maxKWNums ? (this.showTipBox(this.config.tip1), !0) : this.isRepeatAddKeyword(e, t, !1) ? (this.showTipBox(this.config.tip2), !0) : !1
			},
			handleAddRenderData: function(e) {
				this.isShowKeywordsContent(!0), this.doms.$curKeywordsNums.text(e.length), this.renderKeywordsHtml(e)
			},
			clickDeleteBtn: function() {
				var t = this;
				this.doms.$filKeyMainContent.off().on("click", ".room-filter-delete", function() {
					var a = e(this).parent().find(".room-filter-list").text();
					e(this).parent().remove(), t.dys({
						key: "dys.room.filterkeywords.deletebtn",
						kv: a,
						type: "room" === t.config.curScope ? 1 : 0
					}), "room" === t.config.curScope ? (t.handleDeleteData(t.config.curRoomKWData, a, t.config.noKwsRoomTx), t.localData.roomKw[t.config.roomId] = t.config.curRoomKWData, 0 === t.config.curRoomKWData.length && (delete t.localData.roomKw[t.config.roomId], t.config.roomNums--)) : t.handleDeleteData(t.localData.globalKw, a, t.config.noKwsAllRoomTx), i.set(s, JSON.stringify(t.localData)), n.exe("js_filterKeywords", t.localData)
				})
			},
			handleDeleteData: function(e, t, i) {
				var a = this.isRepeatAddKeyword(e, t, !0);
				e.splice(a, 1), this.doms.$curKeywordsNums.text(e.length), 0 === e.length && (this.isShowKeywordsContent(!1), this.changeTipText(i))
			},
			isRepeatAddKeyword: function(e, t, i) {
				if (e = e || [], 0 === e.length) return !1;
				for (var a = 0, n = e.length; n > a; a++) if (e[a] === t) return i ? a : !0;
				return !1
			},
			renderKeywordsHtml: function(e) {
				for (var t = "", i = 0, a = e.length; a > i; i++) t += this.renderKeywords(e[i]);
				this.doms.$filKeyMainContent.html(t)
			},
			changeTipText: function(e) {
				this.doms.$noKeywordsBox.find(".title-scope-name").text(e), this.doms.$noKeywordsBox.find(".tip-scope-name").text(e)
			},
			showTipBox: function(t) {
				var i = this.doms.$roomFilterKwsWrap.find(".fk-error-tip");
				i.length > 0 || (this.doms.$roomFilterKwsWrap.append(this.renderTip(t)), setTimeout(function() {
					e("#room-filter-keywords-wrap .fk-error-tip").remove()
				}, 2e3))
			},
			isShowKeywordsContent: function(e) {
				e ? (this.doms.$roomFilterContent.removeClass("active"), this.doms.$noKeywordsBox.removeClass("active")) : (this.doms.$roomFilterContent.addClass("active"), this.doms.$noKeywordsBox.addClass("active"))
			},
			render: function() {
				var e = ['<div id="room-filter-keywords-wrap" class="room-filter-keywords-wrap">', '<div class="room-filter-close"></div>', '<div class="room-filter-header">', '<div class="room-filter-status">', "<h3>等级屏蔽</h3>", '<span class="room-filter-switch" data-channel="level"><span class="room-filter-inner"></span></span>', '<span class="room-filter-switch-status" data-switch-status="level">未开启</span>', "</div>", '<div class="room-level-filter">', '<p>屏蔽<input class="room-level-filter-input" type="text" placeholder="1~30" maxlength="2" onkeyup="this.value=this.value.replace(/[^\\d]/g, \'\')" onpaste="this.value=this.value.replace(/[^\\d]/g, \'\')" />级及以下用户的弹幕</p>', "</div>", '<div class="room-filter-status">', "<h3>关键词屏蔽</h3>", '<span class="room-filter-switch" data-channel="keywords"><span class="room-filter-inner"></span></span>', '<span class="room-filter-switch-status" data-switch-status="keywords">未开启</span>', "</div>", '<div class="room-filter-tabs">', '<div class="room-filter-tab first active" data-scope="global">全站</div>', '<div class="room-filter-tab last" data-scope="room">本房间</div>', "</div>", "</div>", '<div class="room-filter-footer">', '<input class="room-filter-input" type="text" placeholder="请输入关键词（支持通配符*、？）" maxlength="10" />', '<div class="room-filter-add">添加</div>', "</div>", '<div class="room-filter-content">', '<p class="filter-keywords-title"><span class="cur-filter-scope">全站</span>过滤包含以下关键词的弹幕（<span class="cur-keywords-nums">10</span>/20）</p>', '<div class="fk-mc-box">', '<ul class="filter-keywords-main-content">', "</ul>", "</div>", "</div>", '<div class="no-keywords-box">', '<p class="nkb-title"><span class="title-scope-name">全站</span>没有被过滤的关键词</p>', '<p class="nkb-tip">设置后<span class="tip-scope-name">全站</span>包含关键词的弹幕对您不可见</p>', "</div>", "</div>"].join("");
				return e
			},
			renderKeywords: function(e) {
				var t = e || "";
				t = t.replace(/</g, "&lt;").replace(/>/g, "&gt;");
				var i = ["<li>", '<span class="room-filter-list-icon"></span>', '<span class="room-filter-list"><pre>', t, "</pre></span>", '<span class="room-filter-delete"></span>', "</li>"].join("");
				return i
			},
			renderTip: function(e) {
				var t = '<div class="fk-error-tip"><div class="fk-tip-content-box"><span class="fk-tip-content">' + e + "</span></div></div>";
				return t
			}
		};
	return {
		init: function() {
			r.init(), t.on("mod.room.filter.keywords.set", function() {
				var e = i.get(s),
					t = e ? "string" == typeof e ? JSON.parse(e) : e : r.localData;
				n.exe("js_filterKeywords", t)
			})
		}
	}
});